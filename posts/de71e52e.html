<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/favicons/tool-logo.png"><link rel="icon" href="/favicons/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="msvalidate.01" content="6CDECB7628FCAB6B2809D0BB2021D458"><meta name="google-site-verification" content="-aHgnC4GpgdSy24VC2beoxvaFnCzmcyt_Z8p2ZnILy0"><meta name="theme-color" content="#2f4154"><meta name="author" content="guosec"><meta name="keywords" content="guosec,学习笔记,blog,漏洞复现"><meta name="description" content="原文：https:&#x2F;&#x2F;www.proofpoint.com&#x2F;us&#x2F;blog&#x2F;threat-insight&#x2F;bumblebee-is-still-transforming 重要发现  Proofpoint 监测到了一个名为 BumbleBee 的新恶意软件加载程序，该加载器由多个犯罪威胁组织在使用，观察到以往这些犯罪威胁者提供基本加载器(BazaLoader)和IcedID。 一些常用BazaLoa"><meta property="og:type" content="article"><meta property="og:title" content="BumbleBee-大黄蜂"><meta property="og:url" content="https://guosec.online/posts/de71e52e.html"><meta property="og:site_name" content="InfoSec&#39;s Blog"><meta property="og:description" content="原文：https:&#x2F;&#x2F;www.proofpoint.com&#x2F;us&#x2F;blog&#x2F;threat-insight&#x2F;bumblebee-is-still-transforming 重要发现  Proofpoint 监测到了一个名为 BumbleBee 的新恶意软件加载程序，该加载器由多个犯罪威胁组织在使用，观察到以往这些犯罪威胁者提供基本加载器(BazaLoader)和IcedID。 一些常用BazaLoa"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://rmt.ladydaily.com/fetch/fluid/storage/hexo-static/cover.jpg?w=480&fmt=webp"><meta property="article:published_time" content="2022-08-20T13:10:44.000Z"><meta property="article:modified_time" content="2023-05-07T05:54:43.740Z"><meta property="article:author" content="guosec"><meta property="article:tag" content="guosec,学习笔记,blog,漏洞复现"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://rmt.ladydaily.com/fetch/fluid/storage/hexo-static/cover.jpg?w=480&fmt=webp"><title>BumbleBee-大黄蜂 - InfoSec&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/macpanel.css"><link rel="stylesheet" href="/css/hbe.style.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"guosec.online",root:"/",version:"1.9.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 7.0.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>InfoSec&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>Links</span></a></li><li class="nav-item"><a class="nav-link" href="https://guosec.online/tools-pages/"><i class="iconfont icon-briefcase"></i> <span>Tools</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://rmt.ladydaily.com/fetch/fluid/storage/hexo-static/cover.jpg?w=480&fmt=webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="BumbleBee-大黄蜂"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-08-20 21:10" pubdate>August 20, 2022 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.9k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 6 mins</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">BumbleBee-大黄蜂</h1><p class="note note-info">Last updated on 8 months ago</p><div class="markdown-body"><p>原文：<a target="_blank" rel="noopener" href="https://www.proofpoint.com/us/blog/threat-insight/bumblebee-is-still-transforming">https://www.proofpoint.com/us/blog/threat-insight/bumblebee-is-still-transforming</a></p><h2 id="重要发现">重要发现</h2><ul><li>Proofpoint 监测到了一个名为 BumbleBee 的新恶意软件加载程序，该加载器由多个犯罪威胁组织在使用，观察到以往这些犯罪威胁者提供基本加载器(BazaLoader)和IcedID。</li><li>一些常用BazaLoader的威胁攻击者已经过度到 BumbleBee 。从2022年2月开始，BazaLoader 尚未出现在Proofpoint数据中。</li><li>BumbleBee 处于维护中，并使用复杂的规避技术，如反虚拟化。</li><li>与大多数使用进程空心化或DLL注入的其他如意软件不同，此加载器利用了异步过程调用（APC）注入从命令和控件（C2）接收的命令启动shellcode。</li><li>Proofpoint观察到Bumblebee掉落Cobalt Strike，shellcode，Slimver和Meterpreter。</li><li>使用Bumblebee的威胁行为者与与后续勒索软件活动相关的恶意软件有效payload相关。</li></ul><h2 id="概述">概述</h2><p>​	从2022年3月开始，Proofpoint监测到了一个名为Bumblebee的新下载器的活动。包括已知的威胁行为者在内的至少三个活动集群目前正在使用BumbleBee。Proofpoint 识别的活动与 Google 威胁分析组博客中详述的导致 Conti 和 Diavol 勒索软件的活动重叠。</p><p>​	BumbleBee 是一个复杂的下载器，包含反虚拟化检测和通用下载器功能，尽管它目前还处于恶意软件开发的早期阶段。</p><p>​	Bumblebee 的目标是下载和执行额外的有效载荷。 Proofpoint 研究人员观察到 Bumblebee 丢弃了 Cobalt Strike、shellcode、Sliver 和 Meterpreter。恶意软件名称来自早期活动中使用的唯一User-Agent“bumblebee”。</p><p>​	BumbleBee 在威胁领域的增加与 BazaLoader 相吻合，BazaLoader 是一种常用的payloads加载器，可促进后续攻击，但在好像消失了–来自 Proofpoint 威胁数据。</p><h2 id="威胁详情">威胁详情</h2><p>​	Proofpoint 研究人员监测到 Bumblebee 被至少三个跟踪的威胁参与者分发到电子邮件活动中。 威胁攻击者使用多种技术来传播 Bumblebee。 虽然使用的诱饵、传递技术和文件名通常是针对分发活动的不同威胁攻击者组织定制的，但 Proofpoint 观察到活动之间的几个共同点，例如使用包含快捷方式文件和 DLL 的 ISO 文件以及多个参与者使用的通用 DLL 入口点。</p><h3 id="指向BumbleBee的URL和HTML文件">指向BumbleBee的URL和HTML文件</h3><p>​	2022年3月，Proofpoint 监测到一个附带有 DocuSign 品牌的钓鱼邮件，邮件内含两个链接，用于诱导收件人下载恶意ISO文件。一个是在邮件正文中的“查看此文档”超链接。当用户点击后，会跳转到托管在 OneDrive的是压缩文件（ISO）。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLgIg.png" srcset="/img/loading.gif" lazyload alt=""></p><p>另外一个是，邮件中还包含一个HTML附件，该HTML文件伪装成一个指向未支付订单的电子邮件。HTML附件中嵌入了可重定向的URL，它使用Prometheus TDS根据潜在受害者的时区和cookie过滤下载。重定向器反过来将用户定向到压缩文件，该文件也托管在OneDrive上。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLcdS.png" srcset="/img/loading.gif" lazyload alt=""></p><p>压缩文件内包含一个名为 <code>Invoice-32203.iso</code> 的ISO文件。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsL6Z8.png" srcset="/img/loading.gif" lazyload alt=""></p><p>ISO文件内包含名为 <code>Attachments.lnk</code> 快捷方式和 <code>Attachments.dat</code> 文件。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLRiQ.png" srcset="/img/loading.gif" lazyload alt=""></p><p>如果双击打开 Attachments.lnk 会执行 Attachments.dat (实际上是一个dll文件)，从而运行下载器 BumbleBee。</p><p>快捷方式 Attachments.lnk 的命令及进程攻击链：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmd.exe /c start /wait <span class="hljs-string">&quot;&quot;</span> <span class="hljs-string">&quot;C:\Users\[removed]\AppData\Local\Temp\ATTACHME.LNK&quot;</span><br>rundll32.exe <span class="hljs-string">&quot;C:\Windows\System32\rundll32.exe&quot;</span> Attachments.dat,IternalJob<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/08/20/vsLWGj.png" srcset="/img/loading.gif" lazyload alt=""></p><p>​	Proofpoint 研究人员确认这次攻击活动是有网络犯罪组织 TA579发起的。从2021年8月以来，Proofpoint一直在跟踪 TA579。该威胁行为者在过去的活动中经常提供 BazaLoader 和 IcedID。</p><h3 id="压缩的ISO附件包含BumbleBee导致进程被劫持">压缩的ISO附件包含BumbleBee导致进程被劫持</h3><p>​	2022年4月，Proofpoint监测到一个进程劫持攻击活动，该活动发送的电子邮件似乎是对带有恶意压缩ISO文件的现有安全电子邮件对话的回复。此活动中的所有附件名称都使用了<code>doc_invoice_[数字].zip</code>的形式进行命名。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLfRs.png" srcset="/img/loading.gif" lazyload alt=""></p><p>ISO文件位于带密码ZIP中，解压密码则已经写在邮件正文中。ISO含有两个文件，一个快捷方式和dll。当受害者双击打开快捷方式文件<code>DCOUNENT.LNK</code>时，会变相的通过cmd调用rundll32执行dll文件 <code>tar.dll</code> 从而启动BumbleBee下载器。</p><p>快捷方式 进程链：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsL5Mq.png" srcset="/img/loading.gif" lazyload alt=""></p><p>BumbleBee 攻击链：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLhzn.png" srcset="/img/loading.gif" lazyload alt=""></p><h3 id="联系表单-Stolen-Images-指向BumbleBee">联系表单&quot;Stolen Images&quot;指向BumbleBee</h3><p>2022年3月，Proofpoint 监测到一项活动，该活动通过向目标网站上的联系表格提交消息而生成电子邮件。 此外，根据网站“联系我们”部分的配置方式，提交的内容还在目标网站上留下了关于该主题的公众评论。 这些电子邮件据称声称网站上存在被盗图像。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLLi4.png" srcset="/img/loading.gif" lazyload alt=""></p><p>&quot;投诉&quot;表单包含了一个指向登录页面的超链接，点击该超链接会打开一个下载ISO文件的页面，该ISO文件内包含一个lnk(<code>DOCUMENT_STOLENIMAGES.LNK</code>)和dll(<code>neqe.dll</code>)文件。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLIs0.png" srcset="/img/loading.gif" lazyload alt="登录页面样式"></p><p>如果双击打开快捷方式文件，就会通过相应的参数执行<code>neqw.dll</code>从而启动 BumbleBee 加载器。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLoLV.png" srcset="/img/loading.gif" lazyload alt="指向BumbleBee的表单攻击链"></p><p>Proofpoint 将此活动归因于 TA578，这是 Proofpoint 研究人员自 2020 年 5 月以来一直在跟踪的威胁行为者。TA578 此前曾在基于电子邮件的活动中监测到，这些活动提供 Ursnif、IcedID、KPOT Stealer、Buer Loader、BazaLoader 和 Cobalt Strike。</p><h2 id="与其他恶意软件的关系">与其他恶意软件的关系</h2><p>​	多个威胁参与者正在使用BumbleBee，将其引入环境的时间及本报告中描述的行为可以被认为是网络犯罪威胁领域的转折点。此外，Proofpoint以适度的信心评估使用BumbleBee的攻击者可能被视为初始访问促进，即，渗透主要目标然后向后续勒索软件行为者出售访问权的独立网络犯罪组织。</p><p>​	至少三个被跟踪的通常传播 BazaLoader 恶意软件的威胁行为者已经过渡到 Bumblebee 有效载荷，BazaLoader 最后一次出现在 Proofpoint 数据中是在 2022 年 2 月。</p><p>​	BazaLoader 是 2020 年首次发现的第一阶段下载器，与包括 <a target="_blank" rel="noopener" href="https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/">Conti</a> 在内的后续勒索软件活动有关。 Proofpoint 研究人员最初监测到 BazaLoader 由主要有传播 Trick 银行木马的威胁行为者大量传播。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/92a5d907766d31d2.png" srcset="/img/loading.gif" lazyload alt="BazaLoader 和 Bumblebee 精选活动的时间表"></p><p>​	BazaLoader 从网络犯罪威胁领域的明显消失恰逢 Conti Leaks 发生的时间，2022 年 2 月末，一名有权访问 Conti 内部操作的乌克兰研究人员开始从网络犯罪组织泄露数据。 在泄露的文件中发现了与 BazaLoader 相关的基础设施。</p><h2 id="恶意软件分析">恶意软件分析</h2><p>BumbleBee 是一款用C++写的下载器。分析的初始BumBleBee DLL样本包含两个导出，一个是直接启动 Bumblebee 主函数的线程，另一个最终导致相同的主函数，但添加了检查钩子是否已放置在关键动态链接库 (DLL) 中，加载此 DLL 的 LNK 会跳过默认的 DllMain 函数，而是调用检查函数挂钩的导出。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLHdU.png" srcset="/img/loading.gif" lazyload alt="BumBleBee hook检查"></p><p>和大多数恶意软件不同，BumBleBee加载器的大部分内容都被压缩为一个方法函数，后面的初始化、请求发送和响应处理都被分解为不同的函数。该加载器首先复制有效作用僵尸网络标识符的GroupID，于大多数恶意软件不同，BumBleBee 目前以明文形式存储其配置，但在未来可能会增加混淆功能。复制GroupID后，加载器会解析各种NTDLL函数的地址，使其能够加载过程之后能正常执行注入。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsL7ZT.png" srcset="/img/loading.gif" lazyload alt="复制和设置GroupID"></p><p>一旦解析函数，就会创建一个独特的事件，该事件作用互斥以确保只有一个加载器示例正在运行。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLboF.png" srcset="/img/loading.gif" lazyload alt="创建事件"></p><p>此时，确认单个 Bumblebee 实例正在运行，恶意软件开始收集系统信息。 以下 WMI 查询通过 COM 对象执行以收集通信所需的详细信息：</p><ul><li>SELECT * FROM Win32_ComputerSystem</li><li>SELECT * FROM Win32_ComputerSystemProduct</li></ul><p>根据查询输出收集和连接系统的主机名和UUID，然后生成此值的MD5哈希并将其转换为十六进制的结果作为机器的唯一客户端ID。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLOJJ.png" srcset="/img/loading.gif" lazyload alt="创建客户端ID"></p><p>生成客户端ID后，加载器创建系统版本字符串，其中包括WMI查询的标题、主机的用户名和主机的域。</p><p>收集到所有这些信息后，加载器开始与 C2 通信，加载器每 25 秒检查一次 C2 以接收命令。和大多数具有立即返回给客户端的模块或有效负载的恶意软件不同，该恶意软件背后的攻击者似乎手动将有效负载部署到Bumblebee，因为它可能需要几个小时才能收到任何要执行的作业。每个服务器响应都包含下图中显示的数据的变体。如果返回有效任务，“tasks”值将是包含所有任务信息的字典列表。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLXW9.png" srcset="/img/loading.gif" lazyload alt="Bumblebee 响应内容"></p><p><em>Bumblebee</em> 加载器支持以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">Shi：shellcode 注入<br>Dij：DLL注入<br>Dex：下载执行文件<br>Sdl：卸载加载器<br>Ins：在目标上开启权限维持<br></code></pre></td></tr></table></figure><h3 id="Ins-命令">Ins 命令</h3><p>Ins 命令通过将 Bumblebee DLL 复制到 <code>%APPDATA%</code> 文件夹的子目录并创建将加载 DLL 的 VBS 脚本来启用权限维持，然后创建计划任务，通过 wscript.exe 调用 VBS 脚本。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLjzR.png" srcset="/img/loading.gif" lazyload alt="通过VBS加载DLL"></p><p><img src="https://s1.ax1x.com/2022/08/20/vsLxQ1.png" srcset="/img/loading.gif" lazyload alt="使用VBS创建计划任务"></p><h3 id="Dex-命令">Dex 命令</h3><p>Dex 命令是支持的命令中最基本命令，该命令从服务器响应中获取 base64 解码的内容，以硬编码路径将其写入磁盘并通过 COM 对象执行。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/895554bb6f668058.png" srcset="/img/loading.gif" lazyload alt="Dex命令输出"></p><h3 id="Dij-命令">Dij 命令</h3><p>Dij 命令增加了将 DLL 注入其他进程内存的能力，对于注入目标，恶意软件会选择三个硬编码选项之一来将 DLL 注入到ImagingDevices.exe、wab.exe 或 wabmig.exe。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLzsx.png" srcset="/img/loading.gif" lazyload alt="将可执行文件识别为注入目标"></p><p>选择一个随机可执行文件后，加载器会以挂起状态启动进程，使得恶意软件可以轻松操作该过程而不被发现。接下来，它通过启用调试权限来准备进程注入，以便注入执行所需的shellcode。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOSL6.png" srcset="/img/loading.gif" lazyload alt="创建新进程和启用调试权限"></p><p>设置适当的权限后，可以操作数据，加载器将shellcode写入挂起的进程，用新的入口点覆盖初始入口点，这个入口点实现写入32字节的shellcode，并将占位符替换为SleepEx的解析地址功能。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsO9eK.png" srcset="/img/loading.gif" lazyload alt="SleepEx替换占位符数值"></p><p>如下图所示，shellcode 程序集中的 <code>call RAX</code> 指令被替换为 SleepEx 的地址，延迟1000毫秒，shellcode 调用 SleepEx ，然后将 shellcode 注入到进程中，进程恢复。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOCdO.png" srcset="/img/loading.gif" lazyload alt="反汇编后的shellcode"></p><p>加载器通过 APC 例程将恶意负载注入到可执行文件中。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOPoD.png" srcset="/img/loading.gif" lazyload alt="通过APCj进行进程注入"></p><p>为了成功并正确的注入，加载器在注入目标中创建两个新部分，并将缓冲区从 dij 复制到新的内存空间，然后通过动态解析的 <code>NtQueueApcThread</code> 调用目标可执行文件中复制的内容。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOFFe.png" srcset="/img/loading.gif" lazyload alt="创建两个内存空间"></p><p><img src="https://s1.ax1x.com/2022/08/20/vsOkJH.png" srcset="/img/loading.gif" lazyload alt="调用动态解析的 NtQueueApcThread"></p><h3 id="恶意软件开发">恶意软件开发</h3><p>Proofpoint 研究人员监测到，在一月份的活动中，BumbleBee 开发人员为恶意软件添加了新功能，具体来说，包括反虚拟机和反沙盒检查。以下是较早的示例：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOAWd.png" srcset="/img/loading.gif" lazyload alt="旧版BumBleBee样本"></p><p>最新样本，更新了 BumbleBee 示例，添加了 check_bad_artifacts。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOVSA.png" srcset="/img/loading.gif" lazyload alt="最新BumBleBee样本"></p><p>通过研究新功能，我们发现了一个新的方法：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOZQI.png" srcset="/img/loading.gif" lazyload alt="反编译恶意软件的框架检查"></p><p>下图是 Al Khaser 工具的一部分，该工具是用于检查 VM 工件的常用工具，Bumblebee 加载器的开发人员似乎依赖开源工具，就像标准开发人员一样。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOmOP.png" srcset="/img/loading.gif" lazyload alt="来自 Al Khaser 的开源代码显示完全相同的检查"></p><h2 id="重大更新">重大更新</h2><p>Proofpoint 表示，在2022年4月19 日观察到的最新版本 BumbleBee 中，BumbleBee 功能发生了重大变化，现在支持通过逗号分隔列表支持多个 C2。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOeyt.png" srcset="/img/loading.gif" lazyload alt="多个嵌入式C2"></p><p>旧版中硬编码设置了睡眠时间 25秒，在新版本中已经改为了随机。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOuef.png" srcset="/img/loading.gif" lazyload alt="随机sleep"></p><p>该恶意软件最明显的变化是在网络通信中增加了一个加密层，开发人员通过RC4硬编码密钥添加到样本中，用于加密请求和解密响应。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/67da4f2856ce534f.png" srcset="/img/loading.gif" lazyload alt="加密请求内容"></p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/014ade3c194d2c5b.png" srcset="/img/loading.gif" lazyload alt="解密响应内容"></p><p>作为该组织的另一个标志，展示了他们快速的开发速度，4月22日，Proofpoint 监测到该组织向 BumbleBee 添加了一个新线程，该线程根据恶意软件分析师使用的常用工具的硬编码列表来检查当前正在运行的进程，该线程在 BumbleBee 进程开始时创建。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/528dc025cc56c9c2.png" srcset="/img/loading.gif" lazyload alt="Bumblebee 主函数显示新线程的开始"></p><p>如果找到这些进程中的任何一个，该函数将返回 1，这会触发 BumbleBee 主线程终止。</p><p><img src="https://s1.ax1x.com/2023/05/07/p9dNFeA.png" srcset="/img/loading.gif" lazyload alt="BumBleBee检查工具列表"></p><h2 id="结论">结论</h2><p>Bumblebee 是一个复杂的恶意软件加载程序，它展示了持续开发的证据， 它被多个网络犯罪威胁攻击者使用。 Proofpoint 高度自信地评估 BumbleBee 加载器可用作初始访问促进者，以提供后续有效负载，例如勒索软件。 根据它在威胁环境中出现的时间以及被多个网络犯罪团伙使用的时间，BumbleBee 很可能是BazaLoader 的直接替代品，那么它是一种新的多功能工具，由历史上偏爱其他恶意软件的行为者使用。</p><h3 id="通信样本">通信样本</h3><table><thead><tr><th>样本</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>c6ef53740f2011825dd531fc65d6eba92f87d0ed1b30207a9694c0218c10d6e0</td><td>SHA256</td><td>2022年3月31日至4月1日ISO 样本</td></tr><tr><td>a72538ba00dc95190d6919756ffce74f0b3cf60db387c6c9281a0dc892ded802</td><td>SHA256</td><td>2022年3月31日至4月1日样本</td></tr><tr><td>77f6cdf03ba70367c93ac194604175e2bd1239a29bc66da50b5754b7adbe8ae4</td><td>SHA256</td><td>2022年4月5日ISO样本</td></tr><tr><td>0faa970001791cb0013416177cefebb25fbff543859bd81536a3096ee8e79127</td><td>SHA256</td><td>2022年4月5日Bumblebee 样本</td></tr><tr><td>Fe7a64dad14fe240aa026e57615fc3a22a7f5ba1dd55d675b1d2072f6262a1</td><td>SHA256</td><td>2022年3月28日至4月1日ISO样本</td></tr><tr><td>08CD6983F183EF65EABD073C01F137A913282504E2502AC34A1BE3E599AC386B</td><td>SHA256</td><td>3月10日未混淆的Bumblebee 样本</td></tr></tbody></table></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%BD%AC%E8%BD%BD%E6%90%AC%E8%BF%90/" class="category-chain-item">转载搬运</a></span></span></div></div><div class="license-box my-3"><div class="license-title"><div>BumbleBee-大黄蜂</div><div>https://guosec.online/posts/de71e52e.html</div></div><div class="license-meta"><div class="license-meta-item license-meta-date"><div>Posted on</div><div>August 20, 2022</div></div><div class="license-meta-item license-meta-date"><div>Updated on</div><div>May 7, 2023</div></div><div class="license-meta-item"><div>Licensed under</div><div>本博客所有文章除特别声明外，均采用 <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-sa"></i> </span></a>&nbsp;协议，转载请注明出处！</div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/ee0c8274.html" title="阻止 WebRTC 泄露本地/真实 IP"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">阻止 WebRTC 泄露本地/真实 IP</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/posts/843d207e.html" title="炫龙毁灭者DD2换屏&amp;更新BIOS过程"><span class="hidden-mobile">炫龙毁灭者DD2换屏&amp;更新BIOS过程</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><i class="iconfont">Copyright </i><i class="iconfont icon-copyright"></i> <i class="iconfont">2022 InfoSec</i></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">京ICP证1236666号 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备125364257号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>